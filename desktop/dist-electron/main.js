"use strict";var fv=Object.defineProperty;var hv=(t,e,r)=>e in t?fv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var E=(t,e,r)=>hv(t,typeof e!="symbol"?e+"":e,r);const xt=require("electron"),cn=require("node:path"),pv=require("better-sqlite3"),ll=require("path");require("node:module");const dl=require("node:crypto"),mv=require("node:fs"),fl=require("fs"),gv=require("http"),_v=require("https"),tm=require("url"),fo=require("stream"),ou=require("util"),yv=require("crypto"),vv=require("querystring"),bv=require("buffer"),wv=require("string_decoder"),Ev=require("child_process"),Tv=require("fs/promises");function ho(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const Sv=ho(cn),Bt=ho(ll),sn=ho(mv),Jt=ho(Tv),xv=ll.join(xt.app.getPath("userData"),"redconvert.db"),Ii=new pv(xv),Iv=()=>{Ii.exec(`
    CREATE TABLE IF NOT EXISTS settings (
      id INTEGER PRIMARY KEY CHECK (id = 1),
      api_endpoint TEXT,
      api_key TEXT,
      model_name TEXT,
      role_mapping TEXT
    );
  `);try{Ii.exec("ALTER TABLE settings ADD COLUMN role_mapping TEXT;")}catch(t){t.message.includes("duplicate column name")}};Iv();const Av=t=>Ii.prepare(`
    INSERT INTO settings (id, api_endpoint, api_key, model_name, role_mapping)
    VALUES (1, @api_endpoint, @api_key, @model_name, @role_mapping)
    ON CONFLICT(id) DO UPDATE SET
      api_endpoint = @api_endpoint,
      api_key = @api_key,
      model_name = @model_name,
      role_mapping = @role_mapping
  `).run({...t,role_mapping:typeof t.role_mapping=="object"?JSON.stringify(t.role_mapping):t.role_mapping||"{}"}),rm=()=>Ii.prepare("SELECT * FROM settings WHERE id = 1").get();var Le;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function r(s){throw new Error}t.assertNever=r,t.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},t.getValidEnumValues=s=>{const a=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(a){return s[a]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},t.find=(s,a)=>{for(const i of s)if(a(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(Le||(Le={}));var Wd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Wd||(Wd={}));const ie=Le.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),an=t=>{switch(typeof t){case"undefined":return ie.undefined;case"string":return ie.string;case"number":return Number.isNaN(t)?ie.nan:ie.number;case"boolean":return ie.boolean;case"function":return ie.function;case"bigint":return ie.bigint;case"symbol":return ie.symbol;case"object":return Array.isArray(t)?ie.array:t===null?ie.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ie.promise:typeof Map<"u"&&t instanceof Map?ie.map:typeof Set<"u"&&t instanceof Set?ie.set:typeof Date<"u"&&t instanceof Date?ie.date:ie.object;default:return ie.unknown}},z=Le.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Vr extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){const r=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let o=n,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(r(i))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return s(this),n}static assert(e){if(!(e instanceof Vr))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Le.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const s of this.issues)if(s.path.length>0){const a=s.path[0];r[a]=r[a]||[],r[a].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Vr.create=t=>new Vr(t);const cu=(t,e)=>{let r;switch(t.code){case z.invalid_type:t.received===ie.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case z.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Le.jsonStringifyReplacer)}`;break;case z.unrecognized_keys:r=`Unrecognized key(s) in object: ${Le.joinValues(t.keys,", ")}`;break;case z.invalid_union:r="Invalid input";break;case z.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Le.joinValues(t.options)}`;break;case z.invalid_enum_value:r=`Invalid enum value. Expected ${Le.joinValues(t.options)}, received '${t.received}'`;break;case z.invalid_arguments:r="Invalid function arguments";break;case z.invalid_return_type:r="Invalid function return type";break;case z.invalid_date:r="Invalid date";break;case z.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Le.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case z.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case z.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case z.custom:r="Invalid input";break;case z.invalid_intersection_types:r="Intersection results could not be merged";break;case z.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case z.not_finite:r="Number must be finite";break;default:r=e.defaultError,Le.assertNever(t)}return{message:r}};let kv=cu;function Ov(){return kv}const Cv=t=>{const{data:e,path:r,errorMaps:n,issueData:s}=t,a=[...r,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const c=n.filter(u=>!!u).slice().reverse();for(const u of c)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}};function K(t,e){const r=Ov(),n=Cv({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===cu?void 0:cu].filter(s=>!!s)});t.common.issues.push(n)}class Zt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const s of r){if(s.status==="aborted")return Te;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const s of r){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return Zt.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const s of r){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return Te;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const Te=Object.freeze({status:"aborted"}),ks=t=>({status:"dirty",value:t}),Xt=t=>({status:"valid",value:t}),Jd=t=>t.status==="aborted",Kd=t=>t.status==="dirty",cs=t=>t.status==="valid",Ai=t=>typeof Promise<"u"&&t instanceof Promise;var oe;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(oe||(oe={}));class hn{constructor(e,r,n,s){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Xd=(t,e)=>{if(cs(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Vr(t.common.issues);return this._error=r,this._error}}};function ke(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:s}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{const{message:c}=t;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??n??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:c??r??o.defaultError}},description:s}}let $e=class{get description(){return this._def.description}_getType(e){return an(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:an(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Zt,ctx:{common:e.parent.common,data:e.data,parsedType:an(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(Ai(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:an(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Xd(n,s)}"~validate"(e){var n,s;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:an(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:r});return cs(a)?{value:a.value}:{issues:r.common.issues}}catch(a){(s=(n=a==null?void 0:a.message)==null?void 0:n.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(a=>cs(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:an(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(Ai(s)?s:Promise.resolve(s));return Xd(n,a)}refine(e,r){const n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:z.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(e){return new us({schema:this,typeName:M.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Or.create(this,this._def)}nullable(){return ls.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jn.create(this)}promise(){return $i.create(this,this._def)}or(e){return aa.create([this,e],this._def)}and(e){return Ni.create(this,e,this._def)}transform(e){return new us({...ke(this._def),schema:this,typeName:M.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new Ri({...ke(this._def),innerType:this,defaultValue:r,typeName:M.ZodDefault})}brand(){return new Qv({typeName:M.ZodBranded,type:this,...ke(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new pu({...ke(this._def),innerType:this,catchValue:r,typeName:M.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return hl.create(this,e)}readonly(){return mu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const Nv=/^c[^\s-]{8,}$/i,$v=/^[0-9a-z]+$/,Rv=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Pv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Lv=/^[a-z0-9_-]{21}$/i,Dv=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Mv=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,jv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Fv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let lc;const Uv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Bv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,zv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Zv=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Gv=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nm="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Vv=new RegExp(`^${nm}$`);function sm(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function Hv(t){return new RegExp(`^${sm(t)}$`)}function Wv(t){let e=`${nm}T${sm(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Jv(t,e){return!!((e==="v4"||!e)&&Uv.test(t)||(e==="v6"||!e)&&zv.test(t))}function Kv(t,e){if(!Dv.test(t))return!1;try{const[r]=t.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Xv(t,e){return!!((e==="v4"||!e)&&Bv.test(t)||(e==="v6"||!e)&&qv.test(t))}let ki=class Os extends $e{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ie.string){const a=this._getOrReturnCtx(e);return K(a,{code:z.invalid_type,expected:ie.string,received:a.parsedType}),Te}const n=new Zt;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:z.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:z.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?K(s,{code:z.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&K(s,{code:z.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")jv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"email",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")lc||(lc=new RegExp(Fv,"u")),lc.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"emoji",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")Pv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"uuid",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")Lv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"nanoid",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")Nv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")$v.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cuid2",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")Rv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ulid",code:z.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),K(s,{validation:"url",code:z.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"regex",code:z.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),K(s,{code:z.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:z.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),K(s,{code:z.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?Wv(a).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:z.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?Vv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:z.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?Hv(a).test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{code:z.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?Mv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"duration",code:z.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?Jv(e.data,a.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"ip",code:z.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?Kv(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"jwt",code:z.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?Xv(e.data,a.version)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"cidr",code:z.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?Zv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"base64",code:z.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?Gv.test(e.data)||(s=this._getOrReturnCtx(e,s),K(s,{validation:"base64url",code:z.invalid_string,message:a.message}),n.dirty()):Le.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(s=>e.test(s),{validation:r,code:z.invalid_string,...oe.errToObj(n)})}_addCheck(e){return new Os({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...oe.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...oe.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...oe.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...oe.errToObj(r)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new Os({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Os({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Os({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};ki.create=t=>new ki({checks:[],typeName:M.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...ke(t)});function Yv(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=r>n?r:n,a=Number.parseInt(t.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}let na=class uu extends $e{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ie.number){const a=this._getOrReturnCtx(e);return K(a,{code:z.invalid_type,expected:ie.number,received:a.parsedType}),Te}let n;const s=new Zt;for(const a of this._def.checks)a.kind==="int"?Le.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),K(n,{code:z.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:z.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:z.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Yv(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),K(n,{code:z.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),K(n,{code:z.not_finite,message:a.message}),s.dirty()):Le.assertNever(a);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,oe.toString(r))}gt(e,r){return this.setLimit("min",e,!1,oe.toString(r))}lte(e,r){return this.setLimit("max",e,!0,oe.toString(r))}lt(e,r){return this.setLimit("max",e,!1,oe.toString(r))}setLimit(e,r,n,s){return new uu({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:oe.toString(s)}]})}_addCheck(e){return new uu({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Le.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};na.create=t=>new na({checks:[],typeName:M.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...ke(t)});class sa extends $e{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ie.bigint)return this._getInvalidInput(e);let n;const s=new Zt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:z.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),K(n,{code:z.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),K(n,{code:z.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Le.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const r=this._getOrReturnCtx(e);return K(r,{code:z.invalid_type,expected:ie.bigint,received:r.parsedType}),Te}gte(e,r){return this.setLimit("min",e,!0,oe.toString(r))}gt(e,r){return this.setLimit("min",e,!1,oe.toString(r))}lte(e,r){return this.setLimit("max",e,!0,oe.toString(r))}lt(e,r){return this.setLimit("max",e,!1,oe.toString(r))}setLimit(e,r,n,s){return new sa({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:oe.toString(s)}]})}_addCheck(e){return new sa({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}sa.create=t=>new sa({checks:[],typeName:M.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...ke(t)});class Oi extends $e{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ie.boolean){const n=this._getOrReturnCtx(e);return K(n,{code:z.invalid_type,expected:ie.boolean,received:n.parsedType}),Te}return Xt(e.data)}}Oi.create=t=>new Oi({typeName:M.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...ke(t)});class Ci extends $e{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ie.date){const a=this._getOrReturnCtx(e);return K(a,{code:z.invalid_type,expected:ie.date,received:a.parsedType}),Te}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return K(a,{code:z.invalid_date}),Te}const n=new Zt;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:z.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),K(s,{code:z.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Le.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ci({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}Ci.create=t=>new Ci({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:M.ZodDate,...ke(t)});class Yd extends $e{_parse(e){if(this._getType(e)!==ie.symbol){const n=this._getOrReturnCtx(e);return K(n,{code:z.invalid_type,expected:ie.symbol,received:n.parsedType}),Te}return Xt(e.data)}}Yd.create=t=>new Yd({typeName:M.ZodSymbol,...ke(t)});class Qd extends $e{_parse(e){if(this._getType(e)!==ie.undefined){const n=this._getOrReturnCtx(e);return K(n,{code:z.invalid_type,expected:ie.undefined,received:n.parsedType}),Te}return Xt(e.data)}}Qd.create=t=>new Qd({typeName:M.ZodUndefined,...ke(t)});class ef extends $e{_parse(e){if(this._getType(e)!==ie.null){const n=this._getOrReturnCtx(e);return K(n,{code:z.invalid_type,expected:ie.null,received:n.parsedType}),Te}return Xt(e.data)}}ef.create=t=>new ef({typeName:M.ZodNull,...ke(t)});class lu extends $e{constructor(){super(...arguments),this._any=!0}_parse(e){return Xt(e.data)}}lu.create=t=>new lu({typeName:M.ZodAny,...ke(t)});let tf=class extends $e{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Xt(e.data)}};tf.create=t=>new tf({typeName:M.ZodUnknown,...ke(t)});let pn=class extends $e{_parse(e){const r=this._getOrReturnCtx(e);return K(r,{code:z.invalid_type,expected:ie.never,received:r.parsedType}),Te}};pn.create=t=>new pn({typeName:M.ZodNever,...ke(t)});class rf extends $e{_parse(e){if(this._getType(e)!==ie.undefined){const n=this._getOrReturnCtx(e);return K(n,{code:z.invalid_type,expected:ie.void,received:n.parsedType}),Te}return Xt(e.data)}}rf.create=t=>new rf({typeName:M.ZodVoid,...ke(t)});let jn=class hi extends $e{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),s=this._def;if(r.parsedType!==ie.array)return K(r,{code:z.invalid_type,expected:ie.array,received:r.parsedType}),Te;if(s.exactLength!==null){const i=r.data.length>s.exactLength.value,o=r.data.length<s.exactLength.value;(i||o)&&(K(r,{code:i?z.too_big:z.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(K(r,{code:z.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(K(r,{code:z.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,o)=>s.type._parseAsync(new hn(r,i,r.path,o)))).then(i=>Zt.mergeArray(n,i));const a=[...r.data].map((i,o)=>s.type._parseSync(new hn(r,i,r.path,o)));return Zt.mergeArray(n,a)}get element(){return this._def.type}min(e,r){return new hi({...this._def,minLength:{value:e,message:oe.toString(r)}})}max(e,r){return new hi({...this._def,maxLength:{value:e,message:oe.toString(r)}})}length(e,r){return new hi({...this._def,exactLength:{value:e,message:oe.toString(r)}})}nonempty(e){return this.min(1,e)}};jn.create=(t,e)=>new jn({type:t,minLength:null,maxLength:null,exactLength:null,typeName:M.ZodArray,...ke(e)});function Yn(t){if(t instanceof hr){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=Or.create(Yn(n))}return new hr({...t._def,shape:()=>e})}else return t instanceof jn?new jn({...t._def,type:Yn(t.element)}):t instanceof Or?Or.create(Yn(t.unwrap())):t instanceof ls?ls.create(Yn(t.unwrap())):t instanceof Fn?Fn.create(t.items.map(e=>Yn(e))):t}let hr=class ar extends $e{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Le.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==ie.object){const u=this._getOrReturnCtx(e);return K(u,{code:z.invalid_type,expected:ie.object,received:u.parsedType}),Te}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof pn&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const c=[];for(const u of i){const l=a[u],d=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new hn(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof pn){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")o.length>0&&(K(s,{code:z.unrecognized_keys,keys:o}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const d=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new hn(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of c){const d=await l.key,h=await l.value;u.push({key:d,value:h,alwaysSet:l.alwaysSet})}return u}).then(u=>Zt.mergeObjectSync(n,u)):Zt.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new ar({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var a,i;const s=((i=(a=this._def).errorMap)==null?void 0:i.call(a,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:oe.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new ar({...this._def,unknownKeys:"strip"})}passthrough(){return new ar({...this._def,unknownKeys:"passthrough"})}extend(e){return new ar({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ar({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:M.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new ar({...this._def,catchall:e})}pick(e){const r={};for(const n of Le.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new ar({...this._def,shape:()=>r})}omit(e){const r={};for(const n of Le.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new ar({...this._def,shape:()=>r})}deepPartial(){return Yn(this)}partial(e){const r={};for(const n of Le.objectKeys(this.shape)){const s=this.shape[n];e&&!e[n]?r[n]=s:r[n]=s.optional()}return new ar({...this._def,shape:()=>r})}required(e){const r={};for(const n of Le.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof Or;)a=a._def.innerType;r[n]=a}return new ar({...this._def,shape:()=>r})}keyof(){return am(Le.objectKeys(this.shape))}};hr.create=(t,e)=>new hr({shape:()=>t,unknownKeys:"strip",catchall:pn.create(),typeName:M.ZodObject,...ke(e)});hr.strictCreate=(t,e)=>new hr({shape:()=>t,unknownKeys:"strict",catchall:pn.create(),typeName:M.ZodObject,...ke(e)});hr.lazycreate=(t,e)=>new hr({shape:t,unknownKeys:"strip",catchall:pn.create(),typeName:M.ZodObject,...ke(e)});let aa=class extends $e{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new Vr(o.ctx.common.issues));return K(r,{code:z.invalid_union,unionErrors:i}),Te}if(r.common.async)return Promise.all(n.map(async a=>{const i={...r,common:{...r.common,issues:[]},parent:null};return{result:await a._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const c of n){const u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return r.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new Vr(c));return K(r,{code:z.invalid_union,unionErrors:o}),Te}}get options(){return this._def.options}};aa.create=(t,e)=>new aa({options:t,typeName:M.ZodUnion,...ke(e)});function du(t,e){const r=an(t),n=an(e);if(t===e)return{valid:!0,data:t};if(r===ie.object&&n===ie.object){const s=Le.objectKeys(e),a=Le.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(const o of a){const c=du(t[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(r===ie.array&&n===ie.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<t.length;a++){const i=t[a],o=e[a],c=du(i,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return r===ie.date&&n===ie.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}let Ni=class extends $e{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(Jd(a)||Jd(i))return Te;const o=du(a.value,i.value);return o.valid?((Kd(a)||Kd(i))&&r.dirty(),{status:r.value,value:o.data}):(K(n,{code:z.invalid_intersection_types}),Te)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Ni.create=(t,e,r)=>new Ni({left:t,right:e,typeName:M.ZodIntersection,...ke(r)});class Fn extends $e{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ie.array)return K(n,{code:z.invalid_type,expected:ie.array,received:n.parsedType}),Te;if(n.data.length<this._def.items.length)return K(n,{code:z.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Te;!this._def.rest&&n.data.length>this._def.items.length&&(K(n,{code:z.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const a=[...n.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new hn(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>Zt.mergeArray(r,i)):Zt.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new Fn({...this._def,rest:e})}}Fn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Fn({items:t,typeName:M.ZodTuple,rest:null,...ke(e)})};class nf extends $e{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ie.map)return K(n,{code:z.invalid_type,expected:ie.map,received:n.parsedType}),Te;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,c],u)=>({key:s._parse(new hn(n,o,n.path,[u,"key"])),value:a._parse(new hn(n,c,n.path,[u,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return Te;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(u.value,l.value)}return{status:r.value,value:o}})}else{const o=new Map;for(const c of i){const u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return Te;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(u.value,l.value)}return{status:r.value,value:o}}}}nf.create=(t,e,r)=>new nf({valueType:e,keyType:t,typeName:M.ZodMap,...ke(r)});class ia extends $e{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ie.set)return K(n,{code:z.invalid_type,expected:ie.set,received:n.parsedType}),Te;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(K(n,{code:z.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(K(n,{code:z.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());const a=this._def.valueType;function i(c){const u=new Set;for(const l of c){if(l.status==="aborted")return Te;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}const o=[...n.data.values()].map((c,u)=>a._parse(new hn(n,c,n.path,u)));return n.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,r){return new ia({...this._def,minSize:{value:e,message:oe.toString(r)}})}max(e,r){return new ia({...this._def,maxSize:{value:e,message:oe.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}ia.create=(t,e)=>new ia({valueType:t,minSize:null,maxSize:null,typeName:M.ZodSet,...ke(e)});class sf extends $e{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}sf.create=(t,e)=>new sf({getter:t,typeName:M.ZodLazy,...ke(e)});let fu=class extends $e{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return K(r,{received:r.data,code:z.invalid_literal,expected:this._def.value}),Te}return{status:"valid",value:e.data}}get value(){return this._def.value}};fu.create=(t,e)=>new fu({value:t,typeName:M.ZodLiteral,...ke(e)});function am(t,e){return new po({values:t,typeName:M.ZodEnum,...ke(e)})}let po=class hu extends $e{_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return K(r,{expected:Le.joinValues(n),received:r.parsedType,code:z.invalid_type}),Te}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return K(r,{received:r.data,code:z.invalid_enum_value,options:n}),Te}return Xt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return hu.create(e,{...this._def,...r})}exclude(e,r=this._def){return hu.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};po.create=am;class af extends $e{_parse(e){const r=Le.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==ie.string&&n.parsedType!==ie.number){const s=Le.objectValues(r);return K(n,{expected:Le.joinValues(s),received:n.parsedType,code:z.invalid_type}),Te}if(this._cache||(this._cache=new Set(Le.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=Le.objectValues(r);return K(n,{received:n.data,code:z.invalid_enum_value,options:s}),Te}return Xt(e.data)}get enum(){return this._def.values}}af.create=(t,e)=>new af({values:t,typeName:M.ZodNativeEnum,...ke(e)});class $i extends $e{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==ie.promise&&r.common.async===!1)return K(r,{code:z.invalid_type,expected:ie.promise,received:r.parsedType}),Te;const n=r.parsedType===ie.promise?r.data:Promise.resolve(r.data);return Xt(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}}$i.create=(t,e)=>new $i({type:t,typeName:M.ZodPromise,...ke(e)});class us extends $e{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===M.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{K(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(r.value==="aborted")return Te;const c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?Te:c.status==="dirty"||r.value==="dirty"?ks(c.value):c});{if(r.value==="aborted")return Te;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?Te:o.status==="dirty"||r.value==="dirty"?ks(o.value):o}}if(s.type==="refinement"){const i=o=>{const c=s.refinement(o,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Te:(o.status==="dirty"&&r.dirty(),i(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?Te:(o.status==="dirty"&&r.dirty(),i(o.value).then(()=>({status:r.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!cs(i))return Te;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>cs(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:r.value,value:o})):Te);Le.assertNever(s)}}us.create=(t,e,r)=>new us({schema:t,typeName:M.ZodEffects,effect:e,...ke(r)});us.createWithPreprocess=(t,e,r)=>new us({schema:e,effect:{type:"preprocess",transform:t},typeName:M.ZodEffects,...ke(r)});let Or=class extends $e{_parse(e){return this._getType(e)===ie.undefined?Xt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Or.create=(t,e)=>new Or({innerType:t,typeName:M.ZodOptional,...ke(e)});let ls=class extends $e{_parse(e){return this._getType(e)===ie.null?Xt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ls.create=(t,e)=>new ls({innerType:t,typeName:M.ZodNullable,...ke(e)});let Ri=class extends $e{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===ie.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Ri.create=(t,e)=>new Ri({innerType:t,typeName:M.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ke(e)});let pu=class extends $e{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Ai(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Vr(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Vr(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};pu.create=(t,e)=>new pu({innerType:t,typeName:M.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ke(e)});class of extends $e{_parse(e){if(this._getType(e)!==ie.nan){const n=this._getOrReturnCtx(e);return K(n,{code:z.invalid_type,expected:ie.nan,received:n.parsedType}),Te}return{status:"valid",value:e.data}}}of.create=t=>new of({typeName:M.ZodNaN,...ke(t)});class Qv extends $e{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class hl extends $e{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?Te:a.status==="dirty"?(r.dirty(),ks(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Te:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,r){return new hl({in:e,out:r,typeName:M.ZodPipeline})}}let mu=class extends $e{_parse(e){const r=this._def.innerType._parse(e),n=s=>(cs(s)&&(s.value=Object.freeze(s.value)),s);return Ai(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}};mu.create=(t,e)=>new mu({innerType:t,typeName:M.ZodReadonly,...ke(e)});var M;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(M||(M={}));const Kt=ki.create,oa=na.create,gu=Oi.create,cf=lu.create;pn.create;jn.create;const Lr=hr.create;aa.create;Ni.create;Fn.create;po.create;$i.create;Or.create;ls.create;var Cr=(t=>(t.Read="read",t.Edit="edit",t.Delete="delete",t.Execute="execute",t.Search="search",t.Fetch="fetch",t.Think="think",t.Other="other",t))(Cr||{}),gt=(t=>(t.INVALID_PARAMS="INVALID_PARAMS",t.EXECUTION_FAILED="EXECUTION_FAILED",t.PERMISSION_DENIED="PERMISSION_DENIED",t.FILE_NOT_FOUND="FILE_NOT_FOUND",t.TIMEOUT="TIMEOUT",t.CANCELLED="CANCELLED",t))(gt||{}),im=(t=>(t.ProceedOnce="proceed_once",t.ProceedAlways="proceed_always",t.Cancel="cancel",t))(im||{});class zn{constructor(){E(this,"requiresConfirmation",!1);E(this,"canStreamOutput",!1)}validate(e){const r=this.parameterSchema.safeParse(e);return r.success?this.validateValues(r.data):r.error.issues.map(n=>`${n.path.join(".")}: ${n.message}`).join("; ")}validateValues(e){return null}getConfirmationDetails(e){return null}getFunctionSchema(){return{name:this.name,description:this.description,parameters:pl(this.parameterSchema)}}}class eb{constructor(){E(this,"tools",new Map);E(this,"toolOrder",[])}registerTool(e){this.tools.has(e.name)&&console.warn(`Tool "${e.name}" already registered, will be overwritten.`),this.tools.set(e.name,e),this.toolOrder.includes(e.name)||this.toolOrder.push(e.name)}registerTools(e){for(const r of e)this.registerTool(r)}getTool(e){return this.tools.get(e)}getAllToolNames(){return this.toolOrder}getAllTools(){return this.toolOrder.map(e=>this.tools.get(e))}getToolSchemas(){return this.getAllTools().map(e=>e instanceof zn?e.getFunctionSchema():{name:e.name,description:e.description,parameters:pl(e.parameterSchema)})}getToolsByKind(e){return this.getAllTools().filter(r=>r.kind===e)}getToolsRequiringConfirmation(){return this.getAllTools().filter(e=>e.requiresConfirmation)}clear(){this.tools.clear(),this.toolOrder=[]}}function pl(t){const e={type:"object",properties:{},required:[]};if(t instanceof hr){const r=t.shape,n={},s=[];for(const[a,i]of Object.entries(r))n[a]=Cs(i),i instanceof Or||s.push(a);e.properties=n,e.required=s}return e}function Cs(t){var e;if(t instanceof Or||t instanceof Ri)return Cs(t._def.innerType);if(t instanceof ki){const r={type:"string"};return t.description&&(r.description=t.description),r}if(t instanceof na){const r={type:"number"};return t.description&&(r.description=t.description),r}if(t instanceof na&&((e=t._def.checks)!=null&&e.some(r=>r.kind==="int")))return{type:"integer"};if(t instanceof Oi)return{type:"boolean"};if(t instanceof jn)return{type:"array",items:Cs(t._def.type)};if(t instanceof po)return{type:"string",enum:t._def.values};if(t instanceof aa)return{oneOf:t._def.options.map(r=>Cs(r))};if(t instanceof fu){const r=t._def.value;return{type:typeof r,const:r}}return t instanceof hr?pl(t):{}}function Un(t,e){return{success:!0,llmContent:t,display:e??t}}function ze(t,e){return{success:!1,llmContent:`Error: ${t}`,error:{message:t,type:e??"EXECUTION_FAILED"}}}class tb{constructor(e,r,n=new Set){this.registry=e,this.onConfirmRequest=r,this.autoConfirmTools=n}async execute(e,r,n){var l;const s=Date.now(),{callId:a,name:i,params:o}=e,c=this.registry.getTool(i);if(!c)return{callId:a,name:i,result:ze(`Tool "${i}" not found`),durationMs:Date.now()-s};const u=c.validate(o);if(u)return{callId:a,name:i,result:ze(`Invalid parameters: ${u}`,"INVALID_PARAMS"),durationMs:Date.now()-s};if(c.requiresConfirmation&&!this.autoConfirmTools.has(i)){const d=(l=c.getConfirmationDetails)==null?void 0:l.call(c,o);if(d&&this.onConfirmRequest){const h=await this.onConfirmRequest(a,c,o,d);if(h==="cancel")return{callId:a,name:i,result:ze("Tool execution cancelled by user","CANCELLED"),durationMs:Date.now()-s};h==="proceed_always"&&this.autoConfirmTools.add(i)}}try{const d=await c.execute(o,r,n);return{callId:a,name:i,result:d,durationMs:Date.now()-s}}catch(d){if(r.aborted)return{callId:a,name:i,result:ze("Tool execution aborted","CANCELLED"),durationMs:Date.now()-s};const h=d instanceof Error?d.message:String(d);return{callId:a,name:i,result:ze(h,"EXECUTION_FAILED"),durationMs:Date.now()-s}}}async executeMany(e,r){return Promise.all(e.map(n=>this.execute(n,r)))}setAutoConfirmTool(e,r){r?this.autoConfirmTools.add(e):this.autoConfirmTools.delete(e)}}var rb=Object.defineProperty,om=(t,e)=>{for(var r in e)rb(t,r,{get:e[r],enumerable:!0})},nb=Object.defineProperty,Ne=(t,e)=>{for(var r in e)nb(t,r,{get:e[r],enumerable:!0})},Se=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ml(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var sb=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const ab=ml(sb);var cm={exports:{}};const ib=/[\p{Lu}]/u,ob=/[\p{Ll}]/u,uf=/^[\p{Lu}](?![\p{Lu}])/gu,um=/([\p{Alpha}\p{N}_]|$)/u,lm=/[_.\- ]+/,cb=new RegExp("^"+lm.source),lf=new RegExp(lm.source+um.source,"gu"),df=new RegExp("\\d+"+um.source,"gu"),ub=(t,e,r)=>{let n=!1,s=!1,a=!1;for(let i=0;i<t.length;i++){const o=t[i];n&&ib.test(o)?(t=t.slice(0,i)+"-"+t.slice(i),n=!1,a=s,s=!0,i++):s&&a&&ob.test(o)?(t=t.slice(0,i-1)+"-"+t.slice(i-1),a=s,s=!1,n=!0):(n=e(o)===o&&r(o)!==o,a=s,s=r(o)===o&&e(o)!==o)}return t},lb=(t,e)=>(uf.lastIndex=0,t.replace(uf,r=>e(r))),db=(t,e)=>(lf.lastIndex=0,df.lastIndex=0,t.replace(lf,(r,n)=>e(n)).replace(df,r=>e(r))),dm=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const r=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?n(t):r(t):(t!==r(t)&&(t=ub(t,r,n)),t=t.replace(cb,""),e.preserveConsecutiveUppercase?t=lb(t,r):t=r(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),db(t,n))};cm.exports=dm;cm.exports.default=dm;function fb(t,e){return(e==null?void 0:e[t])||ab(t)}function hb(t,e,r){const n={};for(const s in t)Object.hasOwn(t,s)&&(n[e(s,r)]=t[s]);return n}const fm="__lc_escaped__";function pb(t){return"lc"in t||Object.keys(t).length===1&&fm in t}function mb(t){return{[fm]:t}}function gb(t){return t!==null&&typeof t=="object"&&"lc_serializable"in t&&typeof t.toJSON=="function"}function _b(t){var r;let e;return t!==null&&typeof t=="object"?"lc_id"in t&&Array.isArray(t.lc_id)?e=t.lc_id:e=[((r=t.constructor)==null?void 0:r.name)??"Object"]:e=[typeof t],{lc:1,type:"not_implemented",id:e}}function _u(t,e=new WeakSet){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){if(e.has(t))return _b(t);if(gb(t))return t;e.add(t);const r=t;if(pb(r))return e.delete(t),mb(r);const n={};for(const[s,a]of Object.entries(r))n[s]=_u(a,e);return e.delete(t),n}return Array.isArray(t)?t.map(r=>_u(r,e)):t}var yb={};Ne(yb,{Serializable:()=>ds,get_lc_unique_name:()=>gl});function ff(t){return Array.isArray(t)?[...t]:{...t}}function vb(t,e){const r=ff(t);for(const[n,s]of Object.entries(e)){const[a,...i]=n.split(".").reverse();let o=r;for(const c of i.reverse()){if(o[c]===void 0)break;o[c]=ff(o[c]),o=o[c]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return r}function gl(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}var ds=class hm{constructor(e,...r){E(this,"lc_serializable",!1);E(this,"lc_kwargs");this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,gl(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof hm||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},r={},n=Object.keys(this.lc_kwargs).reduce((c,u)=>(c[u]=u in this?this[u]:this.lc_kwargs[u],c),{});for(let c=Object.getPrototypeOf(this);c;c=Object.getPrototypeOf(c))Object.assign(e,Reflect.get(c,"lc_aliases",this)),Object.assign(r,Reflect.get(c,"lc_secrets",this)),Object.assign(n,Reflect.get(c,"lc_attributes",this));Object.keys(r).forEach(c=>{let u=this,l=n;const[d,...h]=c.split(".").reverse();for(const f of h.reverse()){if(!(f in u)||u[f]===void 0)return;(!(f in l)||l[f]===void 0)&&(typeof u[f]=="object"&&u[f]!=null?l[f]={}:Array.isArray(u[f])&&(l[f]=[])),u=u[f],l=l[f]}d in u&&u[d]!==void 0&&(l[d]=l[d]||u[d])});const s={},a=new WeakSet;a.add(this);for(const[c,u]of Object.entries(n))s[c]=_u(u,a);const i=Object.keys(r).length?vb(s,r):s,o=hb(i,fb,e);return{lc:1,type:"constructor",id:this.lc_id,kwargs:o}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Rr(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")}function _l(t){return Rr(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"}function yl(t){return Rr(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"}function bb(t){return Rr(t)&&t.source_type==="text"&&"text"in t&&typeof t.text=="string"}function pm(t){return Rr(t)&&t.source_type==="id"&&"id"in t&&typeof t.id=="string"}function mm(t){if(Rr(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function yu(t){const e=t.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${t}" - does not match type/subtype format.`);const r=e[0].trim(),n=e[1].trim();if(r===""||n==="")throw new Error(`Invalid mime type: "${t}" - type or subtype is empty.`);const s={};for(const a of t.split(";").slice(1)){const i=a.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${t}".`);const o=i[0].trim(),c=i[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${t}".`);s[o]=c}return{type:r,subtype:n,parameters:s}}function ca({dataUrl:t,asTypedArray:e=!1}){const r=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let n;if(r){n=r[1].toLowerCase();const s=e?Uint8Array.from(atob(r[2]),a=>a.charCodeAt(0)):r[2];return{mime_type:n,data:s}}}function vl(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)}function fe(t,e){return we(t)&&t.type===e}function we(t){return typeof t=="object"&&t!==null}function fr(t){return Array.isArray(t)}function V(t){return typeof t=="string"}function or(t){return typeof t=="number"}function bl(t){return t instanceof Uint8Array}function hf(t){try{return JSON.parse(t)}catch{return}}const ua=t=>t();function wb(t){if(t.type==="char_location"&&V(t.document_title)&&or(t.start_char_index)&&or(t.end_char_index)&&V(t.cited_text)){const{document_title:e,start_char_index:r,end_char_index:n,cited_text:s,...a}=t;return{...a,type:"citation",source:"char",title:e??void 0,startIndex:r,endIndex:n,citedText:s}}if(t.type==="page_location"&&V(t.document_title)&&or(t.start_page_number)&&or(t.end_page_number)&&V(t.cited_text)){const{document_title:e,start_page_number:r,end_page_number:n,cited_text:s,...a}=t;return{...a,type:"citation",source:"page",title:e??void 0,startIndex:r,endIndex:n,citedText:s}}if(t.type==="content_block_location"&&V(t.document_title)&&or(t.start_block_index)&&or(t.end_block_index)&&V(t.cited_text)){const{document_title:e,start_block_index:r,end_block_index:n,cited_text:s,...a}=t;return{...a,type:"citation",source:"block",title:e??void 0,startIndex:r,endIndex:n,citedText:s}}if(t.type==="web_search_result_location"&&V(t.url)&&V(t.title)&&V(t.encrypted_index)&&V(t.cited_text)){const{url:e,title:r,encrypted_index:n,cited_text:s,...a}=t;return{...a,type:"citation",source:"url",url:e,title:r,startIndex:Number(n),endIndex:Number(n),citedText:s}}if(t.type==="search_result_location"&&V(t.source)&&V(t.title)&&or(t.start_block_index)&&or(t.end_block_index)&&V(t.cited_text)){const{source:e,title:r,start_block_index:n,end_block_index:s,cited_text:a,...i}=t;return{...i,type:"citation",source:"search",url:e,title:r??void 0,startIndex:n,endIndex:s,citedText:a}}}function gm(t){if(fe(t,"document")&&we(t.source)&&"type"in t.source){if(t.source.type==="base64"&&V(t.source.media_type)&&V(t.source.data))return{type:"file",mimeType:t.source.media_type,data:t.source.data};if(t.source.type==="url"&&V(t.source.url))return{type:"file",url:t.source.url};if(t.source.type==="file"&&V(t.source.file_id))return{type:"file",fileId:t.source.file_id};if(t.source.type==="text"&&V(t.source.data))return{type:"file",mimeType:String(t.source.media_type??"text/plain"),data:t.source.data}}else if(fe(t,"image")&&we(t.source)&&"type"in t.source){if(t.source.type==="base64"&&V(t.source.media_type)&&V(t.source.data))return{type:"image",mimeType:t.source.media_type,data:t.source.data};if(t.source.type==="url"&&V(t.source.url))return{type:"image",url:t.source.url};if(t.source.type==="file"&&V(t.source.file_id))return{type:"image",fileId:t.source.file_id}}}function Eb(t){function*e(){for(const r of t){const n=gm(r);n?yield n:yield r}}return Array.from(e())}function pf(t){function*e(){var n;const r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const s of r){if(fe(s,"text")&&V(s.text)){const{text:a,citations:i,...o}=s;if(fr(i)&&i.length){const c=i.reduce((u,l)=>{const d=wb(l);return d?[...u,d]:u},[]);yield{...o,type:"text",text:a,annotations:c};continue}else{yield{...o,type:"text",text:a};continue}}else if(fe(s,"thinking")&&V(s.thinking)){const{thinking:a,signature:i,...o}=s;yield{...o,type:"reasoning",reasoning:a,signature:i};continue}else if(fe(s,"redacted_thinking")){yield{type:"non_standard",value:s};continue}else if(fe(s,"tool_use")&&V(s.name)&&V(s.id)){yield{type:"tool_call",id:s.id,name:s.name,args:s.input};continue}else if(fe(s,"input_json_delta")){if(Sb(t)&&((n=t.tool_call_chunks)!=null&&n.length)){const a=t.tool_call_chunks[0];yield{type:"tool_call_chunk",id:a.id,name:a.name,args:a.args,index:a.index};continue}}else if(fe(s,"server_tool_use")&&V(s.name)&&V(s.id)){const{name:a,id:i}=s;if(a==="web_search"){const o=ua(()=>{if(typeof s.input=="string")return s.input;if(we(s.input)&&V(s.input.query))return s.input.query;if(V(s.partial_json)){const c=hf(s.partial_json);if(c!=null&&c.query)return c.query}return""});yield{id:i,type:"server_tool_call",name:"web_search",args:{query:o}};continue}else if(s.name==="code_execution"){const o=ua(()=>{if(typeof s.input=="string")return s.input;if(we(s.input)&&V(s.input.code))return s.input.code;if(V(s.partial_json)){const c=hf(s.partial_json);if(c!=null&&c.code)return c.code}return""});yield{id:i,type:"server_tool_call",name:"code_execution",args:{code:o}};continue}}else if(fe(s,"web_search_tool_result")&&V(s.tool_use_id)&&fr(s.content)){const{content:a,tool_use_id:i}=s,o=a.reduce((c,u)=>fe(u,"web_search_result")?[...c,u.url]:c,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:i,status:"success",output:{urls:o}};continue}else if(fe(s,"code_execution_tool_result")&&V(s.tool_use_id)&&we(s.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:s.tool_use_id,status:"success",output:s.content};continue}else if(fe(s,"mcp_tool_use")){yield{id:s.id,type:"server_tool_call",name:"mcp_tool_use",args:s.input};continue}else if(fe(s,"mcp_tool_result")&&V(s.tool_use_id)&&we(s.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:s.tool_use_id,status:"success",output:s.content};continue}else if(fe(s,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:s.input};continue}else if(fe(s,"search_result")){yield{id:s.id,type:"non_standard",value:s};continue}else if(fe(s,"tool_result")){yield{id:s.id,type:"non_standard",value:s};continue}else{const a=gm(s);if(a){yield a;continue}}yield{type:"non_standard",value:s}}}return Array.from(e())}const Tb={translateContent:pf,translateContentChunk:pf};function Sb(t){return typeof(t==null?void 0:t._getType)=="function"&&typeof t.concat=="function"&&t._getType()==="ai"}function xb(t){return _l(t)?{type:t.type,mimeType:t.mime_type,url:t.url,metadata:t.metadata}:yl(t)?{type:t.type,mimeType:t.mime_type??"application/octet-stream",data:t.data,metadata:t.metadata}:pm(t)?{type:t.type,mimeType:t.mime_type,fileId:t.id,metadata:t.metadata}:t}function Ib(t){return t.map(xb)}function Ab(t){return!!(fe(t,"image_url")&&we(t.image_url)||fe(t,"input_audio")&&we(t.input_audio)||fe(t,"file")&&we(t.file))}function kb(t){if(fe(t,"image_url")&&we(t.image_url)&&V(t.image_url.url)){const e=ca({dataUrl:t.image_url.url});return e?{type:"image",mimeType:e.mime_type,data:e.data}:{type:"image",url:t.image_url.url}}else{if(fe(t,"input_audio")&&we(t.input_audio)&&V(t.input_audio.data)&&V(t.input_audio.format))return{type:"audio",data:t.input_audio.data,mimeType:`audio/${t.input_audio.format}`};if(fe(t,"file")&&we(t.file)&&V(t.file.data)){const e=ca({dataUrl:t.file.data});if(e)return{type:"file",data:e.data,mimeType:e.mime_type};if(V(t.file.file_id))return{type:"file",fileId:t.file.file_id}}}return t}function Ob(t){const e=[];typeof t.content=="string"?e.push({type:"text",text:t.content}):e.push(...wl(t.content));for(const r of t.tool_calls??[])e.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return e}function Cb(t){const e=[];typeof t.content=="string"?e.push({type:"text",text:t.content}):e.push(...wl(t.content));for(const r of t.tool_calls??[])e.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return e}function wl(t){const e=[];for(const r of t)Ab(r)?e.push(kb(r)):e.push(r);return e}function Nb(t){if(t.type==="url_citation"){const{url:e,title:r,start_index:n,end_index:s}=t;return{type:"citation",url:e,title:r,startIndex:n,endIndex:s}}if(t.type==="file_citation"){const{file_id:e,filename:r,index:n}=t;return{type:"citation",title:r,startIndex:n,endIndex:n,fileId:e}}return t}function _m(t){function*e(){var n;we((n=t.additional_kwargs)==null?void 0:n.reasoning)&&fr(t.additional_kwargs.reasoning.summary)&&(yield{type:"reasoning",reasoning:t.additional_kwargs.reasoning.summary.reduce((a,i)=>we(i)&&V(i.text)?`${a}${i.text}`:a,"")});const r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const s of r)if(fe(s,"text")){const{text:a,annotations:i,...o}=s;Array.isArray(i)?yield{...o,type:"text",text:String(a),annotations:i.map(Nb)}:yield{...o,type:"text",text:String(a)}}for(const s of t.tool_calls??[])yield{type:"tool_call",id:s.id,name:s.name,args:s.args};if(we(t.additional_kwargs)&&fr(t.additional_kwargs.tool_outputs))for(const s of t.additional_kwargs.tool_outputs){if(fe(s,"web_search_call")){yield{id:s.id,type:"server_tool_call",name:"web_search",args:{query:s.query}};continue}else if(fe(s,"file_search_call")){yield{id:s.id,type:"server_tool_call",name:"file_search",args:{query:s.query}};continue}else if(fe(s,"computer_call")){yield{type:"non_standard",value:s};continue}else if(fe(s,"code_interpreter_call")){if(V(s.code)&&(yield{id:s.id,type:"server_tool_call",name:"code_interpreter",args:{code:s.code}}),fr(s.outputs)){const a=ua(()=>{if(s.status!=="in_progress"){if(s.status==="completed")return 0;if(s.status==="incomplete")return 127;if(s.status!=="interpreting"&&s.status==="failed")return 1}});for(const i of s.outputs)if(fe(i,"logs")){yield{type:"server_tool_call_result",toolCallId:s.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:a??0,stderr:[0,void 0].includes(a)?void 0:String(i.logs),stdout:[0,void 0].includes(a)?String(i.logs):void 0}};continue}}continue}else if(fe(s,"mcp_call")){yield{id:s.id,type:"server_tool_call",name:"mcp_call",args:s.input};continue}else if(fe(s,"mcp_list_tools")){yield{id:s.id,type:"server_tool_call",name:"mcp_list_tools",args:s.input};continue}else if(fe(s,"mcp_approval_request")){yield{type:"non_standard",value:s};continue}else if(fe(s,"image_generation_call")){yield{type:"non_standard",value:s};continue}we(s)&&(yield{type:"non_standard",value:s})}}return Array.from(e())}function $b(t){function*e(){yield*_m(t);for(const r of t.tool_call_chunks??[])yield{type:"tool_call_chunk",id:r.id,name:r.name,args:r.args}}return Array.from(e())}const Rb={translateContent:t=>typeof t.content=="string"?Ob(t):_m(t),translateContentChunk:t=>typeof t.content=="string"?Cb(t):$b(t)};function ym(t){return typeof t=="object"&&t!==null&&"type"in t&&"content"in t&&(typeof t.content=="string"||Array.isArray(t.content))}function Pb(t,e="pretty"){return e==="pretty"?Lb(t):JSON.stringify(t)}function Lb(t){const e=[],r=` ${t.type.charAt(0).toUpperCase()+t.type.slice(1)} Message `,n=Math.floor((80-r.length)/2),s="=".repeat(n),a=r.length%2===0?s:`${s}=`;if(e.push(`${s}${r}${a}`),t.type==="ai"){const i=t;if(i.tool_calls&&i.tool_calls.length>0){e.push("Tool Calls:");for(const o of i.tool_calls){e.push(`  ${o.name} (${o.id})`),e.push(` Call ID: ${o.id}`),e.push("  Args:");for(const[c,u]of Object.entries(o.args))e.push(`    ${c}: ${typeof u=="object"?JSON.stringify(u):u}`)}}}if(t.type==="tool"){const i=t;i.name&&e.push(`Name: ${i.name}`)}return typeof t.content=="string"&&t.content.trim()&&(e.length>1&&e.push(""),e.push(t.content)),e.join(`
`)}const dc=Symbol.for("langchain.message");function Hr(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.length===0?t:Array.isArray(e)&&e.some(r=>Rr(r))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?ba(t,e)??[...t,...e]:e===""?t:Array.isArray(t)&&t.some(r=>Rr(r))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function vm(t,e){return t==="error"||e==="error"?"error":"success"}function Db(t,e){function r(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>r(i,s+1));const a={};for(const i of Object.keys(n))a[i]=r(n[i],s+1);return a}return JSON.stringify(r(t,0),null,2)}var em,Xr=class extends ds{constructor(e){const r=typeof e=="string"||Array.isArray(e)?{content:e}:e;r.additional_kwargs||(r.additional_kwargs={}),r.response_metadata||(r.response_metadata={});super(r);E(this,"lc_namespace",["langchain_core","messages"]);E(this,"lc_serializable",!0);E(this,em,!0);E(this,"id");E(this,"name");E(this,"content");E(this,"additional_kwargs");E(this,"response_metadata");this.name=r.name,r.content===void 0&&r.contentBlocks!==void 0?(this.content=r.contentBlocks,this.response_metadata={output_version:"v1",...r.response_metadata}):r.content!==void 0?(this.content=r.content??[],this.response_metadata=r.response_metadata):(this.content=[],this.response_metadata=r.response_metadata),this.additional_kwargs=r.additional_kwargs,this.id=r.id}get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}_getType(){return this.type}getType(){return this._getType()}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}get contentBlocks(){const e=typeof this.content=="string"?[{type:"text",text:this.content}]:this.content;return[Ib,wl,Eb].reduce((s,a)=>a(s),e)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return typeof e=="object"&&e!==null&&dc in e&&e[dc]===!0&&ym(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[(em=dc,Symbol.toStringTag)](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const r=Db(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${r}`}toFormattedString(e="pretty"){return Pb(this,e)}};function Mb(t){return Array.isArray(t)&&t.every(e=>typeof e.index=="number")}const bm=["index","created","timestamp"];function vt(t,e,r){const n=(r==null?void 0:r.ignoreKeys)??bm;if(t===void 0&&e===void 0)return;if(t===void 0||e===void 0)return t??e;const s={...t};for(const[a,i]of Object.entries(e))if(s[a]==null)s[a]=i;else{if(i==null)continue;if(typeof s[a]!=typeof i||Array.isArray(s[a])!==Array.isArray(i))throw new Error(`field[${a}] already exists in the message chunk, but with a different type.`);if(typeof s[a]=="string"){if(a==="type")continue;if(["id","name","output_version","model_provider"].includes(a))i&&(s[a]=i);else{if(n.includes(a))continue;s[a]+=i}}else if(typeof s[a]=="number"){if(n.includes(a))continue;s[a]=s[a]+i}else if(typeof s[a]=="object"&&!Array.isArray(s[a]))s[a]=vt(s[a],i,r);else if(Array.isArray(s[a]))s[a]=ba(s[a],i,r);else{if(s[a]===i)continue;console.warn(`field[${a}] already exists in this message chunk and value has unsupported type.`)}}return s}function ba(t,e,r){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const n=[...t];for(const s of e)if(typeof s=="object"&&s!==null&&"index"in s&&typeof s.index=="number"){const a=n.findIndex(i=>{const o=typeof i=="object",c="index"in i&&i.index===s.index,u="id"in i&&"id"in s&&(i==null?void 0:i.id)===(s==null?void 0:s.id),l=!("id"in i)||!(i!=null&&i.id)||!("id"in s)||!(s!=null&&s.id);return o&&c&&(u||l)});a!==-1&&typeof n[a]=="object"&&n[a]!==null?n[a]=vt(n[a],s,r):n.push(s)}else{if(typeof s=="object"&&s!==null&&"text"in s&&s.text==="")continue;n.push(s)}return n}}}function wm(t,e,r){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t??e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return ba(t,e,r);if(typeof t=="object"&&typeof e=="object")return vt(t,e,r);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}}var vn=class Em extends Xr{static isInstance(e){if(!super.isInstance(e))return!1;let r=Object.getPrototypeOf(e);for(;r!==null;){if(r===Em.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}};function Tm(t){return typeof t.role=="string"}function un(t){return typeof(t==null?void 0:t._getType)=="function"}function El(t){return vn.isInstance(t)}var jb={};Ne(jb,{ToolMessage:()=>pr,ToolMessageChunk:()=>wa,defaultToolCallParser:()=>Sl,isDirectToolOutput:()=>Tl,isToolMessage:()=>Sm,isToolMessageChunk:()=>xm});function Tl(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0}var pr=class extends Xr{constructor(e,r,n){const s=typeof e=="string"||Array.isArray(e)?{content:e,name:n,tool_call_id:r}:e;super(s);E(this,"lc_direct_tool_output",!0);E(this,"type","tool");E(this,"status");E(this,"tool_call_id");E(this,"metadata");E(this,"artifact");this.tool_call_id=s.tool_call_id,this.artifact=s.artifact,this.status=s.status,this.metadata=s.metadata}static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}static isInstance(e){return super.isInstance(e)&&e.type==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},wa=class extends vn{constructor(e){super(e);E(this,"type","tool");E(this,"tool_call_id");E(this,"status");E(this,"artifact");this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){const r=this.constructor;return new r({content:Hr(this.content,e.content),additional_kwargs:vt(this.additional_kwargs,e.additional_kwargs),response_metadata:vt(this.response_metadata,e.response_metadata),artifact:wm(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:vm(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function Sl(t){const e=[],r=[];for(const n of t)if(n.function){const s=n.function.name;try{const a=JSON.parse(n.function.arguments);e.push({name:s||"",args:a||{},id:n.id})}catch{r.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,r]}function Sm(t){return typeof t=="object"&&t!==null&&"getType"in t&&typeof t.getType=="function"&&t.getType()==="tool"}function xm(t){return t._getType()==="tool"}function Gs(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}function Fb(t){return!!(t&&typeof t=="object"&&"toolCall"in t&&t.toolCall!=null&&typeof t.toolCall=="object"&&"id"in t.toolCall&&typeof t.toolCall.id=="string")}var Pi=class extends Error{constructor(e,r){super(e);E(this,"output");this.output=r}};function Im(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,t}function vu(t,e=mo){t=t.trim();const r=t.indexOf("```");if(r===-1)return e(t);let n=t.substring(r+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));const s=n.indexOf("```");let a=n;return s!==-1&&(a=n.substring(0,s)),e(a.trim())}function Ub(t){try{return JSON.parse(t)}catch{}const e=t.trim();if(e.length===0)throw new Error("Unexpected end of JSON input");let r=0;function n(){for(;r<e.length&&/\s/.test(e[r]);)r+=1}function s(){if(e[r]!=='"')throw new Error(`Expected '"' at position ${r}, got '${e[r]}'`);r+=1;let l="",d=!1;for(;r<e.length;){const h=e[r];if(d){if(h==="n")l+=`
`;else if(h==="t")l+="	";else if(h==="r")l+="\r";else if(h==="\\")l+="\\";else if(h==='"')l+='"';else if(h==="b")l+="\b";else if(h==="f")l+="\f";else if(h==="/")l+="/";else if(h==="u"){const f=e.substring(r+1,r+5);if(/^[0-9A-Fa-f]{0,4}$/.test(f))f.length===4?l+=String.fromCharCode(Number.parseInt(f,16)):l+=`u${f}`,r+=f.length;else throw new Error(`Invalid unicode escape sequence '\\u${f}' at position ${r}`)}else throw new Error(`Invalid escape sequence '\\${h}' at position ${r}`);d=!1}else if(h==="\\")d=!0;else{if(h==='"')return r+=1,l;l+=h}r+=1}return d&&(l+="\\"),l}function a(){const l=r;let d="";if(e[r]==="-"&&(d+="-",r+=1),r<e.length&&e[r]==="0"&&(d+="0",r+=1,e[r]>="0"&&e[r]<="9"))throw new Error(`Invalid number at position ${l}`);if(r<e.length&&e[r]>="1"&&e[r]<="9")for(;r<e.length&&e[r]>="0"&&e[r]<="9";)d+=e[r],r+=1;if(r<e.length&&e[r]===".")for(d+=".",r+=1;r<e.length&&e[r]>="0"&&e[r]<="9";)d+=e[r],r+=1;if(r<e.length&&(e[r]==="e"||e[r]==="E"))for(d+=e[r],r+=1,r<e.length&&(e[r]==="+"||e[r]==="-")&&(d+=e[r],r+=1);r<e.length&&e[r]>="0"&&e[r]<="9";)d+=e[r],r+=1;if(d==="-")return-0;const h=Number.parseFloat(d);if(Number.isNaN(h))throw r=l,new Error(`Invalid number '${d}' at position ${l}`);return h}function i(){if(n(),r>=e.length)throw new Error(`Unexpected end of input at position ${r}`);const l=e[r];if(l==="{")return c();if(l==="[")return o();if(l==='"')return s();if("null".startsWith(e.substring(r,r+4)))return r+=Math.min(4,e.length-r),null;if("true".startsWith(e.substring(r,r+4)))return r+=Math.min(4,e.length-r),!0;if("false".startsWith(e.substring(r,r+5)))return r+=Math.min(5,e.length-r),!1;if(l==="-"||l>="0"&&l<="9")return a();throw new Error(`Unexpected character '${l}' at position ${r}`)}function o(){if(e[r]!=="[")throw new Error(`Expected '[' at position ${r}, got '${e[r]}'`);const l=[];if(r+=1,n(),r>=e.length)return l;if(e[r]==="]")return r+=1,l;for(;r<e.length;){if(n(),r>=e.length||(l.push(i()),n(),r>=e.length))return l;if(e[r]==="]")return r+=1,l;if(e[r]===","){r+=1;continue}throw new Error(`Expected ',' or ']' at position ${r}, got '${e[r]}'`)}return l}function c(){if(e[r]!=="{")throw new Error(`Expected '{' at position ${r}, got '${e[r]}'`);const l={};if(r+=1,n(),r>=e.length)return l;if(e[r]==="}")return r+=1,l;for(;r<e.length;){if(n(),r>=e.length)return l;const d=s();if(n(),r>=e.length)return l;if(e[r]!==":")throw new Error(`Expected ':' at position ${r}, got '${e[r]}'`);if(r+=1,n(),r>=e.length||(l[d]=i(),n(),r>=e.length))return l;if(e[r]==="}")return r+=1,l;if(e[r]===","){r+=1;continue}throw new Error(`Expected ',' or '}' at position ${r}, got '${e[r]}'`)}return l}const u=i();if(n(),r<e.length)throw new Error(`Unexpected character '${e[r]}' at position ${r}`);return u}function mo(t){try{return typeof t>"u"?null:Ub(t)}catch{return null}}var qn=class Am extends Xr{constructor(r,n){(typeof r=="string"||Array.isArray(r))&&(r={content:r,role:n});super(r);E(this,"type","generic");E(this,"role");this.role=r.role}static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Am}static isInstance(r){return super.isInstance(r)&&r.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Ea=class extends vn{constructor(e,r){(typeof e=="string"||Array.isArray(e))&&(e={content:e,role:r});super(e);E(this,"type","generic");E(this,"role");this.role=e.role}static lc_name(){return"ChatMessageChunk"}concat(e){const r=this.constructor;return new r({content:Hr(this.content,e.content),additional_kwargs:vt(this.additional_kwargs,e.additional_kwargs),response_metadata:vt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}};function Bb(t){return t._getType()==="generic"}function zb(t){return t._getType()==="generic"}var go=class extends Xr{constructor(e){super(e);E(this,"type","function");E(this,"name");this.name=e.name}static lc_name(){return"FunctionMessage"}},Ta=class extends vn{constructor(){super(...arguments);E(this,"type","function")}static lc_name(){return"FunctionMessageChunk"}concat(e){const r=this.constructor;return new r({content:Hr(this.content,e.content),additional_kwargs:vt(this.additional_kwargs,e.additional_kwargs),response_metadata:vt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function qb(t){return t._getType()==="function"}function Zb(t){return t._getType()==="function"}var Dr=class extends Xr{constructor(e){super(e);E(this,"type","human")}static lc_name(){return"HumanMessage"}static isInstance(e){return super.isInstance(e)&&e.type==="human"}},Sa=class extends vn{constructor(e){super(e);E(this,"type","human")}static lc_name(){return"HumanMessageChunk"}concat(e){const r=this.constructor;return new r({content:Hr(this.content,e.content),additional_kwargs:vt(this.additional_kwargs,e.additional_kwargs),response_metadata:vt(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="human"}};function Gb(t){return t.getType()==="human"}function Vb(t){return t.getType()==="human"}var Li=class extends Xr{constructor(e){super({...e,content:[]});E(this,"type","remove");E(this,"id");this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&e.type==="remove"}},Wr=class pi extends Xr{constructor(r){super(r);E(this,"type","system")}static lc_name(){return"SystemMessage"}concat(r){if(typeof r=="string")return new pi({...this,content:Hr(this.content,r)});if(pi.isInstance(r))return new pi({...this,additional_kwargs:{...this.additional_kwargs,...r.additional_kwargs},response_metadata:{...this.response_metadata,...r.response_metadata},content:Hr(this.content,r.content)});throw new Error("Unexpected chunk type for system message")}static isInstance(r){return super.isInstance(r)&&r.type==="system"}},mn=class extends vn{constructor(e){super(e);E(this,"type","system")}static lc_name(){return"SystemMessageChunk"}concat(e){const r=this.constructor;return new r({content:Hr(this.content,e.content),additional_kwargs:vt(this.additional_kwargs,e.additional_kwargs),response_metadata:vt(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="system"}};function Hb(t){return t._getType()==="system"}function Wb(t){return t._getType()==="system"}function xl(t){switch(t){case"csv":return"text/csv";case"doc":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function Jb(t){if(we(t.document)&&we(t.document.source)){const e=we(t.document)&&V(t.document.format)?t.document.format:"",r=xl(e);if(we(t.document.source)){if(we(t.document.source.s3Location)&&V(t.document.source.s3Location.uri))return{type:"file",mimeType:r,fileId:t.document.source.s3Location.uri};if(bl(t.document.source.bytes))return{type:"file",mimeType:r,data:t.document.source.bytes};if(V(t.document.source.text))return{type:"file",mimeType:r,data:Buffer.from(t.document.source.text).toString("base64")};if(fr(t.document.source.content)){const n=t.document.source.content.reduce((s,a)=>we(a)&&V(a.text)?s+a.text:s,"");return{type:"file",mimeType:r,data:n}}}}return{type:"non_standard",value:t}}function Kb(t){if(fe(t,"image")&&we(t.image)){const e=we(t.image)&&V(t.image.format)?t.image.format:"",r=xl(e);if(we(t.image.source)){if(we(t.image.source.s3Location)&&V(t.image.source.s3Location.uri))return{type:"image",mimeType:r,fileId:t.image.source.s3Location.uri};if(bl(t.image.source.bytes))return{type:"image",mimeType:r,data:t.image.source.bytes}}}return{type:"non_standard",value:t}}function Xb(t){if(fe(t,"video")&&we(t.video)){const e=we(t.video)&&V(t.video.format)?t.video.format:"",r=xl(e);if(we(t.video.source)){if(we(t.video.source.s3Location)&&V(t.video.source.s3Location.uri))return{type:"video",mimeType:r,fileId:t.video.source.s3Location.uri};if(bl(t.video.source.bytes))return{type:"video",mimeType:r,data:t.video.source.bytes}}}return{type:"non_standard",value:t}}function mf(t){function*e(){const r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const n of r){if(fe(n,"cache_point")){yield{type:"non_standard",value:n};continue}else if(fe(n,"citations_content")&&we(n.citationsContent)){const s=fr(n.citationsContent.content)?n.citationsContent.content.reduce((i,o)=>we(o)&&V(o.text)?i+o.text:i,""):"",a=fr(n.citationsContent.citations)?n.citationsContent.citations.reduce((i,o)=>{if(we(o)){const c=fr(o.sourceContent)?o.sourceContent.reduce((l,d)=>we(d)&&V(d.text)?l+d.text:l,""):"",u=ua(()=>{if(we(o.location)){const l=o.location.documentChar||o.location.documentPage||o.location.documentChunk;if(we(l))return{source:or(l.documentIndex)?l.documentIndex.toString():void 0,startIndex:or(l.start)?l.start:void 0,endIndex:or(l.end)?l.end:void 0}}return{}});i.push({type:"citation",citedText:c,...u})}return i},[]):[];yield{type:"text",text:s,annotations:a};continue}else if(fe(n,"document")&&we(n.document)){yield Jb(n);continue}else if(fe(n,"guard_content")){yield{type:"non_standard",value:n};continue}else if(fe(n,"image")&&we(n.image)){yield Kb(n);continue}else if(fe(n,"reasoning_content")&&V(n.reasoningText)){yield{type:"reasoning",reasoning:n.reasoningText};continue}else if(fe(n,"text")&&V(n.text)){yield{type:"text",text:n.text};continue}else if(fe(n,"tool_result")){yield{type:"non_standard",value:n};continue}else{if(fe(n,"tool_call"))continue;if(fe(n,"video")&&we(n.video)){yield Xb(n);continue}}yield{type:"non_standard",value:n}}}return Array.from(e())}const Yb={translateContent:mf,translateContentChunk:mf};function gf(t){var n;const e=[],r=(n=t.additional_kwargs)==null?void 0:n.reasoning_content;if(V(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(const s of t.content)typeof s=="object"&&"type"in s&&s.type==="text"&&"text"in s&&V(s.text)&&e.push({type:"text",text:s.text});for(const s of t.tool_calls??[])e.push({type:"tool_call",id:s.id,name:s.name,args:s.args});return e}const Qb={translateContent:gf,translateContentChunk:gf};function _f(t){function*e(){const r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const n of r){if(fe(n,"text")&&V(n.text)){yield{type:"text",text:n.text};continue}else if(fe(n,"thinking")&&V(n.thinking)){yield{type:"reasoning",reasoning:n.thinking,...n.signature?{signature:n.signature}:{}};continue}else if(fe(n,"inlineData")&&we(n.inlineData)&&V(n.inlineData.mimeType)&&V(n.inlineData.data)){yield{type:"file",mimeType:n.inlineData.mimeType,data:n.inlineData.data};continue}else if(fe(n,"functionCall")&&we(n.functionCall)&&V(n.functionCall.name)&&we(n.functionCall.args)){yield{type:"tool_call",id:t.id,name:n.functionCall.name,args:n.functionCall.args};continue}else if(fe(n,"functionResponse")){yield{type:"non_standard",value:n};continue}else if(fe(n,"fileData")&&we(n.fileData)&&V(n.fileData.mimeType)&&V(n.fileData.fileUri)){yield{type:"file",mimeType:n.fileData.mimeType,fileId:n.fileData.fileUri};continue}else if(fe(n,"executableCode")){yield{type:"non_standard",value:n};continue}else if(fe(n,"codeExecutionResult")){yield{type:"non_standard",value:n};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}const ew={translateContent:_f,translateContentChunk:_f};function yf(t){function*e(){const r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const n of r){if(fe(n,"reasoning")&&V(n.reasoning)){const s=ua(()=>{var i;const a=r.indexOf(n);if(fr((i=t.additional_kwargs)==null?void 0:i.signatures)&&a>=0)return t.additional_kwargs.signatures.at(a)});V(s)?yield{type:"reasoning",reasoning:n.reasoning,signature:s}:yield{type:"reasoning",reasoning:n.reasoning};continue}else if(fe(n,"thinking")&&V(n.thinking)){yield{type:"reasoning",reasoning:n.thinking,...n.signature?{signature:n.signature}:{}};continue}else if(fe(n,"text")&&V(n.text)){yield{type:"text",text:n.text};continue}else if(fe(n,"image_url")){if(V(n.image_url))if(n.image_url.startsWith("data:")){const s=/^data:([^;]+);base64,(.+)$/,a=n.image_url.match(s);a?yield{type:"image",data:a[2],mimeType:a[1]}:yield{type:"image",url:n.image_url}}else yield{type:"image",url:n.image_url};continue}else if(fe(n,"media")&&V(n.mimeType)&&V(n.data)){yield{type:"file",mimeType:n.mimeType,data:n.data};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}const tw={translateContent:yf,translateContentChunk:yf};function vf(t){var n;const e=[],r=(n=t.additional_kwargs)==null?void 0:n.reasoning;if(V(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string"){let s=t.content;const a=s.match(/<think>([\s\S]*?)<\/think>/);if(a){const i=a[1].trim();i.length>0&&e.push({type:"reasoning",reasoning:i}),s=s.replace(/<think>[\s\S]*?<\/think>/,"").trim()}s.length>0&&e.push({type:"text",text:s})}else for(const s of t.content)if(typeof s=="object"&&"type"in s&&s.type==="text"&&"text"in s&&V(s.text)){let a=s.text;const i=a.match(/<think>([\s\S]*?)<\/think>/);if(i){const o=i[1].trim();o.length>0&&e.push({type:"reasoning",reasoning:o}),a=a.replace(/<think>[\s\S]*?<\/think>/,"").trim()}a.length>0&&e.push({type:"text",text:a})}for(const s of t.tool_calls??[])e.push({type:"tool_call",id:s.id,name:s.name,args:s.args});return e}const rw={translateContent:vf,translateContentChunk:vf};function bf(t){var n;const e=[],r=(n=t.additional_kwargs)==null?void 0:n.reasoning_content;if(V(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(const s of t.content)typeof s=="object"&&"type"in s&&s.type==="text"&&"text"in s&&V(s.text)&&e.push({type:"text",text:s.text});for(const s of t.tool_calls??[])e.push({type:"tool_call",id:s.id,name:s.name,args:s.args});return e}const nw={translateContent:bf,translateContentChunk:bf};function wf(t){var n,s;const e=[];if(we((n=t.additional_kwargs)==null?void 0:n.reasoning)){const a=t.additional_kwargs.reasoning;if(fr(a.summary)){const i=a.summary.reduce((o,c)=>we(c)&&V(c.text)?`${o}${c.text}`:o,"");i.length>0&&e.push({type:"reasoning",reasoning:i})}}const r=(s=t.additional_kwargs)==null?void 0:s.reasoning_content;if(V(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(const a of t.content)typeof a=="object"&&"type"in a&&a.type==="text"&&"text"in a&&V(a.text)&&e.push({type:"text",text:a.text});for(const a of t.tool_calls??[])e.push({type:"tool_call",id:a.id,name:a.name,args:a.args});return e}const sw={translateContent:wf,translateContentChunk:wf};globalThis.lc_block_translators_registry??(globalThis.lc_block_translators_registry=new Map([["anthropic",Tb],["bedrock-converse",Yb],["deepseek",Qb],["google-genai",ew],["google-vertexai",tw],["groq",rw],["ollama",nw],["openai",Rb],["xai",sw]]));function km(t){return globalThis.lc_block_translators_registry.get(t)}function Om(t,e){return vt(t,e)??{}}function Cm(t,e){const r={};return((t==null?void 0:t.audio)!==void 0||(e==null?void 0:e.audio)!==void 0)&&(r.audio=((t==null?void 0:t.audio)??0)+((e==null?void 0:e.audio)??0)),((t==null?void 0:t.image)!==void 0||(e==null?void 0:e.image)!==void 0)&&(r.image=((t==null?void 0:t.image)??0)+((e==null?void 0:e.image)??0)),((t==null?void 0:t.video)!==void 0||(e==null?void 0:e.video)!==void 0)&&(r.video=((t==null?void 0:t.video)??0)+((e==null?void 0:e.video)??0)),((t==null?void 0:t.document)!==void 0||(e==null?void 0:e.document)!==void 0)&&(r.document=((t==null?void 0:t.document)??0)+((e==null?void 0:e.document)??0)),((t==null?void 0:t.text)!==void 0||(e==null?void 0:e.text)!==void 0)&&(r.text=((t==null?void 0:t.text)??0)+((e==null?void 0:e.text)??0)),r}function aw(t,e){const r={...Cm(t,e)};return((t==null?void 0:t.cache_read)!==void 0||(e==null?void 0:e.cache_read)!==void 0)&&(r.cache_read=((t==null?void 0:t.cache_read)??0)+((e==null?void 0:e.cache_read)??0)),((t==null?void 0:t.cache_creation)!==void 0||(e==null?void 0:e.cache_creation)!==void 0)&&(r.cache_creation=((t==null?void 0:t.cache_creation)??0)+((e==null?void 0:e.cache_creation)??0)),r}function iw(t,e){const r={...Cm(t,e)};return((t==null?void 0:t.reasoning)!==void 0||(e==null?void 0:e.reasoning)!==void 0)&&(r.reasoning=((t==null?void 0:t.reasoning)??0)+((e==null?void 0:e.reasoning)??0)),r}function Il(t,e){return{input_tokens:((t==null?void 0:t.input_tokens)??0)+((e==null?void 0:e.input_tokens)??0),output_tokens:((t==null?void 0:t.output_tokens)??0)+((e==null?void 0:e.output_tokens)??0),total_tokens:((t==null?void 0:t.total_tokens)??0)+((e==null?void 0:e.total_tokens)??0),input_token_details:aw(t==null?void 0:t.input_token_details,e==null?void 0:e.input_token_details),output_token_details:iw(t==null?void 0:t.output_token_details,e==null?void 0:e.output_token_details)}}var It=class extends Xr{constructor(e){var n;let r;if(typeof e=="string"||Array.isArray(e))r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{r=e;const s=(n=r.additional_kwargs)==null?void 0:n.tool_calls,a=r.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `pnpm install @langchain/anthropic`,","pnpm install @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){const[i,o]=Sl(s);r.tool_calls=i??[],r.invalid_tool_calls=o??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}if(r.response_metadata!==void 0&&"output_version"in r.response_metadata&&r.response_metadata.output_version==="v1"&&(r.contentBlocks=r.content,r.content=void 0),r.contentBlocks!==void 0){r.tool_calls&&r.contentBlocks.push(...r.tool_calls.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})));const i=r.contentBlocks.filter(o=>o.type==="tool_call").filter(o=>{var c;return!((c=r.tool_calls)!=null&&c.some(u=>u.id===o.id&&u.name===o.name))});i.length>0&&(r.tool_calls=i.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})))}}super(r);E(this,"type","ai");E(this,"tool_calls",[]);E(this,"invalid_tool_calls",[]);E(this,"usage_metadata");typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const r=km(this.response_metadata.model_provider);if(r)return r.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls){const r=this.tool_calls.filter(n=>!e.some(s=>s.id===n.id&&s.name===n.name));e.push(...r.map(n=>({type:"tool_call",id:n.id,name:n.name,args:n.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};function _o(t){return t._getType()==="ai"}function bu(t){return t._getType()==="ai"}var Mr=class extends vn{constructor(e){let r;if(typeof e=="string"||Array.isArray(e))r={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)r={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=$m(e.tool_call_chunks??[]);r={...e,tool_call_chunks:n.tool_call_chunks,tool_calls:n.tool_calls,invalid_tool_calls:n.invalid_tool_calls,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(r);E(this,"type","ai");E(this,"tool_calls",[]);E(this,"invalid_tool_calls",[]);E(this,"tool_call_chunks",[]);E(this,"usage_metadata");this.tool_call_chunks=r.tool_call_chunks??this.tool_call_chunks,this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=r.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const r=km(this.response_metadata.model_provider);if(r)return r.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls&&typeof this.content!="string"){const r=this.content.filter(n=>n.type==="tool_call").map(n=>n.id);for(const n of this.tool_calls)n.id&&!r.includes(n.id)&&e.push({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const r={content:Hr(this.content,e.content),additional_kwargs:vt(this.additional_kwargs,e.additional_kwargs),response_metadata:Om(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const s=ba(this.tool_call_chunks,e.tool_call_chunks);s!==void 0&&s.length>0&&(r.tool_call_chunks=s)}(this.usage_metadata!==void 0||e.usage_metadata!==void 0)&&(r.usage_metadata=Il(this.usage_metadata,e.usage_metadata));const n=this.constructor;return new n(r)}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};const Nm=t=>t();function ow(t){return Gs(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function cw(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function fc(t){let e,r;if(cw(t)){const n=t.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",r=t.kwargs}else{const{type:n,...s}=t;e=n,r=s}if(e==="human"||e==="user")return new Dr(r);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=r;if(!Array.isArray(n))return new It(r);const a=n.map(ow);return new It({...s,tool_calls:a})}else{if(e==="system")return new Wr(r);if(e==="developer")return new Wr({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in r)return new pr({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});if(e==="remove"&&"id"in r&&typeof r.id=="string")return new Li({...r,id:r.id});throw Im(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Vs(t){if(typeof t=="string")return new Dr(t);if(un(t))return t;if(Array.isArray(t)){const[e,r]=t;return fc({type:e,content:r})}else if(Tm(t)){const{role:e,...r}=t;return fc({...r,type:e})}else return fc(t)}function Al(t,e="Human",r="AI"){const n=[];for(const s of t){let a;if(s.type==="human")a=e;else if(s.type==="ai")a=r;else if(s.type==="system")a="System";else if(s.type==="tool")a="Tool";else if(s.type==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s.type}`);const i=s.name?`${s.name}, `:"",o=s.text;let c=`${a}: ${i}${o}`;if(s.type==="ai"){const u=s;u.tool_calls&&u.tool_calls.length>0?c+=JSON.stringify(u.tool_calls):u.additional_kwargs&&"function_call"in u.additional_kwargs&&(c+=JSON.stringify(u.additional_kwargs.function_call))}n.push(c)}return n.join(`
`)}function uw(t){if(t.data!==void 0)return t;{const e=t;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function kl(t){const e=uw(t);switch(e.type){case"human":return new Dr(e.data);case"ai":return new It(e.data);case"system":return new Wr(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new go(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new pr(e.data);case"generic":if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new qn(e.data);default:throw new Error(`Got unexpected type: ${e.type}`)}}function lw(t){return t.map(kl)}function dw(t){return t.map(e=>e.toDict())}function Di(t){var r;const e=t._getType();if(e==="human")return new Sa({...t});if(e==="ai"){let n={...t};return"tool_calls"in n&&(n={...n,tool_call_chunks:(r=n.tool_calls)==null?void 0:r.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new Mr({...n})}else{if(e==="system")return new mn({...t});if(e==="function")return new Ta({...t});if(qn.isInstance(t))return new Ea({...t});throw new Error("Unknown message type.")}}function $m(t){var s,a;const e=t.reduce((i,o)=>{const c=i.findIndex(([u])=>"id"in o&&o.id&&"index"in o&&o.index!==void 0?o.id===u.id&&o.index===u.index:"id"in o&&o.id?o.id===u.id:"index"in o&&o.index!==void 0?o.index===u.index:!1);return c!==-1?i[c].push(o):i.push([o]),i},[]),r=[],n=[];for(const i of e){let o=null;const c=((s=i[0])==null?void 0:s.name)??"",u=i.map(h=>h.args||"").join("").trim(),l=u.length?u:"{}",d=(a=i[0])==null?void 0:a.id;try{if(o=mo(l),!d||o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");r.push({name:c,args:o,id:d,type:"tool_call"})}catch{n.push({name:c,args:l,id:d,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:t,tool_calls:r,invalid_tool_calls:n}}var fw={};Ne(fw,{getEnv:()=>Ol,getEnvironmentVariable:()=>Nr,getRuntimeEnvironment:()=>Mm,isBrowser:()=>Rm,isDeno:()=>yo,isJsDom:()=>Lm,isNode:()=>Dm,isWebWorker:()=>Pm});const Rm=()=>typeof window<"u"&&typeof window.document<"u",Pm=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Lm=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),yo=()=>typeof Deno<"u",Dm=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!yo(),Ol=()=>{let t;return Rm()?t="browser":Dm()?t="node":Pm()?t="webworker":Lm()?t="jsdom":yo()?t="deno":t="other",t};let hc;function Mm(){return hc===void 0&&(hc={library:"langchain-js",runtime:Ol()}),hc}function Nr(t){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[t]:yo()?Deno==null?void 0:Deno.env.get(t):void 0}catch{return}}const hw=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Hs(t){return typeof t=="string"&&hw.test(t)}function pw(t){if(!Hs(t))throw TypeError("Invalid UUID");let e;const r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}const dt=[];for(let t=0;t<256;++t)dt.push((t+256).toString(16).slice(1));function Cl(t,e=0){return(dt[t[e+0]]+dt[t[e+1]]+dt[t[e+2]]+dt[t[e+3]]+"-"+dt[t[e+4]]+dt[t[e+5]]+"-"+dt[t[e+6]]+dt[t[e+7]]+"-"+dt[t[e+8]]+dt[t[e+9]]+"-"+dt[t[e+10]]+dt[t[e+11]]+dt[t[e+12]]+dt[t[e+13]]+dt[t[e+14]]+dt[t[e+15]]).toLowerCase()}const mi=new Uint8Array(256);let Ua=mi.length;function jm(){return Ua>mi.length-16&&(dl.randomFillSync(mi),Ua=0),mi.slice(Ua,Ua+=16)}function mw(t){t=unescape(encodeURIComponent(t));const e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}const gw="6ba7b810-9dad-11d1-80b4-00c04fd430c8",_w="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function yw(t,e,r){function n(s,a,i,o){var c;if(typeof s=="string"&&(s=mw(s)),typeof a=="string"&&(a=pw(a)),((c=a)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+s.length);if(u.set(a),u.set(s,a.length),u=r(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,i){o=o||0;for(let l=0;l<16;++l)i[o+l]=u[l];return i}return Cl(u)}try{n.name=t}catch{}return n.DNS=gw,n.URL=_w,n}const Ef={randomUUID:dl.randomUUID};function An(t,e,r){if(Ef.randomUUID&&!t)return Ef.randomUUID();t=t||{};const n=t.random||(t.rng||jm)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Cl(n)}function vw(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),dl.createHash("sha1").update(t).digest()}const Ns=yw("v5",80,vw);let Tf=null,Sf=null,Yt=0;function on(t,e,r){t=t||{};let n=0;const s=new Uint8Array(16),a=t.random||(t.rng||jm)(),i=t.msecs!==void 0?t.msecs:Date.now();let o=t.seq!==void 0?t.seq:null,c=Sf,u=Tf;return i>Yt&&t.msecs===void 0&&(Yt=i,o!==null&&(c=null,u=null)),o!==null&&(o>2147483647&&(o=2147483647),c=o>>>19&4095,u=o&524287),(c===null||u===null)&&(c=a[6]&127,c=c<<8|a[7],u=a[8]&63,u=u<<8|a[9],u=u<<5|a[10]>>>3),i+1e4>Yt&&o===null?++u>524287&&(u=0,++c>4095&&(c=0,Yt++)):Yt=i,Sf=c,Tf=u,s[n++]=Yt/1099511627776&255,s[n++]=Yt/4294967296&255,s[n++]=Yt/16777216&255,s[n++]=Yt/65536&255,s[n++]=Yt/256&255,s[n++]=Yt&255,s[n++]=c>>>4&15|112,s[n++]=c&255,s[n++]=u>>>13&63|128,s[n++]=u>>>5&255,s[n++]=u<<3&255|a[10]&7,s[n++]=a[11],s[n++]=a[12],s[n++]=a[13],s[n++]=a[14],s[n++]=a[15],e||Cl(s)}var bw={};Ne(bw,{BaseCallbackHandler:()=>xa,callbackHandlerPrefersStreaming:()=>Nl,isBaseCallbackHandler:()=>Fm});var ww=class{};function Nl(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}var xa=class extends ww{constructor(e){super();E(this,"lc_serializable",!1);E(this,"lc_kwargs");E(this,"ignoreLLM",!1);E(this,"ignoreChain",!1);E(this,"ignoreAgent",!1);E(this,"ignoreRetriever",!1);E(this,"ignoreCustomEvent",!1);E(this,"raiseError",!1);E(this,"awaitHandlers",Nr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false");this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,gl(this.constructor)]}copy(){return new this.constructor(this)}toJSON(){return ds.prototype.toJSON.call(this)}toJSONNotImplemented(){return ds.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends xa{constructor(){super();E(this,"name",on());Object.assign(this,e)}}return new r}};const Fm=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},Ew="gen_ai.operation.name",Tw="gen_ai.system",xf="gen_ai.request.model",Sw="gen_ai.response.model",If="gen_ai.usage.input_tokens",Af="gen_ai.usage.output_tokens",kf="gen_ai.usage.total_tokens",xw="gen_ai.request.max_tokens",Iw="gen_ai.request.temperature",Aw="gen_ai.request.top_p",kw="gen_ai.request.frequency_penalty",Ow="gen_ai.request.presence_penalty",Cw="gen_ai.response.finish_reasons",Nw="gen_ai.prompt",$w="gen_ai.completion",Rw="gen_ai.request.extra_query",Pw="gen_ai.request.extra_body",Lw="gen_ai.serialized.name",Dw="gen_ai.serialized.signature",Mw="gen_ai.serialized.doc",jw="gen_ai.response.id",Fw="gen_ai.response.service_tier",Uw="gen_ai.response.system_fingerprint",Bw="gen_ai.usage.input_token_details",zw="gen_ai.usage.output_token_details",qw="langsmith.trace.session_id",Zw="langsmith.trace.session_name",Gw="langsmith.span.kind",Vw="langsmith.trace.name",Hw="langsmith.metadata",Of="langsmith.span.tags",Ww="langsmith.request.streaming",Jw="langsmith.request.headers",Kw=(...t)=>fetch(...t),Um=Symbol.for("ls:fetch_implementation"),Xw=()=>{const t=globalThis[Um];return t?typeof t=="function"&&"Headers"in t&&"Request"in t&&"Response"in t:!1},Yw=t=>async(...e)=>{if(t||Rt("DEBUG")==="true"){const[n,s]=e;console.log(` ${(s==null?void 0:s.method)||"GET"} ${n}`)}const r=await(globalThis[Um]??Kw)(...e);return(t||Rt("DEBUG")==="true")&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r},Bm=()=>Rt("PROJECT")??Pr("LANGCHAIN_SESSION")??"default",Cf={};function zm(t){Cf[t]||(console.warn(t),Cf[t]=!0)}const Qw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Ee(t,e){if(!Qw.test(t)){const r=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(r)}return t}function e1(t){const e=typeof t=="string"?Date.parse(t):t;return on({msecs:e,seq:0})}function t1(t,e){const r=Sv.dirname(t);sn.existsSync(r)||sn.mkdirSync(r,{recursive:!0});const n={entries:e},s=`${t}.tmp`;try{sn.writeFileSync(s,JSON.stringify(n,null,2)),sn.renameSync(s,t)}catch(a){throw sn.existsSync(s)&&sn.unlinkSync(s),a}}function r1(t){if(!sn.existsSync(t))return null;try{const e=sn.readFileSync(t,"utf-8");return JSON.parse(e).entries??null}catch{return null}}function n1(t,e){return e===null?!1:Date.now()-t.createdAt>e*1e3}class s1{constructor(e={}){Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ttlSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshIntervalSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_metrics",{enumerable:!0,configurable:!0,writable:!0,value:{hits:0,misses:0,refreshes:0,refreshErrors:0}}),this.maxSize=e.maxSize??100,this.ttlSeconds=e.ttlSeconds??3600,this.refreshIntervalSeconds=e.refreshIntervalSeconds??60,this.fetchFunc=e.fetchFunc,this.fetchFunc&&this.ttlSeconds!==null&&this.startRefreshLoop()}get metrics(){return{...this._metrics}}get totalRequests(){return this._metrics.hits+this._metrics.misses}get hitRate(){const e=this.totalRequests;return e>0?this._metrics.hits/e:0}resetMetrics(){this._metrics={hits:0,misses:0,refreshes:0,refreshErrors:0}}get(e){const r=this.cache.get(e);if(!r){this._metrics.misses+=1;return}return this.cache.delete(e),this.cache.set(e,r),this._metrics.hits+=1,r.value}set(e,r){if(!this.cache.has(e)&&this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s!==void 0&&this.cache.delete(s)}const n={value:r,createdAt:Date.now()};this.cache.delete(e),this.cache.set(e,n)}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}stop(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=void 0)}dump(e){const r={};for(const[n,s]of this.cache.entries())r[n]=s.value;t1(e,r)}load(e){const r=r1(e);if(!r)return 0;let n=0;const s=Date.now();for(const[a,i]of Object.entries(r)){if(this.cache.size>=this.maxSize)break;const o={value:i,createdAt:s};this.cache.set(a,o),n+=1}return n}startRefreshLoop(){this.refreshTimer=setInterval(()=>{this.refreshStaleEntries().catch(e=>{console.warn("Unexpected error in cache refresh loop:",e)})},this.refreshIntervalSeconds*1e3),this.refreshTimer.unref&&this.refreshTimer.unref()}getStaleKeys(){const e=[];for(const[r,n]of this.cache.entries())n1(n,this.ttlSeconds)&&e.push(r);return e}async refreshStaleEntries(){if(!this.fetchFunc)return;const e=this.getStaleKeys();if(e.length!==0)for(const r of e)try{const n=await this.fetchFunc(r);this.set(r,n),this._metrics.refreshes+=1}catch(n){this._metrics.refreshErrors+=1,console.warn(`Failed to refresh cache entry ${r}:`,n)}}}const qm="0.4.7";let vr;const a1=()=>typeof window<"u"&&typeof window.document<"u",i1=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",o1=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Zm=()=>typeof Deno<"u",c1=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Zm(),Gm=()=>vr||(typeof Bun<"u"?vr="bun":a1()?vr="browser":c1()?vr="node":i1()?vr="webworker":o1()?vr="jsdom":Zm()?vr="deno":vr="other",vr);let pc;function Vm(){if(pc===void 0){const t=Gm(),e=l1();pc={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:qm,...e}}return pc}function Hm(){const t=u1(),e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(t))typeof s=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function u1(){const t={};try{if(typeof process<"u"&&process.env)for(const[e,r]of Object.entries(process.env))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&r!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof r=="string"?t[e]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2):t[e]=r)}catch{}return t}function Pr(t){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[t]:void 0}catch{return}}function Rt(t){return Pr(`LANGSMITH_${t}`)||Pr(`LANGCHAIN_${t}`)}let mc;function l1(){if(mc!==void 0)return mc;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const r of t){const n=Pr(r);n!==void 0&&(e[r]=n)}return mc=e,e}function Wm(){return Pr("OTEL_ENABLED")==="true"||Rt("OTEL_ENABLED")==="true"}class d1{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...r){!this.hasWarned&&Wm()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(r.length===1&&typeof r[0]=="function"?n=r[0]:r.length===2&&typeof r[1]=="function"?n=r[1]:r.length===3&&typeof r[2]=="function"&&(n=r[2]),typeof n=="function")return n()}}class f1{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new d1})}getTracer(e,r){return this.mockTracer}getActiveSpan(){}setSpan(e,r){return e}getSpan(e){}setSpanContext(e,r){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class h1{active(){return{}}with(e,r){return r()}}const gc=Symbol.for("ls:otel_trace"),_c=Symbol.for("ls:otel_context"),Nf=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),p1=new f1,m1=new h1;class g1{getTraceInstance(){return globalThis[gc]??p1}getContextInstance(){return globalThis[_c]??m1}initializeGlobalInstances(e){globalThis[gc]===void 0&&(globalThis[gc]=e.trace),globalThis[_c]===void 0&&(globalThis[_c]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[Nf]=e}getDefaultOTLPTracerComponents(){return globalThis[Nf]??void 0}}const $l=new g1;function Jm(){return $l.getTraceInstance()}function _1(){return $l.getContextInstance()}function y1(){return $l.getDefaultOTLPTracerComponents()}const v1={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function b1(t){return v1[t]||t}class w1{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,r){for(const n of e)try{if(!n.run)continue;if(n.operation==="post"){const s=this.createSpanForRun(n,n.run,r.get(n.id));s&&!n.run.end_time&&this.spans.set(n.id,s)}else this.updateSpanForRun(n,n.run)}catch(s){console.error(`Error processing operation ${n.id}:`,s)}}createSpanForRun(e,r,n){const s=n&&Jm().getSpan(n);if(s)try{return this.finishSpanSetup(s,r,e)}catch(a){console.error(`Failed to create span for run ${e.id}:`,a);return}}finishSpanSetup(e,r,n){return this.setSpanAttributes(e,r,n),r.error?(e.setStatus({code:2}),e.recordException(new Error(r.error))):e.setStatus({code:1}),r.end_time&&e.end(new Date(r.end_time)),e}updateSpanForRun(e,r){try{const n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,r,e),r.error?(n.setStatus({code:2}),n.recordException(new Error(r.error))):n.setStatus({code:1});const s=r.end_time;s&&(n.end(new Date(s)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){var r;if((r=e.extra)!=null&&r.metadata){const n=e.extra.metadata;if(n.ls_model_name)return n.ls_model_name;if(n.invocation_params){const s=n.invocation_params;if(s.model)return s.model;if(s.model_name)return s.model_name}}}setSpanAttributes(e,r,n){var o;if("run_type"in r&&r.run_type){e.setAttribute(Gw,r.run_type);const c=b1(r.run_type||"chain");e.setAttribute(Ew,c)}"name"in r&&r.name&&e.setAttribute(Vw,r.name),"session_id"in r&&r.session_id&&e.setAttribute(qw,r.session_id),"session_name"in r&&r.session_name&&e.setAttribute(Zw,r.session_name),this.setGenAiSystem(e,r);const s=this.extractModelName(r);s&&e.setAttribute(xf,s),"prompt_tokens"in r&&typeof r.prompt_tokens=="number"&&e.setAttribute(If,r.prompt_tokens),"completion_tokens"in r&&typeof r.completion_tokens=="number"&&e.setAttribute(Af,r.completion_tokens),"total_tokens"in r&&typeof r.total_tokens=="number"&&e.setAttribute(kf,r.total_tokens),this.setInvocationParameters(e,r);const a=((o=r.extra)==null?void 0:o.metadata)||{};for(const[c,u]of Object.entries(a))u!=null&&e.setAttribute(`${Hw}.${c}`,String(u));const i=r.tags;if(i&&Array.isArray(i)?e.setAttribute(Of,i.join(", ")):i&&e.setAttribute(Of,String(i)),"serialized"in r&&typeof r.serialized=="object"){const c=r.serialized;c.name&&e.setAttribute(Lw,String(c.name)),c.signature&&e.setAttribute(Dw,String(c.signature)),c.doc&&e.setAttribute(Mw,String(c.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,r){let n="langchain";const s=this.extractModelName(r);if(s){const a=s.toLowerCase();a.includes("anthropic")||a.startsWith("claude")?n="anthropic":a.includes("bedrock")?n="aws.bedrock":a.includes("azure")&&a.includes("openai")?n="az.ai.openai":a.includes("azure")&&a.includes("inference")?n="az.ai.inference":a.includes("cohere")?n="cohere":a.includes("deepseek")?n="deepseek":a.includes("gemini")?n="gemini":a.includes("groq")?n="groq":a.includes("watson")||a.includes("ibm")?n="ibm.watsonx.ai":a.includes("mistral")?n="mistral_ai":a.includes("gpt")||a.includes("openai")?n="openai":a.includes("perplexity")||a.includes("sonar")?n="perplexity":a.includes("vertex")?n="vertex_ai":(a.includes("xai")||a.includes("grok"))&&(n="xai")}e.setAttribute(Tw,n)}setInvocationParameters(e,r){var s,a;if(!((a=(s=r.extra)==null?void 0:s.metadata)!=null&&a.invocation_params))return;const n=r.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(xw,n.max_tokens),n.temperature!==void 0&&e.setAttribute(Iw,n.temperature),n.top_p!==void 0&&e.setAttribute(Aw,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(kw,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(Ow,n.presence_penalty)}setIOAttributes(e,r){if(r.run.inputs)try{const n=r.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(xf,n.model),n.stream!==void 0&&e.setAttribute(Ww,n.stream),n.extra_headers&&e.setAttribute(Jw,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(Rw,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(Pw,JSON.stringify(n.extra_body))),e.setAttribute(Nw,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${r.id}`,n)}if(r.run.outputs)try{const n=r.run.outputs,s=this.getUnifiedRunTokens(n);if(s&&(e.setAttribute(If,s[0]),e.setAttribute(Af,s[1]),e.setAttribute(kf,s[0]+s[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(Sw,String(n.model)),n.id&&e.setAttribute(jw,n.id),n.choices&&Array.isArray(n.choices)){const a=n.choices.map(i=>i.finish_reason).filter(i=>i).map(String);a.length>0&&e.setAttribute(Cw,a.join(", "))}if(n.service_tier&&e.setAttribute(Fw,n.service_tier),n.system_fingerprint&&e.setAttribute(Uw,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){const a=n.usage_metadata;a.input_token_details&&e.setAttribute(Bw,JSON.stringify(a.input_token_details)),a.output_token_details&&e.setAttribute(zw,JSON.stringify(a.output_token_details))}}e.setAttribute($w,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${r.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let r=this.extractUnifiedRunTokens(e.usage_metadata);if(r)return r;const n=Object.keys(e);for(const i of n){const o=e[i];if(!(!o||typeof o!="object")&&(r=this.extractUnifiedRunTokens(o.usage_metadata),r||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(r=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),r)))return r}const s=e.generations||[];if(!Array.isArray(s))return null;const a=Array.isArray(s[0])?s.flat():s;for(const i of a)if(typeof i=="object"&&i.message&&typeof i.message=="object"&&i.message.kwargs&&typeof i.message.kwargs=="object"&&(r=this.extractUnifiedRunTokens(i.message.kwargs.usage_metadata),r))return r;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}const E1=Object.prototype.toString,T1=t=>E1.call(t)==="[object Error]",S1=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function x1(t){if(!(t&&T1(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:r,stack:n}=t;return r==="Load failed"?n===void 0||"__sentry_captured__"in t:r.startsWith("error sending request for url")?!0:S1.has(r)}function I1(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function Ba(t,e,{min:r=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<r)throw new TypeError(`Expected \`${t}\` to be  ${r}.`)}}let A1=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function k1(t,e){const r=Math.max(1,t+1),n=e.randomize?Math.random()+1:1;let s=Math.round(n*e.minTimeout*e.factor**(r-1));return s=Math.min(s,e.maxTimeout),s}function $f(t,e){return Number.isFinite(e)?e-(performance.now()-t):e}async function O1({error:t,attemptNumber:e,retriesConsumed:r,startTime:n,options:s}){var f,m,_;const a=t instanceof Error?t:new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(a instanceof A1)throw a.originalError;const i=Number.isFinite(s.retries)?Math.max(0,s.retries-r):s.retries,o=s.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:a,attemptNumber:e,retriesLeft:i,retriesConsumed:r});if(await s.onFailedAttempt(c),$f(n,o)<=0)throw a;const u=await s.shouldConsumeRetry(c),l=$f(n,o);if(l<=0||i<=0)throw a;if(a instanceof TypeError&&!x1(a)){if(u)throw a;return(f=s.signal)==null||f.throwIfAborted(),!1}if(!await s.shouldRetry(c))throw a;if(!u)return(m=s.signal)==null||m.throwIfAborted(),!1;const d=k1(r,s),h=Math.min(d,l);return h>0&&await new Promise((y,w)=>{var T,I;const g=()=>{var C;clearTimeout(b),(C=s.signal)==null||C.removeEventListener("abort",g),w(s.signal.reason)},b=setTimeout(()=>{var C;(C=s.signal)==null||C.removeEventListener("abort",g),y()},h);s.unref&&((T=b.unref)==null||T.call(b)),(I=s.signal)==null||I.addEventListener("abort",g,{once:!0})}),(_=s.signal)==null||_.throwIfAborted(),!0}async function C1(t,e={}){var a,i,o;if(e={...e},I1(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),Ba("factor",e.factor,{min:0,allowInfinity:!1}),Ba("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),Ba("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),Ba("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),(a=e.signal)==null||a.throwIfAborted();let r=0,n=0;const s=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){r++;try{(i=e.signal)==null||i.throwIfAborted();const c=await t(r);return(o=e.signal)==null||o.throwIfAborted(),c}catch(c){await O1({error:c,attemptNumber:r,retriesConsumed:n,startTime:s,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}var Km={},Xm={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function a(c,u,l,d,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new s(l,d||c,h),m=r?r+u:u;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],f]:c._events[m].push(f):(c._events[m]=f,c._eventsCount++),c}function i(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,d;if(this._eventsCount===0)return u;for(d in l=this._events)e.call(l,d)&&u.push(r?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=r?r+u:u,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,m=new Array(f);h<f;h++)m[h]=d[h].fn;return m},o.prototype.listenerCount=function(u){var l=r?r+u:u,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,l,d,h,f,m){var _=r?r+u:u;if(!this._events[_])return!1;var y=this._events[_],w=arguments.length,g,b;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),w){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,d),!0;case 4:return y.fn.call(y.context,l,d,h),!0;case 5:return y.fn.call(y.context,l,d,h,f),!0;case 6:return y.fn.call(y.context,l,d,h,f,m),!0}for(b=1,g=new Array(w-1);b<w;b++)g[b-1]=arguments[b];y.fn.apply(y.context,g)}else{var T=y.length,I;for(b=0;b<T;b++)switch(y[b].once&&this.removeListener(u,y[b].fn,void 0,!0),w){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,l);break;case 3:y[b].fn.call(y[b].context,l,d);break;case 4:y[b].fn.call(y[b].context,l,d,h);break;default:if(!g)for(I=1,g=new Array(w-1);I<w;I++)g[I-1]=arguments[I];y[b].fn.apply(y[b].context,g)}}return!0},o.prototype.on=function(u,l,d){return a(this,u,l,d,!1)},o.prototype.once=function(u,l,d){return a(this,u,l,d,!0)},o.prototype.removeListener=function(u,l,d,h){var f=r?r+u:u;if(!this._events[f])return this;if(!l)return i(this,f),this;var m=this._events[f];if(m.fn)m.fn===l&&(!h||m.once)&&(!d||m.context===d)&&i(this,f);else{for(var _=0,y=[],w=m.length;_<w;_++)(m[_].fn!==l||h&&!m[_].once||d&&m[_].context!==d)&&y.push(m[_]);y.length?this._events[f]=y.length===1?y[0]:y:i(this,f)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=r?r+u:u,this._events[l]&&i(this,l)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o})(Xm);var N1=Xm.exports,vo={exports:{}},$1=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})));const R1=$1;class Ym extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Qm=(t,e,r)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(t);return}const a=setTimeout(()=>{if(typeof r=="function"){try{n(r())}catch(c){s(c)}return}const i=typeof r=="string"?r:`Promise timed out after ${e} milliseconds`,o=r instanceof Error?r:new Ym(i);typeof t.cancel=="function"&&t.cancel(),s(o)},e);R1(t.then(n,s),()=>{clearTimeout(a)})});vo.exports=Qm;vo.exports.default=Qm;vo.exports.TimeoutError=Ym;var P1=vo.exports,Rl={},Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});function L1(t,e,r){let n=0,s=t.length;for(;s>0;){const a=s/2|0;let i=n+a;r(t[i],e)<=0?(n=++i,s-=a+1):s=a}return n}Pl.default=L1;Object.defineProperty(Rl,"__esModule",{value:!0});const D1=Pl;class M1{constructor(){this._queue=[]}enqueue(e,r){r=Object.assign({priority:0},r);const n={priority:r.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=r.priority){this._queue.push(n);return}const s=D1.default(this._queue,n,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,n)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(r=>r.priority===e.priority).map(r=>r.run)}get size(){return this._queue.length}}Rl.default=M1;Object.defineProperty(Km,"__esModule",{value:!0});const j1=N1,eg=P1,F1=Rl,za=()=>{},U1=new eg.TimeoutError;class B1 extends j1{constructor(e){var r,n,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=za,this._resolveIdle=za,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:F1.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(r=e.intervalCap)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=za,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=za,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const r=this._intervalEnd-e;if(r<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},r)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const r=this._queue.dequeue();return r?(this.emit("active"),r(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,r={}){return new Promise((n,s)=>{const a=async()=>{this._pendingCount++,this._intervalCount++;try{const i=this._timeout===void 0&&r.timeout===void 0?e():eg.default(Promise.resolve(e()),r.timeout===void 0?this._timeout:r.timeout,()=>{(r.throwOnTimeout===void 0?this._throwOnTimeout:r.throwOnTimeout)&&s(U1)});n(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,r),this._tryToStartAnother(),this.emit("add")})}async addAll(e,r){return Promise.all(e.map(async n=>this.add(n,r)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const r=this._resolveEmpty;this._resolveEmpty=()=>{r(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const r=this._resolveIdle;this._resolveIdle=()=>{r(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Zr=Km.default=B1;const z1=[408,425,429,500,502,503,504];let Rf=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in Zr?this.queue=new Zr.default({concurrency:this.maxConcurrency}):this.queue=new Zr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...r){return this.callWithOptions({},e,...r)}callWithOptions(e,r,...n){const s=e.sizeBytes??0;if(this.maxQueueSizeBytes!==void 0&&s>0&&this.queueSizeBytes+s>this.maxQueueSizeBytes)return Promise.reject(new Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${s} bytes.`));s>0&&(this.queueSizeBytes+=s);const a=this.onFailedResponseHook;let i=this.queue.add(()=>C1(()=>r(...n).catch(o=>{throw o instanceof Error?o:new Error(o)}),{async onFailedAttempt({error:o}){if(typeof o!="object"||o==null)throw o;const c="message"in o&&typeof o.message=="string"?o.message:void 0;if(c!=null&&c.startsWith("Cancel")||c!=null&&c.startsWith("TimeoutError")||c!=null&&c.startsWith("AbortError")||"name"in o&&o.name==="TimeoutError"||"code"in o&&o.code==="ECONNABORTED")throw o;const u="response"in o?o.response:void 0;if(a&&await a(u))return;const l=(u==null?void 0:u.status)??("status"in o?o.status:void 0);if(l!=null&&(typeof l=="number"||typeof l=="string")&&!z1.includes(+l))throw o},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return s>0&&(i=i.finally(()=>{this.queueSizeBytes-=s})),e.signal?Promise.race([i,new Promise((o,c)=>{var u;(u=e.signal)==null||u.addEventListener("abort",()=>{c(new Error("AbortError"))})})]):i}};function Pf(t){return typeof(t==null?void 0:t._getType)=="function"}function Lf(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var wu={exports:{}};const q1="2.0.0",tg=256,Z1=Number.MAX_SAFE_INTEGER||9007199254740991,G1=16,V1=tg-6,H1=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var bo={MAX_LENGTH:tg,MAX_SAFE_COMPONENT_LENGTH:G1,MAX_SAFE_BUILD_LENGTH:V1,MAX_SAFE_INTEGER:Z1,RELEASE_TYPES:H1,SEMVER_SPEC_VERSION:q1,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const W1=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var wo=W1;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=bo,a=wo;e=t.exports={};const i=e.re=[],o=e.safeRe=[],c=e.src=[],u=e.safeSrc=[],l=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,n]],m=y=>{for(const[w,g]of f)y=y.split(`${w}*`).join(`${w}{0,${g}}`).split(`${w}+`).join(`${w}{1,${g}}`);return y},_=(y,w,g)=>{const b=m(w),T=d++;a(y,T,w),l[y]=T,c[T]=w,u[T]=b,i[T]=new RegExp(w,g?"g":void 0),o[T]=new RegExp(b,g?"g":void 0)};_("NUMERICIDENTIFIER","0|[1-9]\\d*"),_("NUMERICIDENTIFIERLOOSE","\\d+"),_("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),_("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),_("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASEIDENTIFIER",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIER]})`),_("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),_("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),_("BUILDIDENTIFIER",`${h}+`),_("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),_("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),_("FULL",`^${c[l.FULLPLAIN]}$`),_("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),_("LOOSE",`^${c[l.LOOSEPLAIN]}$`),_("GTLT","((?:<|>)?=?)"),_("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),_("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),_("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),_("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),_("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),_("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),_("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),_("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),_("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?(?:${c[l.BUILD]})?(?:$|[^\\d])`),_("COERCERTL",c[l.COERCE],!0),_("COERCERTLFULL",c[l.COERCEFULL],!0),_("LONETILDE","(?:~>?)"),_("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",_("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),_("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),_("LONECARET","(?:\\^)"),_("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",_("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),_("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),_("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),_("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),_("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",_("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),_("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),_("STAR","(<|>)?=?\\s*\\*"),_("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),_("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(wu,wu.exports);var Ia=wu.exports;const J1=Object.freeze({loose:!0}),K1=Object.freeze({}),X1=t=>t?typeof t!="object"?J1:t:K1;var Ll=X1;const Df=/^[0-9]+$/,rg=(t,e)=>{if(typeof t=="number"&&typeof e=="number")return t===e?0:t<e?-1:1;const r=Df.test(t),n=Df.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},Y1=(t,e)=>rg(e,t);var ng={compareIdentifiers:rg,rcompareIdentifiers:Y1};const qa=wo,{MAX_LENGTH:Mf,MAX_SAFE_INTEGER:Za}=bo,{safeRe:Ga,t:Va}=Ia,Q1=Ll,{compareIdentifiers:yc}=ng;let eE=class Tr{constructor(e,r){if(r=Q1(r),e instanceof Tr){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Mf)throw new TypeError(`version is longer than ${Mf} characters`);qa("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const n=e.trim().match(r.loose?Ga[Va.LOOSE]:Ga[Va.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Za||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Za||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Za||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const a=+s;if(a>=0&&a<Za)return a}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(qa("SemVer.compare",this.version,this.options,e),!(e instanceof Tr)){if(typeof e=="string"&&e===this.version)return 0;e=new Tr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Tr||(e=new Tr(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof Tr||(e=new Tr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{const n=this.prerelease[r],s=e.prerelease[r];if(qa("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return yc(n,s)}while(++r)}compareBuild(e){e instanceof Tr||(e=new Tr(e,this.options));let r=0;do{const n=this.build[r],s=e.build[r];if(qa("build compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return yc(n,s)}while(++r)}inc(e,r,n){if(e.startsWith("pre")){if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(r){const s=`-${r}`.match(this.options.loose?Ga[Va.PRERELEASELOOSE]:Ga[Va.PRERELEASE]);if(!s||s[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let a=[r,s];n===!1&&(a=[r]),yc(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var Dl=eE;const jf=Dl,tE=(t,e,r)=>new jf(t,r).compare(new jf(e,r));var vs=tE;const rE=vs,nE=(t,e,r)=>rE(t,e,r)>0;var sE=nE;const aE=vs,iE=(t,e,r)=>aE(t,e,r)<0;var oE=iE;const cE=vs,uE=(t,e,r)=>cE(t,e,r)===0;var lE=uE;const dE=vs,fE=(t,e,r)=>dE(t,e,r)!==0;var hE=fE;const pE=vs,mE=(t,e,r)=>pE(t,e,r)>=0;var gE=mE;const _E=vs,yE=(t,e,r)=>_E(t,e,r)<=0;var vE=yE;const bE=lE,wE=hE,EE=sE,TE=gE,SE=oE,xE=vE,IE=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return bE(t,r,n);case"!=":return wE(t,r,n);case">":return EE(t,r,n);case">=":return TE(t,r,n);case"<":return SE(t,r,n);case"<=":return xE(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};var AE=IE;const{safeRe:q8,t:Z8}=Ia;class kE{constructor(){this.max=1e3,this.map=new Map}get(e){const r=this.map.get(e);if(r!==void 0)return this.map.delete(e),this.map.set(e,r),r}delete(e){return this.map.delete(e)}set(e,r){if(!this.delete(e)&&r!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(e,r)}return this}}var OE=kE,vc,Ff;function yr(){if(Ff)return vc;Ff=1;const t=/\s+/g;class e{constructor(P,$){if($=s($),P instanceof e)return P.loose===!!$.loose&&P.includePrerelease===!!$.includePrerelease?P:new e(P.raw,$);if(P instanceof a)return this.raw=P.value,this.set=[[P]],this.formatted=void 0,this;if(this.options=$,this.loose=!!$.loose,this.includePrerelease=!!$.includePrerelease,this.raw=P.trim().replace(t," "),this.set=this.raw.split("||").map(L=>this.parseRange(L.trim())).filter(L=>L.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const L=this.set[0];if(this.set=this.set.filter(F=>!_(F[0])),this.set.length===0)this.set=[L];else if(this.set.length>1){for(const F of this.set)if(F.length===1&&y(F[0])){this.set=[F];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let P=0;P<this.set.length;P++){P>0&&(this.formatted+="||");const $=this.set[P];for(let L=0;L<$.length;L++)L>0&&(this.formatted+=" "),this.formatted+=$[L].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(P){const L=((this.options.includePrerelease&&f)|(this.options.loose&&m))+":"+P,F=n.get(L);if(F)return F;const Z=this.options.loose,X=Z?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];P=P.replace(X,pe(this.options.includePrerelease)),i("hyphen replace",P),P=P.replace(c[u.COMPARATORTRIM],l),i("comparator trim",P),P=P.replace(c[u.TILDETRIM],d),i("tilde trim",P),P=P.replace(c[u.CARETTRIM],h),i("caret trim",P);let Y=P.split(" ").map(_e=>g(_e,this.options)).join(" ").split(/\s+/).map(_e=>q(_e,this.options));Z&&(Y=Y.filter(_e=>(i("loose invalid filter",_e,this.options),!!_e.match(c[u.COMPARATORLOOSE])))),i("range list",Y);const J=new Map,ce=Y.map(_e=>new a(_e,this.options));for(const _e of ce){if(_(_e))return[_e];J.set(_e.value,_e)}J.size>1&&J.has("")&&J.delete("");const Ce=[...J.values()];return n.set(L,Ce),Ce}intersects(P,$){if(!(P instanceof e))throw new TypeError("a Range is required");return this.set.some(L=>w(L,$)&&P.set.some(F=>w(F,$)&&L.every(Z=>F.every(X=>Z.intersects(X,$)))))}test(P){if(!P)return!1;if(typeof P=="string")try{P=new o(P,this.options)}catch{return!1}for(let $=0;$<this.set.length;$++)if(Q(this.set[$],P,this.options))return!0;return!1}}vc=e;const r=OE,n=new r,s=Ll,a=Eo(),i=wo,o=Dl,{safeRe:c,t:u,comparatorTrimReplace:l,tildeTrimReplace:d,caretTrimReplace:h}=Ia,{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:m}=bo,_=N=>N.value==="<0.0.0-0",y=N=>N.value==="",w=(N,P)=>{let $=!0;const L=N.slice();let F=L.pop();for(;$&&L.length;)$=L.every(Z=>F.intersects(Z,P)),F=L.pop();return $},g=(N,P)=>(N=N.replace(c[u.BUILD],""),i("comp",N,P),N=C(N,P),i("caret",N),N=T(N,P),i("tildes",N),N=k(N,P),i("xrange",N),N=H(N,P),i("stars",N),N),b=N=>!N||N.toLowerCase()==="x"||N==="*",T=(N,P)=>N.trim().split(/\s+/).map($=>I($,P)).join(" "),I=(N,P)=>{const $=P.loose?c[u.TILDELOOSE]:c[u.TILDE];return N.replace($,(L,F,Z,X,Y)=>{i("tilde",N,L,F,Z,X,Y);let J;return b(F)?J="":b(Z)?J=`>=${F}.0.0 <${+F+1}.0.0-0`:b(X)?J=`>=${F}.${Z}.0 <${F}.${+Z+1}.0-0`:Y?(i("replaceTilde pr",Y),J=`>=${F}.${Z}.${X}-${Y} <${F}.${+Z+1}.0-0`):J=`>=${F}.${Z}.${X} <${F}.${+Z+1}.0-0`,i("tilde return",J),J})},C=(N,P)=>N.trim().split(/\s+/).map($=>D($,P)).join(" "),D=(N,P)=>{i("caret",N,P);const $=P.loose?c[u.CARETLOOSE]:c[u.CARET],L=P.includePrerelease?"-0":"";return N.replace($,(F,Z,X,Y,J)=>{i("caret",N,F,Z,X,Y,J);let ce;return b(Z)?ce="":b(X)?ce=`>=${Z}.0.0${L} <${+Z+1}.0.0-0`:b(Y)?Z==="0"?ce=`>=${Z}.${X}.0${L} <${Z}.${+X+1}.0-0`:ce=`>=${Z}.${X}.0${L} <${+Z+1}.0.0-0`:J?(i("replaceCaret pr",J),Z==="0"?X==="0"?ce=`>=${Z}.${X}.${Y}-${J} <${Z}.${X}.${+Y+1}-0`:ce=`>=${Z}.${X}.${Y}-${J} <${Z}.${+X+1}.0-0`:ce=`>=${Z}.${X}.${Y}-${J} <${+Z+1}.0.0-0`):(i("no pr"),Z==="0"?X==="0"?ce=`>=${Z}.${X}.${Y}${L} <${Z}.${X}.${+Y+1}-0`:ce=`>=${Z}.${X}.${Y}${L} <${Z}.${+X+1}.0-0`:ce=`>=${Z}.${X}.${Y} <${+Z+1}.0.0-0`),i("caret return",ce),ce})},k=(N,P)=>(i("replaceXRanges",N,P),N.split(/\s+/).map($=>A($,P)).join(" ")),A=(N,P)=>{N=N.trim();const $=P.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return N.replace($,(L,F,Z,X,Y,J)=>{i("xRange",N,L,F,Z,X,Y,J);const ce=b(Z),Ce=ce||b(X),_e=Ce||b(Y),S=_e;return F==="="&&S&&(F=""),J=P.includePrerelease?"-0":"",ce?F===">"||F==="<"?L="<0.0.0-0":L="*":F&&S?(Ce&&(X=0),Y=0,F===">"?(F=">=",Ce?(Z=+Z+1,X=0,Y=0):(X=+X+1,Y=0)):F==="<="&&(F="<",Ce?Z=+Z+1:X=+X+1),F==="<"&&(J="-0"),L=`${F+Z}.${X}.${Y}${J}`):Ce?L=`>=${Z}.0.0${J} <${+Z+1}.0.0-0`:_e&&(L=`>=${Z}.${X}.0${J} <${Z}.${+X+1}.0-0`),i("xRange return",L),L})},H=(N,P)=>(i("replaceStars",N,P),N.trim().replace(c[u.STAR],"")),q=(N,P)=>(i("replaceGTE0",N,P),N.trim().replace(c[P.includePrerelease?u.GTE0PRE:u.GTE0],"")),pe=N=>(P,$,L,F,Z,X,Y,J,ce,Ce,_e,S)=>(b(L)?$="":b(F)?$=`>=${L}.0.0${N?"-0":""}`:b(Z)?$=`>=${L}.${F}.0${N?"-0":""}`:X?$=`>=${$}`:$=`>=${$}${N?"-0":""}`,b(ce)?J="":b(Ce)?J=`<${+ce+1}.0.0-0`:b(_e)?J=`<${ce}.${+Ce+1}.0-0`:S?J=`<=${ce}.${Ce}.${_e}-${S}`:N?J=`<${ce}.${Ce}.${+_e+1}-0`:J=`<=${J}`,`${$} ${J}`.trim()),Q=(N,P,$)=>{for(let L=0;L<N.length;L++)if(!N[L].test(P))return!1;if(P.prerelease.length&&!$.includePrerelease){for(let L=0;L<N.length;L++)if(i(N[L].semver),N[L].semver!==a.ANY&&N[L].semver.prerelease.length>0){const F=N[L].semver;if(F.major===P.major&&F.minor===P.minor&&F.patch===P.patch)return!0}return!1}return!0};return vc}var bc,Uf;function Eo(){if(Uf)return bc;Uf=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(l,d){if(d=r(d),l instanceof e){if(l.loose===!!d.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),i("comparator",l,d),this.options=d,this.loose=!!d.loose,this.parse(l),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(l){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],h=l.match(d);if(!h)throw new TypeError(`Invalid comparator: ${l}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=t}toString(){return this.value}test(l){if(i("Comparator.test",l,this.options.loose),this.semver===t||l===t)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return a(l,this.operator,this.semver,this.options)}intersects(l,d){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(l.value,d).test(this.value):l.operator===""?l.value===""?!0:new c(this.value,d).test(l.semver):(d=r(d),d.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||a(this.semver,"<",l.semver,d)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||a(this.semver,">",l.semver,d)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}bc=e;const r=Ll,{safeRe:n,t:s}=Ia,a=AE,i=wo,o=Dl,c=yr();return bc}yr();yr();yr();yr();yr();yr();const CE=Eo(),{ANY:G8}=CE;yr();yr();yr();const Ml=Eo(),{ANY:V8}=Ml;new Ml(">=0.0.0-0");new Ml(">=0.0.0");const wc=Ia,Bf=bo,zf=ng;Eo();yr();wc.re,wc.src,wc.t,Bf.SEMVER_SPEC_VERSION,Bf.RELEASE_TYPES,zf.compareIdentifiers,zf.rcompareIdentifiers;function Qr(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,r]=t.split(":"),n=r||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${t}`);return[s,a,n]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,n]}}class NE extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}class $E extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithNotFoundError",this.status=404}}function qf(t){return t!=null&&typeof t=="object"&&"name"in t&&(t==null?void 0:t.name)==="LangSmithNotFoundError"}async function de(t,e,r){let n;if(t.ok){r&&(n=await t.text());return}if(t.status===403)try{const i=await t.json();(i==null?void 0:i.error)==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${t.status} ${t.statusText}`);throw o.status=t==null?void 0:t.status,o}if(n===void 0)try{n=await t.text()}catch{n=""}const s=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Message: ${n}`;if(t.status===404)throw new $E(s);if(t.status===409)throw new NE(s);const a=new Error(s);throw a.status=t.status,a}const sg="ERR_CONFLICTING_ENDPOINTS";class RE extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:sg}),this.name="ConflictingEndpointsError"}}function PE(t){return typeof t=="object"&&t!==null&&t.code===sg}var Zf="[...]",LE={result:"[Circular]"},Mi=[],ns=[];const DE=new TextEncoder;function ME(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Ha(t){return DE.encode(t)}function ag(t){if(t&&typeof t=="object"&&t!==null){if(t instanceof Map)return Object.fromEntries(t);if(t instanceof Set)return Array.from(t);if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return t.toString();if(t instanceof Error)return{name:t.name,message:t.message}}else if(typeof t=="bigint")return t.toString();return t}function jE(t){return function(e,r){return ag(r)}}function Dt(t,e,r,n,s){var a;try{const i=JSON.stringify(t,jE(r),n);return Ha(i)}catch(i){if(!((a=i.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Ha("[Unserializable]");Rt("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=ME()),Eu(t,"",0,[],void 0,0,s);let o;try{ns.length===0?o=JSON.stringify(t,r,n):o=JSON.stringify(t,FE(r),n)}catch{return Ha("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Mi.length!==0;){const c=Mi.pop();c.length===4?Object.defineProperty(c[0],c[1],c[3]):c[0][c[1]]=c[2]}}return Ha(o)}}function Ec(t,e,r,n){var s=Object.getOwnPropertyDescriptor(n,r);s.get!==void 0?s.configurable?(Object.defineProperty(n,r,{value:t}),Mi.push([n,r,e,s])):ns.push([e,r,t]):(n[r]=t,Mi.push([n,r,e]))}function Eu(t,e,r,n,s,a,i){a+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<n.length;o++)if(n[o]===t){Ec(LE,t,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Ec(Zf,t,e,s);return}if(typeof i.edgesLimit<"u"&&r+1>i.edgesLimit){Ec(Zf,t,e,s);return}if(n.push(t),Array.isArray(t))for(o=0;o<t.length;o++)Eu(t[o],o,o,n,t,a,i);else{t=ag(t);var c=Object.keys(t);for(o=0;o<c.length;o++){var u=c[o];Eu(t[u],u,o,n,t,a,i)}}n.pop()}}function FE(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(ns.length>0)for(var n=0;n<ns.length;n++){var s=ns[n];if(s[1]===e&&s[0]===r){r=s[2],ns.splice(n,1);break}}return t.call(this,e,r)}}function Gf(t,e,r){if(r)return t;const n=Vm(),s=e??Hm(),a=t.extra??{},i=a.metadata;return t.extra={...a,runtime:{...n,...a==null?void 0:a.runtime},metadata:{...s,...s.revision_id||"revision_id"in t&&t.revision_id?{revision_id:("revision_id"in t?t.revision_id:void 0)??s.revision_id}:{},...i}},t}const UE=t=>{const e=(t==null?void 0:t.toString())??Rt("TRACING_SAMPLING_RATE");if(e===void 0)return;const r=parseFloat(e);if(r<0||r>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},BE=t=>{const r=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return r==="localhost"||r==="127.0.0.1"||r==="::1"};async function zE(t){const e=[];for await(const r of t)e.push(r);return e}function Wa(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const qE=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};function Vf(t){return typeof t=="number"?Number(t.toFixed(4)):t}const ZE=24*1024*1024,ig=1024*1024*1024,GE=1e4,VE=100,Hf="https://api.smith.langchain.com";class HE{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??ig}peek(){return this.items[0]}push(e){let r;const n=new Promise(a=>{r=a}),s=Dt(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+s>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${s} bytes.`),r(),n):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:r,itemPromise:n,size:s}),this.sizeBytes+=s,n)}pop({upToSizeBytes:e,upToSize:r}){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const n=[];let s=0;for(;s+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0&&n.length<r;){const i=this.items.shift();i&&(n.push(i),s+=i.size,this.sizeBytes-=i.size)}if(n.length===0&&this.items.length>0){const i=this.items.shift();n.push(i),s+=i.size,this.sizeBytes-=i.size}return[n.map(i=>({action:i.action,item:i.payload,otelContext:i.otelContext,apiKey:i.apiKey,apiUrl:i.apiUrl,size:i.size})),()=>n.forEach(i=>i.itemPromiseResolve())]}}class la{get _fetch(){return this.fetchImplementation||Yw(this.debug)}constructor(e={}){var s;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitTracedRuntimeInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Pr("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_multipartDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Pr("LANGSMITH_DEBUG")==="true"});const r=la.getDefaultClientConfig();if(this.tracingSampleRate=UE(e.tracingSamplingRate),this.apiUrl=Wa(e.apiUrl??r.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Wa(e.apiKey??r.apiKey),this.webUrl=Wa(e.webUrl??r.webUrl),(s=this.webUrl)!=null&&s.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=Wa(e.workspaceId??Rt("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Rf({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;const n=e.maxIngestMemoryBytes??ig;this.batchIngestCaller=new Rf({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:n,...e.callerOptions??{},onFailedResponseHook:qE,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??r.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??r.hideOutputs,this.omitTracedRuntimeInfo=e.omitTracedRuntimeInfo??!1,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new HE(n),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,Wm()&&(this.langSmithToOTELTranslator=new w1),this.cachedLSEnvVarsForMetadata=Hm(),e.cache===!0?this._cache=new s1:e.cache&&typeof e.cache=="object"?this._cache=e.cache:this._cache=void 0}static getDefaultClientConfig(){const e=Rt("API_KEY"),r=Rt("ENDPOINT")??Hf,n=Rt("HIDE_INPUTS")==="true",s=Rt("HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:BE(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${qm}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const r={...e};return r.inputs!==void 0&&(r.inputs=await this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=await this.processOutputs(r.outputs)),r}async _getResponse(e,r){const n=(r==null?void 0:r.toString())??"",s=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{const i=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(i,`fetch ${e}`),i})}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams,n){let s=Number(r.get("offset"))||0;const a=Number(r.get("limit"))||100;for(;;){r.set("offset",String(s)),r.set("limit",String(a));const i=`${this.apiUrl}${e}?${r}`,o=await this.caller.call(async()=>{const u=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(u,`fetch ${e}`),u}),c=n?n(await o.json()):await o.json();if(c.length===0||(yield c,c.length<a))break;s+=c.length}}async*_getCursorPaginatedList(e,r=null,n="POST",s="runs"){const a=r?{...r}:{};for(;;){const i=JSON.stringify(a),c=await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(l,`fetch ${e}`),l})).json();if(!c||!c[s])break;yield c[s];const u=c.cursors;if(!u||!u.next)break;a.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){const n=[];for(const s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):n.push(s);return n}else{const n=[];for(const s of e){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?n.push(s):this.filteredPostUuids.add(a):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var r;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((r=e==null?void 0:e.batch_ingest_config)==null?void 0:r.size_limit_bytes)??ZE}async _getBatchSizeLimit(){var r;const e=await this._ensureServerInfo();return this.batchSizeLimit??((r=e==null?void 0:e.batch_ingest_config)==null?void 0:r.size_limit)??VE}async _getDatasetExamplesMultiPartSupport(){var r;return((r=(await this._ensureServerInfo()).instance_flags)==null?void 0:r.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:r}){const n=[];for(;this.autoBatchQueue.items.length>0;){const[s,a]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:r});if(!s.length){a();break}const i=s.reduce((u,l)=>{const d=l.apiUrl??this.apiUrl,h=l.apiKey??this.apiKey,m=l.apiKey===this.apiKey&&l.apiUrl===this.apiUrl?"default":`${d}|${h}`;return u[m]||(u[m]=[]),u[m].push(l),u},{}),o=[];for(const[u,l]of Object.entries(i)){const d=this._processBatch(l,{apiUrl:u==="default"?void 0:u.split("|")[0],apiKey:u==="default"?void 0:u.split("|")[1]});o.push(d)}const c=Promise.all(o).finally(a);n.push(c)}return Promise.all(n)}async _processBatch(e,r){var s,a;if(!e.length)return;const n=e.reduce((i,o)=>i+(o.size??0),0);try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const i={runCreates:e.filter(u=>u.action==="create").map(u=>u.item),runUpdates:e.filter(u=>u.action==="update").map(u=>u.item)},o=await this._ensureServerInfo();if(!this._multipartDisabled&&(((s=o==null?void 0:o.batch_ingest_config)==null?void 0:s.use_multipart_endpoint)??!0)){const u=(a=o==null?void 0:o.instance_flags)==null?void 0:a.gzip_body_enabled;try{await this.multipartIngestRuns(i,{...r,useGzip:u,sizeBytes:n})}catch(l){if(qf(l))this._multipartDisabled=!0,await this.batchIngestRuns(i,{...r,sizeBytes:n});else throw l}}else await this.batchIngestRuns(i,{...r,sizeBytes:n})}}catch(i){console.error("Error exporting batch:",i)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const r=new Map,n=[];for(const s of e)s.item.id&&s.otelContext&&(r.set(s.item.id,s.otelContext),s.action==="create"?n.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):n.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(n,r)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=Gf(e.item,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);const r=this.autoBatchQueue.push(e);if(this.manualFlushMode)return r;const n=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),r}async _getServerInfo(){const r=await(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(GE),...this.fetchOptions});return await de(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(r,null,2)+`
`),r}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes(),r=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:r})}_cloneCurrentOTELContext(){const e=Jm(),r=_1();if(this.langSmithToOTELTranslator!==void 0){const n=e.getActiveSpan();if(n)return e.setSpan(r.active(),n)}}async createRun(e,r){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){const c=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:c,apiKey:r==null?void 0:r.apiKey,apiUrl:r==null?void 0:r.apiUrl}).catch(console.error);return}const i=Gf(a,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);(r==null?void 0:r.apiKey)!==void 0&&(n["x-api-key"]=r.apiKey),(r==null?void 0:r.workspaceId)!==void 0&&(n["x-tenant-id"]=r.workspaceId);const o=Dt(i,`Creating run with id: ${i.id}`);await this.caller.call(async()=>{const c=await this._fetch(`${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await de(c,"create run",!0),c})}async batchIngestRuns({runCreates:e,runUpdates:r},n){if(e===void 0&&r===void 0)return;let s=await Promise.all((e==null?void 0:e.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[]),a=await Promise.all((r==null?void 0:r.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[]);if(s.length>0&&a.length>0){const c=s.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),u=[];for(const l of a)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);s=Object.values(c),a=u}const i={post:s,patch:a};if(!i.post.length&&!i.patch.length)return;const o={post:[],patch:[]};for(const c of["post","patch"]){const u=c,l=i[u].reverse();let d=l.pop();for(;d!==void 0;)o[u].push(d),d=l.pop()}if(o.post.length>0||o.patch.length>0){const c=o.post.map(u=>u.id).concat(o.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(Dt(o,`Ingesting runs with ids: ${c}`),n)}}async _postBatchIngestRuns(e,r){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};(r==null?void 0:r.apiKey)!==void 0&&(n["x-api-key"]=r.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:r==null?void 0:r.sizeBytes},async()=>{const s=await this._fetch(`${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await de(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:e,runUpdates:r},n){if(e===void 0&&r===void 0)return;const s={};let a=[];for(const d of e??[]){const h=await this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(s[h.id]=h.attachments),delete h.attachments,a.push(h)}let i=[];for(const d of r??[])i.push(await this.prepareRunCreateOrUpdateInputs(d));if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){const d=a.reduce((f,m)=>(m.id&&(f[m.id]=m),f),{}),h=[];for(const f of i)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);a=Object.values(d),i=h}if(a.length===0&&i.length===0)return;const u=[],l=[];for(const[d,h]of[["post",a],["patch",i]])for(const f of h){const{inputs:m,outputs:_,events:y,extra:w,error:g,serialized:b,attachments:T,...I}=f,C={inputs:m,outputs:_,events:y,extra:w,error:g,serialized:b},D=Dt(I,`Serializing for multipart ingestion of run with id: ${I.id}`);l.push({name:`${d}.${I.id}`,payload:new Blob([D],{type:`application/json; length=${D.length}`})});for(const[k,A]of Object.entries(C)){if(A===void 0)continue;const H=Dt(A,`Serializing ${k} for multipart ingestion of run with id: ${I.id}`);l.push({name:`${d}.${I.id}.${k}`,payload:new Blob([H],{type:`application/json; length=${H.length}`})})}if(I.id!==void 0){const k=s[I.id];if(k){delete s[I.id];for(const[A,H]of Object.entries(k)){let q,pe;if(Array.isArray(H)?[q,pe]=H:(q=H.mimeType,pe=H.data),A.includes(".")){console.warn(`Skipping attachment '${A}' for run ${I.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${I.id}.${A}`,payload:new Blob([pe],{type:`${q}; length=${pe.byteLength}`})})}}}u.push(`trace=${I.trace_id},id=${I.id}`)}await this._sendMultipartRequest(l,u.join("; "),n)}async _createNodeFetchBody(e,r){const n=[];for(const i of e)n.push(new Blob([`--${r}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),n.push(i.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${r}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,r){const n=new TextEncoder;return new ReadableStream({async start(a){const i=async o=>{typeof o=="string"?a.enqueue(n.encode(o)):a.enqueue(o)};for(const o of e){await i(`--${r}\r
`),await i(`Content-Disposition: form-data; name="${o.name}"\r
`),await i(`Content-Type: ${o.payload.type}\r
\r
`);const u=o.payload.stream().getReader();try{let l;for(;!(l=await u.read()).done;)a.enqueue(l.value)}finally{u.releaseLock()}await i(`\r
`)}await i(`--${r}--\r
`),a.close()}})}async _sendMultipartRequest(e,r,n){const s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=Xw(),i=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),c=async u=>this.batchIngestCaller.callWithOptions({sizeBytes:n==null?void 0:n.sizeBytes},async()=>{const l=await u(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};(n==null?void 0:n.apiKey)!==void 0&&(d["x-api-key"]=n.apiKey);let h=l;n!=null&&n.useGzip&&typeof l=="object"&&"pipeThrough"in l&&(h=l.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");const f=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:h,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(f,"Failed to send multipart request",!0),f});try{let u,l=!1;!a&&!this.multipartStreamingDisabled&&Gm()!=="bun"?(l=!0,u=await c(o)):u=await c(i),(!this.multipartStreamingDisabled||l)&&u.status===422&&((n==null?void 0:n.apiUrl)??this.apiUrl)!==Hf&&(console.warn(`Streaming multipart upload to ${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${r}".`),this.multipartStreamingDisabled=!0,u=await c(i))}catch(u){if(qf(u))throw u;console.warn(`${u.message.trim()}

Context: ${r}`)}}async updateRun(e,r,n){Ee(e),r.inputs&&(r.inputs=await this.processInputs(r.inputs)),r.outputs&&(r.outputs=await this.processOutputs(r.outputs));const s={...r,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(r.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"};(n==null?void 0:n.apiKey)!==void 0&&(a["x-api-key"]=n.apiKey),(n==null?void 0:n.workspaceId)!==void 0&&(a["x-tenant-id"]=n.workspaceId);const i=Dt(r,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{const o=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(o,"update run",!0),o})}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){Ee(e);let n=await this._get(`/runs/${e}`);return r&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let s;r.session_id?s=r.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:Rt("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${r.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var a;const r=await zE(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},s={};r.sort((i,o)=>((i==null?void 0:i.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const i of r){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);(a=i.dotted_order)!=null&&a.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i)}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:r,projectName:n,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:c,isRoot:u,runType:l,error:d,id:h,query:f,filter:m,traceFilter:_,treeFilter:y,limit:w,select:g,order:b}=e;let T=[];if(r&&(T=Array.isArray(r)?r:[r]),n){const k=Array.isArray(n)?n:[n],A=await Promise.all(k.map(H=>this.readProject({projectName:H}).then(q=>q.id)));T.push(...A)}const I=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],C={session:T.length?T:null,run_type:l,reference_example:i,query:f,filter:m,trace_filter:_,tree_filter:y,execution_order:c,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:w,trace:a,select:g||I,is_root:u,order:b};C.select.includes("child_run_ids")&&zm("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let D=0;for await(const k of this._getCursorPaginatedList("/runs/query",C))if(w){if(D>=w)break;if(k.length+D>w){yield*k.slice(0,w-D);break}D+=k.length,yield*k}else yield*k}async*listGroupRuns(e){const{projectId:r,projectName:n,groupBy:s,filter:a,startTime:i,endTime:o,limit:c,offset:u}=e,d={session_id:r||(await this.readProject({projectName:n})).id,group_by:s,filter:a,start_time:i?i.toISOString():null,end_time:o?o.toISOString():null,limit:Number(c)||100};let h=Number(u)||0;const f="/runs/group",m=`${this.apiUrl}${f}`;for(;;){const _={...d,offset:h},y=Object.fromEntries(Object.entries(_).filter(([C,D])=>D!==void 0)),w=JSON.stringify(y),b=await(await this.caller.call(async()=>{const C=await this._fetch(m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:w});return await de(C,`Failed to fetch ${f}`),C})).json(),{groups:T,total:I}=b;if(T.length===0)break;for(const C of T)yield C;if(h+=T.length,h>=I)break}}async getRunStats({id:e,trace:r,parentRun:n,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:c,endTime:u,error:l,query:d,filter:h,traceFilter:f,treeFilter:m,isRoot:_,dataSourceType:y}){let w=i||[];a&&(w=[...i||[],...await Promise.all(a.map(D=>this.readProject({projectName:D}).then(k=>k.id)))]);const b=Object.fromEntries(Object.entries({id:e,trace:r,parent_run:n,run_type:s,session:w,reference_example:o,start_time:c,end_time:u,error:l,query:d,filter:h,trace_filter:f,tree_filter:m,is_root:_,data_source_type:y}).filter(([D,k])=>k!==void 0)),T=JSON.stringify(b);return await(await this.caller.call(async()=>{const D=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:T});return await de(D,"get run stats"),D})).json()}async shareRun(e,{shareId:r}={}){const n={run_id:e,share_token:r||An()};Ee(e);const s=JSON.stringify(n),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await de(o,"share run"),o})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){Ee(e),await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(r,"unshare run",!0),r})}async readRunSharedLink(e){Ee(e);const n=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(s,"read run shared link"),s})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){const n=new URLSearchParams({share_token:e});if(r!==void 0)for(const i of r)n.append("id",i);return Ee(e),await(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(i,"list shared runs"),i})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),Ee(e);const s=await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(a,"read dataset shared schema"),a})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);const n={dataset_id:e};Ee(e);const s=JSON.stringify(n),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await de(o,"share dataset"),o})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){Ee(e),await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(r,"unshare dataset",!0),r})}async readSharedDataset(e){return Ee(e),await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(s,"read shared dataset"),s})).json()}async listSharedExamples(e,r){const n={};r!=null&&r.exampleIds&&(n.id=r.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,c])=>{Array.isArray(c)?c.forEach(u=>s.append(o,u)):s.append(o,c)});const a=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(o,"list shared examples"),o}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,u=a||{};n&&(u.metadata=n);const l={name:e,extra:u,description:r};i!==null&&(l.reference_dataset_id=i);const d=JSON.stringify(l);return await(await this.caller.call(async()=>{const m=await this._fetch(c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await de(m,"create project"),m})).json()}async updateProject(e,{name:r=null,description:n=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let c=a;s&&(c={...c||{},metadata:s});const u=JSON.stringify({name:r,extra:c,description:n,end_time:i?new Date(i).toISOString():null});return await(await this.caller.call(async()=>{const h=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await de(h,"update project"),h})).json()}async hasProject({projectId:e,projectName:r}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(r!==void 0)s.append("name",r);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(i,"has project"),i});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),s+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:r}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:r}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:s,referenceDatasetName:a,includeStats:i,datasetVersion:o,referenceFree:c,metadata:u}={}){const l=new URLSearchParams;if(e!==void 0)for(const d of e)l.append("id",d);if(r!==void 0&&l.append("name",r),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){const d=await this.readDataset({datasetName:a});l.append("reference_dataset",d.id)}i!==void 0&&l.append("include_stats",i.toString()),o!==void 0&&l.append("dataset_version",o),c!==void 0&&l.append("reference_free",c.toString()),u!==void 0&&l.append("metadata",JSON.stringify(u));for await(const d of this._getPaginated("/sessions",l))yield*d}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,Ee(n),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(s,`delete session ${n} (${r})`,!0),s})}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:s,description:a,dataType:i,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;return u.append("file",e,r),n.forEach(h=>{u.append("input_keys",h)}),s.forEach(h=>{u.append("output_keys",h)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o),await(await this.caller.call(async()=>{const h=await this._fetch(c,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await de(h,"upload CSV"),h})).json()}async createDataset(e,{description:r,dataType:n,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:r,extra:i?{metadata:i}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const c=JSON.stringify(o);return await(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await de(d,"create dataset"),d})).json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e&&r)throw new Error("Must provide either datasetName or datasetId, not both");if(e)Ee(e),n+=`/${e}`;else if(r)s.append("name",r);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(n,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:s}){let a=e;if(a===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:r})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){const n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",c=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(const u of n)c.append("id",u);s!==void 0&&c.append("name",s),a!==void 0&&c.append("name_contains",a),i!==void 0&&c.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,c))yield*u}async updateDataset(e){const{datasetId:r,datasetName:n,...s}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const a=r??(await this.readDataset({datasetName:n})).id;Ee(a);const i=JSON.stringify(s);return await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(c,"update dataset"),c})).json()}async updateDatasetTag(e){const{datasetId:r,datasetName:n,asOf:s,tag:a}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const i=r??(await this.readDataset({datasetName:n})).id;Ee(i);const o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a});await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await de(c,"update dataset tags",!0),c})}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",s=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(s=(await this.readDataset({datasetName:r})).id),s!==void 0)Ee(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const a=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(a,`delete ${n}`,!0),a})}async indexDataset({datasetId:e,datasetName:r,tag:n}){let s=e;if(!s&&!r)throw new Error("Must provide either datasetName or datasetId");if(s&&r)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:r})).id),Ee(s);const i=JSON.stringify({tag:n});await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(c,"index dataset"),c})).json()}async similarExamples(e,r,n,{filter:s}={}){const a={limit:n,inputs:e};s!==void 0&&(a.filter=s),Ee(r);const i=JSON.stringify(a);return(await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${r}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:i});return await de(u,"fetch similar examples"),u})).json()).examples}async createExample(e,r,n){var l;if(Wf(e)&&(r!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=r?n==null?void 0:n.datasetId:e.dataset_id;const a=r?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(r?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;Wf(e)?o=e:o={inputs:e,outputs:r,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const c=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((l=c.example_ids)==null?void 0:l[0])??An())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const g=e;let b=g[0].dataset_id;const T=g[0].dataset_name;if(b===void 0&&T===void 0)throw new Error("Must provide either datasetName or datasetId");if(b!==void 0&&T!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");b===void 0&&(b=(await this.readDataset({datasetName:T})).id);const I=await this._uploadExamplesMultipart(b,g);return await Promise.all(I.example_ids.map(D=>this.readExample(D)))}const{inputs:r,outputs:n,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:c,attachments:u,exampleIds:l,datasetId:d,datasetName:h}=e;if(r===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const m=h;if(f===void 0&&m===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&m!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:m})).id);const _=r.map((g,b)=>({dataset_id:f,inputs:g,outputs:n==null?void 0:n[b],metadata:s==null?void 0:s[b],split:a==null?void 0:a[b],id:l==null?void 0:l[b],attachments:u==null?void 0:u[b],source_run_id:i==null?void 0:i[b],use_source_run_io:o==null?void 0:o[b],use_source_run_attachments:c==null?void 0:c[b]})),y=await this._uploadExamplesMultipart(f,_);return await Promise.all(y.example_ids.map(g=>this.readExample(g)))}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){const s=e.map(i=>Pf(i)?Lf(i):i),a=Pf(r)?Lf(r):r;return this.createExample({input:s},{output:a},n)}async readExample(e){Ee(e);const r=`/examples/${e}`,n=await this._get(r),{attachment_urls:s,...a}=n,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[c,u])=>(o[c.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:c,offset:u,filter:l,includeAttachments:d}={}){let h;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(r!==void 0)h=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),m=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;m&&f.append("as_of",m);const _=i??!0;if(f.append("inline_s3_urls",_.toString()),n!==void 0)for(const w of n)f.append("id",w);if(a!==void 0)for(const w of a)f.append("splits",w);if(o!==void 0){const w=JSON.stringify(o);f.append("metadata",w)}c!==void 0&&f.append("limit",c.toString()),u!==void 0&&f.append("offset",u.toString()),l!==void 0&&f.append("filter",l),d===!0&&["attachment_urls","outputs","metadata"].forEach(w=>f.append("select",w));let y=0;for await(const w of this._getPaginated("/examples",f)){for(const g of w){const{attachment_urls:b,...T}=g,I=T;b&&(I.attachments=Object.entries(b).reduce((C,[D,k])=>(C[D.slice(11)]={presigned_url:k.presigned_url,mime_type:k.mime_type||void 0},C),{})),yield I,y++}if(c!==void 0&&y>=c)break}}async deleteExample(e){Ee(e);const r=`/examples/${e}`;await this.caller.call(async()=>{const n=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(n,`delete ${r}`,!0),n})}async deleteExamples(e,r){if(e.forEach(n=>Ee(n)),r!=null&&r.hardDelete){const n=this._getPlatformEndpointPath("datasets/examples/delete");await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({example_ids:e,hard_delete:!0}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(s,"hard delete examples",!0),s})}else{const n=new URLSearchParams;e.forEach(s=>n.append("example_ids",s)),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/examples?${n.toString()}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(s,"delete examples",!0),s})}}async updateExample(e,r){let n;r?n=e:n=e.id,Ee(n);let s;r?s={id:n,...r}:s=e;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(e){let r;return e[0].dataset_id===void 0?r=(await this.readExample(e[0].id)).dataset_id:r=e[0].dataset_id,this._updateExamplesMultipart(r,e)}async readDatasetVersion({datasetId:e,datasetName:r,asOf:n,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:r})).id,Ee(a),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;return n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&i.append("tag",s),await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(c,"read dataset version"),c})).json()}async listDatasetSplits({datasetId:e,datasetName:r,asOf:n}){let s;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:r})).id:s=e,Ee(s);const a=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:r,splitName:n,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:r})).id:i=e,Ee(i);const o={split_name:n,examples:s.map(u=>(Ee(u),u)),remove:a},c=JSON.stringify(o);await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await de(u,"update dataset splits",!0),u})}async createFeedback(e,r,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var g;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const m={type:c??"api",metadata:o??{}};u!==void 0&&(m==null?void 0:m.metadata)!==void 0&&!m.metadata.__run&&(m.metadata.__run={run_id:u}),(m==null?void 0:m.metadata)!==void 0&&((g=m.metadata.__run)==null?void 0:g.run_id)!==void 0&&Ee(m.metadata.__run.run_id);const _={id:l??An(),run_id:e,key:r,score:Vf(n),value:s,correction:a,comment:i,feedback_source:m,comparative_experiment_id:f,feedbackConfig:d,session_id:h},y=JSON.stringify(_),w=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const b=await this._fetch(w,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await de(b,"create feedback",!0),b}),_}async updateFeedback(e,{score:r,value:n,correction:s,comment:a}){const i={};r!=null&&(i.score=Vf(r)),n!=null&&(i.value=n),s!=null&&(i.correction=s),a!=null&&(i.comment=a),Ee(e);const o=JSON.stringify(i);await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await de(c,"update feedback",!0),c})}async readFeedback(e){Ee(e);const r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){Ee(e);const r=`/feedback/${e}`;await this.caller.call(async()=>{const n=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(n,`delete ${r}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e)for(const a of e)Ee(a),s.append("run",a);if(r)for(const a of r)s.append("key",a);if(n)for(const a of n)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:s}={}){const a={run_id:e,feedback_key:r,feedback_config:s};n?typeof n=="string"?a.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(a.expires_in=n):a.expires_in={hours:3};const i=JSON.stringify(a);return await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(c,"create presigned feedback token"),c})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:s,description:a,metadata:i,id:o}){var d;if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const c={id:o,name:e,experiment_ids:r,reference_dataset_id:n,description:a,created_at:(d=s??new Date)==null?void 0:d.toISOString(),extra:{}};i&&(c.extra.metadata=i);const u=JSON.stringify(c);return(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await de(h,"create comparative experiment"),h})).json()}async*listPresignedFeedbackTokens(e){Ee(e);const r=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:Array.isArray(e)?r=e:r=[e],r}async _logEvaluationFeedback(e,r,n){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=n||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let c=null;i.targetRunId?c=i.targetRunId:r&&(c=r.id),a.push(await this.createFeedback(c,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,r,n){const[s]=await this._logEvaluationFeedback(e,r,n);return s}async*listAnnotationQueues(e={}){const{queueIds:r,name:n,nameContains:s,limit:a}=e,i=new URLSearchParams;r&&r.forEach((c,u)=>{Ee(c,`queueIds[${u}]`),i.append("ids",c)}),n&&i.append("name",n),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const c of this._getPaginated("/annotation-queues",i))if(yield*c,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:r,description:n,queueId:s,rubricInstructions:a}=e,i={name:r,description:n,id:s||An(),rubric_instructions:a},o=JSON.stringify(Object.fromEntries(Object.entries(i).filter(([u,l])=>l!==void 0)));return(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await de(u,"create annotation queue"),u})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,r){const{name:n,description:s,rubricInstructions:a}=r,i=JSON.stringify({name:n,description:s,rubric_instructions:a});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(r,"delete annotation queue",!0),r})}async addRunsToAnnotationQueue(e,r){const n=JSON.stringify(r.map((s,a)=>Ee(s,`runIds[${a}]`).toString()));await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await de(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(e,r){const n=`/annotation-queues/${Ee(e,"queueId")}/run`;return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(a,"get run from annotation queue"),a})).json()}async deleteRunFromAnnotationQueue(e,r){await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs/${Ee(r,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){const r=await this._getSettings();return e=="-"||r.tenant_handle===e}async _ownerConflictError(e,r){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${r}`)}async _getLatestCommitHash(e){const n=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(s,"get latest commit hash"),s})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,r){const[n,s,a]=Qr(e),i=JSON.stringify({like:r});return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(c,`${r?"like":"unlike"} prompt`),c})).json()}async _getPromptUrl(e){const[r,n,s]=Qr(e);if(await this._currentTenantIsOwner(r)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${r}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${r}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const r of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*r}async*listPrompts(e){const r=new URLSearchParams;r.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),r.append("sort_direction","desc"),r.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&r.append("is_public",e.isPublic.toString()),e!=null&&e.query&&r.append("query",e.query);for await(const n of this._getPaginated("/repos",r,s=>s.repos))yield*n}async getPrompt(e){const[r,n,s]=Qr(e),a=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return(o==null?void 0:o.status)===404?null:(await de(o,"get prompt"),o)}),i=await(a==null?void 0:a.json());return i!=null&&i.repo?i.repo:null}async createPrompt(e,r){const n=await this._getSettings();if(r!=null&&r.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=Qr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(r==null?void 0:r.description)&&{description:r.description},...(r==null?void 0:r.readme)&&{readme:r.readme},...(r==null?void 0:r.tags)&&{tags:r.tags},is_public:!!(r!=null&&r.isPublic)},c=JSON.stringify(o),u=await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await de(d,"create prompt"),d}),{repo:l}=await u.json();return l}async createCommit(e,r,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=Qr(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):n==null?void 0:n.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(r)),parent_commit:o},u=JSON.stringify(c),d=await(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await de(h,"create commit"),h})).json();return this._getPromptUrl(`${s}/${a}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,r=[]){return this._updateExamplesMultipart(e,r)}async _updateExamplesMultipart(e,r=[]){var i;if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const o of r){const c=o.id,u={...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split}},l=Dt(u,`Serializing body for example with id: ${c}`),d=new Blob([l],{type:"application/json"});if(n.append(c,d),o.inputs){const h=Dt(o.inputs,`Serializing inputs for example with id: ${c}`),f=new Blob([h],{type:"application/json"});n.append(`${c}.inputs`,f)}if(o.outputs){const h=Dt(o.outputs,`Serializing outputs whle updating example with id: ${c}`),f=new Blob([h],{type:"application/json"});n.append(`${c}.outputs`,f)}if(o.attachments)for(const[h,f]of Object.entries(o.attachments)){let m,_;Array.isArray(f)?[m,_]=f:(m=f.mimeType,_=f.data);const y=new Blob([_],{type:`${m}; length=${_.byteLength}`});n.append(`${c}.attachment.${h}`,y)}if(o.attachments_operations){const h=Dt(o.attachments_operations,`Serializing attachments while updating example with id: ${c}`),f=new Blob([h],{type:"application/json"});n.append(`${c}.attachments_operations`,f)}}const s=e??((i=r[0])==null?void 0:i.dataset_id);return(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await de(o,"update examples"),o})).json()}async uploadExamplesMultipart(e,r=[]){return this._uploadExamplesMultipart(e,r)}async _uploadExamplesMultipart(e,r=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const a of r){const i=(a.id??An()).toString(),o={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},c=Dt(o,`Serializing body for uploaded example with id: ${i}`),u=new Blob([c],{type:"application/json"});if(n.append(i,u),a.inputs){const l=Dt(a.inputs,`Serializing inputs for uploaded example with id: ${i}`),d=new Blob([l],{type:"application/json"});n.append(`${i}.inputs`,d)}if(a.outputs){const l=Dt(a.outputs,`Serializing outputs for uploaded example with id: ${i}`),d=new Blob([l],{type:"application/json"});n.append(`${i}.outputs`,d)}if(a.attachments)for(const[l,d]of Object.entries(a.attachments)){let h,f;Array.isArray(d)?[h,f]=d:(h=d.mimeType,f=d.data);const m=new Blob([f],{type:`${h}; length=${f.byteLength}`});n.append(`${i}.attachment.${l}`,m)}}return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await de(a,"upload examples"),a})).json()}async updatePrompt(e,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=Qr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const a={};if((r==null?void 0:r.description)!==void 0&&(a.description=r.description),(r==null?void 0:r.readme)!==void 0&&(a.readme=r.readme),(r==null?void 0:r.tags)!==void 0&&(a.tags=r.tags),(r==null?void 0:r.isPublic)!==void 0&&(a.is_public=r.isPublic),(r==null?void 0:r.isArchived)!==void 0&&(a.is_archived=r.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=JSON.stringify(a);return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await de(c,"update prompt"),c})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,n,s]=Qr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("delete a prompt",r);return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/repos/${r}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(i,"delete prompt"),i})).json()}_getPromptCacheKey(e,r){return`${e}${r?":with_model":""}`}async _fetchPromptFromApi(e,r){const[n,s,a]=Qr(e),o=await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/commits/${n}/${s}/${a}${r!=null&&r.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await de(c,"pull prompt commit"),c})).json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async pullPromptCommit(e,r){if(!(r!=null&&r.skipCache)&&this._cache){const n=this._getPromptCacheKey(e,r==null?void 0:r.includeModel),s=this._cache.get(n);if(s)return s;const a=await this._fetchPromptFromApi(e,r);return this._cache.set(n,a),a}return this._fetchPromptFromApi(e,r)}async _pullPrompt(e,r){const n=await this.pullPromptCommit(e,{includeModel:r==null?void 0:r.includeModel,skipCache:r==null?void 0:r.skipCache});return JSON.stringify(n.manifest)}async pushPrompt(e,r){return await this.promptExists(e)?r&&Object.keys(r).some(s=>s!=="object")&&await this.updatePrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}):await this.createPrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}),r!=null&&r.object?await this.createCommit(e,r==null?void 0:r.object,{parentCommitHash:r==null?void 0:r.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,r={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=r,[a,i]=this.parseTokenOrUrl(e,n),o=new la({apiUrl:a,apiKey:"placeholder"}),c=await o.readSharedDataset(i),u=s||c.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(i),d=await this.createDataset(u,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(h=>h.inputs),outputs:l.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),h}}parseTokenOrUrl(e,r,n=2,s="dataset"){try{return Ee(e),[r,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){const o=i[i.length-n];return[r,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}get cache(){return this._cache}cleanup(){this._cache&&this._cache.stop()}async awaitPendingTraceBatches(){var e,r;if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await new Promise(n=>setTimeout(n,1)),await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:n})=>n),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await((r=(e=y1())==null?void 0:e.DEFAULT_LANGSMITH_SPAN_PROCESSOR)==null?void 0:r.forceFlush())}}function Wf(t){return"dataset_id"in t||"dataset_name"in t}const WE=t=>!!["TRACING_V2","TRACING"].find(r=>Rt(r)==="true"),fn=Symbol.for("lc:context_variables"),Tc=Symbol.for("langsmith:replica_trace_roots");function Jf(t,e){if(fn in t)return t[fn][e]}function JE(t,e,r){const n=fn in t?t[fn]:{};n[e]=r,t[fn]=n}const $s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function Kf(t){const r=Object.keys(t).sort().map(n=>`${n}:${t[n]??""}`).join("|");return Ns(r,$s)}function KE(t){return t.replace(/[-:.]/g,"")}function og(t,e=1){const r=e.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(t).toISOString().slice(0,-1)}${r}Z`}function cg(t,e,r=1){const n=og(t,r);return{dottedOrder:KE(n)+e,microsecondPrecisionDatestring:n}}const XE=new Set(["projectName","updates","reroot"]);function YE(t){const e={};for(const r of Object.keys(t))XE.has(r)&&(e[r]=t[r]);return e}class ji{constructor(e,r,n,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r,this.project_name=n,this.replicas=s}static fromHeader(e){const r=e.split(",");let n={},s=[],a,i;for(const o of r){const[c,u]=o.split("="),l=decodeURIComponent(u);c==="langsmith-metadata"?n=JSON.parse(l):c==="langsmith-tags"?s=l.split(","):c==="langsmith-project"?a=l:c==="langsmith-replicas"&&(i=JSON.parse(l).map(h=>Array.isArray(h)?h:YE(h)))}return new ji(n,s,a,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class Ct{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_awaitInputsOnPost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),QE(e)){Object.assign(this,{...e});return}const r=Ct.getDefaultConfig(),{metadata:n,...s}=e,a=s.client??Ct.getSharedClient(),i={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},"id"in s&&s.id==null&&delete s.id,Object.assign(this,{...r,...s,client:a}),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),this.dotted_order||(this._serialized_start_time=og(this.start_time,this.execution_order)),this.id||(this.id=e1(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=nT(this.replicas),!this.dotted_order){const{dottedOrder:c}=cg(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+c:this.dotted_order=c}}set metadata(e){var r;this.extra={...this.extra,metadata:{...(r=this.extra)==null?void 0:r.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){const e=Date.now();return{run_type:"chain",project_name:Bm(),child_runs:[],api_url:Pr("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Pr("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Ct.sharedClient||(Ct.sharedClient=new la),Ct.sharedClient}createChild(e){var l,d,h,f,m,_,y;const r=this.child_execution_order+1,n=(l=this.replicas)==null?void 0:l.map(w=>{const{reroot:g,...b}=w;return b}),s=e.replicas??n,a=new Ct({...e,parent_run:this,project_name:this.project_name,replicas:s,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r});fn in this&&(a[fn]=this[fn]);const i=Symbol.for("lc:child_config"),o=((d=e.extra)==null?void 0:d[i])??this.extra[i];if(tT(o)){const w={...o},g=eT(w.callbacks)?(f=(h=w.callbacks).copy)==null?void 0:f.call(h):void 0;g&&(Object.assign(g,{_parentRunId:a.id}),(y=(_=(m=g.handlers)==null?void 0:m.find(ug))==null?void 0:_.updateFromRunTree)==null||y.call(_,a),w.callbacks=g),a.extra[i]=w}const c=new Set;let u=this;for(;u!=null&&!c.has(u.id);)c.add(u.id),u.child_execution_order=Math.max(u.child_execution_order,r),u=u.parent_run;return this.child_runs.push(a),a}async end(e,r,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,r,n=!0){var o,c;const s=e.extra??{};if(((o=s==null?void 0:s.runtime)==null?void 0:o.library)===void 0&&(s.runtime||(s.runtime={}),r))for(const[u,l]of Object.entries(r))s.runtime[u]||(s.runtime[u]=l);let a,i;return n?(i=((c=e.parent_run)==null?void 0:c.id)??e.parent_run_id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,r,n)),i=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,r){if(r.dotted_order){const n=r.dotted_order.split(".");let s=null;for(let a=0;a<n.length;a++)if(n[a].slice(-36)===e){s=a;break}if(s!==null){const a=n.slice(s+1);r.dotted_order=a.join("."),a.length>0?r.trace_id=a[0].slice(-36):r.trace_id=r.id}}r.parent_run_id===e&&(r.parent_run_id=void 0)}_setReplicaTraceRoot(e,r){const n=Jf(this,Tc)??{};n[e]=r,JE(this,Tc,n);for(const s of this.child_runs)s._setReplicaTraceRoot(e,r)}_remapForProject(e){const{projectName:r,runtimeEnv:n,excludeChildRuns:s=!0,reroot:a=!1,distributedParentId:i,apiUrl:o,apiKey:c,workspaceId:u}=e,l=this._convertToCreate(this,n,s);if(r===this.project_name)return{...l,session_name:r};if(a){if(i)this._sliceParentId(i,l);else if(l.parent_run_id=void 0,l.dotted_order){const g=l.dotted_order.split(".");g.length>0&&(l.dotted_order=g[g.length-1],l.trace_id=l.id)}const w=Kf({projectName:r,apiUrl:o,apiKey:c,workspaceId:u});this._setReplicaTraceRoot(w,l.id)}let d;if(!a){const w=Jf(this,Tc)??{},g=Kf({projectName:r,apiUrl:o,apiKey:c,workspaceId:u});if(d=w[g],d&&(l.trace_id=d,l.dotted_order)){const b=l.dotted_order.split(".");let T=null;for(let I=0;I<b.length;I++)if(b[I].slice(-36)===d){T=I;break}if(T!==null){const I=b.slice(T);l.dotted_order=I.join(".")}}}const h=l.id,f=Ns(`${h}:${r}`,$s);let m;l.trace_id?m=Ns(`${l.trace_id}:${r}`,$s):m=f;let _;l.parent_run_id&&(_=Ns(`${l.parent_run_id}:${r}`,$s));let y;return l.dotted_order&&(y=l.dotted_order.split(".").map(b=>{const T=b.slice(-36),I=Ns(`${T}:${r}`,$s);return b.slice(0,-36)+I}).join(".")),{...l,id:f,trace_id:m,parent_run_id:_,dotted_order:y,session_name:r}}async postRun(e=!0){this._awaitInputsOnPost&&(this.inputs=await this.inputs);try{const r=Vm();if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:s,apiUrl:a,workspaceId:i,reroot:o}of this.replicas){const c=this._remapForProject({projectName:n??this.project_name,runtimeEnv:r,excludeChildRuns:!0,reroot:o,distributedParentId:this.distributedParentId,apiUrl:a,apiKey:s,workspaceId:i});await this.client.createRun(c,{apiKey:s,apiUrl:a,workspaceId:i})}else{const n=this._convertToCreate(this,r,e);await this.client.createRun(n)}if(!e){zm("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const n of this.child_runs)await n.postRun(!1)}this.child_runs=[]}catch(r){console.error(`Error in postRun for run ${this.id}:`,r)}}async patchRun(e){var r;if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:s,apiUrl:a,workspaceId:i,updates:o,reroot:c}of this.replicas){const u=this._remapForProject({projectName:n??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:c,distributedParentId:this.distributedParentId,apiUrl:a,apiKey:s,workspaceId:i}),l={id:u.id,name:u.name,run_type:u.run_type,start_time:u.start_time,outputs:u.outputs,error:u.error,parent_run_id:u.parent_run_id,session_name:u.session_name,reference_example_id:u.reference_example_id,end_time:u.end_time,dotted_order:u.dotted_order,trace_id:u.trace_id,events:u.events,tags:u.tags,extra:u.extra,attachments:this.attachments,...o};e!=null&&e.excludeInputs||(l.inputs=u.inputs),await this.client.updateRun(u.id,l,{apiKey:s,apiUrl:a,workspaceId:i})}else try{const n={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:((r=this.parent_run)==null?void 0:r.id)??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e!=null&&e.excludeInputs||(n.inputs=this.inputs),await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}this.child_runs=[]}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,r){var u,l,d,h;const n=e==null?void 0:e.callbacks;let s,a,i,o=WE();if(n){const f=((u=n==null?void 0:n.getParentRunId)==null?void 0:u.call(n))??"",m=(l=n==null?void 0:n.handlers)==null?void 0:l.find(_=>(_==null?void 0:_.name)=="langchain_tracer");s=(d=m==null?void 0:m.getRun)==null?void 0:d.call(m,f),a=m==null?void 0:m.projectName,i=m==null?void 0:m.client,o=o||!!m}return s?new Ct({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(r):new Ct({...r,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){var l;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(d=>{const[h,f]=d.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:f}}),o=i[0].uuid,c={...r,name:(r==null?void 0:r.name)??"parent",run_type:(r==null?void 0:r.run_type)??"chain",start_time:(r==null?void 0:r.start_time)??Date.now(),id:(l=i.at(-1))==null?void 0:l.uuid,trace_id:o,dotted_order:a};if(n.baggage&&typeof n.baggage=="string"){const d=ji.fromHeader(n.baggage);c.metadata=d.metadata,c.tags=d.tags,c.project_name=d.project_name,c.replicas=d.replicas}const u=new Ct(c);return u.distributedParentId=u.id,u}toHeaders(e){var n;const r={"langsmith-trace":this.dotted_order,baggage:new ji((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[s,a]of Object.entries(r))e.set(s,a);return r}}Object.defineProperty(Ct,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function QE(t){return t!=null&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function ug(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function Xf(t){return Array.isArray(t)&&t.some(e=>ug(e))}function eT(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function tT(t){const e=t==null?void 0:t.callbacks;return t!=null&&typeof e=="object"&&(Xf(e==null?void 0:e.handlers)||Xf(e))}function rT(){const t=Pr("LANGSMITH_RUNS_ENDPOINTS");if(!t)return[];try{const e=JSON.parse(t);if(Array.isArray(e)){const r=[];for(const n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}r.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return r}else if(typeof e=="object"&&e!==null){sT(e);const r=[];for(const[n,s]of Object.entries(e)){const a=n.replace(/\/$/,"");if(typeof s=="string")r.push({apiUrl:a,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof s}`);continue}}return r}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(PE(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function nT(t){return t?t.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):rT()}function sT(t){if(Object.keys(t).length>0&&Rt("ENDPOINT"))throw new RE}var aT={};Ne(aT,{BaseTracer:()=>bs,isBaseTracer:()=>Qn});const iT=t=>{if(t)return t.events=t.events??[],t.child_runs=t.child_runs??[],t};function Tu(t,e){if(t)return new Ct({...t,start_time:t._serialized_start_time??t.start_time,parent_run:Tu(e),child_runs:t.child_runs.map(r=>Tu(r)).filter(r=>r!==void 0),extra:{...t.extra,runtime:Mm()},tracingEnabled:!1})}function Sc(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function Qn(t){return typeof t._addRunToRunMap=="function"}var bs=class extends xa{constructor(e){super(...arguments);E(this,"runMap",new Map);E(this,"runTreeMap",new Map);E(this,"usesRunTreeMap",!1)}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?iT(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}_addRunToRunMap(e){const{dottedOrder:r,microsecondPrecisionDatestring:n}=cg(new Date(e.start_time).getTime(),e.id,e.execution_order),s={...e},a=this.getRunById(s.parent_run_id);if(s.parent_run_id!==void 0?a?(this._addChildRun(a,s),a.child_execution_order=Math.max(a.child_execution_order,s.child_execution_order),s.trace_id=a.trace_id,a.dotted_order!==void 0&&(s.dotted_order=[a.dotted_order,r].join("."),s._serialized_start_time=n)):s.parent_run_id=void 0:(s.trace_id=s.id,s.dotted_order=r,s._serialized_start_time=n),this.usesRunTreeMap){const i=Tu(s,a);i!==void 0&&this.runTreeMap.set(s.id,i)}else this.runMap.set(s.id,s);return s}async _endTrace(e){var n;const r=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),await((n=this.onRunUpdate)==null?void 0:n.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const r=e!==void 0&&this.getRunById(e);return r?r.child_execution_order+1:1}_createRunForLLMStart(e,r,n,s,a,i,o,c){const u=this._getExecutionOrder(s),l=Date.now(),d=o?{...a,metadata:o}:a,h={id:n,name:c??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:r},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,r,n,s,a,i,o,c){var l,d;const u=this.getRunById(n)??this._createRunForLLMStart(e,r,n,s,a,i,o,c);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,r,n,s,a,i,o,c){const u=this._getExecutionOrder(s),l=Date.now(),d=o?{...a,metadata:o}:a,h={id:n,name:c??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:r},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,r,n,s,a,i,o,c){var l,d;const u=this.getRunById(n)??this._createRunForChatModelStart(e,r,n,s,a,i,o,c);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,r,n,s,a){var o;const i=this.getRunById(r);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,r,n,s,a){var o;const i=this.getRunById(r);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,r,n,s,a,i,o,c,u){const l=this._getExecutionOrder(s),d=Date.now(),h={id:n,name:c??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:r,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:i?{...u,metadata:i}:{...u},tags:a||[]};return this._addRunToRunMap(h)}async handleChainStart(e,r,n,s,a,i,o,c){var l,d;const u=this.getRunById(n)??this._createRunForChainStart(e,r,n,s,a,i,o,c);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,r,n,s,a){var o;const i=this.getRunById(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Sc(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=Sc(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,r,n,s,a){var o;const i=this.getRunById(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=Sc(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,r,n,s,a,i,o){const c=this._getExecutionOrder(s),u=Date.now(),l={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:r},execution_order:c,child_execution_order:c,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(l)}async handleToolStart(e,r,n,s,a,i,o){var u,l;const c=this.getRunById(n)??this._createRunForToolStart(e,r,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((l=this.onToolStart)==null?void 0:l.call(this,c)),c}async handleToolEnd(e,r){var s;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,r){var s;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,n))}async handleAgentEnd(e,r){var s;const n=this.getRunById(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,r,n,s,a,i,o){const c=this._getExecutionOrder(s),u=Date.now(),l={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:r},execution_order:c,child_execution_order:c,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,r,n,s,a,i,o){var u,l;const c=this.getRunById(n)??this._createRunForRetrieverStart(e,r,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((l=this.onRetrieverStart)==null?void 0:l.call(this,c)),c}async handleRetrieverEnd(e,r){var s;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,r){var s;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,r){var s;const n=this.getRunById(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,r,n,s,a,i){var c;const o=this.getRunById(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:i==null?void 0:i.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}},jl={exports:{}};jl.exports;(function(t){const r=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,n=(a=0)=>(i,o,c)=>`\x1B[${38+a};2;${i};${o};${c}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,c]of Object.entries(i)){for(const[u,l]of Object.entries(c))i[u]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},c[u]=i[u],a.set(l[0],l[1]);Object.defineProperty(i,o,{value:c,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=r(),i.color.ansi16m=n(),i.bgColor.ansi256=r(10),i.bgColor.ansi16m=n(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const l=Number.parseInt(u,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(t,"exports",{enumerable:!0,get:s})})(jl);var oT=jl.exports;const lg=ml(oT);var cT={};Ne(cT,{ConsoleCallbackHandler:()=>Su});function wt(t,e){return`${t.open}${e}${t.close}`}function Ht(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function Yf(t){return typeof t=="string"?t.trim():t==null?t:Ht(t,t.toString())}function en(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Ot}=lg;var Su=class extends bs{constructor(){super(...arguments);E(this,"name","console_callback_handler")}persistRun(e){return Promise.resolve()}getParents(e){const r=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)r.push(s),n=s;else break}return r}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?wt(lg.bold,o):o}).join(" > ");return wt(Ot.grey,n)}onChainStart(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.green,"[chain/start]")} [${r}] Entering Chain run with input: ${Ht(e.inputs,"[inputs]")}`)}onChainEnd(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.cyan,"[chain/end]")} [${r}] [${en(e)}] Exiting Chain run with output: ${Ht(e.outputs,"[outputs]")}`)}onChainError(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.red,"[chain/error]")} [${r}] [${en(e)}] Chain run errored with error: ${Ht(e.error,"[error]")}`)}onLLMStart(e){const r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${wt(Ot.green,"[llm/start]")} [${r}] Entering LLM run with input: ${Ht(n,"[inputs]")}`)}onLLMEnd(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.cyan,"[llm/end]")} [${r}] [${en(e)}] Exiting LLM run with output: ${Ht(e.outputs,"[response]")}`)}onLLMError(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.red,"[llm/error]")} [${r}] [${en(e)}] LLM run errored with error: ${Ht(e.error,"[error]")}`)}onToolStart(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.green,"[tool/start]")} [${r}] Entering Tool run with input: "${Yf(e.inputs.input)}"`)}onToolEnd(e){var n;const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.cyan,"[tool/end]")} [${r}] [${en(e)}] Exiting Tool run with output: "${Yf((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.red,"[tool/error]")} [${r}] [${en(e)}] Tool run errored with error: ${Ht(e.error,"[error]")}`)}onRetrieverStart(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${Ht(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.cyan,"[retriever/end]")} [${r}] [${en(e)}] Exiting Retriever run with output: ${Ht(e.outputs,"[outputs]")}`)}onRetrieverError(e){const r=this.getBreadcrumbs(e);console.log(`${wt(Ot.red,"[retriever/error]")} [${r}] [${en(e)}] Retriever run errored with error: ${Ht(e.error,"[error]")}`)}onAgentAction(e){const r=e,n=this.getBreadcrumbs(e);console.log(`${wt(Ot.blue,"[agent/action]")} [${n}] Agent selected action: ${Ht(r.actions[r.actions.length-1],"[action]")}`)}};let xc;const dg=()=>{if(xc===void 0){const t=Nr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};xc=new la(t)}return xc};let uT=class{getStore(){}run(e,r){return r()}};const Ic=Symbol.for("ls:tracing_async_local_storage"),lT=new uT;let dT=class{getInstance(){return globalThis[Ic]??lT}initializeGlobalInstance(e){globalThis[Ic]===void 0&&(globalThis[Ic]=e)}};const fT=new dT;function hT(t=!1){const e=fT.getInstance().getStore();if(!t&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Fl(t){return typeof t=="function"&&"langsmith:traceable"in t}var pT={};Ne(pT,{LangChainTracer:()=>gi});function mT(t){let e;for(const r of t)for(const n of r)It.isInstance(n.message)&&n.message.usage_metadata!==void 0&&(e=Il(e,n.message.usage_metadata));return e}var gi=class fg extends bs{constructor(r={}){super(r);E(this,"name","langchain_tracer");E(this,"projectName");E(this,"exampleId");E(this,"client");E(this,"replicas");E(this,"usesRunTreeMap",!0);const{exampleId:n,projectName:s,client:a,replicas:i}=r;this.projectName=s??Bm(),this.replicas=i,this.exampleId=n,this.client=a??dg();const o=fg.getTraceableRunTree();o&&this.updateFromRunTree(o)}async persistRun(r){}async onRunCreate(r){var n;if(!((n=r.extra)!=null&&n.lc_defers_inputs)){const s=this.getRunTreeWithTracingConfig(r.id);await(s==null?void 0:s.postRun())}}async onRunUpdate(r){var s;const n=this.getRunTreeWithTracingConfig(r.id);(s=r.extra)!=null&&s.lc_defers_inputs?await(n==null?void 0:n.postRun()):await(n==null?void 0:n.patchRun())}onLLMEnd(r){const n=r.outputs;if(n!=null&&n.generations){const s=mT(n.generations);if(s!==void 0){r.extra=r.extra??{};const a=r.extra.metadata??{};a.usage_metadata=s,r.extra.metadata=a}}}getRun(r){return this.runTreeMap.get(r)}updateFromRunTree(r){this.runTreeMap.set(r.id,r);let n=r;const s=new Set;for(;n.parent_run&&!(s.has(n.id)||(s.add(n.id),!n.parent_run));)n=n.parent_run;s.clear();const a=[n];for(;a.length>0;){const i=a.shift();!i||s.has(i.id)||(s.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&a.push(...i.child_runs))}this.client=r.client??this.client,this.replicas=r.replicas??this.replicas,this.projectName=r.project_name??this.projectName,this.exampleId=r.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(r){const n=this.runTreeMap.get(r);if(n)return new Ct({...n,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return hT(!0)}catch{return}}};const hg=Symbol.for("ls:tracing_async_local_storage"),Ws=Symbol.for("lc:context_variables"),gT=t=>{globalThis[hg]=t},da=()=>globalThis[hg];let $n;function _T(){const t="default"in Zr?Zr.default:Zr;return new t({autoStart:!0,concurrency:1})}function yT(){return typeof $n>"u"&&($n=_T()),$n}async function Qe(t,e){if(e===!0){const r=da();r!==void 0?await r.run(void 0,async()=>t()):await t()}else $n=yT(),$n.add(async()=>{const r=da();r!==void 0?await r.run(void 0,async()=>t()):await t()})}async function vT(){const t=dg();await Promise.allSettled([typeof $n<"u"?$n.onIdle():Promise.resolve(),t.awaitPendingTraceBatches()])}var bT={};Ne(bT,{awaitAllCallbacks:()=>vT,consumeCallback:()=>Qe});const wT=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(r=>Nr(r)==="true");function pg(t){var n;const e=da();if(e===void 0)return;const r=e.getStore();return(n=r==null?void 0:r[Ws])==null?void 0:n[t]}const ET=Symbol("lc:configure_hooks"),TT=()=>pg(ET)||[];var ST={};Ne(ST,{BaseCallbackManager:()=>mg,BaseRunManager:()=>Aa,CallbackManager:()=>Pt,CallbackManagerForChainRun:()=>_g,CallbackManagerForLLMRun:()=>xu,CallbackManagerForRetrieverRun:()=>gg,CallbackManagerForToolRun:()=>yg,ensureHandler:()=>fa,parseCallbackConfigArg:()=>To});function To(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}var mg=class{setHandler(t){return this.setHandlers([t])}},Aa=class{constructor(t,e,r,n,s,a,i,o){this.runId=t,this.handlers=e,this.inheritableHandlers=r,this.tags=n,this.inheritableTags=s,this.metadata=a,this.inheritableMetadata=i,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;try{await((r=e.handleText)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleText: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleCustomEvent(t,e,r,n,s){await Promise.all(this.handlers.map(a=>Qe(async()=>{var i;try{await((i=a.handleCustomEvent)==null?void 0:i.call(a,t,e,this.runId,this.tags,this.metadata))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},gg=class extends Aa{getChild(t){const e=new Pt(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleRetrieverEnd(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;if(!e.ignoreRetriever)try{await((r=e.handleRetrieverEnd)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetriever`),e.raiseError)throw n}},e.awaitHandlers)))}async handleRetrieverError(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;if(!e.ignoreRetriever)try{await((r=e.handleRetrieverError)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetrieverError: ${n}`),e.raiseError)throw t}},e.awaitHandlers)))}},xu=class extends Aa{async handleLLMNewToken(t,e,r,n,s,a){await Promise.all(this.handlers.map(i=>Qe(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMNewToken)==null?void 0:o.call(i,t,e??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMNewToken: ${c}`),i.raiseError)throw c}},i.awaitHandlers)))}async handleLLMError(t,e,r,n,s){await Promise.all(this.handlers.map(a=>Qe(async()=>{var i;if(!a.ignoreLLM)try{await((i=a.handleLLMError)==null?void 0:i.call(a,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleLLMEnd(t,e,r,n,s){await Promise.all(this.handlers.map(a=>Qe(async()=>{var i;if(!a.ignoreLLM)try{await((i=a.handleLLMEnd)==null?void 0:i.call(a,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},_g=class extends Aa{getChild(t){const e=new Pt(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleChainError(t,e,r,n,s){await Promise.all(this.handlers.map(a=>Qe(async()=>{var i;if(!a.ignoreChain)try{await((i=a.handleChainError)==null?void 0:i.call(a,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleChainEnd(t,e,r,n,s){await Promise.all(this.handlers.map(a=>Qe(async()=>{var i;if(!a.ignoreChain)try{await((i=a.handleChainEnd)==null?void 0:i.call(a,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleAgentAction(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;if(!e.ignoreAgent)try{await((r=e.handleAgentAction)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentAction: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleAgentEnd(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;if(!e.ignoreAgent)try{await((r=e.handleAgentEnd)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentEnd: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}},yg=class extends Aa{getChild(t){const e=new Pt(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleToolError(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;if(!e.ignoreAgent)try{await((r=e.handleToolError)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolError: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}async handleToolEnd(t){await Promise.all(this.handlers.map(e=>Qe(async()=>{var r;if(!e.ignoreAgent)try{await((r=e.handleToolEnd)==null?void 0:r.call(e,t,this.runId,this._parentRunId,this.tags))}catch(n){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolEnd: ${n}`),e.raiseError)throw n}},e.awaitHandlers)))}},Pt=class Rs extends mg{constructor(r,n){super();E(this,"handlers",[]);E(this,"inheritableHandlers",[]);E(this,"tags",[]);E(this,"inheritableTags",[]);E(this,"metadata",{});E(this,"inheritableMetadata",{});E(this,"name","callback_manager");E(this,"_parentRunId");this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=r}getParentRunId(){return this._parentRunId}async handleLLMStart(r,n,s=void 0,a=void 0,i=void 0,o=void 0,c=void 0,u=void 0){return Promise.all(n.map(async(l,d)=>{const h=d===0&&s?s:on();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Qn(f)&&f._createRunForLLMStart(r,[l],h,this._parentRunId,i,this.tags,this.metadata,u),Qe(async()=>{var m;try{await((m=f.handleLLMStart)==null?void 0:m.call(f,r,[l],h,this._parentRunId,i,this.tags,this.metadata,u))}catch(_){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${_}`),f.raiseError)throw _}},f.awaitHandlers)})),new xu(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(r,n,s=void 0,a=void 0,i=void 0,o=void 0,c=void 0,u=void 0){return Promise.all(n.map(async(l,d)=>{const h=d===0&&s?s:on();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Qn(f)&&f._createRunForChatModelStart(r,[l],h,this._parentRunId,i,this.tags,this.metadata,u),Qe(async()=>{var m,_;try{if(f.handleChatModelStart)await((m=f.handleChatModelStart)==null?void 0:m.call(f,r,[l],h,this._parentRunId,i,this.tags,this.metadata,u));else if(f.handleLLMStart){const y=Al(l);await((_=f.handleLLMStart)==null?void 0:_.call(f,r,[y],h,this._parentRunId,i,this.tags,this.metadata,u))}}catch(y){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${y}`),f.raiseError)throw y}},f.awaitHandlers)})),new xu(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(r,n,s=on(),a=void 0,i=void 0,o=void 0,c=void 0,u=void 0,l=void 0){return await Promise.all(this.handlers.map(d=>{if(!d.ignoreChain)return Qn(d)&&d._createRunForChainStart(r,n,s,this._parentRunId,this.tags,this.metadata,a,c,l),Qe(async()=>{var h;try{await((h=d.handleChainStart)==null?void 0:h.call(d,r,n,s,this._parentRunId,this.tags,this.metadata,a,c,l))}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleChainStart: ${f}`),d.raiseError)throw f}},d.awaitHandlers)})),new _g(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(r,n,s=on(),a=void 0,i=void 0,o=void 0,c=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Qn(u)&&u._createRunForToolStart(r,n,s,this._parentRunId,this.tags,this.metadata,c),Qe(async()=>{var l;try{await((l=u.handleToolStart)==null?void 0:l.call(u,r,n,s,this._parentRunId,this.tags,this.metadata,c))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new yg(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(r,n,s=on(),a=void 0,i=void 0,o=void 0,c=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Qn(u)&&u._createRunForRetrieverStart(r,n,s,this._parentRunId,this.tags,this.metadata,c),Qe(async()=>{var l;try{await((l=u.handleRetrieverStart)==null?void 0:l.call(u,r,n,s,this._parentRunId,this.tags,this.metadata,c))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new gg(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(r,n,s,a,i){await Promise.all(this.handlers.map(o=>Qe(async()=>{var c;if(!o.ignoreCustomEvent)try{await((c=o.handleCustomEvent)==null?void 0:c.call(o,r,n,s,this.tags,this.metadata))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}addHandler(r,n=!0){this.handlers.push(r),n&&this.inheritableHandlers.push(r)}removeHandler(r){this.handlers=this.handlers.filter(n=>n!==r),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==r)}setHandlers(r,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const s of r)this.addHandler(s,n)}addTags(r,n=!0){this.removeTags(r),this.tags.push(...r),n&&this.inheritableTags.push(...r)}removeTags(r){this.tags=this.tags.filter(n=>!r.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!r.includes(n))}addMetadata(r,n=!0){this.metadata={...this.metadata,...r},n&&(this.inheritableMetadata={...this.inheritableMetadata,...r})}removeMetadata(r){for(const n of Object.keys(r))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(r=[],n=!0){const s=new Rs(this._parentRunId);for(const a of this.handlers){const i=this.inheritableHandlers.includes(a);s.addHandler(a,i)}for(const a of this.tags){const i=this.inheritableTags.includes(a);s.addTags([a],i)}for(const a of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(a);s.addMetadata({[a]:this.metadata[a]},i)}for(const a of r)s.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||s.addHandler(a,n);return s}static fromHandlers(r){class n extends xa{constructor(){super();E(this,"name",on());Object.assign(this,r)}}const s=new this;return s.addHandler(new n),s}static configure(r,n,s,a,i,o,c){return this._configureSync(r,n,s,a,i,o,c)}static _configureSync(r,n,s,a,i,o,c){var f;let u;(r||n)&&(Array.isArray(r)||!r?(u=new Rs,u.setHandlers((r==null?void 0:r.map(fa))??[],!0)):u=r,u=u.copy(Array.isArray(n)?n.map(fa):n==null?void 0:n.handlers,!1));const l=Nr("LANGCHAIN_VERBOSE")==="true"||(c==null?void 0:c.verbose),d=((f=gi.getTraceableRunTree())==null?void 0:f.tracingEnabled)||wT(),h=d||(Nr("LANGCHAIN_TRACING")??!1);if(l||h){if(u||(u=new Rs),l&&!u.handlers.some(m=>m.name===Su.prototype.name)){const m=new Su;u.addHandler(m,!0)}if(h&&!u.handlers.some(m=>m.name==="langchain_tracer")&&d){const m=new gi;u.addHandler(m,!0)}if(d){const m=gi.getTraceableRunTree();if(m&&u._parentRunId===void 0){u._parentRunId=m.id;const _=u.handlers.find(y=>y.name==="langchain_tracer");_==null||_.updateFromRunTree(m)}}}for(const{contextVar:m,inheritable:_=!0,handlerClass:y,envVar:w}of TT()){const g=w&&Nr(w)==="true"&&y;let b;const T=m!==void 0?pg(m):void 0;T&&Fm(T)?b=T:g&&(b=new y({})),b!==void 0&&(u||(u=new Rs),u.handlers.some(I=>I.name===b.name)||u.addHandler(b,_))}return(s||a)&&u&&(u.addTags(s??[]),u.addTags(a??[],!1)),(i||o)&&u&&(u.addMetadata(i??{}),u.addMetadata(o??{},!1)),u}};function fa(t){return"name"in t?t:xa.fromMethods(t)}var vg=class{getStore(){}run(t,e){return e()}enterWith(t){}};const xT=new vg,Qf=Symbol.for("lc:child_config");var IT=class{getInstance(){return da()??xT}getRunnableConfig(){var e,r;return(r=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:r[Qf]}runWithConfig(t,e,r){var u;const n=Pt._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),s=this.getInstance(),a=s.getStore(),i=n==null?void 0:n.getParentRunId(),o=(u=n==null?void 0:n.handlers)==null?void 0:u.find(l=>(l==null?void 0:l.name)==="langchain_tracer");let c;return o&&i?c=o.getRunTreeWithTracingConfig(i):r||(c=new Ct({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Qf]:t}),a!==void 0&&a[Ws]!==void 0&&(c===void 0&&(c={}),c[Ws]=a[Ws]),s.run(c,e)}initializeGlobalInstance(t){da()===void 0&&gT(t)}};const mr=new IT;var AT={};Ne(AT,{AsyncLocalStorageProviderSingleton:()=>mr,MockAsyncLocalStorage:()=>vg,_CONTEXT_VARIABLES_KEY:()=>Ws});const Ac=25;async function qt(t){return Pt._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function Fi(...t){const e={};for(const r of t.filter(n=>!!n))for(const n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=r.timeout:r.timeout!==void 0&&(e.timeout=Math.min(e.timeout,r.timeout));else if(n==="signal")e.signal===void 0?e.signal=r.signal:r.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,r.signal]):e.signal=r.signal);else if(n==="callbacks"){const s=e.callbacks,a=r.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(fa(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(fa(o),!0);e.callbacks=i}else e.callbacks=new Pt(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=n;e[s]=r[s]??e[s]}return e}const kT=new Set(["string","number","boolean"]);function Pe(t){var n;const e=mr.getRunnableConfig();let r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;r=Object.entries(i).reduce((o,[c,u])=>(u!==void 0&&(o[c]=u),o),r)}if(t&&(r=Object.entries(t).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),r)),r!=null&&r.configurable)for(const s of Object.keys(r.configurable))kT.has(typeof r.configurable[s])&&!((n=r.metadata)!=null&&n[s])&&(r.metadata||(r.metadata={}),r.metadata[s]=r.configurable[s]);if(r.timeout!==void 0){if(r.timeout<=0)throw new Error("Timeout must be a positive number");const s=r.timeout,a=AbortSignal.timeout(s);r.metadata||(r.metadata={}),r.metadata.timeoutMs===void 0&&(r.metadata.timeoutMs=s),r.signal!==void 0?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,a])):r.signal=a,delete r.timeout}return r}function qe(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:s,configurable:a,runId:i}={}){const o=Pe(t);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),r!==void 0&&(o.maxConcurrency=r),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function Jr(t){if(t)return{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal,store:t.store}}async function Kr(t,e){if(e===void 0)return t;let r;return Promise.race([t.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{r=()=>{s(ha(e))},e.addEventListener("abort",r),e.aborted&&s(ha(e))})]).finally(()=>e.removeEventListener("abort",r))}function ha(t){return(t==null?void 0:t.reason)instanceof Error?t.reason:typeof(t==null?void 0:t.reason)=="string"?new Error(t.reason):new Error("Aborted")}function j(t,e,r){function n(o,c){var u;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(u=o._zod).traits??(u.traits=new Set),o._zod.traits.add(t),e(o,c);for(const l in i.prototype)l in o||Object.defineProperty(o,l,{value:i.prototype[l].bind(o)});o._zod.constr=i,o._zod.def=c}const s=(r==null?void 0:r.Parent)??Object;class a extends s{}Object.defineProperty(a,"name",{value:t});function i(o){var c;const u=r!=null&&r.Parent?new a:this;n(u,o),(c=u._zod).deferred??(c.deferred=[]);for(const l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:o=>{var c,u;return r!=null&&r.Parent&&o instanceof r.Parent?!0:(u=(c=o==null?void 0:o._zod)==null?void 0:c.traits)==null?void 0:u.has(t)}}),Object.defineProperty(i,"name",{value:t}),i}class pa extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const bg={};function gn(t){return bg}function wg(t){const e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,s])=>e.indexOf(+n)===-1).map(([n,s])=>s)}function OT(t,e){return typeof e=="bigint"?e.toString():e}function Ul(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function Bl(t){return t==null}function zl(t){const e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function CT(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=r>n?r:n,a=Number.parseInt(t.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}function Ze(t,e,r){Object.defineProperty(t,e,{get(){{const n=r();return t[e]=n,n}},set(n){Object.defineProperty(t,e,{value:n})},configurable:!0})}function ql(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Ss(t){return JSON.stringify(t)}const Eg=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function Ui(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const NT=Ul(()=>{var t;if(typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)!=null&&t.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Bi(t){if(Ui(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return!(Ui(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}const $T=new Set(["string","number","symbol"]);function ka(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _t(t,e,r){const n=new t._zod.constr(e??t._zod.def);return(!e||r!=null&&r.parent)&&(n._zod.parent=t),n}function ge(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function RT(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const PT={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function LT(t,e){const r={},n=t._zod.def;for(const s in e){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(r[s]=n.shape[s])}return _t(t,{...t._zod.def,shape:r,checks:[]})}function DT(t,e){const r={...t._zod.def.shape},n=t._zod.def;for(const s in e){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete r[s]}return _t(t,{...t._zod.def,shape:r,checks:[]})}function Tg(t,e){if(!Bi(e))throw new Error("Invalid input to extend: expected a plain object");const r={...t._zod.def,get shape(){const n={...t._zod.def.shape,...e};return ql(this,"shape",n),n},checks:[]};return _t(t,r)}function MT(t,e){return _t(t,{...t._zod.def,get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return ql(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function Sg(t,e,r){const n=e._zod.def.shape,s={...n};if(r)for(const a in r){if(!(a in n))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(s[a]=t?new t({type:"optional",innerType:n[a]}):n[a])}else for(const a in n)s[a]=t?new t({type:"optional",innerType:n[a]}):n[a];return _t(e,{...e._zod.def,shape:s,checks:[]})}function jT(t,e,r){const n=e._zod.def.shape,s={...n};if(r)for(const a in r){if(!(a in s))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(s[a]=new t({type:"nonoptional",innerType:n[a]}))}else for(const a in n)s[a]=new t({type:"nonoptional",innerType:n[a]});return _t(e,{...e._zod.def,shape:s,checks:[]})}function Js(t,e=0){var r;for(let n=e;n<t.issues.length;n++)if(((r=t.issues[n])==null?void 0:r.continue)!==!0)return!0;return!1}function On(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Ja(t){return typeof t=="string"?t:t==null?void 0:t.message}function _n(t,e,r){var s,a,i,o,c,u;const n={...t,path:t.path??[]};if(!t.message){const l=Ja((i=(a=(s=t.inst)==null?void 0:s._zod.def)==null?void 0:a.error)==null?void 0:i.call(a,t))??Ja((o=e==null?void 0:e.error)==null?void 0:o.call(e,t))??Ja((c=r.customError)==null?void 0:c.call(r,t))??Ja((u=r.localeError)==null?void 0:u.call(r,t))??"Invalid input";n.message=l}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}function Zl(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function ma(...t){const[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}const xg=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,OT,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Ig=j("$ZodError",xg),So=j("$ZodError",xg,{Parent:Error});function FT(t,e=r=>r.message){const r={},n=[];for(const s of t.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:r}}function UT(t,e){const r=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(o=>s({issues:o}));else if(i.code==="invalid_key")s({issues:i.issues});else if(i.code==="invalid_element")s({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let o=n,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(r(i))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return s(t),n}function BT(t){const e=[];for(const r of t)typeof r=="number"?e.push(`[${r}]`):typeof r=="symbol"?e.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?e.push(`[${JSON.stringify(r)}]`):(e.length&&e.push("."),e.push(r));return e.join("")}function zT(t){var n;const e=[],r=[...t.issues].sort((s,a)=>s.path.length-a.path.length);for(const s of r)e.push(` ${s.message}`),(n=s.path)!=null&&n.length&&e.push(`   at ${BT(s.path)}`);return e.join(`
`)}const Ag=t=>(e,r,n,s)=>{const a=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},a);if(i instanceof Promise)throw new pa;if(i.issues.length){const o=new((s==null?void 0:s.Err)??t)(i.issues.map(c=>_n(c,a,gn())));throw Eg(o,s==null?void 0:s.callee),o}return i.value},xo=Ag(So),kg=t=>async(e,r,n,s)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let i=e._zod.run({value:r,issues:[]},a);if(i instanceof Promise&&(i=await i),i.issues.length){const o=new((s==null?void 0:s.Err)??t)(i.issues.map(c=>_n(c,a,gn())));throw Eg(o,s==null?void 0:s.callee),o}return i.value},Og=kg(So),Cg=t=>(e,r,n)=>{const s=n?{...n,async:!1}:{async:!1},a=e._zod.run({value:r,issues:[]},s);if(a instanceof Promise)throw new pa;return a.issues.length?{success:!1,error:new(t??Ig)(a.issues.map(i=>_n(i,s,gn())))}:{success:!0,data:a.value}},qT=Cg(So),Ng=t=>async(e,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let a=e._zod.run({value:r,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new t(a.issues.map(i=>_n(i,s,gn())))}:{success:!0,data:a.value}},ZT=Ng(So),GT=/^[cC][^\s-]{8,}$/,VT=/^[0-9a-z]+$/,HT=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,WT=/^[0-9a-vA-V]{20}$/,JT=/^[A-Za-z0-9]{27}$/,KT=/^[a-zA-Z0-9_-]{21}$/,XT=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,YT=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,eh=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,QT=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,eS="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function tS(){return new RegExp(eS,"u")}const rS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,nS=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,sS=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,aS=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,iS=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,$g=/^[A-Za-z0-9_-]*$/,oS=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,cS=/^\+(?:[0-9]){6,14}[0-9]$/,Rg="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",uS=new RegExp(`^${Rg}$`);function Pg(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function lS(t){return new RegExp(`^${Pg(t)}$`)}function dS(t){const e=Pg({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");const n=`${e}(?:${r.join("|")})`;return new RegExp(`^${Rg}T(?:${n})$`)}const fS=t=>{const e=t?`[\\s\\S]{${(t==null?void 0:t.minimum)??0},${(t==null?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},hS=/^\d+$/,pS=/^-?\d+(?:\.\d+)?/i,mS=/^[^A-Z]*$/,gS=/^[^a-z]*$/,Lt=j("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),Lg={number:"number",bigint:"bigint",object:"date"},Dg=j("$ZodCheckLessThan",(t,e)=>{Lt.init(t,e);const r=Lg[typeof e.value];t._zod.onattach.push(n=>{const s=n._zod.bag,a=(e.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<a&&(e.inclusive?s.maximum=e.value:s.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Mg=j("$ZodCheckGreaterThan",(t,e)=>{Lt.init(t,e);const r=Lg[typeof e.value];t._zod.onattach.push(n=>{const s=n._zod.bag,a=(e.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>a&&(e.inclusive?s.minimum=e.value:s.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),_S=j("$ZodCheckMultipleOf",(t,e)=>{Lt.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):CT(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),yS=j("$ZodCheckNumberFormat",(t,e)=>{var i;Lt.init(t,e),e.format=e.format||"float64";const r=(i=e.format)==null?void 0:i.includes("int"),n=r?"int":"number",[s,a]=PT[e.format];t._zod.onattach.push(o=>{const c=o._zod.bag;c.format=e.format,c.minimum=s,c.maximum=a,r&&(c.pattern=hS)}),t._zod.check=o=>{const c=o.value;if(r){if(!Number.isInteger(c)){o.issues.push({expected:n,format:e.format,code:"invalid_type",input:c,inst:t});return}if(!Number.isSafeInteger(c)){c>0?o.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):o.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}c<s&&o.issues.push({origin:"number",input:c,code:"too_small",minimum:s,inclusive:!0,inst:t,continue:!e.abort}),c>a&&o.issues.push({origin:"number",input:c,code:"too_big",maximum:a,inst:t})}}),vS=j("$ZodCheckMaxLength",(t,e)=>{var r;Lt.init(t,e),(r=t._zod.def).when??(r.when=n=>{const s=n.value;return!Bl(s)&&s.length!==void 0}),t._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<s&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{const s=n.value;if(s.length<=e.maximum)return;const i=Zl(s);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),bS=j("$ZodCheckMinLength",(t,e)=>{var r;Lt.init(t,e),(r=t._zod.def).when??(r.when=n=>{const s=n.value;return!Bl(s)&&s.length!==void 0}),t._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>s&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{const s=n.value;if(s.length>=e.minimum)return;const i=Zl(s);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),wS=j("$ZodCheckLengthEquals",(t,e)=>{var r;Lt.init(t,e),(r=t._zod.def).when??(r.when=n=>{const s=n.value;return!Bl(s)&&s.length!==void 0}),t._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=e.length,s.maximum=e.length,s.length=e.length}),t._zod.check=n=>{const s=n.value,a=s.length;if(a===e.length)return;const i=Zl(s),o=a>e.length;n.issues.push({origin:i,...o?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Io=j("$ZodCheckStringFormat",(t,e)=>{var r,n;Lt.init(t,e),t._zod.onattach.push(s=>{const a=s._zod.bag;a.format=e.format,e.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=s=>{e.pattern.lastIndex=0,!e.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:e.format,input:s.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),ES=j("$ZodCheckRegex",(t,e)=>{Io.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),TS=j("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=mS),Io.init(t,e)}),SS=j("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=gS),Io.init(t,e)}),xS=j("$ZodCheckIncludes",(t,e)=>{Lt.init(t,e);const r=ka(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(s=>{const a=s._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(n)}),t._zod.check=s=>{s.value.includes(e.includes,e.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:s.value,inst:t,continue:!e.abort})}}),IS=j("$ZodCheckStartsWith",(t,e)=>{Lt.init(t,e);const r=new RegExp(`^${ka(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),AS=j("$ZodCheckEndsWith",(t,e)=>{Lt.init(t,e);const r=new RegExp(`.*${ka(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}}),kS=j("$ZodCheckOverwrite",(t,e)=>{Lt.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});class OS{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const n=e.split(`
`).filter(i=>i),s=Math.min(...n.map(i=>i.length-i.trimStart().length)),a=n.map(i=>i.slice(s)).map(i=>" ".repeat(this.indent*2)+i);for(const i of a)this.content.push(i)}compile(){const e=Function,r=this==null?void 0:this.args,s=[...((this==null?void 0:this.content)??[""]).map(a=>`  ${a}`)];return new e(...r,s.join(`
`))}}const CS={major:4,minor:0,patch:0},We=j("$ZodType",(t,e)=>{var s;var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=CS;const n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(const a of n)for(const i of a._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),(s=t._zod.deferred)==null||s.push(()=>{t._zod.run=t._zod.parse});else{const a=(i,o,c)=>{let u=Js(i),l;for(const d of o){if(d._zod.def.when){if(!d._zod.def.when(i))continue}else if(u)continue;const h=i.issues.length,f=d._zod.check(i);if(f instanceof Promise&&(c==null?void 0:c.async)===!1)throw new pa;if(l||f instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await f,i.issues.length!==h&&(u||(u=Js(i,h)))});else{if(i.issues.length===h)continue;u||(u=Js(i,h))}}return l?l.then(()=>i):i};t._zod.run=(i,o)=>{const c=t._zod.parse(i,o);if(c instanceof Promise){if(o.async===!1)throw new pa;return c.then(u=>a(u,n,o))}return a(c,n,o)}}t["~standard"]={validate:a=>{var i;try{const o=qT(t,a);return o.success?{value:o.data}:{issues:(i=o.error)==null?void 0:i.issues}}catch{return ZT(t,a).then(c=>{var u;return c.success?{value:c.data}:{issues:(u=c.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),Gl=j("$ZodString",(t,e)=>{var r;We.init(t,e),t._zod.pattern=[...((r=t==null?void 0:t._zod.bag)==null?void 0:r.patterns)??[]].pop()??fS(t._zod.bag),t._zod.parse=(n,s)=>{if(e.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:t}),n}}),Ve=j("$ZodStringFormat",(t,e)=>{Io.init(t,e),Gl.init(t,e)}),NS=j("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=YT),Ve.init(t,e)}),$S=j("$ZodUUID",(t,e)=>{if(e.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=eh(n))}else e.pattern??(e.pattern=eh());Ve.init(t,e)}),RS=j("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=QT),Ve.init(t,e)}),PS=j("$ZodURL",(t,e)=>{Ve.init(t,e),t._zod.check=r=>{try{const n=r.value,s=new URL(n),a=s.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:oS.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&a.endsWith("/")?r.value=a.slice(0,-1):r.value=a;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),LS=j("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=tS()),Ve.init(t,e)}),DS=j("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=KT),Ve.init(t,e)}),MS=j("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=GT),Ve.init(t,e)}),jS=j("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=VT),Ve.init(t,e)}),FS=j("$ZodULID",(t,e)=>{e.pattern??(e.pattern=HT),Ve.init(t,e)}),US=j("$ZodXID",(t,e)=>{e.pattern??(e.pattern=WT),Ve.init(t,e)}),BS=j("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=JT),Ve.init(t,e)}),zS=j("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=dS(e)),Ve.init(t,e)}),qS=j("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=uS),Ve.init(t,e)}),ZS=j("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=lS(e)),Ve.init(t,e)}),GS=j("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=XT),Ve.init(t,e)}),VS=j("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=rS),Ve.init(t,e),t._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),HS=j("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=nS),Ve.init(t,e),t._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),WS=j("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=sS),Ve.init(t,e)}),JS=j("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=aS),Ve.init(t,e),t._zod.check=r=>{const[n,s]=r.value.split("/");try{if(!s)throw new Error;const a=Number(s);if(`${a}`!==s)throw new Error;if(a<0||a>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function jg(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const KS=j("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=iS),Ve.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{jg(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function XS(t){if(!$g.test(t))return!1;const e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return jg(r)}const YS=j("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=$g),Ve.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{XS(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),QS=j("$ZodE164",(t,e)=>{e.pattern??(e.pattern=cS),Ve.init(t,e)});function ex(t,e=null){try{const r=t.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&(!("alg"in s)||s.alg!==e))}catch{return!1}}const tx=j("$ZodJWT",(t,e)=>{Ve.init(t,e),t._zod.check=r=>{ex(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),Fg=j("$ZodNumber",(t,e)=>{We.init(t,e),t._zod.pattern=t._zod.bag.pattern??pS,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}const s=r.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return r;const a=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:s,inst:t,...a?{received:a}:{}}),r}}),rx=j("$ZodNumber",(t,e)=>{yS.init(t,e),Fg.init(t,e)}),Ug=j("$ZodUnknown",(t,e)=>{We.init(t,e),t._zod.parse=r=>r}),Bg=j("$ZodNever",(t,e)=>{We.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function th(t,e,r){t.issues.length&&e.issues.push(...On(r,t.issues)),e.value[r]=t.value}const nx=j("$ZodArray",(t,e)=>{We.init(t,e),t._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:t}),r;r.value=Array(s.length);const a=[];for(let i=0;i<s.length;i++){const o=s[i],c=e.element._zod.run({value:o,issues:[]},n);c instanceof Promise?a.push(c.then(u=>th(u,r,i))):th(c,r,i)}return a.length?Promise.all(a).then(()=>r):r}});function Ka(t,e,r){t.issues.length&&e.issues.push(...On(r,t.issues)),e.value[r]=t.value}function rh(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...On(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}const sx=j("$ZodObject",(t,e)=>{We.init(t,e);const r=Ul(()=>{const d=Object.keys(e.shape);for(const f of d)if(!(e.shape[f]instanceof We))throw new Error(`Invalid element at key "${f}": expected a Zod schema`);const h=RT(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(h)}});Ze(t._zod,"propValues",()=>{const d=e.shape,h={};for(const f in d){const m=d[f]._zod;if(m.values){h[f]??(h[f]=new Set);for(const _ of m.values)h[f].add(_)}}return h});const n=d=>{const h=new OS(["shape","payload","ctx"]),f=r.value,m=g=>{const b=Ss(g);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};h.write("const input = payload.value;");const _=Object.create(null);let y=0;for(const g of f.keys)_[g]=`key_${y++}`;h.write("const newResult = {}");for(const g of f.keys)if(f.optionalKeys.has(g)){const b=_[g];h.write(`const ${b} = ${m(g)};`);const T=Ss(g);h.write(`
        if (${b}.issues.length) {
          if (input[${T}] === undefined) {
            if (${T} in input) {
              newResult[${T}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${b}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${T}, ...iss.path] : [${T}],
              }))
            );
          }
        } else if (${b}.value === undefined) {
          if (${T} in input) newResult[${T}] = undefined;
        } else {
          newResult[${T}] = ${b}.value;
        }
        `)}else{const b=_[g];h.write(`const ${b} = ${m(g)};`),h.write(`
          if (${b}.issues.length) payload.issues = payload.issues.concat(${b}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Ss(g)}, ...iss.path] : [${Ss(g)}]
          })));`),h.write(`newResult[${Ss(g)}] = ${b}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");const w=h.compile();return(g,b)=>w(d,g,b)};let s;const a=Ui,i=!bg.jitless,c=i&&NT.value,u=e.catchall;let l;t._zod.parse=(d,h)=>{l??(l=r.value);const f=d.value;if(!a(f))return d.issues.push({expected:"object",code:"invalid_type",input:f,inst:t}),d;const m=[];if(i&&c&&(h==null?void 0:h.async)===!1&&h.jitless!==!0)s||(s=n(e.shape)),d=s(d,h);else{d.value={};const b=l.shape;for(const T of l.keys){const I=b[T],C=I._zod.run({value:f[T],issues:[]},h),D=I._zod.optin==="optional"&&I._zod.optout==="optional";C instanceof Promise?m.push(C.then(k=>D?rh(k,d,T,f):Ka(k,d,T))):D?rh(C,d,T,f):Ka(C,d,T)}}if(!u)return m.length?Promise.all(m).then(()=>d):d;const _=[],y=l.keySet,w=u._zod,g=w.def.type;for(const b of Object.keys(f)){if(y.has(b))continue;if(g==="never"){_.push(b);continue}const T=w.run({value:f[b],issues:[]},h);T instanceof Promise?m.push(T.then(I=>Ka(I,d,b))):Ka(T,d,b)}return _.length&&d.issues.push({code:"unrecognized_keys",keys:_,input:f,inst:t}),m.length?Promise.all(m).then(()=>d):d}});function nh(t,e,r,n){for(const s of t)if(s.issues.length===0)return e.value=s.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(s=>s.issues.map(a=>_n(a,n,gn())))}),e}const zg=j("$ZodUnion",(t,e)=>{We.init(t,e),Ze(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),Ze(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),Ze(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),Ze(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){const r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>zl(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let s=!1;const a=[];for(const i of e.options){const o=i._zod.run({value:r.value,issues:[]},n);if(o instanceof Promise)a.push(o),s=!0;else{if(o.issues.length===0)return o;a.push(o)}}return s?Promise.all(a).then(i=>nh(i,r,t,n)):nh(a,r,t,n)}}),ax=j("$ZodDiscriminatedUnion",(t,e)=>{zg.init(t,e);const r=t._zod.parse;Ze(t._zod,"propValues",()=>{const s={};for(const a of e.options){const i=a._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(a)}"`);for(const[o,c]of Object.entries(i)){s[o]||(s[o]=new Set);for(const u of c)s[o].add(u)}}return s});const n=Ul(()=>{const s=e.options,a=new Map;for(const i of s){const o=i._zod.propValues[e.discriminator];if(!o||o.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(const c of o){if(a.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);a.set(c,i)}}return a});t._zod.parse=(s,a)=>{const i=s.value;if(!Ui(i))return s.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),s;const o=n.value.get(i==null?void 0:i[e.discriminator]);return o?o._zod.run(s,a):e.unionFallback?r(s,a):(s.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),s)}}),ix=j("$ZodIntersection",(t,e)=>{We.init(t,e),t._zod.parse=(r,n)=>{const s=r.value,a=e.left._zod.run({value:s,issues:[]},n),i=e.right._zod.run({value:s,issues:[]},n);return a instanceof Promise||i instanceof Promise?Promise.all([a,i]).then(([c,u])=>sh(r,c,u)):sh(r,a,i)}});function Iu(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(Bi(t)&&Bi(e)){const r=Object.keys(e),n=Object.keys(t).filter(a=>r.indexOf(a)!==-1),s={...t,...e};for(const a of n){const i=Iu(t[a],e[a]);if(!i.valid)return{valid:!1,mergeErrorPath:[a,...i.mergeErrorPath]};s[a]=i.data}return{valid:!0,data:s}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<t.length;n++){const s=t[n],a=e[n],i=Iu(s,a);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function sh(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),Js(t))return t;const n=Iu(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}const ox=j("$ZodRecord",(t,e)=>{We.init(t,e),t._zod.parse=(r,n)=>{const s=r.value;if(!Bi(s))return r.issues.push({expected:"record",code:"invalid_type",input:s,inst:t}),r;const a=[];if(e.keyType._zod.values){const i=e.keyType._zod.values;r.value={};for(const c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const u=e.valueType._zod.run({value:s[c],issues:[]},n);u instanceof Promise?a.push(u.then(l=>{l.issues.length&&r.issues.push(...On(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...On(c,u.issues)),r.value[c]=u.value)}let o;for(const c in s)i.has(c)||(o=o??[],o.push(c));o&&o.length>0&&r.issues.push({code:"unrecognized_keys",input:s,inst:t,keys:o})}else{r.value={};for(const i of Reflect.ownKeys(s)){if(i==="__proto__")continue;const o=e.keyType._zod.run({value:i,issues:[]},n);if(o instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(o.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:o.issues.map(u=>_n(u,n,gn())),input:i,path:[i],inst:t}),r.value[o.value]=o.value;continue}const c=e.valueType._zod.run({value:s[i],issues:[]},n);c instanceof Promise?a.push(c.then(u=>{u.issues.length&&r.issues.push(...On(i,u.issues)),r.value[o.value]=u.value})):(c.issues.length&&r.issues.push(...On(i,c.issues)),r.value[o.value]=c.value)}}return a.length?Promise.all(a).then(()=>r):r}}),cx=j("$ZodEnum",(t,e)=>{We.init(t,e);const r=wg(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>$T.has(typeof n)).map(n=>typeof n=="string"?ka(n):n.toString()).join("|")})$`),t._zod.parse=(n,s)=>{const a=n.value;return t._zod.values.has(a)||n.issues.push({code:"invalid_value",values:r,input:a,inst:t}),n}}),ux=j("$ZodLiteral",(t,e)=>{We.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?ka(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{const s=r.value;return t._zod.values.has(s)||r.issues.push({code:"invalid_value",values:e.values,input:s,inst:t}),r}}),lx=j("$ZodTransform",(t,e)=>{We.init(t,e),t._zod.parse=(r,n)=>{const s=e.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(i=>(r.value=i,r));if(s instanceof Promise)throw new pa;return r.value=s,r}}),Vl=j("$ZodOptional",(t,e)=>{We.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Ze(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Ze(t._zod,"pattern",()=>{const r=e.innerType._zod.pattern;return r?new RegExp(`^(${zl(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),dx=j("$ZodNullable",(t,e)=>{We.init(t,e),Ze(t._zod,"optin",()=>e.innerType._zod.optin),Ze(t._zod,"optout",()=>e.innerType._zod.optout),Ze(t._zod,"pattern",()=>{const r=e.innerType._zod.pattern;return r?new RegExp(`^(${zl(r.source)}|null)$`):void 0}),Ze(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),fx=j("$ZodDefault",(t,e)=>{We.init(t,e),t._zod.optin="optional",Ze(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(a=>ah(a,e)):ah(s,e)}});function ah(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const hx=j("$ZodPrefault",(t,e)=>{We.init(t,e),t._zod.optin="optional",Ze(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),px=j("$ZodNonOptional",(t,e)=>{We.init(t,e),Ze(t._zod,"values",()=>{const r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(a=>ih(a,t)):ih(s,t)}});function ih(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const mx=j("$ZodCatch",(t,e)=>{We.init(t,e),t._zod.optin="optional",Ze(t._zod,"optout",()=>e.innerType._zod.optout),Ze(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(a=>(r.value=a.value,a.issues.length&&(r.value=e.catchValue({...r,error:{issues:a.issues.map(i=>_n(i,n,gn()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(a=>_n(a,n,gn()))},input:r.value}),r.issues=[]),r)}}),gx=j("$ZodPipe",(t,e)=>{We.init(t,e),Ze(t._zod,"values",()=>e.in._zod.values),Ze(t._zod,"optin",()=>e.in._zod.optin),Ze(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{const s=e.in._zod.run(r,n);return s instanceof Promise?s.then(a=>oh(a,e,n)):oh(s,e,n)}});function oh(t,e,r){return Js(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}const _x=j("$ZodReadonly",(t,e)=>{We.init(t,e),Ze(t._zod,"propValues",()=>e.innerType._zod.propValues),Ze(t._zod,"values",()=>e.innerType._zod.values),Ze(t._zod,"optin",()=>e.innerType._zod.optin),Ze(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{const s=e.innerType._zod.run(r,n);return s instanceof Promise?s.then(ch):ch(s)}});function ch(t){return t.value=Object.freeze(t.value),t}const yx=j("$ZodCustom",(t,e)=>{Lt.init(t,e),We.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{const n=r.value,s=e.fn(n);if(s instanceof Promise)return s.then(a=>uh(a,r,n,t));uh(s,r,n,t)}});function uh(t,e,r,n){if(!t){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),e.issues.push(ma(s))}}class qg{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){const n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){const r=e._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function vx(){return new qg}const ut=vx();function bx(t,e){return new t({type:"string",...ge(e)})}function wx(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...ge(e)})}function lh(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...ge(e)})}function Ex(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...ge(e)})}function Tx(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...ge(e)})}function Sx(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...ge(e)})}function xx(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...ge(e)})}function Ix(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...ge(e)})}function Ax(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...ge(e)})}function kx(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...ge(e)})}function Ox(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...ge(e)})}function Cx(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...ge(e)})}function Nx(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...ge(e)})}function $x(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...ge(e)})}function Rx(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...ge(e)})}function Px(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...ge(e)})}function Lx(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...ge(e)})}function Dx(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...ge(e)})}function Mx(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...ge(e)})}function jx(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...ge(e)})}function Fx(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...ge(e)})}function Ux(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...ge(e)})}function Bx(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...ge(e)})}function zx(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...ge(e)})}function qx(t,e){return new t({type:"string",format:"date",check:"string_format",...ge(e)})}function Zx(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...ge(e)})}function Gx(t,e){return new t({type:"string",format:"duration",check:"string_format",...ge(e)})}function Vx(t,e){return new t({type:"number",checks:[],...ge(e)})}function Hx(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...ge(e)})}function Zg(t){return new t({type:"unknown"})}function Gg(t,e){return new t({type:"never",...ge(e)})}function dh(t,e){return new Dg({check:"less_than",...ge(e),value:t,inclusive:!1})}function kc(t,e){return new Dg({check:"less_than",...ge(e),value:t,inclusive:!0})}function fh(t,e){return new Mg({check:"greater_than",...ge(e),value:t,inclusive:!1})}function Oc(t,e){return new Mg({check:"greater_than",...ge(e),value:t,inclusive:!0})}function hh(t,e){return new _S({check:"multiple_of",...ge(e),value:t})}function Vg(t,e){return new vS({check:"max_length",...ge(e),maximum:t})}function zi(t,e){return new bS({check:"min_length",...ge(e),minimum:t})}function Hg(t,e){return new wS({check:"length_equals",...ge(e),length:t})}function Wx(t,e){return new ES({check:"string_format",format:"regex",...ge(e),pattern:t})}function Jx(t){return new TS({check:"string_format",format:"lowercase",...ge(t)})}function Kx(t){return new SS({check:"string_format",format:"uppercase",...ge(t)})}function Xx(t,e){return new xS({check:"string_format",format:"includes",...ge(e),includes:t})}function Yx(t,e){return new IS({check:"string_format",format:"starts_with",...ge(e),prefix:t})}function Qx(t,e){return new AS({check:"string_format",format:"ends_with",...ge(e),suffix:t})}function Oa(t){return new kS({check:"overwrite",tx:t})}function eI(t){return Oa(e=>e.normalize(t))}function tI(){return Oa(t=>t.trim())}function rI(){return Oa(t=>t.toLowerCase())}function nI(){return Oa(t=>t.toUpperCase())}function sI(t,e,r){return new t({type:"array",element:e,...ge(r)})}function aI(t,e,r){return new t({type:"custom",check:"custom",fn:e,...ge(r)})}class ph{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??ut,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var d,h,f;var n;const s=e._zod.def,a={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;const o={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,o);const c=(h=(d=e._zod).toJSONSchema)==null?void 0:h.call(d);if(c)o.schema=c;else{const m={...r,schemaPath:[...r.schemaPath,e],path:r.path},_=e._zod.parent;if(_)o.ref=_,this.process(_,m),this.seen.get(_).isParent=!0;else{const y=o.schema;switch(s.type){case"string":{const w=y;w.type="string";const{minimum:g,maximum:b,format:T,patterns:I,contentEncoding:C}=e._zod.bag;if(typeof g=="number"&&(w.minLength=g),typeof b=="number"&&(w.maxLength=b),T&&(w.format=a[T]??T,w.format===""&&delete w.format),C&&(w.contentEncoding=C),I&&I.size>0){const D=[...I];D.length===1?w.pattern=D[0].source:D.length>1&&(o.schema.allOf=[...D.map(k=>({...this.target==="draft-7"?{type:"string"}:{},pattern:k.source}))])}break}case"number":{const w=y,{minimum:g,maximum:b,format:T,multipleOf:I,exclusiveMaximum:C,exclusiveMinimum:D}=e._zod.bag;typeof T=="string"&&T.includes("int")?w.type="integer":w.type="number",typeof D=="number"&&(w.exclusiveMinimum=D),typeof g=="number"&&(w.minimum=g,typeof D=="number"&&(D>=g?delete w.minimum:delete w.exclusiveMinimum)),typeof C=="number"&&(w.exclusiveMaximum=C),typeof b=="number"&&(w.maximum=b,typeof C=="number"&&(C<=b?delete w.maximum:delete w.exclusiveMaximum)),typeof I=="number"&&(w.multipleOf=I);break}case"boolean":{const w=y;w.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{y.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{y.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const w=y,{minimum:g,maximum:b}=e._zod.bag;typeof g=="number"&&(w.minItems=g),typeof b=="number"&&(w.maxItems=b),w.type="array",w.items=this.process(s.element,{...m,path:[...m.path,"items"]});break}case"object":{const w=y;w.type="object",w.properties={};const g=s.shape;for(const I in g)w.properties[I]=this.process(g[I],{...m,path:[...m.path,"properties",I]});const b=new Set(Object.keys(g)),T=new Set([...b].filter(I=>{const C=s.shape[I]._zod;return this.io==="input"?C.optin===void 0:C.optout===void 0}));T.size>0&&(w.required=Array.from(T)),((f=s.catchall)==null?void 0:f._zod.def.type)==="never"?w.additionalProperties=!1:s.catchall?s.catchall&&(w.additionalProperties=this.process(s.catchall,{...m,path:[...m.path,"additionalProperties"]})):this.io==="output"&&(w.additionalProperties=!1);break}case"union":{const w=y;w.anyOf=s.options.map((g,b)=>this.process(g,{...m,path:[...m.path,"anyOf",b]}));break}case"intersection":{const w=y,g=this.process(s.left,{...m,path:[...m.path,"allOf",0]}),b=this.process(s.right,{...m,path:[...m.path,"allOf",1]}),T=C=>"allOf"in C&&Object.keys(C).length===1,I=[...T(g)?g.allOf:[g],...T(b)?b.allOf:[b]];w.allOf=I;break}case"tuple":{const w=y;w.type="array";const g=s.items.map((I,C)=>this.process(I,{...m,path:[...m.path,"prefixItems",C]}));if(this.target==="draft-2020-12"?w.prefixItems=g:w.items=g,s.rest){const I=this.process(s.rest,{...m,path:[...m.path,"items"]});this.target==="draft-2020-12"?w.items=I:w.additionalItems=I}s.rest&&(w.items=this.process(s.rest,{...m,path:[...m.path,"items"]}));const{minimum:b,maximum:T}=e._zod.bag;typeof b=="number"&&(w.minItems=b),typeof T=="number"&&(w.maxItems=T);break}case"record":{const w=y;w.type="object",w.propertyNames=this.process(s.keyType,{...m,path:[...m.path,"propertyNames"]}),w.additionalProperties=this.process(s.valueType,{...m,path:[...m.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const w=y,g=wg(s.entries);g.every(b=>typeof b=="number")&&(w.type="number"),g.every(b=>typeof b=="string")&&(w.type="string"),w.enum=g;break}case"literal":{const w=y,g=[];for(const b of s.values)if(b===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof b=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");g.push(Number(b))}else g.push(b);if(g.length!==0)if(g.length===1){const b=g[0];w.type=b===null?"null":typeof b,w.const=b}else g.every(b=>typeof b=="number")&&(w.type="number"),g.every(b=>typeof b=="string")&&(w.type="string"),g.every(b=>typeof b=="boolean")&&(w.type="string"),g.every(b=>b===null)&&(w.type="null"),w.enum=g;break}case"file":{const w=y,g={type:"string",format:"binary",contentEncoding:"binary"},{minimum:b,maximum:T,mime:I}=e._zod.bag;b!==void 0&&(g.minLength=b),T!==void 0&&(g.maxLength=T),I?I.length===1?(g.contentMediaType=I[0],Object.assign(w,g)):w.anyOf=I.map(C=>({...g,contentMediaType:C})):Object.assign(w,g);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const w=this.process(s.innerType,m);y.anyOf=[w,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,m),o.ref=s.innerType;break}case"success":{const w=y;w.type="boolean";break}case"default":{this.process(s.innerType,m),o.ref=s.innerType,y.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,m),o.ref=s.innerType,this.io==="input"&&(y._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,m),o.ref=s.innerType;let w;try{w=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}y.default=w;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const w=y,g=e._zod.pattern;if(!g)throw new Error("Pattern not found in template literal");w.type="string",w.pattern=g.source;break}case"pipe":{const w=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(w,m),o.ref=w;break}case"readonly":{this.process(s.innerType,m),o.ref=s.innerType,y.readOnly=!0;break}case"promise":{this.process(s.innerType,m),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,m),o.ref=s.innerType;break}case"lazy":{const w=e._zod.innerType;this.process(w,m),o.ref=w;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const u=this.metadataRegistry.get(e);return u&&Object.assign(o.schema,u),this.io==="input"&&nt(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,r){var l,d,h,f,m,_;const n={cycles:(r==null?void 0:r.cycles)??"ref",reused:(r==null?void 0:r.reused)??"inline",external:(r==null?void 0:r.external)??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");const a=y=>{var I;const w=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const C=(I=n.external.registry.get(y[0]))==null?void 0:I.id,D=n.external.uri??(A=>A);if(C)return{ref:D(C)};const k=y[1].defId??y[1].schema.id??`schema${this.counter++}`;return y[1].defId=k,{defId:k,ref:`${D("__shared")}#/${w}/${k}`}}if(y[1]===s)return{ref:"#"};const b=`#/${w}/`,T=y[1].schema.id??`__schema${this.counter++}`;return{defId:T,ref:b+T}},i=y=>{if(y[1].schema.$ref)return;const w=y[1],{ref:g,defId:b}=a(y);w.def={...w.schema},b&&(w.defId=b);const T=w.schema;for(const I in T)delete T[I];T.$ref=g};if(n.cycles==="throw")for(const y of this.seen.entries()){const w=y[1];if(w.cycle)throw new Error(`Cycle detected: #/${(l=w.cycle)==null?void 0:l.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const y of this.seen.entries()){const w=y[1];if(e===y[0]){i(y);continue}if(n.external){const b=(d=n.external.registry.get(y[0]))==null?void 0:d.id;if(e!==y[0]&&b){i(y);continue}}if((h=this.metadataRegistry.get(y[0]))==null?void 0:h.id){i(y);continue}if(w.cycle){i(y);continue}if(w.count>1&&n.reused==="ref"){i(y);continue}}const o=(y,w)=>{const g=this.seen.get(y),b=g.def??g.schema,T={...b};if(g.ref===null)return;const I=g.ref;if(g.ref=null,I){o(I,w);const C=this.seen.get(I).schema;C.$ref&&w.target==="draft-7"?(b.allOf=b.allOf??[],b.allOf.push(C)):(Object.assign(b,C),Object.assign(b,T))}g.isParent||this.override({zodSchema:y,jsonSchema:b,path:g.path??[]})};for(const y of[...this.seen.entries()].reverse())o(y[0],{target:this.target});const c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),(f=n.external)!=null&&f.uri){const y=(m=n.external.registry.get(e))==null?void 0:m.id;if(!y)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(y)}Object.assign(c,s.def);const u=((_=n.external)==null?void 0:_.defs)??{};for(const y of this.seen.entries()){const w=y[1];w.def&&w.defId&&(u[w.defId]=w.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}}function Au(t,e){if(t instanceof qg){const n=new ph(e),s={};for(const o of t._idmap.entries()){const[c,u]=o;n.process(u)}const a={},i={registry:t,uri:e==null?void 0:e.uri,defs:s};for(const o of t._idmap.entries()){const[c,u]=o;a[c]=n.emit(u,{...e,external:i})}if(Object.keys(s).length>0){const o=n.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[o]:s}}return{schemas:a}}const r=new ph(e);return r.process(t),r.emit(t,e)}function nt(t,e){const r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);const s=t._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return nt(s.element,r);case"object":{for(const a in s.shape)if(nt(s.shape[a],r))return!0;return!1}case"union":{for(const a of s.options)if(nt(a,r))return!0;return!1}case"intersection":return nt(s.left,r)||nt(s.right,r);case"tuple":{for(const a of s.items)if(nt(a,r))return!0;return!!(s.rest&&nt(s.rest,r))}case"record":return nt(s.keyType,r)||nt(s.valueType,r);case"map":return nt(s.keyType,r)||nt(s.valueType,r);case"set":return nt(s.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return nt(s.innerType,r);case"lazy":return nt(s.getter(),r);case"default":return nt(s.innerType,r);case"prefault":return nt(s.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return nt(s.in,r)||nt(s.out,r);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${s.type}`)}function He(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_zod"in e))return!1;const r=e._zod;return typeof r=="object"&&r!==null&&"def"in r}function tt(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_def"in e)||"_zod"in e)return!1;const r=e._def;return typeof r=="object"&&r!=null&&"typeName"in r}function iI(t){return He(t)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),tt(t)}function Ir(t){return!t||typeof t!="object"||Array.isArray(t)?!1:!!(He(t)||tt(t))}function Wg(t){return typeof t=="object"&&t!==null&&"_def"in t&&typeof t._def=="object"&&t._def!==null&&"typeName"in t._def&&t._def.typeName==="ZodLiteral"}function Jg(t){return He(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="literal":!1}function oI(t){return!!(Wg(t)||Jg(t))}async function Kg(t,e){if(He(t))try{return{success:!0,data:await Og(t,e)}}catch(r){return{success:!1,error:r}}if(tt(t))return await t.safeParseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function Ao(t,e){if(He(t))return await Og(t,e);if(tt(t))return await t.parseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function cI(t,e){if(He(t))try{return{success:!0,data:xo(t,e)}}catch(r){return{success:!1,error:r}}if(tt(t))return t.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function uI(t,e){if(He(t))return xo(t,e);if(tt(t))return t.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function ko(t){var e;if(He(t))return(e=ut.get(t))==null?void 0:e.description;if(tt(t)||"description"in t&&typeof t.description=="string")return t.description}function lI(t){if(!Ir(t))return!1;if(tt(t)){const e=t._def;if(e.typeName==="ZodObject"){const r=t;return!r.shape||Object.keys(r.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(He(t)){const e=t._zod.def;if(e.type==="object"){const r=t;return!r.shape||Object.keys(r.shape).length===0}if(e.type==="record")return!0}return typeof t=="object"&&t!==null&&!("shape"in t)}function Hl(t){return Ir(t)?tt(t)?t._def.typeName==="ZodString":He(t)?t._zod.def.type==="string":!1:!1}function Wl(t){return typeof t=="object"&&t!==null&&"_def"in t&&typeof t._def=="object"&&t._def!==null&&"typeName"in t._def&&t._def.typeName==="ZodObject"}function $r(t){return He(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="object":!1}function Oo(t){return He(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="array":!1}function Xg(t){return He(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="optional":!1}function Yg(t){return He(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="nullable":!1}function dI(t){return!!(Wl(t)||$r(t))}function ku(t){if(tt(t))return t.shape;if(He(t))return t._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function fI(t,e){if(tt(t))return t.extend(e);if(He(t))return Tg(t,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hI(t){if(tt(t))return t.partial();if(He(t))return Sg(Vl,t,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function qi(t,e=!1){if(tt(t))return t.strict();if($r(t)){const r=t._zod.def.shape;if(e)for(const[a,i]of Object.entries(t._zod.def.shape)){if($r(i)){const c=qi(i,e);r[a]=c}else if(Oo(i)){let c=i._zod.def.element;$r(c)&&(c=qi(c,e)),r[a]=_t(i,{...i._zod.def,element:c})}else r[a]=i;const o=ut.get(i);o&&ut.add(r[a],o)}const n=_t(t,{...t._zod.def,shape:r,catchall:Gg(Bg)}),s=ut.get(t);return s&&ut.add(n,s),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Ou(t,e=!1){if(Wl(t))return t.passthrough();if($r(t)){const r=t._zod.def.shape;if(e)for(const[a,i]of Object.entries(t._zod.def.shape)){if($r(i)){const c=Ou(i,e);r[a]=c}else if(Oo(i)){let c=i._zod.def.element;$r(c)&&(c=Ou(c,e)),r[a]=_t(i,{...i._zod.def,element:c})}else r[a]=i;const o=ut.get(i);o&&ut.add(r[a],o)}const n=_t(t,{...t._zod.def,shape:r,catchall:Zg(Ug)}),s=ut.get(t);return s&&ut.add(n,s),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function pI(t){if(tt(t))try{const e=t.parse(void 0);return()=>e}catch{return}if(He(t))try{const e=xo(t,void 0);return()=>e}catch{return}}function mI(t){return tt(t)&&"typeName"in t._def&&t._def.typeName==="ZodEffects"}function gI(t){return He(t)&&t._zod.def.type==="pipe"}function Tn(t,e,r){const n=r.get(t);if(n!==void 0)return n;if(tt(t))return mI(t)?Tn(t._def.schema,e,r):t;if(He(t)){let s=t;if(gI(t)&&(s=Tn(t._zod.def.in,e,r)),e){if($r(s)){const i={};for(const[o,c]of Object.entries(s._zod.def.shape))i[o]=Tn(c,e,r);s=_t(s,{...s._zod.def,shape:i})}else if(Oo(s)){const i=Tn(s._zod.def.element,e,r);s=_t(s,{...s._zod.def,element:i})}else if(Xg(s)){const i=Tn(s._zod.def.innerType,e,r);s=_t(s,{...s._zod.def,innerType:i})}else if(Yg(s)){const i=Tn(s._zod.def.innerType,e,r);s=_t(s,{...s._zod.def,innerType:i})}}const a=ut.get(t);return a&&ut.add(s,a),r.set(t,s),s}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Qg(t,e=!1){return Tn(t,e,new WeakMap)}function _I(t,e){if(tt(t)){const r=ku(t),n={};for(const[s,a]of Object.entries(r))e(s,a)?n[s]=a.optional():n[s]=a;return t.extend(n)}if(He(t)){const r=ku(t),n={...t._zod.def.shape};for(const[i,o]of Object.entries(r))e(i,o)&&(n[i]=new Vl({type:"optional",innerType:o}));const s=_t(t,{...t._zod.def,shape:n}),a=ut.get(t);return a&&ut.add(s,a),s}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function e_(t){return t instanceof Error&&(t.constructor.name==="ZodError"||t.constructor.name==="$ZodError")}const yI=Symbol("Let zodToJsonSchema decide on which parser to use"),vI={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},bI=t=>({...vI,...t}),wI=t=>{const e=bI(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}},t_=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function Gt(t){if(t.target!=="openAi")return{};const e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?t_(e,t.currentPath):e.join("/")}}function r_(t,e,r,n){n!=null&&n.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function Fe(t,e,r,n,s){t[e]=r,r_(t,e,n,s)}function EI(t,e){var n,s,a;const r={type:"array"};return(n=t.type)!=null&&n._def&&((a=(s=t.type)==null?void 0:s._def)==null?void 0:a.typeName)!==M.ZodAny&&(r.items=je(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Fe(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Fe(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Fe(r,"minItems",t.exactLength.value,t.exactLength.message,e),Fe(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function TI(t,e){const r={type:"integer",format:"int64"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Fe(r,"minimum",n.value,n.message,e):Fe(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Fe(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Fe(r,"maximum",n.value,n.message,e):Fe(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Fe(r,"maximum",n.value,n.message,e));break;case"multipleOf":Fe(r,"multipleOf",n.value,n.message,e);break}return r}function SI(){return{type:"boolean"}}function n_(t,e){return je(t.type._def,e)}const xI=(t,e)=>je(t.innerType._def,e);function s_(t,e,r){const n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(s=>s_(t,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return II(t,e)}}const II=(t,e)=>{const r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(const n of t.checks)switch(n.kind){case"min":Fe(r,"minimum",n.value,n.message,e);break;case"max":Fe(r,"maximum",n.value,n.message,e);break}return r};function AI(t,e){return{...je(t.innerType._def,e),default:t.defaultValue()}}function kI(t,e){return e.effectStrategy==="input"?je(t.schema._def,e):Gt(e)}function OI(t){return{type:"string",enum:Array.from(t.values)}}const CI=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function NI(t,e){const r=[je(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),je(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return r.forEach(a=>{if(CI(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function $I(t,e){const r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}let Cc;const Qt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Cc===void 0&&(Cc=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Cc),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function a_(t,e){const r={type:"string"};if(t.checks)for(const n of t.checks)switch(n.kind){case"min":Fe(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":Fe(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":er(r,"email",n.message,e);break;case"format:idn-email":er(r,"idn-email",n.message,e);break;case"pattern:zod":Et(r,Qt.email,n.message,e);break}break;case"url":er(r,"uri",n.message,e);break;case"uuid":er(r,"uuid",n.message,e);break;case"regex":Et(r,n.regex,n.message,e);break;case"cuid":Et(r,Qt.cuid,n.message,e);break;case"cuid2":Et(r,Qt.cuid2,n.message,e);break;case"startsWith":Et(r,RegExp(`^${Nc(n.value,e)}`),n.message,e);break;case"endsWith":Et(r,RegExp(`${Nc(n.value,e)}$`),n.message,e);break;case"datetime":er(r,"date-time",n.message,e);break;case"date":er(r,"date",n.message,e);break;case"time":er(r,"time",n.message,e);break;case"duration":er(r,"duration",n.message,e);break;case"length":Fe(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),Fe(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":Et(r,RegExp(Nc(n.value,e)),n.message,e);break;case"ip":n.version!=="v6"&&er(r,"ipv4",n.message,e),n.version!=="v4"&&er(r,"ipv6",n.message,e);break;case"base64url":Et(r,Qt.base64url,n.message,e);break;case"jwt":Et(r,Qt.jwt,n.message,e);break;case"cidr":n.version!=="v6"&&Et(r,Qt.ipv4Cidr,n.message,e),n.version!=="v4"&&Et(r,Qt.ipv6Cidr,n.message,e);break;case"emoji":Et(r,Qt.emoji(),n.message,e);break;case"ulid":Et(r,Qt.ulid,n.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":er(r,"binary",n.message,e);break;case"contentEncoding:base64":Fe(r,"contentEncoding","base64",n.message,e);break;case"pattern:zod":Et(r,Qt.base64,n.message,e);break}break;case"nanoid":Et(r,Qt.nanoid,n.message,e);break}return r}function Nc(t,e){return e.patternStrategy==="escape"?PI(t):t}const RI=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function PI(t){let e="";for(let r=0;r<t.length;r++)RI.has(t[r])||(e+="\\"),e+=t[r];return e}function er(t,e,r,n){var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Fe(t,"format",e,r,n)}function Et(t,e,r,n){var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:mh(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Fe(t,"pattern",mh(e,n),r,n)}function mh(t,e){var c;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source;let s="",a=!1,i=!1,o=!1;for(let u=0;u<n.length;u++){if(a){s+=n[u],a=!1;continue}if(r.i){if(i){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&((c=n[u+2])!=null&&c.match(/[a-z]/))?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(r.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(r.s&&n[u]==="."){s+=i?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?a=!0:i&&n[u]==="]"?i=!1:!i&&n[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function i_(t,e){var n,s,a,i,o,c;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=t.keyType)==null?void 0:n._def.typeName)===M.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((u,l)=>({...u,[l]:je(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??Gt(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const r={type:"object",additionalProperties:je(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(((s=t.keyType)==null?void 0:s._def.typeName)===M.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const{type:u,...l}=a_(t.keyType._def,e);return{...r,propertyNames:l}}else{if(((i=t.keyType)==null?void 0:i._def.typeName)===M.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===M.ZodBranded&&t.keyType._def.type._def.typeName===M.ZodString&&((c=t.keyType._def.type._def.checks)!=null&&c.length)){const{type:u,...l}=n_(t.keyType._def,e);return{...r,propertyNames:l}}}return r}function LI(t,e){if(e.mapStrategy==="record")return i_(t,e);const r=je(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Gt(e),n=je(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Gt(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function DI(t){const e=t.values,n=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function MI(t){return t.target==="openAi"?void 0:{not:Gt({...t,currentPath:[...t.currentPath,"not"]})}}function jI(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Zi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function FI(t,e){if(e.target==="openApi3")return gh(t,e);const r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Zi&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((s,a)=>{const i=Zi[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":return a._def.value===null?[...s,"null"]:s;case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===r.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:r.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return gh(t,e)}const gh=(t,e)=>{const r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,s)=>je(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function UI(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Zi[t.innerType._def.typeName],nullable:!0}:{type:[Zi[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=je(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=je(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function BI(t,e){const r={type:"number"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"int":r.type="integer",r_(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Fe(r,"minimum",n.value,n.message,e):Fe(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Fe(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Fe(r,"maximum",n.value,n.message,e):Fe(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Fe(r,"maximum",n.value,n.message,e));break;case"multipleOf":Fe(r,"multipleOf",n.value,n.message,e);break}return r}function zI(t,e){const r=e.target==="openAi",n={type:"object",properties:{}},s=[],a=t.shape();for(const o in a){let c=a[o];if(c===void 0||c._def===void 0)continue;let u=ZI(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);const l=je(c._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});l!==void 0&&(n.properties[o]=l,u||s.push(o))}s.length&&(n.required=s);const i=qI(t,e);return i!==void 0&&(n.additionalProperties=i),n}function qI(t,e){if(t.catchall._def.typeName!=="ZodNever")return je(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function ZI(t){try{return t.isOptional()}catch{return!0}}const GI=(t,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return je(t.innerType._def,e);const r=je(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Gt(e)},r]}:Gt(e)},VI=(t,e)=>{if(e.pipeStrategy==="input")return je(t.in._def,e);if(e.pipeStrategy==="output")return je(t.out._def,e);const r=je(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=je(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(s=>s!==void 0)}};function HI(t,e){return je(t.type._def,e)}function WI(t,e){const n={type:"array",uniqueItems:!0,items:je(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Fe(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Fe(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function JI(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>je(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:je(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>je(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function KI(t){return{not:Gt(t)}}function XI(t){return Gt(t)}const YI=(t,e)=>je(t.innerType._def,e),QI=(t,e,r)=>{switch(e){case M.ZodString:return a_(t,r);case M.ZodNumber:return BI(t,r);case M.ZodObject:return zI(t,r);case M.ZodBigInt:return TI(t,r);case M.ZodBoolean:return SI();case M.ZodDate:return s_(t,r);case M.ZodUndefined:return KI(r);case M.ZodNull:return jI(r);case M.ZodArray:return EI(t,r);case M.ZodUnion:case M.ZodDiscriminatedUnion:return FI(t,r);case M.ZodIntersection:return NI(t,r);case M.ZodTuple:return JI(t,r);case M.ZodRecord:return i_(t,r);case M.ZodLiteral:return $I(t,r);case M.ZodEnum:return OI(t);case M.ZodNativeEnum:return DI(t);case M.ZodNullable:return UI(t,r);case M.ZodOptional:return GI(t,r);case M.ZodMap:return LI(t,r);case M.ZodSet:return WI(t,r);case M.ZodLazy:return()=>t.getter()._def;case M.ZodPromise:return HI(t,r);case M.ZodNaN:case M.ZodNever:return MI(r);case M.ZodEffects:return kI(t,r);case M.ZodAny:return Gt(r);case M.ZodUnknown:return XI(r);case M.ZodDefault:return AI(t,r);case M.ZodBranded:return n_(t,r);case M.ZodReadonly:return YI(t,r);case M.ZodCatch:return xI(t,r);case M.ZodPipeline:return VI(t,r);case M.ZodFunction:case M.ZodVoid:case M.ZodSymbol:return;default:return(n=>{})()}};function je(t,e,r=!1){var o;const n=e.seen.get(t);if(e.override){const c=(o=e.override)==null?void 0:o.call(e,t,e,n,r);if(c!==yI)return c}if(n&&!r){const c=eA(n,e);if(c!==void 0)return c}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=QI(t,t.typeName,e),i=typeof a=="function"?je(a(),e):a;if(i&&tA(t,e,i),e.postProcess){const c=e.postProcess(i,t,e);return s.jsonSchema=i,c}return s.jsonSchema=i,i}const eA=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:t_(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Gt(e)):e.$refStrategy==="seen"?Gt(e):void 0}},tA=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r),rA=(t,e)=>{const r=wI(e);let n;const s=je(t._def,r,!1)??Gt(r);r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));const a=n?{...s,[r.definitionPath]:n}:s;return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Rn(t,e){const r=typeof t;if(r!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!Rn(t[s],e[s]))return!1;return!0}if(r==="object"){if(!t||!e)return t===e;const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!Rn(t[i],e[i]))return!1;return!0}return t===e}function ir(t){return encodeURI(nA(t))}function nA(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}const sA={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},aA={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},iA={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let oA=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function ln(t,e=Object.create(null),r=oA,n=""){if(t&&typeof t=="object"&&!Array.isArray(t)){const a=t.$id||t.id;if(a){const i=new URL(a,r.href);i.hash.length>1?e[i.href]=t:(i.hash="",n===""?r=i:ln(t,e,r))}}else if(t!==!0&&t!==!1)return e;const s=r.href+(n?"#"+n:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=t,t===!0||t===!1)return e;if(t.__absolute_uri__===void 0&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:s}),t.$ref&&t.__absolute_ref__===void 0){const a=new URL(t.$ref,r.href);a.hash=a.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:a.href})}if(t.$recursiveRef&&t.__absolute_recursive_ref__===void 0){const a=new URL(t.$recursiveRef,r.href);a.hash=a.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:a.href})}if(t.$anchor){const a=new URL("#"+t.$anchor,r.href);e[a.href]=t}for(let a in t){if(iA[a])continue;const i=`${n}/${ir(a)}`,o=t[a];if(Array.isArray(o)){if(sA[a]){const c=o.length;for(let u=0;u<c;u++)ln(o[u],e,r,`${i}/${u}`)}}else if(aA[a])for(let c in o)ln(o[c],e,r,`${i}/${ir(c)}`);else ln(o,e,r,i)}return e}const cA=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,uA=[0,31,28,31,30,31,30,31,31,30,31,30,31],lA=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,dA=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,fA=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,hA=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,pA=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,mA=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,gA=/^(?:\/(?:[^~/]|~0|~1)*)*$/,_A=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,yA=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,vA=t=>{if(t[0]==='"')return!1;const[e,r,...n]=t.split("@");return!e||!r||n.length!==0||e.length>64||r.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(r)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:r.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},bA=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,wA=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,EA=t=>t.length>1&&t.length<80&&(/^P\d+([.,]\d+)?W$/.test(t)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(t)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(t));function br(t){return t.test.bind(t)}const _h={date:o_,time:c_.bind(void 0,!1),"date-time":xA,duration:EA,uri:kA,"uri-reference":br(fA),"uri-template":br(hA),url:br(pA),email:vA,hostname:br(dA),ipv4:br(bA),ipv6:br(wA),regex:CA,uuid:br(mA),"json-pointer":br(gA),"json-pointer-uri-fragment":br(_A),"relative-json-pointer":br(yA)};function TA(t){return t%4===0&&(t%100!==0||t%400===0)}function o_(t){const e=t.match(cA);if(!e)return!1;const r=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&TA(r)?29:uA[n])}function c_(t,e){const r=e.match(lA);if(!r)return!1;const n=+r[1],s=+r[2],a=+r[3],i=!!r[5];return(n<=23&&s<=59&&a<=59||n==23&&s==59&&a==60)&&(!t||i)}const SA=/t|\s/i;function xA(t){const e=t.split(SA);return e.length==2&&o_(e[0])&&c_(!0,e[1])}const IA=/\/|:/,AA=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function kA(t){return IA.test(t)&&AA.test(t)}const OA=/[^\\]\\Z/;function CA(t){if(OA.test(t))return!1;try{return new RegExp(t,"u"),!0}catch{return!1}}function NA(t){let e=0,r=t.length,n=0,s;for(;n<r;)e++,s=t.charCodeAt(n++),s>=55296&&s<=56319&&n<r&&(s=t.charCodeAt(n),(s&64512)==56320&&n++);return e}function Ge(t,e,r="2019-09",n=ln(e),s=!0,a=null,i="#",o="#",c=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:i,keyword:"false",keywordLocation:i,error:"False boolean schema."}]};const u=typeof t;let l;switch(u){case"boolean":case"number":case"string":l=u;break;case"object":t===null?l="null":Array.isArray(t)?l="array":l="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:m,const:_,enum:y,required:w,not:g,anyOf:b,allOf:T,oneOf:I,if:C,then:D,else:k,format:A,properties:H,patternProperties:q,additionalProperties:pe,unevaluatedProperties:Q,minProperties:N,maxProperties:P,propertyNames:$,dependentRequired:L,dependentSchemas:F,dependencies:Z,prefixItems:X,items:Y,additionalItems:J,unevaluatedItems:ce,contains:Ce,minContains:_e,maxContains:S,minItems:p,maxItems:v,uniqueItems:x,minimum:O,maximum:ae,exclusiveMinimum:U,exclusiveMaximum:re,multipleOf:Ie,minLength:Me,maxLength:Re,pattern:Oe,__absolute_ref__:Be,__absolute_recursive_ref__:jr}=e,G=[];if(f===!0&&a===null&&(a=e),h==="#"){const ue=a===null?n[jr]:a,le=`${o}/$recursiveRef`,ee=Ge(t,a===null?e:a,r,n,s,ue,i,le,c);ee.valid||G.push({instanceLocation:i,keyword:"$recursiveRef",keywordLocation:le,error:"A subschema had errors."},...ee.errors)}if(d!==void 0){const le=n[Be||d];if(le===void 0){let W=`Unresolved $ref "${d}".`;throw Be&&Be!==d&&(W+=`  Absolute URI "${Be}".`),W+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(W)}const ee=`${o}/$ref`,ne=Ge(t,le,r,n,s,a,i,ee,c);if(ne.valid||G.push({instanceLocation:i,keyword:"$ref",keywordLocation:ee,error:"A subschema had errors."},...ne.errors),r==="4"||r==="7")return{valid:G.length===0,errors:G}}if(Array.isArray(m)){let ue=m.length,le=!1;for(let ee=0;ee<ue;ee++)if(l===m[ee]||m[ee]==="integer"&&l==="number"&&t%1===0&&t===t){le=!0;break}le||G.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${m.join('", "')}".`})}else m==="integer"?(l!=="number"||t%1||t!==t)&&G.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${m}".`}):m!==void 0&&l!==m&&G.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${m}".`});if(_!==void 0&&(l==="object"||l==="array"?Rn(t,_)||G.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(_)}.`}):t!==_&&G.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(_)}.`})),y!==void 0&&(l==="object"||l==="array"?y.some(ue=>Rn(t,ue))||G.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`}):y.some(ue=>t===ue)||G.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`})),g!==void 0){const ue=`${o}/not`;Ge(t,g,r,n,s,a,i,ue).valid&&G.push({instanceLocation:i,keyword:"not",keywordLocation:ue,error:'Instance matched "not" schema.'})}let At=[];if(b!==void 0){const ue=`${o}/anyOf`,le=G.length;let ee=!1;for(let ne=0;ne<b.length;ne++){const W=b[ne],be=Object.create(c),ve=Ge(t,W,r,n,s,f===!0?a:null,i,`${ue}/${ne}`,be);G.push(...ve.errors),ee=ee||ve.valid,ve.valid&&At.push(be)}ee?G.length=le:G.splice(le,0,{instanceLocation:i,keyword:"anyOf",keywordLocation:ue,error:"Instance does not match any subschemas."})}if(T!==void 0){const ue=`${o}/allOf`,le=G.length;let ee=!0;for(let ne=0;ne<T.length;ne++){const W=T[ne],be=Object.create(c),ve=Ge(t,W,r,n,s,f===!0?a:null,i,`${ue}/${ne}`,be);G.push(...ve.errors),ee=ee&&ve.valid,ve.valid&&At.push(be)}ee?G.length=le:G.splice(le,0,{instanceLocation:i,keyword:"allOf",keywordLocation:ue,error:"Instance does not match every subschema."})}if(I!==void 0){const ue=`${o}/oneOf`,le=G.length,ee=I.filter((ne,W)=>{const be=Object.create(c),ve=Ge(t,ne,r,n,s,f===!0?a:null,i,`${ue}/${W}`,be);return G.push(...ve.errors),ve.valid&&At.push(be),ve.valid}).length;ee===1?G.length=le:G.splice(le,0,{instanceLocation:i,keyword:"oneOf",keywordLocation:ue,error:`Instance does not match exactly one subschema (${ee} matches).`})}if((l==="object"||l==="array")&&Object.assign(c,...At),C!==void 0){const ue=`${o}/if`;if(Ge(t,C,r,n,s,a,i,ue,c).valid){if(D!==void 0){const ee=Ge(t,D,r,n,s,a,i,`${o}/then`,c);ee.valid||G.push({instanceLocation:i,keyword:"if",keywordLocation:ue,error:'Instance does not match "then" schema.'},...ee.errors)}}else if(k!==void 0){const ee=Ge(t,k,r,n,s,a,i,`${o}/else`,c);ee.valid||G.push({instanceLocation:i,keyword:"if",keywordLocation:ue,error:'Instance does not match "else" schema.'},...ee.errors)}}if(l==="object"){if(w!==void 0)for(const ne of w)ne in t||G.push({instanceLocation:i,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${ne}".`});const ue=Object.keys(t);if(N!==void 0&&ue.length<N&&G.push({instanceLocation:i,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${N} properties.`}),P!==void 0&&ue.length>P&&G.push({instanceLocation:i,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${P} properties.`}),$!==void 0){const ne=`${o}/propertyNames`;for(const W in t){const be=`${i}/${ir(W)}`,ve=Ge(W,$,r,n,s,a,be,ne);ve.valid||G.push({instanceLocation:i,keyword:"propertyNames",keywordLocation:ne,error:`Property name "${W}" does not match schema.`},...ve.errors)}}if(L!==void 0){const ne=`${o}/dependantRequired`;for(const W in L)if(W in t){const be=L[W];for(const ve of be)ve in t||G.push({instanceLocation:i,keyword:"dependentRequired",keywordLocation:ne,error:`Instance has "${W}" but does not have "${ve}".`})}}if(F!==void 0)for(const ne in F){const W=`${o}/dependentSchemas`;if(ne in t){const be=Ge(t,F[ne],r,n,s,a,i,`${W}/${ir(ne)}`,c);be.valid||G.push({instanceLocation:i,keyword:"dependentSchemas",keywordLocation:W,error:`Instance has "${ne}" but does not match dependant schema.`},...be.errors)}}if(Z!==void 0){const ne=`${o}/dependencies`;for(const W in Z)if(W in t){const be=Z[W];if(Array.isArray(be))for(const ve of be)ve in t||G.push({instanceLocation:i,keyword:"dependencies",keywordLocation:ne,error:`Instance has "${W}" but does not have "${ve}".`});else{const ve=Ge(t,be,r,n,s,a,i,`${ne}/${ir(W)}`);ve.valid||G.push({instanceLocation:i,keyword:"dependencies",keywordLocation:ne,error:`Instance has "${W}" but does not match dependant schema.`},...ve.errors)}}}const le=Object.create(null);let ee=!1;if(H!==void 0){const ne=`${o}/properties`;for(const W in H){if(!(W in t))continue;const be=`${i}/${ir(W)}`,ve=Ge(t[W],H[W],r,n,s,a,be,`${ne}/${ir(W)}`);if(ve.valid)c[W]=le[W]=!0;else if(ee=s,G.push({instanceLocation:i,keyword:"properties",keywordLocation:ne,error:`Property "${W}" does not match schema.`},...ve.errors),ee)break}}if(!ee&&q!==void 0){const ne=`${o}/patternProperties`;for(const W in q){const be=new RegExp(W,"u"),ve=q[W];for(const kt in t){if(!be.test(kt))continue;const Vd=`${i}/${ir(kt)}`,Hd=Ge(t[kt],ve,r,n,s,a,Vd,`${ne}/${ir(W)}`);Hd.valid?c[kt]=le[kt]=!0:(ee=s,G.push({instanceLocation:i,keyword:"patternProperties",keywordLocation:ne,error:`Property "${kt}" matches pattern "${W}" but does not match associated schema.`},...Hd.errors))}}}if(!ee&&pe!==void 0){const ne=`${o}/additionalProperties`;for(const W in t){if(le[W])continue;const be=`${i}/${ir(W)}`,ve=Ge(t[W],pe,r,n,s,a,be,ne);ve.valid?c[W]=!0:(ee=s,G.push({instanceLocation:i,keyword:"additionalProperties",keywordLocation:ne,error:`Property "${W}" does not match additional properties schema.`},...ve.errors))}}else if(!ee&&Q!==void 0){const ne=`${o}/unevaluatedProperties`;for(const W in t)if(!c[W]){const be=`${i}/${ir(W)}`,ve=Ge(t[W],Q,r,n,s,a,be,ne);ve.valid?c[W]=!0:G.push({instanceLocation:i,keyword:"unevaluatedProperties",keywordLocation:ne,error:`Property "${W}" does not match unevaluated properties schema.`},...ve.errors)}}}else if(l==="array"){v!==void 0&&t.length>v&&G.push({instanceLocation:i,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${t.length} > ${v}).`}),p!==void 0&&t.length<p&&G.push({instanceLocation:i,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${t.length} < ${p}).`});const ue=t.length;let le=0,ee=!1;if(X!==void 0){const ne=`${o}/prefixItems`,W=Math.min(X.length,ue);for(;le<W;le++){const be=Ge(t[le],X[le],r,n,s,a,`${i}/${le}`,`${ne}/${le}`);if(c[le]=!0,!be.valid&&(ee=s,G.push({instanceLocation:i,keyword:"prefixItems",keywordLocation:ne,error:"Items did not match schema."},...be.errors),ee))break}}if(Y!==void 0){const ne=`${o}/items`;if(Array.isArray(Y)){const W=Math.min(Y.length,ue);for(;le<W;le++){const be=Ge(t[le],Y[le],r,n,s,a,`${i}/${le}`,`${ne}/${le}`);if(c[le]=!0,!be.valid&&(ee=s,G.push({instanceLocation:i,keyword:"items",keywordLocation:ne,error:"Items did not match schema."},...be.errors),ee))break}}else for(;le<ue;le++){const W=Ge(t[le],Y,r,n,s,a,`${i}/${le}`,ne);if(c[le]=!0,!W.valid&&(ee=s,G.push({instanceLocation:i,keyword:"items",keywordLocation:ne,error:"Items did not match schema."},...W.errors),ee))break}if(!ee&&J!==void 0){const W=`${o}/additionalItems`;for(;le<ue;le++){const be=Ge(t[le],J,r,n,s,a,`${i}/${le}`,W);c[le]=!0,be.valid||(ee=s,G.push({instanceLocation:i,keyword:"additionalItems",keywordLocation:W,error:"Items did not match additional items schema."},...be.errors))}}}if(Ce!==void 0)if(ue===0&&_e===void 0)G.push({instanceLocation:i,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(_e!==void 0&&ue<_e)G.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${ue}) than minContains (${_e}).`});else{const ne=`${o}/contains`,W=G.length;let be=0;for(let ve=0;ve<ue;ve++){const kt=Ge(t[ve],Ce,r,n,s,a,`${i}/${ve}`,ne);kt.valid?(c[ve]=!0,be++):G.push(...kt.errors)}be>=(_e||0)&&(G.length=W),_e===void 0&&S===void 0&&be===0?G.splice(W,0,{instanceLocation:i,keyword:"contains",keywordLocation:ne,error:"Array does not contain item matching schema."}):_e!==void 0&&be<_e?G.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${_e} items matching schema. Only ${be} items were found.`}):S!==void 0&&be>S&&G.push({instanceLocation:i,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${S} items matching schema. ${be} items were found.`})}if(!ee&&ce!==void 0){const ne=`${o}/unevaluatedItems`;for(le;le<ue;le++){if(c[le])continue;const W=Ge(t[le],ce,r,n,s,a,`${i}/${le}`,ne);c[le]=!0,W.valid||G.push({instanceLocation:i,keyword:"unevaluatedItems",keywordLocation:ne,error:"Items did not match unevaluated items schema."},...W.errors)}}if(x)for(let ne=0;ne<ue;ne++){const W=t[ne],be=typeof W=="object"&&W!==null;for(let ve=0;ve<ue;ve++){if(ne===ve)continue;const kt=t[ve];(W===kt||be&&(typeof kt=="object"&&kt!==null)&&Rn(W,kt))&&(G.push({instanceLocation:i,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${ne} and ${ve}.`}),ne=Number.MAX_SAFE_INTEGER,ve=Number.MAX_SAFE_INTEGER)}}}else if(l==="number"){if(r==="4"?(O!==void 0&&(U===!0&&t<=O||t<O)&&G.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${U?"or equal to ":""} ${O}.`}),ae!==void 0&&(re===!0&&t>=ae||t>ae)&&G.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${re?"or equal to ":""} ${ae}.`})):(O!==void 0&&t<O&&G.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${O}.`}),ae!==void 0&&t>ae&&G.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${ae}.`}),U!==void 0&&t<=U&&G.push({instanceLocation:i,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${t} is less than ${U}.`}),re!==void 0&&t>=re&&G.push({instanceLocation:i,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${t} is greater than or equal to ${re}.`})),Ie!==void 0){const ue=t%Ie;Math.abs(0-ue)>=11920929e-14&&Math.abs(Ie-ue)>=11920929e-14&&G.push({instanceLocation:i,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${t} is not a multiple of ${Ie}.`})}}else if(l==="string"){const ue=Me===void 0&&Re===void 0?0:NA(t);Me!==void 0&&ue<Me&&G.push({instanceLocation:i,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${ue} < ${Me}).`}),Re!==void 0&&ue>Re&&G.push({instanceLocation:i,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${ue} > ${Re}).`}),Oe!==void 0&&!new RegExp(Oe,"u").test(t)&&G.push({instanceLocation:i,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),A!==void 0&&_h[A]&&!_h[A](t)&&G.push({instanceLocation:i,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${A}".`})}return{valid:G.length===0,errors:G}}class $A{constructor(e,r="2019-09",n=!0){E(this,"schema");E(this,"draft");E(this,"shortCircuit");E(this,"lookup");this.schema=e,this.draft=r,this.shortCircuit=n,this.lookup=ln(e)}validate(e){return Ge(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,r){r&&(e={...e,$id:r}),ln(e,this.lookup)}}var RA={};Ne(RA,{Validator:()=>$A,deepCompareStrict:()=>Rn,toJsonSchema:()=>ur,validatesOnlyStrings:()=>Ks});function ur(t,e){if(He(t)){const r=Qg(t,!0);if($r(r)){const n=qi(r,!0);return Au(n,e)}else return Au(t,e)}return tt(t)?rA(t):t}function Ks(t){if(!t||typeof t!="object"||Object.keys(t).length===0||Array.isArray(t))return!1;if("type"in t)return typeof t.type=="string"?t.type==="string":Array.isArray(t.type)?t.type.every(e=>e==="string"):!1;if("enum"in t)return Array.isArray(t.enum)&&t.enum.length>0&&t.enum.every(e=>typeof e=="string");if("const"in t)return typeof t.const=="string";if("allOf"in t&&Array.isArray(t.allOf))return t.allOf.some(e=>Ks(e));if("anyOf"in t&&Array.isArray(t.anyOf)||"oneOf"in t&&Array.isArray(t.oneOf)){const e="anyOf"in t?t.anyOf:t.oneOf;return e.length>0&&e.every(r=>Ks(r))}if("not"in t)return!1;if("$ref"in t&&typeof t.$ref=="string"){const e=t.$ref,r=ln(t);return r[e]?Ks(r[e]):!1}return!1}const PA=Object.prototype.toString,LA=t=>PA.call(t)==="[object Error]",DA=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function MA(t){if(!(t&&LA(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:r,stack:n}=t;return r==="Load failed"?n===void 0||"__sentry_captured__"in t:r.startsWith("error sending request for url")?!0:DA.has(r)}function jA(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function Xa(t,e,{min:r=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<r)throw new TypeError(`Expected \`${t}\` to be  ${r}.`)}}var FA=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}};function UA(t,e){const r=Math.max(1,t+1),n=e.randomize?Math.random()+1:1;let s=Math.round(n*e.minTimeout*e.factor**(r-1));return s=Math.min(s,e.maxTimeout),s}function yh(t,e){return Number.isFinite(e)?e-(performance.now()-t):e}async function BA({error:t,attemptNumber:e,retriesConsumed:r,startTime:n,options:s}){var f,m,_;const a=t instanceof Error?t:new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(a instanceof FA)throw a.originalError;const i=Number.isFinite(s.retries)?Math.max(0,s.retries-r):s.retries,o=s.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:a,attemptNumber:e,retriesLeft:i,retriesConsumed:r});if(await s.onFailedAttempt(c),yh(n,o)<=0)throw a;const u=await s.shouldConsumeRetry(c),l=yh(n,o);if(l<=0||i<=0)throw a;if(a instanceof TypeError&&!MA(a)){if(u)throw a;return(f=s.signal)==null||f.throwIfAborted(),!1}if(!await s.shouldRetry(c))throw a;if(!u)return(m=s.signal)==null||m.throwIfAborted(),!1;const d=UA(r,s),h=Math.min(d,l);return h>0&&await new Promise((y,w)=>{var T,I;const g=()=>{var C;clearTimeout(b),(C=s.signal)==null||C.removeEventListener("abort",g),w(s.signal.reason)},b=setTimeout(()=>{var C;(C=s.signal)==null||C.removeEventListener("abort",g),y()},h);s.unref&&((T=b.unref)==null||T.call(b)),(I=s.signal)==null||I.addEventListener("abort",g,{once:!0})}),(_=s.signal)==null||_.throwIfAborted(),!0}async function Cu(t,e={}){var a,i,o;if(e={...e},jA(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),Xa("factor",e.factor,{min:0,allowInfinity:!1}),Xa("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),Xa("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),Xa("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),(a=e.signal)==null||a.throwIfAborted();let r=0,n=0;const s=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){r++;try{(i=e.signal)==null||i.throwIfAborted();const c=await t(r);return(o=e.signal)==null||o.throwIfAborted(),c}catch(c){await BA({error:c,attemptNumber:r,retriesConsumed:n,startTime:s,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}var zA={};Ne(zA,{AsyncCaller:()=>Ca});const qA=[400,401,402,403,404,405,406,407,409],ZA=t=>{if(typeof t!="object"||t===null)return;if("message"in t&&typeof t.message=="string"&&(t.message.startsWith("Cancel")||t.message.startsWith("AbortError"))||"name"in t&&typeof t.name=="string"&&t.name==="AbortError"||"code"in t&&typeof t.code=="string"&&t.code==="ECONNABORTED")throw t;const e="response"in t&&typeof t.response=="object"&&t.response!==null&&"status"in t.response&&typeof t.response.status=="number"?t.response.status:void 0;if(e&&qA.includes(+e))throw t;if(("error"in t&&typeof t.error=="object"&&t.error!==null&&"code"in t.error&&typeof t.error.code=="string"?t.error.code:void 0)==="insufficient_quota"){const n=new Error("message"in t&&typeof t.message=="string"?t.message:"Insufficient quota");throw n.name="InsufficientQuotaError",n}};var Ca=class{constructor(t){E(this,"maxConcurrency");E(this,"maxRetries");E(this,"onFailedAttempt");E(this,"queue");this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.onFailedAttempt=t.onFailedAttempt??ZA;const e="default"in Zr?Zr.default:Zr;this.queue=new e({concurrency:this.maxConcurrency})}async call(t,...e){return this.queue.add(()=>Cu(()=>t(...e).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:({error:r})=>{var n;return(n=this.onFailedAttempt)==null?void 0:n.call(this,r)},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){if(t.signal){let n;return Promise.race([this.call(e,...r),new Promise((s,a)=>{var i;n=()=>{a(ha(t.signal))},(i=t.signal)==null||i.addEventListener("abort",n)})]).finally(()=>{t.signal&&n&&t.signal.removeEventListener("abort",n)})}return this.call(e,...r)}fetch(...t){return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}},GA={};Ne(GA,{AsyncGeneratorWithSetup:()=>Zn,IterableReadableStream:()=>gr,atee:()=>Jl,concat:()=>yn,pipeGeneratorWithSetup:()=>u_});var gr=class Nu extends ReadableStream{constructor(){super(...arguments);E(this,"reader")}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const r=await this.reader.read();return r.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:r.value}}catch(r){throw this.reader.releaseLock(),r}}async return(){if(this.ensureReader(),this.locked){const r=this.reader.cancel();this.reader.releaseLock(),await r}return{done:!0,value:void 0}}async throw(r){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw r}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(r){const n=r.getReader();return new Nu({start(s){return a();function a(){return n.read().then(({done:i,value:o})=>{if(i){s.close();return}return s.enqueue(o),a()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(r){return new Nu({async pull(n){const{value:s,done:a}=await r.next();a&&n.close(),n.enqueue(s)},async cancel(n){await r.return(n)}})}};function Jl(t,e=2){const r=Array.from({length:e},()=>[]);return r.map(async function*(s){for(;;)if(s.length===0){const a=await t.next();for(const i of r)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function yn(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const r={...t};for(const[n,s]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=yn(r[n],s):r[n]=s;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}var Zn=class{constructor(t){E(this,"generator");E(this,"setup");E(this,"config");E(this,"signal");E(this,"firstResult");E(this,"firstResultUsed",!1);var e;this.generator=t.generator,this.config=t.config,this.signal=t.signal??((e=this.config)==null?void 0:e.signal),this.setup=new Promise((r,n)=>{mr.runWithConfig(Jr(t.config),async()=>{this.firstResult=t.generator.next(),t.startSetup?this.firstResult.then(t.startSetup).then(r,n):this.firstResult.then(s=>r(void 0),n)},!0)})}async next(...t){var e;return(e=this.signal)==null||e.throwIfAborted(),this.firstResultUsed?mr.runWithConfig(Jr(this.config),this.signal?async()=>Kr(this.generator.next(...t),this.signal):async()=>this.generator.next(...t),!0):(this.firstResultUsed=!0,this.firstResult)}async return(t){return this.generator.return(t)}async throw(t){return this.generator.throw(t)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function u_(t,e,r,n,...s){const a=new Zn({generator:e,startSetup:r,signal:n}),i=await a.setup;return{output:t(a,i,...s),setup:i}}/*!
* https://github.com/Starcounter-Jack/JSON-Patch
* (c) 2017-2022 Joachim Wester
* MIT licensed
*/const VA=Object.prototype.hasOwnProperty;function $u(t,e){return VA.call(t,e)}function Ru(t){if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)$u(t,r)&&e.push(r);return e}function lr(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Pu(t){let e=0;const r=t.length;let n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Gn(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function HA(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Lu(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(Lu(t[r]))return!0}else if(typeof t=="object"){const r=Ru(t),n=r.length;for(var e=0;e<n;e++)if(Lu(t[r[e]]))return!0}}return!1}function vh(t,e){const r=[t];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&r.push(`${n}: ${s}`)}return r.join(`
`)}var WA=class extends Error{constructor(t,e,r,n,s){super(vh(t,{name:e,index:r,operation:n,tree:s})),this.name=e,this.index=r,this.operation=n,this.tree=s,Object.setPrototypeOf(this,new.target.prototype),this.message=vh(t,{name:e,index:r,operation:n,tree:s})}},l_={};Ne(l_,{JsonPatchError:()=>Ke,_areEquals:()=>ga,applyOperation:()=>Pn,applyPatch:()=>fs,applyReducer:()=>XA,deepClone:()=>JA,getValueByPointer:()=>Gi,validate:()=>d_,validator:()=>Vi});const Ke=WA,JA=lr;function $c(t){return Object.getOwnPropertyNames(Object.prototype).includes(t)}const ss={add:function(t,e,r){if($c(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){if($c(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){if($c(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=Gi(r,this.path);n&&(n=lr(n));const s=Pn(r,{op:"remove",path:this.from}).removed;return Pn(r,{op:"add",path:this.path,value:s}),{newDocument:r,removed:n}},copy:function(t,e,r){const n=Gi(r,this.from);return Pn(r,{op:"add",path:this.path,value:lr(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:ga(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}};var KA={add:function(t,e,r){return Pu(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:ss.move,copy:ss.copy,test:ss.test,_get:ss._get};function Gi(t,e){if(e=="")return t;var r={op:"_get",path:e};return Pn(t,r),r.value}function Pn(t,e,r=!1,n=!0,s=!0,a=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):Vi(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=Gi(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=ga(t,e.value),i.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(r)throw new Ke("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t);return i}}else{n||(t=lr(t));const o=(e.path||"").split("/");let c=t,u=1,l=o.length,d,h,f;for(typeof r=="function"?f=r:f=Vi;;){if(h=o[u],h&&h.indexOf("~")!=-1&&(h=HA(h)),s&&(h=="__proto__"||h=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(c[h]===void 0?d=o.slice(0,u).join("/"):u==l-1&&(d=e.path),d!==void 0&&f(e,0,t,d)),u++,Array.isArray(c)){if(h==="-")h=c.length;else{if(r&&!Pu(h))throw new Ke("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);Pu(h)&&(h=~~h)}if(u>=l){if(r&&e.op==="add"&&h>c.length)throw new Ke("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);const m=KA[e.op].call(e,c,h,t);if(m.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return m}}else if(u>=l){const m=ss[e.op].call(e,c,h,t);if(m.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return m}if(c=c[h],r&&u<l&&(!c||typeof c!="object"))throw new Ke("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,t)}}}function fs(t,e,r,n=!0,s=!0){if(r&&!Array.isArray(e))throw new Ke("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=lr(t));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=Pn(t,e[i],r,!0,s,i),t=a[i].newDocument;return a.newDocument=t,a}function XA(t,e,r){const n=Pn(t,e);if(n.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function Vi(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new Ke("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(ss[t.op]){if(typeof t.path!="string")throw new Ke("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Ke('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Ke("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Ke("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Lu(t.value))throw new Ke("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var s=t.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new Ke("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new Ke("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},o=d_([i],r);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ke("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new Ke("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function d_(t,e,r){try{if(!Array.isArray(t))throw new Ke("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)fs(lr(e),lr(t),r||!0);else{r=r||Vi;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(s){if(s instanceof Ke)return s;throw s}}function ga(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),s,a,i;if(r&&n){if(a=t.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!ga(t[s],e[s]))return!1;return!0}if(r!=n)return!1;var o=Object.keys(t);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!ga(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}function f_(t,e,r,n,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=Ru(e),i=Ru(t),o=!1,c=i.length-1;c>=0;c--){var u=i[c],l=t[u];if($u(e,u)&&!(e[u]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var d=e[u];typeof l=="object"&&l!=null&&typeof d=="object"&&d!=null&&Array.isArray(l)===Array.isArray(d)?f_(l,d,r,n+"/"+Gn(u),s):l!==d&&(s&&r.push({op:"test",path:n+"/"+Gn(u),value:lr(l)}),r.push({op:"replace",path:n+"/"+Gn(u),value:lr(d)}))}else Array.isArray(t)===Array.isArray(e)?(s&&r.push({op:"test",path:n+"/"+Gn(u),value:lr(l)}),r.push({op:"remove",path:n+"/"+Gn(u)}),o=!0):(s&&r.push({op:"test",path:n,value:t}),r.push({op:"replace",path:n,value:e}))}if(!(!o&&a.length==i.length))for(var c=0;c<a.length;c++){var u=a[c];!$u(t,u)&&e[u]!==void 0&&r.push({op:"add",path:n+"/"+Gn(u),value:lr(e[u])})}}}function Kl(t,e,r=!1){var n=[];return f_(t,e,n,"",r),n}({...l_});var YA={};Ne(YA,{LogStreamCallbackHandler:()=>Mu,RunLog:()=>Xl,RunLogPatch:()=>qr,isLogStreamHandler:()=>h_});var qr=class{constructor(t){E(this,"ops");this.ops=t.ops??[]}concat(t){const e=this.ops.concat(t.ops),r=fs({},e);return new Xl({ops:e,state:r[r.length-1].newDocument})}},Xl=class Du extends qr{constructor(r){super(r);E(this,"state");this.state=r.state}concat(r){const n=this.ops.concat(r.ops),s=fs(this.state,r.ops);return new Du({ops:n,state:s[s.length-1].newDocument})}static fromRunLogPatch(r){const n=fs({},r.ops);return new Du({ops:r.ops,state:n[n.length-1].newDocument})}};const h_=t=>t.name==="log_stream_tracer";async function bh(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&(r==null?void 0:r.input)===""))return r.input}async function wh(t,e){const{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&(r==null?void 0:r.output)!==void 0?r.output:r}function QA(t){return t!==void 0&&t.message!==void 0}var Mu=class extends bs{constructor(e){super({_awaitHandler:!0,...e});E(this,"autoClose",!0);E(this,"includeNames");E(this,"includeTypes");E(this,"includeTags");E(this,"excludeNames");E(this,"excludeTypes");E(this,"excludeTags");E(this,"_schemaFormat","original");E(this,"rootId");E(this,"keyMapByRunId",{});E(this,"counterMapByRunName",{});E(this,"transformStream");E(this,"writer");E(this,"receiveStream");E(this,"name","log_stream_tracer");E(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=gr.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,r){for await(const n of r){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new qr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new qr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await bh(e,this._schemaFormat)),await this.writer.write(new qr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const r=this.keyMapByRunId[e.id];if(r===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await bh(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await wh(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});const s=new qr({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const r=new qr({ops:[{op:"replace",path:"/final_output",value:await wh(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?QA(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new Mr({id:`run-${e.id}`,content:r}):i=r;const o=new qr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}},ek={};Ne(ek,{ChatGenerationChunk:()=>ps,GenerationChunk:()=>hs,RUN_KEY:()=>_a});const _a="__run";var hs=class p_{constructor(e){E(this,"text");E(this,"generationInfo");this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new p_({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},ps=class m_ extends hs{constructor(r){super(r);E(this,"message");this.message=r.message}concat(r){return new m_({text:this.text+r.text,generationInfo:{...this.generationInfo,...r.generationInfo},message:this.message.concat(r.message)})}};function Ya({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const tk=t=>t.name==="event_stream_tracer";var rk=class extends bs{constructor(e){super({_awaitHandler:!0,...e});E(this,"autoClose",!0);E(this,"includeNames");E(this,"includeTypes");E(this,"includeTags");E(this,"excludeNames");E(this,"excludeTypes");E(this,"excludeTags");E(this,"runInfoMap",new Map);E(this,"tappedPromises",new Map);E(this,"transformStream");E(this,"writer");E(this,"receiveStream");E(this,"readableStreamClosed",!1);E(this,"name","event_stream_tracer");E(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream({flush:()=>{this.readableStreamClosed=!0}}),this.writer=this.transformStream.writable.getWriter(),this.receiveStream=gr.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,r){const n=await r.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function a(o,c){return o==="llm"&&typeof c=="string"?new hs({text:c}):c}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(c=>{o=c}),this.tappedPromises.set(e,i);try{const c={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...c,data:{chunk:a(s.runType,n.value)}},s),yield n.value;for await(const u of r)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...c,data:{chunk:a(s.runType,u)}},s),yield u}finally{o==null||o()}}else{yield n.value;for await(const o of r)yield o}}async send(e,r){this.readableStreamClosed||this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){var i,o;const r=Ya(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${n}_start`;await this.send({event:a,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,r,n){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?a=new Mr({content:r,id:`run-${e.id}`}):a=n.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?a=new hs({text:r}):a=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,c;const r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(r.runType==="chat_model"){for(const u of s??[]){if(a!==void 0)break;a=(o=u[0])==null?void 0:o.message}n="on_chat_model_end"}else if(r.runType==="llm")a={generations:s==null?void 0:s.map(u=>u.map(l=>({text:l.text,generationInfo:l.generationInfo}))),llmOutput:((c=e.outputs)==null?void 0:c.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:a,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){var i,o;const r=Ya(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:a,name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??r.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,r.inputs=s.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){var s,a;const r=Ya(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},n)}async onToolEnd(e){var s;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){var a,i;const r=Ya(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var n;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async handleCustomEvent(e,r,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:r},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}},g_=class extends bs{constructor({config:e,onStart:r,onEnd:n,onError:s}){super({_awaitHandler:!0});E(this,"name","RootListenersTracer");E(this,"rootId");E(this,"config");E(this,"argOnStart");E(this,"argOnEnd");E(this,"argOnError");this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function Yl(t){return t?t.lc_runnable:!1}var nk=class{constructor(t){E(this,"includeNames");E(this,"includeTypes");E(this,"includeTags");E(this,"excludeNames");E(this,"excludeTypes");E(this,"excludeTags");this.includeNames=t.includeNames,this.includeTypes=t.includeTypes,this.includeTags=t.includeTags,this.excludeNames=t.excludeNames,this.excludeTypes=t.excludeTypes,this.excludeTags=t.excludeTags}includeEvent(t,e){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const n=t.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(t.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e)),this.includeTags!==void 0&&(r=r||n.some(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(t.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}};const sk=t=>btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");function Rc(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const ak=["*","_","`"];function ik(t){let e="";for(const[r,n]of Object.entries(t))e+=`	classDef ${r} ${n};
`;return e}function ok(t,e,r){const{firstNode:n,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:c=9}=r??{};let u=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const m="default",_={[m]:"{0}({1})"};n!==void 0&&(_[n]="{0}([{1}]):::first"),s!==void 0&&(_[s]="{0}([{1}]):::last");for(const[y,w]of Object.entries(t)){const g=w.name.split(":").pop()??"";let T=ak.some(C=>g.startsWith(C)&&g.endsWith(C))?`<p>${g}</p>`:g;Object.keys(w.metadata??{}).length&&(T+=`<hr/><small><em>${Object.entries(w.metadata??{}).map(([C,D])=>`${C} = ${D}`).join(`
`)}</em></small>`);const I=(_[y]??_[m]).replace("{0}",Rc(y)).replace("{1}",T);u+=`	${I}
`}}const l={};for(const m of e){const _=m.source.split(":"),y=m.target.split(":"),w=_.filter((g,b)=>g===y[b]).join(":");l[w]||(l[w]=[]),l[w].push(m)}const d=new Set;function h(m){return[...m].sort((_,y)=>_.split(":").length-y.split(":").length)}function f(m,_){const y=m.length===1&&m[0].source===m[0].target;if(_&&!y){const g=_.split(":").pop();if(d.has(_))throw new Error(`Found duplicate subgraph '${g}' at '${_} -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(_),u+=`	subgraph ${g}
`}const w=h(Object.keys(l).filter(g=>g.startsWith(`${_}:`)&&g!==_&&g.split(":").length===_.split(":").length+1));for(const g of w)f(l[g],g);for(const g of m){const{source:b,target:T,data:I,conditional:C}=g;let D="";if(I!==void 0){let k=I;const A=k.split(" ");A.length>c&&(k=Array.from({length:Math.ceil(A.length/c)},(H,q)=>A.slice(q*c,(q+1)*c).join(" ")).join("&nbsp;<br>&nbsp;")),D=C?` -. &nbsp;${k}&nbsp; .-> `:` -- &nbsp;${k}&nbsp; --> `}else D=C?" -.-> ":" --> ";u+=`	${Rc(b)}${D}${Rc(T)};
`}_&&!y&&(u+=`	end
`)}f(l[""]??[],"");for(const m in l)!m.includes(":")&&m!==""&&f(l[m],m);return i&&(u+=ik(a??{})),u}async function ck(t,e){let r=(e==null?void 0:e.backgroundColor)??"white";const n=(e==null?void 0:e.imageType)??"png",s=sk(t);r!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));const a=`https://mermaid.ink/img/${s}?bgColor=${r}&type=${n}`,i=await fetch(a);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}var uk={};Ne(uk,{Graph:()=>Ql});function lk(t,e){if(t!==void 0&&!Hs(t))return t;if(Yl(e))try{let r=e.getName();return r=r.startsWith("Runnable")?r.slice(8):r,r}catch{return e.getName()}else return e.name??"UnknownSchema"}function dk(t){return Yl(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...ur(t.data.schema),title:t.data.name}}}var Ql=class __{constructor(e){E(this,"nodes",{});E(this,"edges",[]);this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=Hs(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...dk(r)})),edges:this.edges.map(r=>{const n={source:e[r.source],target:e[r.target]};return typeof r.data<"u"&&(n.data=r.data),typeof r.conditional<"u"&&(n.conditional=r.conditional),n})}}addNode(e,r,n){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);const s=r??An(),a={id:s,data:e,name:lk(r,e),metadata:n};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);const a={source:e.id,target:r.id,data:n,conditional:s};return this.edges.push(a),a}firstNode(){return Eh(this)}lastNode(){return Th(this)}extend(e,r=""){let n=r;Object.values(e.nodes).map(u=>u.id).every(Hs)&&(n="");const a=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,l])=>{this.nodes[a(u)]={...l,id:a(u)}});const i=e.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),c=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,c?{id:a(c.id),data:c.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Eh(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Th(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),r=new Map;Object.values(e).forEach(s=>{r.set(s,(r.get(s)||0)+1)});const n=s=>{const a=e[s];return Hs(s)&&r.get(a)===1?a:s};return new __({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[n(s),{...a,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:r,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),c=i.lastNode();return ok(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:c==null?void 0:c.id,withStyles:r,curveStyle:n,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const r=this.drawMermaid(e);return ck(r,{backgroundColor:e==null?void 0:e.backgroundColor})}};function Eh(t,e=[]){const r=new Set(t.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!r.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function Th(t,e=[]){const r=new Set(t.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!r.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function fk(t){const e=new TextEncoder,r=new ReadableStream({async start(n){for await(const s of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return gr.fromReadableStream(r)}function Sh(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const hk=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function ju(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*xh(t,e){for(;;){const{value:r,done:n}=mr.runWithConfig(Jr(t),e.next.bind(e),!0);if(n)break;yield r}}async function*Fu(t,e){const r=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await mr.runWithConfig(Jr(t),r.next.bind(e),!0);if(s)break;yield n}}function at(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}var Xe=class extends ds{constructor(){super(...arguments);E(this,"lc_runnable",!0);E(this,"name")}getName(e){const r=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${r}${e}`:r}withRetry(e){return new ed({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new ms({bound:this,config:e,kwargs:{}})}withFallbacks(e){const r=Array.isArray(e)?e:e.fallbacks;return new T_({runnable:this,fallbacks:r})}_getOptionsList(e,r=0){if(Array.isArray(e)&&e.length!==r)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${r} inputs`);if(Array.isArray(e))return e.map(Pe);if(r>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:r},(s,a)=>Pe(a===0?e:n))}return Array.from({length:r},()=>Pe(e))}async batch(e,r,n){var c;const s=this._getOptionsList(r??{},e.length),a=((c=s[0])==null?void 0:c.maxConcurrency)??(n==null?void 0:n.maxConcurrency),i=new Ca({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,l)=>i.call(async()=>{try{return await this.invoke(u,s[l])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,r){yield this.invoke(e,r)}async stream(e,r){const n=Pe(r),s=new Zn({generator:this._streamIterator(e,n),config:n});return await s.setup,gr.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let r;e===void 0?r=Pe(e):r=Pe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[r,n]}async _callWithConfig(e,r,n){const s=Pe(n),a=await qt(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),at(r,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const c=e.call(this,r,s,i);o=await Kr(c,n==null?void 0:n.signal)}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(at(o,"output"))),o}async _batchWithConfig(e,r,n,s){var u;const a=this._getOptionsList(n??{},r.length),i=await Promise.all(a.map(qt)),o=await Promise.all(i.map(async(l,d)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),at(r[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,h}));let c;try{const l=e.call(this,r,a,o,s);c=await Kr(l,(u=a==null?void 0:a[0])==null?void 0:u.signal)}catch(l){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(at(c,"output")))),c}_concatOutputChunks(e,r){return yn(e,r)}async*_transformStreamWithConfig(e,r,n){let s,a=!0,i,o=!0;const c=Pe(n),u=await qt(c),l=this;async function*d(){for await(const f of e){if(a)if(s===void 0)s=f;else try{s=l._concatOutputChunks(s,f)}catch{s=void 0,a=!1}yield f}}let h;try{const f=await u_(r.bind(this),d(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},c.runId,c.runType,void 0,void 0,c.runName??this.getName(),void 0,{lc_defers_inputs:!0}),n==null?void 0:n.signal,c);delete c.runId,h=f.setup;const m=h==null?void 0:h.handlers.find(tk);let _=f.output;m!==void 0&&h!==void 0&&(_=m.tapOutputIterable(h.runId,_));const y=h==null?void 0:h.handlers.find(h_);y!==void 0&&h!==void 0&&(_=y.tapOutputIterable(h.runId,_));for await(const w of _)if(yield w,o)if(i===void 0)i=w;else try{i=this._concatOutputChunks(i,w)}catch{i=void 0,o=!1}}catch(f){throw await(h==null?void 0:h.handleChainError(f,void 0,void 0,void 0,{inputs:at(s,"input")})),f}await(h==null?void 0:h.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:at(s,"input")}))}getGraph(e){const r=new Ql,n=r.addNode({name:`${this.getName()}Input`,schema:cf()}),s=r.addNode(this),a=r.addNode({name:`${this.getName()}Output`,schema:cf()});return r.addEdge(n,s),r.addEdge(s,a),r}pipe(e){return new Na({first:this,last:dr(e)})}pick(e){return this.pipe(new S_(e))}assign(e){return this.pipe(new td(new ws({steps:e})))}async*transform(e,r){let n;for await(const s of e)n===void 0?n=s:n=this._concatOutputChunks(n,s);yield*this._streamIterator(n,Pe(r))}async*streamLog(e,r,n){const s=new Mu({...n,autoClose:!1,_schemaFormat:"original"}),a=Pe(r);yield*this._streamLog(e,s,a)}async*_streamLog(e,r,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[r];else if(Array.isArray(s))n.callbacks=s.concat([r]);else{const c=s.copy();c.addHandler(r,!0),n.callbacks=c}const a=this.stream(e,n);async function i(){try{const c=await a;for await(const u of c){const l=new qr({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await r.writer.write(l)}}finally{await r.writer.close()}}const o=i();try{for await(const c of r)yield c}finally{await o}}streamEvents(e,r,n){let s;if(r.version==="v1")s=this._streamEventsV1(e,r,n);else if(r.version==="v2")s=this._streamEventsV2(e,r,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return r.encoding==="text/event-stream"?fk(s):gr.fromAsyncGenerator(s)}async*_streamEventsV2(e,r,n){var m;const s=new rk({...n,autoClose:!1}),a=Pe(r),i=a.runId??An();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const _=o.copy();_.addHandler(s,!0),a.callbacks=_}const c=new AbortController,u=this;async function l(){let _,y=null;try{r!=null&&r.signal?"any"in AbortSignal?_=AbortSignal.any([c.signal,r.signal]):(_=r.signal,y=()=>{c.abort()},r.signal.addEventListener("abort",y,{once:!0})):_=c.signal;const w=await u.stream(e,{...a,signal:_}),g=s.tapOutputIterable(i,w);for await(const b of g)if(c.signal.aborted)break}finally{await s.finish(),_&&y&&_.removeEventListener("abort",y)}}const d=l();let h=!1,f;try{for await(const _ of s){if(!h){_.data.input=e,h=!0,f=_.run_id,yield _;continue}_.run_id===f&&_.event.endsWith("_end")&&(m=_.data)!=null&&m.input&&delete _.data.input,yield _}}finally{c.abort(),await d}}async*_streamEventsV1(e,r,n){let s,a=!1;const i=Pe(r),o=i.tags??[],c=i.metadata??{},u=i.runName??this.getName(),l=new Mu({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new nk({...n}),h=this._streamLog(e,l,i);for await(const m of h){if(s?s=s.concat(m):s=Xl.fromRunLogPatch(m),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const g={...s.state},b={run_id:g.id,event:`on_${g.type}_start`,name:u,tags:o,metadata:c,data:{input:e}};d.includeEvent(b,g.type)&&(yield b)}const _=m.ops.filter(g=>g.path.startsWith("/logs/")).map(g=>g.path.split("/")[2]),y=[...new Set(_)];for(const g of y){let b,T={};const I=s.state.logs[g];if(I.end_time===void 0?I.streamed_output.length>0?b="stream":b="start":b="end",b==="start")I.inputs!==void 0&&(T.input=I.inputs);else if(b==="end")I.inputs!==void 0&&(T.input=I.inputs),T.output=I.final_output;else if(b==="stream"){const C=I.streamed_output.length;if(C!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${C} instead. Encountered in: "${I.name}"`);T={chunk:I.streamed_output[0]},I.streamed_output=[]}yield{event:`on_${I.type}_${b}`,name:I.name,run_id:I.id,tags:I.tags,metadata:I.metadata,data:T}}const{state:w}=s;if(w.streamed_output.length>0){const g=w.streamed_output.length;if(g!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${g} instead. Encountered in: "${w.name}"`);const b={chunk:w.streamed_output[0]};w.streamed_output=[];const T={event:`on_${w.type}_stream`,run_id:w.id,tags:o,metadata:c,name:u,data:b};d.includeEvent(T,w.type)&&(yield T)}}const f=s==null?void 0:s.state;if(f!==void 0){const m={event:`on_${f.type}_end`,name:u,run_id:f.id,tags:o,metadata:c,data:{output:f.final_output}};d.includeEvent(m,f.type)&&(yield m)}}static isRunnable(e){return Yl(e)}withListeners({onStart:e,onEnd:r,onError:n}){return new ms({bound:this,config:{},configFactories:[s=>({callbacks:[new g_({config:s,onStart:e,onEnd:r,onError:n})]})]})}asTool(e){return yk(this,e)}},ms=class y_ extends Xe{constructor(r){super(r);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"bound");E(this,"config");E(this,"kwargs");E(this,"configFactories");this.bound=r.bound,this.kwargs=r.kwargs,this.config=r.config,this.configFactories=r.configFactories}static lc_name(){return"RunnableBinding"}getName(r){return this.bound.getName(r)}async _mergeConfig(...r){const n=Fi(this.config,...r);return Fi(n,...this.configFactories?await Promise.all(this.configFactories.map(async s=>await s(n))):[])}withConfig(r){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...r}})}withRetry(r){return new ed({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:r==null?void 0:r.stopAfterAttempt,...r})}async invoke(r,n){return this.bound.invoke(r,await this._mergeConfig(n,this.kwargs))}async batch(r,n,s){const a=Array.isArray(n)?await Promise.all(n.map(async i=>this._mergeConfig(Pe(i),this.kwargs))):await this._mergeConfig(Pe(n),this.kwargs);return this.bound.batch(r,a,s)}_concatOutputChunks(r,n){return this.bound._concatOutputChunks(r,n)}async*_streamIterator(r,n){yield*this.bound._streamIterator(r,await this._mergeConfig(Pe(n),this.kwargs))}async stream(r,n){return this.bound.stream(r,await this._mergeConfig(Pe(n),this.kwargs))}async*transform(r,n){yield*this.bound.transform(r,await this._mergeConfig(Pe(n),this.kwargs))}streamEvents(r,n,s){const a=this,i=async function*(){yield*a.bound.streamEvents(r,{...await a._mergeConfig(Pe(n),a.kwargs),version:n.version},s)};return gr.fromAsyncGenerator(i())}static isRunnableBinding(r){return r.bound&&Xe.isRunnable(r.bound)}withListeners({onStart:r,onEnd:n,onError:s}){return new y_({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new g_({config:a,onStart:r,onEnd:n,onError:s})]})]})}},pk=class v_ extends Xe{constructor(r){super(r);E(this,"lc_serializable",!0);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"bound");this.bound=r.bound}static lc_name(){return"RunnableEach"}async invoke(r,n){return this._callWithConfig(this._invoke.bind(this),r,n)}async _invoke(r,n,s){return this.bound.batch(r,qe(n,{callbacks:s==null?void 0:s.getChild()}))}withListeners({onStart:r,onEnd:n,onError:s}){return new v_({bound:this.bound.withListeners({onStart:r,onEnd:n,onError:s})})}},ed=class extends ms{constructor(e){super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"maxAttemptNumber",3);E(this,"onFailedAttempt",()=>{});this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}static lc_name(){return"RunnableRetry"}_patchConfigForRetry(e,r,n){const s=e>1?`retry:attempt:${e}`:void 0;return qe(r,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,r,n){return Cu(s=>super.invoke(e,this._patchConfigForRetry(s,r,n)),{onFailedAttempt:({error:s})=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _batch(e,r,n,s){const a={};try{await Cu(async i=>{const o=e.map((h,f)=>f).filter(h=>a[h.toString()]===void 0||a[h.toString()]instanceof Error),c=o.map(h=>e[h]),u=o.map(h=>this._patchConfigForRetry(i,r==null?void 0:r[h],n==null?void 0:n[h])),l=await super.batch(c,u,{...s,returnExceptions:!0});let d;for(let h=0;h<l.length;h+=1){const f=l[h],m=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=c[h]),a[m.toString()]=f}if(d)throw d;return l},{onFailedAttempt:({error:i})=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}},Na=class Ps extends Xe{constructor(r){super(r);E(this,"first");E(this,"middle",[]);E(this,"last");E(this,"omitSequenceTags",!1);E(this,"lc_serializable",!0);E(this,"lc_namespace",["langchain_core","runnables"]);this.first=r.first,this.middle=r.middle??this.middle,this.last=r.last,this.name=r.name,this.omitSequenceTags=r.omitSequenceTags??this.omitSequenceTags}static lc_name(){return"RunnableSequence"}get steps(){return[this.first,...this.middle,this.last]}async invoke(r,n){var u;const s=Pe(n),a=await qt(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),at(r,"input"),s.runId,void 0,void 0,void 0,s==null?void 0:s.runName));delete s.runId;let o=r,c;try{const l=[this.first,...this.middle];for(let d=0;d<l.length;d+=1){const f=l[d].invoke(o,qe(s,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));o=await Kr(f,n==null?void 0:n.signal)}if((u=n==null?void 0:n.signal)!=null&&u.aborted)throw ha(n.signal);c=await this.last.invoke(o,qe(s,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(at(c,"output"))),c}async batch(r,n,s){var u;const a=this._getOptionsList(n??{},r.length),i=await Promise.all(a.map(qt)),o=await Promise.all(i.map(async(l,d)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),at(r[d],"input"),a[d].runId,void 0,void 0,void 0,a[d].runName));return delete a[d].runId,h}));let c=r;try{for(let l=0;l<this.steps.length;l+=1){const h=this.steps[l].batch(c,o.map((f,m)=>{const _=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return qe(a[m],{callbacks:_})}),s);c=await Kr(h,(u=a[0])==null?void 0:u.signal)}}catch(l){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(at(c,"output")))),c}_concatOutputChunks(r,n){return this.last._concatOutputChunks(r,n)}async*_streamIterator(r,n){var h;const s=await qt(n),{runId:a,...i}=n??{},o=await(s==null?void 0:s.handleChainStart(this.toJSON(),at(r,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),c=[this.first,...this.middle,this.last];let u=!0,l;async function*d(){yield r}try{let f=c[0].transform(d(),qe(i,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let m=1;m<c.length;m+=1)f=await c[m].transform(f,qe(i,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${m+1}`)}));for await(const m of f)if((h=n==null?void 0:n.signal)==null||h.throwIfAborted(),yield m,u)if(l===void 0)l=m;else try{l=this._concatOutputChunks(l,m)}catch{l=void 0,u=!1}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(at(l,"output")))}getGraph(r){const n=new Ql;let s=null;return this.steps.forEach((a,i)=>{const o=a.getGraph(r);i!==0&&o.trimFirstNode(),i!==this.steps.length-1&&o.trimLastNode(),n.extend(o);const c=o.firstNode();if(!c)throw new Error(`Runnable ${a} has no first node`);s&&n.addEdge(s,c),s=o.lastNode()}),n}pipe(r){return Ps.isRunnableSequence(r)?new Ps({first:this.first,middle:this.middle.concat([this.last,r.first,...r.middle]),last:r.last,name:this.name??r.name}):new Ps({first:this.first,middle:[...this.middle,this.last],last:dr(r),name:this.name})}static isRunnableSequence(r){return Array.isArray(r.middle)&&Xe.isRunnable(r)}static from([r,...n],s){let a={};return typeof s=="string"?a.name=s:s!==void 0&&(a=s),new Ps({...a,first:dr(r),middle:n.slice(0,-1).map(dr),last:dr(n[n.length-1])})}},ws=class b_ extends Xe{constructor(r){super(r);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"steps");this.steps={};for(const[n,s]of Object.entries(r.steps))this.steps[n]=dr(s)}static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}static from(r){return new b_({steps:r})}async invoke(r,n){const s=Pe(n),a=await qt(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),{input:r},s.runId,void 0,void 0,void 0,s==null?void 0:s.runName));delete s.runId;const o={};try{const c=Object.entries(this.steps).map(async([u,l])=>{o[u]=await l.invoke(r,qe(s,{callbacks:i==null?void 0:i.getChild(`map:key:${u}`)}))});await Kr(Promise.all(c),n==null?void 0:n.signal)}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(o)),o}async*_transform(r,n,s){const a={...this.steps},i=Jl(r,Object.keys(a).length),o=new Map(Object.entries(a).map(([c,u],l)=>{const d=u.transform(i[l],qe(s,{callbacks:n==null?void 0:n.getChild(`map:key:${c}`)}));return[c,d.next().then(h=>({key:c,gen:d,result:h}))]}));for(;o.size;){const c=Promise.race(o.values()),{key:u,result:l,gen:d}=await Kr(c,s==null?void 0:s.signal);o.delete(u),l.done||(yield{[u]:l.value},o.set(u,d.next().then(h=>({key:u,gen:d,result:h}))))}}transform(r,n){return this._transformStreamWithConfig(r,this._transform.bind(this),n)}async stream(r,n){async function*s(){yield r}const a=Pe(n),i=new Zn({generator:this.transform(s(),a),config:a});return await i.setup,gr.fromAsyncGenerator(i)}},mk=class w_ extends Xe{constructor(r){super(r);E(this,"lc_serializable",!1);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"func");if(!Fl(r.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=r.func}async invoke(r,n){const[s]=this._getOptionsList(n??{},1),a=await qt(s),i=this.func(qe(s,{callbacks:a}),r);return Kr(i,s==null?void 0:s.signal)}async*_streamIterator(r,n){var i,o;const[s]=this._getOptionsList(n??{},1),a=await this.invoke(r,n);if(ju(a)){for await(const c of a)(i=s==null?void 0:s.signal)==null||i.throwIfAborted(),yield c;return}if(hk(a)){for(;;){(o=s==null?void 0:s.signal)==null||o.throwIfAborted();const c=a.next();if(c.done)break;yield c.value}return}yield a}static from(r){return new w_({func:r})}};function gk(t){if(Fl(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var Yr=class E_ extends Xe{constructor(r){if(Fl(r.func))return mk.from(r.func);super(r);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"func");gk(r.func),this.func=r.func}static lc_name(){return"RunnableLambda"}static from(r){return new E_({func:r})}async _invoke(r,n,s){return new Promise((a,i)=>{const o=qe(n,{callbacks:s==null?void 0:s.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Ac)-1});mr.runWithConfig(Jr(o),async()=>{var c,u;try{let l=await this.func(r,{...o});if(l&&Xe.isRunnable(l)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");l=await l.invoke(r,{...o,recursionLimit:(o.recursionLimit??Ac)-1})}else if(ju(l)){let d;for await(const h of Fu(o,l))if((c=n==null?void 0:n.signal)==null||c.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}l=d}else if(Sh(l)){let d;for(const h of xh(o,l))if((u=n==null?void 0:n.signal)==null||u.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}l=d}a(l)}catch(l){i(l)}})})}async invoke(r,n){return this._callWithConfig(this._invoke.bind(this),r,n)}async*_transform(r,n,s){var c,u;let a;for await(const l of r)if(a===void 0)a=l;else try{a=this._concatOutputChunks(a,l)}catch{a=l}const i=qe(s,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((s==null?void 0:s.recursionLimit)??Ac)-1}),o=await new Promise((l,d)=>{mr.runWithConfig(Jr(i),async()=>{try{const h=await this.func(a,{...i,config:i});l(h)}catch(h){d(h)}})});if(o&&Xe.isRunnable(o)){if((s==null?void 0:s.recursionLimit)===0)throw new Error("Recursion limit reached.");const l=await o.stream(a,i);for await(const d of l)yield d}else if(ju(o))for await(const l of Fu(i,o))(c=s==null?void 0:s.signal)==null||c.throwIfAborted(),yield l;else if(Sh(o))for(const l of xh(i,o))(u=s==null?void 0:s.signal)==null||u.throwIfAborted(),yield l;else yield o}transform(r,n){return this._transformStreamWithConfig(r,this._transform.bind(this),n)}async stream(r,n){async function*s(){yield r}const a=Pe(n),i=new Zn({generator:this.transform(s(),a),config:a});return await i.setup,gr.fromAsyncGenerator(i)}},_k=class extends ws{},T_=class extends Xe{constructor(e){super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"runnable");E(this,"fallbacks");this.runnable=e.runnable,this.fallbacks=e.fallbacks}static lc_name(){return"RunnableWithFallbacks"}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,r){const n=Pe(r),s=await qt(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),at(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),c=qe(i,{callbacks:o==null?void 0:o.getChild()});return await mr.runWithConfig(c,async()=>{var d;let l;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,c);return await(o==null?void 0:o.handleChainEnd(at(f,"output"))),f}catch(f){l===void 0&&(l=f)}}throw l===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(l)),l)})}async*_streamIterator(e,r){var d;const n=Pe(r),s=await qt(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),at(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let c,u;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const f=qe(i,{callbacks:o==null?void 0:o.getChild()});try{const m=await h.stream(e,f);u=Fu(f,m);break}catch(m){c===void 0&&(c=m)}}if(u===void 0){const h=c??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let l;try{for await(const h of u){yield h;try{l=l===void 0?l:this._concatOutputChunks(l,h)}catch{l=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd(at(l,"output")))}async batch(e,r,n){var c;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(r??{},e.length),a=await Promise.all(s.map(u=>qt(u))),i=await Promise.all(a.map(async(u,l)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),at(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName));return delete s[l].runId,d}));let o;for(const u of this.runnables()){(c=s[0].signal)==null||c.throwIfAborted();try{const l=await u.batch(e,i.map((d,h)=>qe(s[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,h)=>d==null?void 0:d.handleChainEnd(at(l[h],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(i.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function dr(t){if(typeof t=="function")return new Yr({func:t});if(Xe.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[r]=dr(n);return new ws({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var td=class extends Xe{constructor(e){e instanceof ws&&(e={mapper:e});super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"mapper");this.mapper=e.mapper}static lc_name(){return"RunnableAssign"}async invoke(e,r){const n=await this.mapper.invoke(e,r);return{...e,...n}}async*_transform(e,r,n){const s=this.mapper.getStepsKeys(),[a,i]=Jl(e),o=this.mapper.transform(i,qe(n,{callbacks:r==null?void 0:r.getChild()})),c=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const l=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await c).value;for await(const u of o)yield u}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const s=Pe(r),a=new Zn({generator:this.transform(n(),s),config:s});return await a.setup,gr.fromAsyncGenerator(a)}},S_=class extends Xe{constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e});super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"keys");this.keys=e.keys}static lc_name(){return"RunnablePick"}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(const r of e){const n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const s=Pe(r),a=new Zn({generator:this.transform(n(),s),config:s});return await a.setup,gr.fromAsyncGenerator(a)}},Uu=class extends ms{constructor(e){const r=Na.from([Yr.from(async n=>{let s;if(Gs(n))try{s=await Ao(this.schema,n.args)}catch{throw new Pi("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:r,config:e.config??{}});E(this,"name");E(this,"description");E(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function yk(t,e){const r=e.name??t.getName(),n=e.description??ko(e.schema);return Hl(e.schema)?new Uu({name:r,description:n,schema:Lr({input:Kt()}).transform(s=>s.input),bound:t}):new Uu({name:r,description:n,schema:e.schema,bound:t})}var vk={};Ne(vk,{BasePromptValue:()=>Co,ChatPromptValue:()=>I_,ImagePromptValue:()=>bk,StringPromptValue:()=>x_});var Co=class extends ds{},x_=class extends Co{constructor(e){super({value:e});E(this,"lc_namespace",["langchain_core","prompt_values"]);E(this,"lc_serializable",!0);E(this,"value");this.value=e}static lc_name(){return"StringPromptValue"}toString(){return this.value}toChatMessages(){return[new Dr(this.value)]}},I_=class extends Co{constructor(e){Array.isArray(e)&&(e={messages:e});super(e);E(this,"lc_namespace",["langchain_core","prompt_values"]);E(this,"lc_serializable",!0);E(this,"messages");this.messages=e.messages}static lc_name(){return"ChatPromptValue"}toString(){return Al(this.messages)}toChatMessages(){return this.messages}},bk=class extends Co{constructor(e){"imageUrl"in e||(e={imageUrl:e});super(e);E(this,"lc_namespace",["langchain_core","prompt_values"]);E(this,"lc_serializable",!0);E(this,"imageUrl");E(this,"value");this.imageUrl=e.imageUrl}static lc_name(){return"ImagePromptValue"}toString(){return this.imageUrl.url}toChatMessages(){return[new Dr({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},se="0123456789abcdef".split(""),wk=[-2147483648,8388608,32768,128],tr=[24,16,8,0],Qa=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ot=[];function _r(t,e){e?(ot[0]=ot[16]=ot[1]=ot[2]=ot[3]=ot[4]=ot[5]=ot[6]=ot[7]=ot[8]=ot[9]=ot[10]=ot[11]=ot[12]=ot[13]=ot[14]=ot[15]=0,this.blocks=ot):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}_r.prototype.update=function(t){if(!this.finalized){var e,r=typeof t;if(r!=="string"){if(r==="object"){if(t===null)throw new Error(ERROR);if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(t)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,s=0,a,i=t.length,o=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(a=this.start;s<i&&a<64;++s)o[a>>>2]|=t[s]<<tr[a++&3];else for(a=this.start;s<i&&a<64;++s)n=t.charCodeAt(s),n<128?o[a>>>2]|=n<<tr[a++&3]:n<2048?(o[a>>>2]|=(192|n>>>6)<<tr[a++&3],o[a>>>2]|=(128|n&63)<<tr[a++&3]):n<55296||n>=57344?(o[a>>>2]|=(224|n>>>12)<<tr[a++&3],o[a>>>2]|=(128|n>>>6&63)<<tr[a++&3],o[a>>>2]|=(128|n&63)<<tr[a++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++s)&1023),o[a>>>2]|=(240|n>>>18)<<tr[a++&3],o[a>>>2]|=(128|n>>>12&63)<<tr[a++&3],o[a>>>2]|=(128|n>>>6&63)<<tr[a++&3],o[a>>>2]|=(128|n&63)<<tr[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};_r.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>>2]|=wk[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};_r.prototype.hash=function(){var t=this.h0,e=this.h1,r=this.h2,n=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=this.blocks,u,l,d,h,f,m,_,y,w,g,b;for(u=16;u<64;++u)f=c[u-15],l=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,f=c[u-2],d=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,c[u]=c[u-16]+l+c[u-7]+d<<0;for(b=e&r,u=0;u<64;u+=4)this.first?(this.is224?(y=300032,f=c[0]-1413257819,o=f-150054599<<0,n=f+24177077<<0):(y=704751109,f=c[0]-210244248,o=f-1521486534<<0,n=f+143694565<<0),this.first=!1):(l=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),y=t&e,h=y^t&r^b,_=s&a^~s&i,f=o+d+_+Qa[u]+c[u],m=l+h,o=n+f<<0,n=f+m<<0),l=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),w=n&t,h=w^n&e^y,_=i&o^~i&s,f=a+d+_+Qa[u+1]+c[u+1],m=l+h,i=r+f<<0,r=f+m<<0,l=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),g=r&n,h=g^r&t^w,_=a&i^~a&o,f=s+d+_+Qa[u+2]+c[u+2],m=l+h,a=e+f<<0,e=f+m<<0,l=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),b=e&r,h=b^e&n^g,_=a&i^~a&o,f=s+d+_+Qa[u+3]+c[u+3],m=l+h,s=t+f<<0,t=f+m<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+r<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0,this.h5=this.h5+a<<0,this.h6=this.h6+i<<0,this.h7=this.h7+o<<0};_r.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=se[t>>>28&15]+se[t>>>24&15]+se[t>>>20&15]+se[t>>>16&15]+se[t>>>12&15]+se[t>>>8&15]+se[t>>>4&15]+se[t&15]+se[e>>>28&15]+se[e>>>24&15]+se[e>>>20&15]+se[e>>>16&15]+se[e>>>12&15]+se[e>>>8&15]+se[e>>>4&15]+se[e&15]+se[r>>>28&15]+se[r>>>24&15]+se[r>>>20&15]+se[r>>>16&15]+se[r>>>12&15]+se[r>>>8&15]+se[r>>>4&15]+se[r&15]+se[n>>>28&15]+se[n>>>24&15]+se[n>>>20&15]+se[n>>>16&15]+se[n>>>12&15]+se[n>>>8&15]+se[n>>>4&15]+se[n&15]+se[s>>>28&15]+se[s>>>24&15]+se[s>>>20&15]+se[s>>>16&15]+se[s>>>12&15]+se[s>>>8&15]+se[s>>>4&15]+se[s&15]+se[a>>>28&15]+se[a>>>24&15]+se[a>>>20&15]+se[a>>>16&15]+se[a>>>12&15]+se[a>>>8&15]+se[a>>>4&15]+se[a&15]+se[i>>>28&15]+se[i>>>24&15]+se[i>>>20&15]+se[i>>>16&15]+se[i>>>12&15]+se[i>>>8&15]+se[i>>>4&15]+se[i&15];return this.is224||(c+=se[o>>>28&15]+se[o>>>24&15]+se[o>>>20&15]+se[o>>>16&15]+se[o>>>12&15]+se[o>>>8&15]+se[o>>>4&15]+se[o&15]),c};_r.prototype.toString=_r.prototype.hex;_r.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=[t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255];return this.is224||c.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),c};_r.prototype.array=_r.prototype.digest;_r.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),t};const A_=(...t)=>new _r(!1,!0).update(t.join("")).hex();var Ek={};Ne(Ek,{sha256:()=>A_});var Tk={};Ne(Tk,{BaseCache:()=>O_,InMemoryCache:()=>C_,defaultHashKeyEncoder:()=>k_,deserializeStoredGeneration:()=>Sk,serializeGeneration:()=>xk});const k_=(...t)=>A_(t.join("_"));function Sk(t){return t.message!==void 0?{text:t.text,message:kl(t.message)}:{text:t.text}}function xk(t){const e={text:t.text};return t.message!==void 0&&(e.message=t.message.toDict()),e}var O_=class{constructor(){E(this,"keyEncoder",k_)}makeDefaultKeyEncoder(t){this.keyEncoder=t}};const Ik=new Map;var C_=class N_ extends O_{constructor(r){super();E(this,"cache");this.cache=r??new Map}lookup(r,n){return Promise.resolve(this.cache.get(this.keyEncoder(r,n))??null)}async update(r,n,s){this.cache.set(this.keyEncoder(r,n),s)}static global(){return new N_(Ik)}},No={};No.byteLength=Ok;No.toByteArray=Nk;No.fromByteArray=Pk;var xr=[],Wt=[],Ak=typeof Uint8Array<"u"?Uint8Array:Array,Pc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Vn=0,kk=Pc.length;Vn<kk;++Vn)xr[Vn]=Pc[Vn],Wt[Pc.charCodeAt(Vn)]=Vn;Wt[45]=62;Wt[95]=63;function $_(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function Ok(t){var e=$_(t),r=e[0],n=e[1];return(r+n)*3/4-n}function Ck(t,e,r){return(e+r)*3/4-r}function Nk(t){var e,r=$_(t),n=r[0],s=r[1],a=new Ak(Ck(t,n,s)),i=0,o=s>0?n-4:n,c;for(c=0;c<o;c+=4)e=Wt[t.charCodeAt(c)]<<18|Wt[t.charCodeAt(c+1)]<<12|Wt[t.charCodeAt(c+2)]<<6|Wt[t.charCodeAt(c+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=Wt[t.charCodeAt(c)]<<2|Wt[t.charCodeAt(c+1)]>>4,a[i++]=e&255),s===1&&(e=Wt[t.charCodeAt(c)]<<10|Wt[t.charCodeAt(c+1)]<<4|Wt[t.charCodeAt(c+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function $k(t){return xr[t>>18&63]+xr[t>>12&63]+xr[t>>6&63]+xr[t&63]}function Rk(t,e,r){for(var n,s=[],a=e;a<r;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),s.push($k(n));return s.join("")}function Pk(t){for(var e,r=t.length,n=r%3,s=[],a=16383,i=0,o=r-n;i<o;i+=a)s.push(Rk(t,i,i+a>o?o:i+a));return n===1?(e=t[r-1],s.push(xr[e>>2]+xr[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],s.push(xr[e>>10]+xr[e>>4&63]+xr[e<<2&63]+"=")),s.join("")}var Lk=Object.defineProperty,Dk=(t,e,r)=>e in t?Lk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mk=(t,e,r)=>(Dk(t,e+"",r),r);function jk(t,e){let r=Array.from({length:t.length},(n,s)=>({start:s,end:s+1}));for(;r.length>1;){let n=null;for(let s=0;s<r.length-1;s++){const a=t.slice(r[s].start,r[s+1].end),i=e.get(a.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,s])}if(n!=null){const s=n[1];r[s]={start:r[s].start,end:r[s+1].end},r.splice(s+1,1)}else break}return r}function Fk(t,e){return t.length===1?[e.get(t.join(","))]:jk(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function Uk(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Bu=class{constructor(t,e){E(this,"specialTokens");E(this,"inverseSpecialTokens");E(this,"patStr");E(this,"textEncoder",new TextEncoder);E(this,"textDecoder",new TextDecoder("utf-8"));E(this,"rankMap",new Map);E(this,"textMap",new Map);this.patStr=t.pat_str;const r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[a,i,...o]=s.split(" "),c=Number.parseInt(i,10);return o.forEach((u,l)=>n[u]=c+l),n},{});for(const[n,s]of Object.entries(r)){const a=No.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(t,e=[],r="all"){const n=new RegExp(this.patStr,"ug"),s=Bu.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(r==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):r);if(o.size>0){const u=Bu.specialTokenRegex([...o]),l=t.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;s.lastIndex=l,u=s.exec(t),!(u==null||i.has(u[0]));)l=u.index+1;const d=(u==null?void 0:u.index)??t.length;for(const f of t.substring(c,d).matchAll(n)){const m=this.textEncoder.encode(f[0]),_=this.rankMap.get(m.join(","));if(_!=null){a.push(_);continue}a.push(...Fk(m,this.rankMap))}if(u==null)break;let h=this.specialTokens[u[0]];a.push(h),c=u.index+u[0].length}return a}decode(t){const e=[];let r=0;for(let a=0;a<t.length;++a){const i=t[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),r+=o.length)}const n=new Uint8Array(r);let s=0;for(const a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},R_=Bu;Mk(R_,"specialTokenRegex",t=>new RegExp(t.map(e=>Uk(e)).join("|"),"g"));function Bk(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var zk={};Ne(zk,{encodingForModel:()=>rd,getEncoding:()=>P_});const ei={},qk=new Ca({});async function P_(t){return t in ei||(ei[t]=qk.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new R_(e)).catch(e=>{throw delete ei[t],e})),await ei[t]}async function rd(t){return P_(Bk(t))}var Zk={};Ne(Zk,{BaseLangChain:()=>sd,BaseLanguageModel:()=>ad,calculateMaxTokens:()=>Vk,getEmbeddingContextSize:()=>Gk,getModelContextSize:()=>L_,getModelNameForTiktoken:()=>$o,isOpenAITool:()=>nd});const $o=t=>t.startsWith("gpt-5")?"gpt-5":t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t,Gk=t=>{switch(t){case"text-embedding-ada-002":return 8191;default:return 2046}},L_=t=>{switch($o(t)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":return 128e3;case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"code-cushman-001":return 2048;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6;case"gemini-pro":case"gemini-pro-vision":return 32768;default:return 4097}};function nd(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}const Vk=async({prompt:t,modelName:e})=>{let r;try{r=(await rd($o(e))).encode(t).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(t.length/4)}return L_(e)-r},Hk=()=>!1;var sd=class extends Xe{constructor(e){super(e);E(this,"verbose");E(this,"callbacks");E(this,"tags");E(this,"metadata");this.verbose=e.verbose??Hk(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}get lc_attributes(){return{callbacks:void 0,verbose:void 0}}},ad=class extends sd{constructor({callbacks:e,callbackManager:r,...n}){const{cache:s,...a}=n;super({callbacks:e??r,...a});E(this,"caller");E(this,"cache");E(this,"_encoding");typeof s=="object"?this.cache=s:s?this.cache=C_.global():this.cache=void 0,this.caller=new Ca(n??{})}get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}async getNumTokens(e){let r;typeof e=="string"?r=e:r=e.map(s=>typeof s=="string"?s:s.type==="text"&&"text"in s?s.text:"").join("");let n=Math.ceil(r.length/4);if(!this._encoding)try{this._encoding=await rd("modelName"in this?$o(this.modelName):"gpt2")}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}if(this._encoding)try{n=this._encoding.encode(r).length}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new x_(e):Array.isArray(e)?new I_(e.map(Vs)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...r}){const n={...this._identifyingParams(),...r,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}get profile(){return{}}};function id(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function od(t){return t!==void 0&&Xe.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function cd(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&(Ir(t.schema)||t.schema!=null&&typeof t.schema=="object"&&"type"in t.schema&&typeof t.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(t.schema.type))}function Ro(t){return cd(t)||od(t)||id(t)}const Wk=j("ZodISODateTime",(t,e)=>{zS.init(t,e),Je.init(t,e)});function Jk(t){return zx(Wk,t)}const Kk=j("ZodISODate",(t,e)=>{qS.init(t,e),Je.init(t,e)});function Xk(t){return qx(Kk,t)}const Yk=j("ZodISOTime",(t,e)=>{ZS.init(t,e),Je.init(t,e)});function Qk(t){return Zx(Yk,t)}const eO=j("ZodISODuration",(t,e)=>{GS.init(t,e),Je.init(t,e)});function tO(t){return Gx(eO,t)}const rO=(t,e)=>{Ig.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>UT(t,r)},flatten:{value:r=>FT(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},Po=j("ZodError",rO,{Parent:Error}),nO=Ag(Po),sO=kg(Po),aO=Cg(Po),iO=Ng(Po),Ye=j("ZodType",(t,e)=>(We.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>_t(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t),t.parse=(r,n)=>nO(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>aO(t,r,n),t.parseAsync=async(r,n)=>sO(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>iO(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(QO(r,n)),t.superRefine=r=>t.check(eC(r)),t.overwrite=r=>t.check(Oa(r)),t.optional=()=>Oh(t),t.nullable=()=>Ch(t),t.nullish=()=>Oh(Ch(t)),t.nonoptional=r=>GO(t,r),t.array=()=>$a(t),t.or=r=>NO([t,r]),t.and=r=>PO(t,r),t.transform=r=>Nh(t,FO(r)),t.default=r=>zO(t,r),t.prefault=r=>ZO(t,r),t.catch=r=>HO(t,r),t.pipe=r=>Nh(t,r),t.readonly=()=>KO(t),t.describe=r=>{const n=t.clone();return ut.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){var r;return(r=ut.get(t))==null?void 0:r.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return ut.get(t);const n=t.clone();return ut.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),D_=j("_ZodString",(t,e)=>{Gl.init(t,e),Ye.init(t,e);const r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Wx(...n)),t.includes=(...n)=>t.check(Xx(...n)),t.startsWith=(...n)=>t.check(Yx(...n)),t.endsWith=(...n)=>t.check(Qx(...n)),t.min=(...n)=>t.check(zi(...n)),t.max=(...n)=>t.check(Vg(...n)),t.length=(...n)=>t.check(Hg(...n)),t.nonempty=(...n)=>t.check(zi(1,...n)),t.lowercase=n=>t.check(Jx(n)),t.uppercase=n=>t.check(Kx(n)),t.trim=()=>t.check(tI()),t.normalize=(...n)=>t.check(eI(...n)),t.toLowerCase=()=>t.check(rI()),t.toUpperCase=()=>t.check(nI())}),oO=j("ZodString",(t,e)=>{Gl.init(t,e),D_.init(t,e),t.email=r=>t.check(wx(cO,r)),t.url=r=>t.check(Ix(uO,r)),t.jwt=r=>t.check(Bx(SO,r)),t.emoji=r=>t.check(Ax(lO,r)),t.guid=r=>t.check(lh(Ih,r)),t.uuid=r=>t.check(Ex(ti,r)),t.uuidv4=r=>t.check(Tx(ti,r)),t.uuidv6=r=>t.check(Sx(ti,r)),t.uuidv7=r=>t.check(xx(ti,r)),t.nanoid=r=>t.check(kx(dO,r)),t.guid=r=>t.check(lh(Ih,r)),t.cuid=r=>t.check(Ox(fO,r)),t.cuid2=r=>t.check(Cx(hO,r)),t.ulid=r=>t.check(Nx(pO,r)),t.base64=r=>t.check(jx(wO,r)),t.base64url=r=>t.check(Fx(EO,r)),t.xid=r=>t.check($x(mO,r)),t.ksuid=r=>t.check(Rx(gO,r)),t.ipv4=r=>t.check(Px(_O,r)),t.ipv6=r=>t.check(Lx(yO,r)),t.cidrv4=r=>t.check(Dx(vO,r)),t.cidrv6=r=>t.check(Mx(bO,r)),t.e164=r=>t.check(Ux(TO,r)),t.datetime=r=>t.check(Jk(r)),t.date=r=>t.check(Xk(r)),t.time=r=>t.check(Qk(r)),t.duration=r=>t.check(tO(r))});function Ut(t){return bx(oO,t)}const Je=j("ZodStringFormat",(t,e)=>{Ve.init(t,e),D_.init(t,e)}),cO=j("ZodEmail",(t,e)=>{RS.init(t,e),Je.init(t,e)}),Ih=j("ZodGUID",(t,e)=>{NS.init(t,e),Je.init(t,e)}),ti=j("ZodUUID",(t,e)=>{$S.init(t,e),Je.init(t,e)}),uO=j("ZodURL",(t,e)=>{PS.init(t,e),Je.init(t,e)}),lO=j("ZodEmoji",(t,e)=>{LS.init(t,e),Je.init(t,e)}),dO=j("ZodNanoID",(t,e)=>{DS.init(t,e),Je.init(t,e)}),fO=j("ZodCUID",(t,e)=>{MS.init(t,e),Je.init(t,e)}),hO=j("ZodCUID2",(t,e)=>{jS.init(t,e),Je.init(t,e)}),pO=j("ZodULID",(t,e)=>{FS.init(t,e),Je.init(t,e)}),mO=j("ZodXID",(t,e)=>{US.init(t,e),Je.init(t,e)}),gO=j("ZodKSUID",(t,e)=>{BS.init(t,e),Je.init(t,e)}),_O=j("ZodIPv4",(t,e)=>{VS.init(t,e),Je.init(t,e)}),yO=j("ZodIPv6",(t,e)=>{HS.init(t,e),Je.init(t,e)}),vO=j("ZodCIDRv4",(t,e)=>{WS.init(t,e),Je.init(t,e)}),bO=j("ZodCIDRv6",(t,e)=>{JS.init(t,e),Je.init(t,e)}),wO=j("ZodBase64",(t,e)=>{KS.init(t,e),Je.init(t,e)}),EO=j("ZodBase64URL",(t,e)=>{YS.init(t,e),Je.init(t,e)}),TO=j("ZodE164",(t,e)=>{QS.init(t,e),Je.init(t,e)}),SO=j("ZodJWT",(t,e)=>{tx.init(t,e),Je.init(t,e)}),M_=j("ZodNumber",(t,e)=>{Fg.init(t,e),Ye.init(t,e),t.gt=(n,s)=>t.check(fh(n,s)),t.gte=(n,s)=>t.check(Oc(n,s)),t.min=(n,s)=>t.check(Oc(n,s)),t.lt=(n,s)=>t.check(dh(n,s)),t.lte=(n,s)=>t.check(kc(n,s)),t.max=(n,s)=>t.check(kc(n,s)),t.int=n=>t.check(Ah(n)),t.safe=n=>t.check(Ah(n)),t.positive=n=>t.check(fh(0,n)),t.nonnegative=n=>t.check(Oc(0,n)),t.negative=n=>t.check(dh(0,n)),t.nonpositive=n=>t.check(kc(0,n)),t.multipleOf=(n,s)=>t.check(hh(n,s)),t.step=(n,s)=>t.check(hh(n,s)),t.finite=()=>t;const r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function yt(t){return Vx(M_,t)}const xO=j("ZodNumberFormat",(t,e)=>{rx.init(t,e),M_.init(t,e)});function Ah(t){return Hx(xO,t)}const IO=j("ZodUnknown",(t,e)=>{Ug.init(t,e),Ye.init(t,e)});function kh(){return Zg(IO)}const AO=j("ZodNever",(t,e)=>{Bg.init(t,e),Ye.init(t,e)});function kO(t){return Gg(AO,t)}const OO=j("ZodArray",(t,e)=>{nx.init(t,e),Ye.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(zi(r,n)),t.nonempty=r=>t.check(zi(1,r)),t.max=(r,n)=>t.check(Vg(r,n)),t.length=(r,n)=>t.check(Hg(r,n)),t.unwrap=()=>t.element});function $a(t,e){return sI(OO,t,e)}const CO=j("ZodObject",(t,e)=>{sx.init(t,e),Ye.init(t,e),Ze(t,"shape",()=>e.shape),t.keyof=()=>ld(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:kh()}),t.loose=()=>t.clone({...t._zod.def,catchall:kh()}),t.strict=()=>t.clone({...t._zod.def,catchall:kO()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>Tg(t,r),t.merge=r=>MT(t,r),t.pick=r=>LT(t,r),t.omit=r=>DT(t,r),t.partial=(...r)=>Sg(F_,t,r[0]),t.required=(...r)=>jT(U_,t,r[0])});function bt(t,e){const r={type:"object",get shape(){return ql(this,"shape",{...t}),this.shape},...ge(e)};return new CO(r)}const j_=j("ZodUnion",(t,e)=>{zg.init(t,e),Ye.init(t,e),t.options=e.options});function NO(t,e){return new j_({type:"union",options:t,...ge(e)})}const $O=j("ZodDiscriminatedUnion",(t,e)=>{j_.init(t,e),ax.init(t,e)});function ud(t,e,r){return new $O({type:"union",options:e,discriminator:t,...ge(r)})}const RO=j("ZodIntersection",(t,e)=>{ix.init(t,e),Ye.init(t,e)});function PO(t,e){return new RO({type:"intersection",left:t,right:e})}const LO=j("ZodRecord",(t,e)=>{ox.init(t,e),Ye.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function DO(t,e,r){return new LO({type:"record",keyType:t,valueType:e,...ge(r)})}const zu=j("ZodEnum",(t,e)=>{cx.init(t,e),Ye.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);const r=new Set(Object.keys(e.entries));t.extract=(n,s)=>{const a={};for(const i of n)if(r.has(i))a[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new zu({...e,checks:[],...ge(s),entries:a})},t.exclude=(n,s)=>{const a={...e.entries};for(const i of n)if(r.has(i))delete a[i];else throw new Error(`Key ${i} not found in enum`);return new zu({...e,checks:[],...ge(s),entries:a})}});function ld(t,e){const r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new zu({type:"enum",entries:r,...ge(e)})}const MO=j("ZodLiteral",(t,e)=>{ux.init(t,e),Ye.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function Vt(t,e){return new MO({type:"literal",values:Array.isArray(t)?t:[t],...ge(e)})}const jO=j("ZodTransform",(t,e)=>{lx.init(t,e),Ye.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=a=>{if(typeof a=="string")r.issues.push(ma(a,r.value,e));else{const i=a;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(ma(i))}};const s=e.transform(r.value,r);return s instanceof Promise?s.then(a=>(r.value=a,r)):(r.value=s,r)}});function FO(t){return new jO({type:"transform",transform:t})}const F_=j("ZodOptional",(t,e)=>{Vl.init(t,e),Ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Oh(t){return new F_({type:"optional",innerType:t})}const UO=j("ZodNullable",(t,e)=>{dx.init(t,e),Ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Ch(t){return new UO({type:"nullable",innerType:t})}const BO=j("ZodDefault",(t,e)=>{fx.init(t,e),Ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function zO(t,e){return new BO({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}const qO=j("ZodPrefault",(t,e)=>{hx.init(t,e),Ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ZO(t,e){return new qO({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}const U_=j("ZodNonOptional",(t,e)=>{px.init(t,e),Ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function GO(t,e){return new U_({type:"nonoptional",innerType:t,...ge(e)})}const VO=j("ZodCatch",(t,e)=>{mx.init(t,e),Ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function HO(t,e){return new VO({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const WO=j("ZodPipe",(t,e)=>{gx.init(t,e),Ye.init(t,e),t.in=e.in,t.out=e.out});function Nh(t,e){return new WO({type:"pipe",in:t,out:e})}const JO=j("ZodReadonly",(t,e)=>{_x.init(t,e),Ye.init(t,e)});function KO(t){return new JO({type:"readonly",innerType:t})}const XO=j("ZodCustom",(t,e)=>{yx.init(t,e),Ye.init(t,e)});function YO(t){const e=new Lt({check:"custom"});return e._zod.check=t,e}function QO(t,e={}){return aI(XO,t,e)}function eC(t){const e=YO(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(ma(n,r.value,e._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=e),s.continue??(s.continue=!e._zod.def.abort),r.issues.push(ma(s))}},t(r.value,r)));return e}var tC={};Ne(tC,{BaseToolkit:()=>rC,DynamicStructuredTool:()=>z_,DynamicTool:()=>B_,StructuredTool:()=>dd,Tool:()=>Lo,ToolInputParsingException:()=>Pi,isLangChainTool:()=>Ro,isRunnableToolLike:()=>od,isStructuredTool:()=>id,isStructuredToolParams:()=>cd,tool:()=>nC});var dd=class extends sd{constructor(e){super(e??{});E(this,"extras");E(this,"returnDirect",!1);E(this,"verboseParsingErrors",!1);E(this,"responseFormat","content");E(this,"defaultConfig");this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat,this.defaultConfig=(e==null?void 0:e.defaultConfig)??this.defaultConfig,this.metadata=(e==null?void 0:e.metadata)??this.metadata,this.extras=(e==null?void 0:e.extras)??this.extras}get lc_namespace(){return["langchain","tools"]}async invoke(e,r){let n,s=Pe(Fi(this.defaultConfig,r));return Gs(e)?(n=e.args,s={...s,toolCall:e}):n=e,this.call(n,s)}async call(e,r,n){const s=Gs(e)?e.args:e;let a;if(Ir(this.schema))try{a=await Ao(this.schema,s)}catch(m){let _="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(_=`${_}
Details: ${m.message}`),e_(m)&&(_=`${_}

${zT(m)}`),new Pi(_,JSON.stringify(e))}else{const m=Ge(s,this.schema);if(!m.valid){let _="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(_=`${_}
Details: ${m.errors.map(y=>`${y.keywordLocation}: ${y.error}`).join(`
`)}`),new Pi(_,JSON.stringify(e))}a=s}const i=To(r),o=Pt.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),c=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;let u;try{u=await this._call(a,c,i)}catch(m){throw await(c==null?void 0:c.handleToolError(m)),m}let l,d;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[l,d]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else l=u;let h;Gs(e)&&(h=e.id),!h&&Fb(i)&&(h=i.toolCall.id);const f=sC({content:l,artifact:d,toolCallId:h,name:this.name,metadata:this.metadata});return await(c==null?void 0:c.handleToolEnd(f)),f}},Lo=class extends dd{constructor(e){super(e);E(this,"schema",Lr({input:Kt().optional()}).transform(e=>e.input))}call(e,r){const n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,r)}},B_=class extends Lo{constructor(e){super(e);E(this,"name");E(this,"description");E(this,"func");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}static lc_name(){return"DynamicTool"}async call(e,r){const n=To(r);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,r,n){return this.func(e,r,n)}},z_=class extends dd{constructor(e){super(e);E(this,"description");E(this,"func");E(this,"schema");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}static lc_name(){return"DynamicStructuredTool"}async call(e,r,n){const s=To(r);return s.runName===void 0&&(s.runName=this.name),super.call(e,s,n)}_call(e,r,n){return this.func(e,r,n)}},rC=class{getTools(){return this.tools}};function nC(t,e){var i;const r=Hl(e.schema),n=Ks(e.schema);if(!e.schema||r||n)return new B_({...e,description:e.description??((i=e.schema)==null?void 0:i.description)??`${e.name} tool`,func:async(o,c,u)=>new Promise((l,d)=>{const h=qe(u,{callbacks:c==null?void 0:c.getChild()});mr.runWithConfig(Jr(h),async()=>{try{l(t(o,h))}catch(f){d(f)}})})});const s=e.schema,a=e.description??e.schema.description??`${e.name} tool`;return new z_({...e,description:a,schema:s,func:async(o,c,u)=>new Promise((l,d)=>{let h;const f=()=>{u!=null&&u.signal&&h&&u.signal.removeEventListener("abort",h)};u!=null&&u.signal&&(h=()=>{f(),d(ha(u.signal))},u.signal.addEventListener("abort",h));const m=qe(u,{callbacks:c==null?void 0:c.getChild()});mr.runWithConfig(Jr(m),async()=>{var _;try{const y=await t(o,m);if((_=u==null?void 0:u.signal)!=null&&_.aborted){f();return}f(),l(y)}catch(y){f(),d(y)}})})})}function sC(t){const{content:e,artifact:r,toolCallId:n,metadata:s}=t;return n&&!Tl(e)?typeof e=="string"||Array.isArray(e)&&e.every(a=>typeof a=="object")?new pr({status:"success",content:e,artifact:r,tool_call_id:n,name:t.name,metadata:s}):new pr({status:"success",content:aC(e),artifact:r,tool_call_id:n,name:t.name,metadata:s}):e}function aC(t){try{return JSON.stringify(t,null,2)??""}catch{return`${t}`}}var Hi={},q_={},bn={},Z_={};(function(t){var e=Se&&Se.__assign||function(){return e=Object.assign||function(a){for(var i,o=1,c=arguments.length;o<c;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(a[u]=i[u])}return a},e.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.namedReferences=t.bodyRegExps=void 0;var r="~",n="~~";function s(a,i){for(var o={},c={},u=a.split(n),l=!1,d=0;u.length>d;d++){for(var h=u[d].split(r),f=0;f<h.length;f+=2){var m=h[f],_=h[f+1],y="&"+m+";";o[y]=_,l&&(o["&"+m]=_),c[_]=y}l=!0}return i?{entities:e(e({},o),i.entities),characters:e(e({},c),i.characters)}:{entities:o,characters:c}}t.bodyRegExps={xml:/&(?:#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);?/g,html4:/&notin;|&(?:nbsp|iexcl|cent|pound|curren|yen|brvbar|sect|uml|copy|ordf|laquo|not|shy|reg|macr|deg|plusmn|sup2|sup3|acute|micro|para|middot|cedil|sup1|ordm|raquo|frac14|frac12|frac34|iquest|Agrave|Aacute|Acirc|Atilde|Auml|Aring|AElig|Ccedil|Egrave|Eacute|Ecirc|Euml|Igrave|Iacute|Icirc|Iuml|ETH|Ntilde|Ograve|Oacute|Ocirc|Otilde|Ouml|times|Oslash|Ugrave|Uacute|Ucirc|Uuml|Yacute|THORN|szlig|agrave|aacute|acirc|atilde|auml|aring|aelig|ccedil|egrave|eacute|ecirc|euml|igrave|iacute|icirc|iuml|eth|ntilde|ograve|oacute|ocirc|otilde|ouml|divide|oslash|ugrave|uacute|ucirc|uuml|yacute|thorn|yuml|quot|amp|lt|gt|#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);?/g,html5:/&centerdot;|&copysr;|&divideontimes;|&gtcc;|&gtcir;|&gtdot;|&gtlPar;|&gtquest;|&gtrapprox;|&gtrarr;|&gtrdot;|&gtreqless;|&gtreqqless;|&gtrless;|&gtrsim;|&ltcc;|&ltcir;|&ltdot;|&lthree;|&ltimes;|&ltlarr;|&ltquest;|&ltrPar;|&ltri;|&ltrie;|&ltrif;|&notin;|&notinE;|&notindot;|&notinva;|&notinvb;|&notinvc;|&notni;|&notniva;|&notnivb;|&notnivc;|&parallel;|&timesb;|&timesbar;|&timesd;|&(?:AElig|AMP|Aacute|Acirc|Agrave|Aring|Atilde|Auml|COPY|Ccedil|ETH|Eacute|Ecirc|Egrave|Euml|GT|Iacute|Icirc|Igrave|Iuml|LT|Ntilde|Oacute|Ocirc|Ograve|Oslash|Otilde|Ouml|QUOT|REG|THORN|Uacute|Ucirc|Ugrave|Uuml|Yacute|aacute|acirc|acute|aelig|agrave|amp|aring|atilde|auml|brvbar|ccedil|cedil|cent|copy|curren|deg|divide|eacute|ecirc|egrave|eth|euml|frac12|frac14|frac34|gt|iacute|icirc|iexcl|igrave|iquest|iuml|laquo|lt|macr|micro|middot|nbsp|not|ntilde|oacute|ocirc|ograve|ordf|ordm|oslash|otilde|ouml|para|plusmn|pound|quot|raquo|reg|sect|shy|sup1|sup2|sup3|szlig|thorn|times|uacute|ucirc|ugrave|uml|uuml|yacute|yen|yuml|#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);?/g},t.namedReferences={},t.namedReferences.xml=s(`lt~<~gt~>~quot~"~apos~'~amp~&`),t.namedReferences.html4=s(`apos~'~OElig~~oelig~~Scaron~~scaron~~Yuml~~circ~~tilde~~ensp~~emsp~~thinsp~~zwnj~~zwj~~lrm~~rlm~~ndash~~mdash~~lsquo~~rsquo~~sbquo~~ldquo~~rdquo~~bdquo~~dagger~~Dagger~~permil~~lsaquo~~rsaquo~~euro~~fnof~~Alpha~~Beta~~Gamma~~Delta~~Epsilon~~Zeta~~Eta~~Theta~~Iota~~Kappa~~Lambda~~Mu~~Nu~~Xi~~Omicron~~Pi~~Rho~~Sigma~~Tau~~Upsilon~~Phi~~Chi~~Psi~~Omega~~alpha~~beta~~gamma~~delta~~epsilon~~zeta~~eta~~theta~~iota~~kappa~~lambda~~mu~~nu~~xi~~omicron~~pi~~rho~~sigmaf~~sigma~~tau~~upsilon~~phi~~chi~~psi~~omega~~thetasym~~upsih~~piv~~bull~~hellip~~prime~~Prime~~oline~~frasl~~weierp~~image~~real~~trade~~alefsym~~larr~~uarr~~rarr~~darr~~harr~~crarr~~lArr~~uArr~~rArr~~dArr~~hArr~~forall~~part~~exist~~empty~~nabla~~isin~~notin~~ni~~prod~~sum~~minus~~lowast~~radic~~prop~~infin~~ang~~and~~or~~cap~~cup~~int~~there4~~sim~~cong~~asymp~~ne~~equiv~~le~~ge~~sub~~sup~~nsub~~sube~~supe~~oplus~~otimes~~perp~~sdot~~lceil~~rceil~~lfloor~~rfloor~~lang~~rang~~loz~~spades~~clubs~~hearts~~diams~~~nbsp~~iexcl~~cent~~pound~~curren~~yen~~brvbar~~sect~~uml~~copy~~ordf~~laquo~~not~~shy~~reg~~macr~~deg~~plusmn~~sup2~~sup3~~acute~~micro~~para~~middot~~cedil~~sup1~~ordm~~raquo~~frac14~~frac12~~frac34~~iquest~~Agrave~~Aacute~~Acirc~~Atilde~~Auml~~Aring~~AElig~~Ccedil~~Egrave~~Eacute~~Ecirc~~Euml~~Igrave~~Iacute~~Icirc~~Iuml~~ETH~~Ntilde~~Ograve~~Oacute~~Ocirc~~Otilde~~Ouml~~times~~Oslash~~Ugrave~~Uacute~~Ucirc~~Uuml~~Yacute~~THORN~~szlig~~agrave~~aacute~~acirc~~atilde~~auml~~aring~~aelig~~ccedil~~egrave~~eacute~~ecirc~~euml~~igrave~~iacute~~icirc~~iuml~~eth~~ntilde~~ograve~~oacute~~ocirc~~otilde~~ouml~~divide~~oslash~~ugrave~~uacute~~ucirc~~uuml~~yacute~~thorn~~yuml~~quot~"~amp~&~lt~<~gt~>`),t.namedReferences.html5=s('Abreve~~Acy~~Afr~~Amacr~~And~~Aogon~~Aopf~~ApplyFunction~~Ascr~~Assign~~Backslash~~Barv~~Barwed~~Bcy~~Because~~Bernoullis~~Bfr~~Bopf~~Breve~~Bscr~~Bumpeq~~CHcy~~Cacute~~Cap~~CapitalDifferentialD~~Cayleys~~Ccaron~~Ccirc~~Cconint~~Cdot~~Cedilla~~CenterDot~~Cfr~~CircleDot~~CircleMinus~~CirclePlus~~CircleTimes~~ClockwiseContourIntegral~~CloseCurlyDoubleQuote~~CloseCurlyQuote~~Colon~~Colone~~Congruent~~Conint~~ContourIntegral~~Copf~~Coproduct~~CounterClockwiseContourIntegral~~Cross~~Cscr~~Cup~~CupCap~~DD~~DDotrahd~~DJcy~~DScy~~DZcy~~Darr~~Dashv~~Dcaron~~Dcy~~Del~~Dfr~~DiacriticalAcute~~DiacriticalDot~~DiacriticalDoubleAcute~~DiacriticalGrave~`~DiacriticalTilde~~Diamond~~DifferentialD~~Dopf~~Dot~~DotDot~~DotEqual~~DoubleContourIntegral~~DoubleDot~~DoubleDownArrow~~DoubleLeftArrow~~DoubleLeftRightArrow~~DoubleLeftTee~~DoubleLongLeftArrow~~DoubleLongLeftRightArrow~~DoubleLongRightArrow~~DoubleRightArrow~~DoubleRightTee~~DoubleUpArrow~~DoubleUpDownArrow~~DoubleVerticalBar~~DownArrow~~DownArrowBar~~DownArrowUpArrow~~DownBreve~~DownLeftRightVector~~DownLeftTeeVector~~DownLeftVector~~DownLeftVectorBar~~DownRightTeeVector~~DownRightVector~~DownRightVectorBar~~DownTee~~DownTeeArrow~~Downarrow~~Dscr~~Dstrok~~ENG~~Ecaron~~Ecy~~Edot~~Efr~~Element~~Emacr~~EmptySmallSquare~~EmptyVerySmallSquare~~Eogon~~Eopf~~Equal~~EqualTilde~~Equilibrium~~Escr~~Esim~~Exists~~ExponentialE~~Fcy~~Ffr~~FilledSmallSquare~~FilledVerySmallSquare~~Fopf~~ForAll~~Fouriertrf~~Fscr~~GJcy~~Gammad~~Gbreve~~Gcedil~~Gcirc~~Gcy~~Gdot~~Gfr~~Gg~~Gopf~~GreaterEqual~~GreaterEqualLess~~GreaterFullEqual~~GreaterGreater~~GreaterLess~~GreaterSlantEqual~~GreaterTilde~~Gscr~~Gt~~HARDcy~~Hacek~~Hat~^~Hcirc~~Hfr~~HilbertSpace~~Hopf~~HorizontalLine~~Hscr~~Hstrok~~HumpDownHump~~HumpEqual~~IEcy~~IJlig~~IOcy~~Icy~~Idot~~Ifr~~Im~~Imacr~~ImaginaryI~~Implies~~Int~~Integral~~Intersection~~InvisibleComma~~InvisibleTimes~~Iogon~~Iopf~~Iscr~~Itilde~~Iukcy~~Jcirc~~Jcy~~Jfr~~Jopf~~Jscr~~Jsercy~~Jukcy~~KHcy~~KJcy~~Kcedil~~Kcy~~Kfr~~Kopf~~Kscr~~LJcy~~Lacute~~Lang~~Laplacetrf~~Larr~~Lcaron~~Lcedil~~Lcy~~LeftAngleBracket~~LeftArrow~~LeftArrowBar~~LeftArrowRightArrow~~LeftCeiling~~LeftDoubleBracket~~LeftDownTeeVector~~LeftDownVector~~LeftDownVectorBar~~LeftFloor~~LeftRightArrow~~LeftRightVector~~LeftTee~~LeftTeeArrow~~LeftTeeVector~~LeftTriangle~~LeftTriangleBar~~LeftTriangleEqual~~LeftUpDownVector~~LeftUpTeeVector~~LeftUpVector~~LeftUpVectorBar~~LeftVector~~LeftVectorBar~~Leftarrow~~Leftrightarrow~~LessEqualGreater~~LessFullEqual~~LessGreater~~LessLess~~LessSlantEqual~~LessTilde~~Lfr~~Ll~~Lleftarrow~~Lmidot~~LongLeftArrow~~LongLeftRightArrow~~LongRightArrow~~Longleftarrow~~Longleftrightarrow~~Longrightarrow~~Lopf~~LowerLeftArrow~~LowerRightArrow~~Lscr~~Lsh~~Lstrok~~Lt~~Map~~Mcy~~MediumSpace~~Mellintrf~~Mfr~~MinusPlus~~Mopf~~Mscr~~NJcy~~Nacute~~Ncaron~~Ncedil~~Ncy~~NegativeMediumSpace~~NegativeThickSpace~~NegativeThinSpace~~NegativeVeryThinSpace~~NestedGreaterGreater~~NestedLessLess~~NewLine~\n~Nfr~~NoBreak~~NonBreakingSpace~~Nopf~~Not~~NotCongruent~~NotCupCap~~NotDoubleVerticalBar~~NotElement~~NotEqual~~NotEqualTilde~~NotExists~~NotGreater~~NotGreaterEqual~~NotGreaterFullEqual~~NotGreaterGreater~~NotGreaterLess~~NotGreaterSlantEqual~~NotGreaterTilde~~NotHumpDownHump~~NotHumpEqual~~NotLeftTriangle~~NotLeftTriangleBar~~NotLeftTriangleEqual~~NotLess~~NotLessEqual~~NotLessGreater~~NotLessLess~~NotLessSlantEqual~~NotLessTilde~~NotNestedGreaterGreater~~NotNestedLessLess~~NotPrecedes~~NotPrecedesEqual~~NotPrecedesSlantEqual~~NotReverseElement~~NotRightTriangle~~NotRightTriangleBar~~NotRightTriangleEqual~~NotSquareSubset~~NotSquareSubsetEqual~~NotSquareSuperset~~NotSquareSupersetEqual~~NotSubset~~NotSubsetEqual~~NotSucceeds~~NotSucceedsEqual~~NotSucceedsSlantEqual~~NotSucceedsTilde~~NotSuperset~~NotSupersetEqual~~NotTilde~~NotTildeEqual~~NotTildeFullEqual~~NotTildeTilde~~NotVerticalBar~~Nscr~~Ocy~~Odblac~~Ofr~~Omacr~~Oopf~~OpenCurlyDoubleQuote~~OpenCurlyQuote~~Or~~Oscr~~Otimes~~OverBar~~OverBrace~~OverBracket~~OverParenthesis~~PartialD~~Pcy~~Pfr~~PlusMinus~~Poincareplane~~Popf~~Pr~~Precedes~~PrecedesEqual~~PrecedesSlantEqual~~PrecedesTilde~~Product~~Proportion~~Proportional~~Pscr~~Qfr~~Qopf~~Qscr~~RBarr~~Racute~~Rang~~Rarr~~Rarrtl~~Rcaron~~Rcedil~~Rcy~~Re~~ReverseElement~~ReverseEquilibrium~~ReverseUpEquilibrium~~Rfr~~RightAngleBracket~~RightArrow~~RightArrowBar~~RightArrowLeftArrow~~RightCeiling~~RightDoubleBracket~~RightDownTeeVector~~RightDownVector~~RightDownVectorBar~~RightFloor~~RightTee~~RightTeeArrow~~RightTeeVector~~RightTriangle~~RightTriangleBar~~RightTriangleEqual~~RightUpDownVector~~RightUpTeeVector~~RightUpVector~~RightUpVectorBar~~RightVector~~RightVectorBar~~Rightarrow~~Ropf~~RoundImplies~~Rrightarrow~~Rscr~~Rsh~~RuleDelayed~~SHCHcy~~SHcy~~SOFTcy~~Sacute~~Sc~~Scedil~~Scirc~~Scy~~Sfr~~ShortDownArrow~~ShortLeftArrow~~ShortRightArrow~~ShortUpArrow~~SmallCircle~~Sopf~~Sqrt~~Square~~SquareIntersection~~SquareSubset~~SquareSubsetEqual~~SquareSuperset~~SquareSupersetEqual~~SquareUnion~~Sscr~~Star~~Sub~~Subset~~SubsetEqual~~Succeeds~~SucceedsEqual~~SucceedsSlantEqual~~SucceedsTilde~~SuchThat~~Sum~~Sup~~Superset~~SupersetEqual~~Supset~~TRADE~~TSHcy~~TScy~~Tab~	~Tcaron~~Tcedil~~Tcy~~Tfr~~Therefore~~ThickSpace~~ThinSpace~~Tilde~~TildeEqual~~TildeFullEqual~~TildeTilde~~Topf~~TripleDot~~Tscr~~Tstrok~~Uarr~~Uarrocir~~Ubrcy~~Ubreve~~Ucy~~Udblac~~Ufr~~Umacr~~UnderBar~_~UnderBrace~~UnderBracket~~UnderParenthesis~~Union~~UnionPlus~~Uogon~~Uopf~~UpArrow~~UpArrowBar~~UpArrowDownArrow~~UpDownArrow~~UpEquilibrium~~UpTee~~UpTeeArrow~~Uparrow~~Updownarrow~~UpperLeftArrow~~UpperRightArrow~~Upsi~~Uring~~Uscr~~Utilde~~VDash~~Vbar~~Vcy~~Vdash~~Vdashl~~Vee~~Verbar~~Vert~~VerticalBar~~VerticalLine~|~VerticalSeparator~~VerticalTilde~~VeryThinSpace~~Vfr~~Vopf~~Vscr~~Vvdash~~Wcirc~~Wedge~~Wfr~~Wopf~~Wscr~~Xfr~~Xopf~~Xscr~~YAcy~~YIcy~~YUcy~~Ycirc~~Ycy~~Yfr~~Yopf~~Yscr~~ZHcy~~Zacute~~Zcaron~~Zcy~~Zdot~~ZeroWidthSpace~~Zfr~~Zopf~~Zscr~~abreve~~ac~~acE~~acd~~acy~~af~~afr~~aleph~~amacr~~amalg~~andand~~andd~~andslope~~andv~~ange~~angle~~angmsd~~angmsdaa~~angmsdab~~angmsdac~~angmsdad~~angmsdae~~angmsdaf~~angmsdag~~angmsdah~~angrt~~angrtvb~~angrtvbd~~angsph~~angst~~angzarr~~aogon~~aopf~~ap~~apE~~apacir~~ape~~apid~~approx~~approxeq~~ascr~~ast~*~asympeq~~awconint~~awint~~bNot~~backcong~~backepsilon~~backprime~~backsim~~backsimeq~~barvee~~barwed~~barwedge~~bbrk~~bbrktbrk~~bcong~~bcy~~becaus~~because~~bemptyv~~bepsi~~bernou~~beth~~between~~bfr~~bigcap~~bigcirc~~bigcup~~bigodot~~bigoplus~~bigotimes~~bigsqcup~~bigstar~~bigtriangledown~~bigtriangleup~~biguplus~~bigvee~~bigwedge~~bkarow~~blacklozenge~~blacksquare~~blacktriangle~~blacktriangledown~~blacktriangleleft~~blacktriangleright~~blank~~blk12~~blk14~~blk34~~block~~bne~=~bnequiv~~bnot~~bopf~~bot~~bottom~~bowtie~~boxDL~~boxDR~~boxDl~~boxDr~~boxH~~boxHD~~boxHU~~boxHd~~boxHu~~boxUL~~boxUR~~boxUl~~boxUr~~boxV~~boxVH~~boxVL~~boxVR~~boxVh~~boxVl~~boxVr~~boxbox~~boxdL~~boxdR~~boxdl~~boxdr~~boxh~~boxhD~~boxhU~~boxhd~~boxhu~~boxminus~~boxplus~~boxtimes~~boxuL~~boxuR~~boxul~~boxur~~boxv~~boxvH~~boxvL~~boxvR~~boxvh~~boxvl~~boxvr~~bprime~~breve~~bscr~~bsemi~~bsim~~bsime~~bsol~\\~bsolb~~bsolhsub~~bullet~~bump~~bumpE~~bumpe~~bumpeq~~cacute~~capand~~capbrcup~~capcap~~capcup~~capdot~~caps~~caret~~caron~~ccaps~~ccaron~~ccirc~~ccups~~ccupssm~~cdot~~cemptyv~~centerdot~~cfr~~chcy~~check~~checkmark~~cir~~cirE~~circeq~~circlearrowleft~~circlearrowright~~circledR~~circledS~~circledast~~circledcirc~~circleddash~~cire~~cirfnint~~cirmid~~cirscir~~clubsuit~~colon~:~colone~~coloneq~~comma~,~commat~@~comp~~compfn~~complement~~complexes~~congdot~~conint~~copf~~coprod~~copysr~~cross~~cscr~~csub~~csube~~csup~~csupe~~ctdot~~cudarrl~~cudarrr~~cuepr~~cuesc~~cularr~~cularrp~~cupbrcap~~cupcap~~cupcup~~cupdot~~cupor~~cups~~curarr~~curarrm~~curlyeqprec~~curlyeqsucc~~curlyvee~~curlywedge~~curvearrowleft~~curvearrowright~~cuvee~~cuwed~~cwconint~~cwint~~cylcty~~dHar~~daleth~~dash~~dashv~~dbkarow~~dblac~~dcaron~~dcy~~dd~~ddagger~~ddarr~~ddotseq~~demptyv~~dfisht~~dfr~~dharl~~dharr~~diam~~diamond~~diamondsuit~~die~~digamma~~disin~~div~~divideontimes~~divonx~~djcy~~dlcorn~~dlcrop~~dollar~$~dopf~~dot~~doteq~~doteqdot~~dotminus~~dotplus~~dotsquare~~doublebarwedge~~downarrow~~downdownarrows~~downharpoonleft~~downharpoonright~~drbkarow~~drcorn~~drcrop~~dscr~~dscy~~dsol~~dstrok~~dtdot~~dtri~~dtrif~~duarr~~duhar~~dwangle~~dzcy~~dzigrarr~~eDDot~~eDot~~easter~~ecaron~~ecir~~ecolon~~ecy~~edot~~ee~~efDot~~efr~~eg~~egs~~egsdot~~el~~elinters~~ell~~els~~elsdot~~emacr~~emptyset~~emptyv~~emsp13~~emsp14~~eng~~eogon~~eopf~~epar~~eparsl~~eplus~~epsi~~epsiv~~eqcirc~~eqcolon~~eqsim~~eqslantgtr~~eqslantless~~equals~=~equest~~equivDD~~eqvparsl~~erDot~~erarr~~escr~~esdot~~esim~~excl~!~expectation~~exponentiale~~fallingdotseq~~fcy~~female~~ffilig~~fflig~~ffllig~~ffr~~filig~~fjlig~fj~flat~~fllig~~fltns~~fopf~~fork~~forkv~~fpartint~~frac13~~frac15~~frac16~~frac18~~frac23~~frac25~~frac35~~frac38~~frac45~~frac56~~frac58~~frac78~~frown~~fscr~~gE~~gEl~~gacute~~gammad~~gap~~gbreve~~gcirc~~gcy~~gdot~~gel~~geq~~geqq~~geqslant~~ges~~gescc~~gesdot~~gesdoto~~gesdotol~~gesl~~gesles~~gfr~~gg~~ggg~~gimel~~gjcy~~gl~~glE~~gla~~glj~~gnE~~gnap~~gnapprox~~gne~~gneq~~gneqq~~gnsim~~gopf~~grave~`~gscr~~gsim~~gsime~~gsiml~~gtcc~~gtcir~~gtdot~~gtlPar~~gtquest~~gtrapprox~~gtrarr~~gtrdot~~gtreqless~~gtreqqless~~gtrless~~gtrsim~~gvertneqq~~gvnE~~hairsp~~half~~hamilt~~hardcy~~harrcir~~harrw~~hbar~~hcirc~~heartsuit~~hercon~~hfr~~hksearow~~hkswarow~~hoarr~~homtht~~hookleftarrow~~hookrightarrow~~hopf~~horbar~~hscr~~hslash~~hstrok~~hybull~~hyphen~~ic~~icy~~iecy~~iff~~ifr~~ii~~iiiint~~iiint~~iinfin~~iiota~~ijlig~~imacr~~imagline~~imagpart~~imath~~imof~~imped~~in~~incare~~infintie~~inodot~~intcal~~integers~~intercal~~intlarhk~~intprod~~iocy~~iogon~~iopf~~iprod~~iscr~~isinE~~isindot~~isins~~isinsv~~isinv~~it~~itilde~~iukcy~~jcirc~~jcy~~jfr~~jmath~~jopf~~jscr~~jsercy~~jukcy~~kappav~~kcedil~~kcy~~kfr~~kgreen~~khcy~~kjcy~~kopf~~kscr~~lAarr~~lAtail~~lBarr~~lE~~lEg~~lHar~~lacute~~laemptyv~~lagran~~langd~~langle~~lap~~larrb~~larrbfs~~larrfs~~larrhk~~larrlp~~larrpl~~larrsim~~larrtl~~lat~~latail~~late~~lates~~lbarr~~lbbrk~~lbrace~{~lbrack~[~lbrke~~lbrksld~~lbrkslu~~lcaron~~lcedil~~lcub~{~lcy~~ldca~~ldquor~~ldrdhar~~ldrushar~~ldsh~~leftarrow~~leftarrowtail~~leftharpoondown~~leftharpoonup~~leftleftarrows~~leftrightarrow~~leftrightarrows~~leftrightharpoons~~leftrightsquigarrow~~leftthreetimes~~leg~~leq~~leqq~~leqslant~~les~~lescc~~lesdot~~lesdoto~~lesdotor~~lesg~~lesges~~lessapprox~~lessdot~~lesseqgtr~~lesseqqgtr~~lessgtr~~lesssim~~lfisht~~lfr~~lg~~lgE~~lhard~~lharu~~lharul~~lhblk~~ljcy~~ll~~llarr~~llcorner~~llhard~~lltri~~lmidot~~lmoust~~lmoustache~~lnE~~lnap~~lnapprox~~lne~~lneq~~lneqq~~lnsim~~loang~~loarr~~lobrk~~longleftarrow~~longleftrightarrow~~longmapsto~~longrightarrow~~looparrowleft~~looparrowright~~lopar~~lopf~~loplus~~lotimes~~lowbar~_~lozenge~~lozf~~lpar~(~lparlt~~lrarr~~lrcorner~~lrhar~~lrhard~~lrtri~~lscr~~lsh~~lsim~~lsime~~lsimg~~lsqb~[~lsquor~~lstrok~~ltcc~~ltcir~~ltdot~~lthree~~ltimes~~ltlarr~~ltquest~~ltrPar~~ltri~~ltrie~~ltrif~~lurdshar~~luruhar~~lvertneqq~~lvnE~~mDDot~~male~~malt~~maltese~~map~~mapsto~~mapstodown~~mapstoleft~~mapstoup~~marker~~mcomma~~mcy~~measuredangle~~mfr~~mho~~mid~~midast~*~midcir~~minusb~~minusd~~minusdu~~mlcp~~mldr~~mnplus~~models~~mopf~~mp~~mscr~~mstpos~~multimap~~mumap~~nGg~~nGt~~nGtv~~nLeftarrow~~nLeftrightarrow~~nLl~~nLt~~nLtv~~nRightarrow~~nVDash~~nVdash~~nacute~~nang~~nap~~napE~~napid~~napos~~napprox~~natur~~natural~~naturals~~nbump~~nbumpe~~ncap~~ncaron~~ncedil~~ncong~~ncongdot~~ncup~~ncy~~neArr~~nearhk~~nearr~~nearrow~~nedot~~nequiv~~nesear~~nesim~~nexist~~nexists~~nfr~~ngE~~nge~~ngeq~~ngeqq~~ngeqslant~~nges~~ngsim~~ngt~~ngtr~~nhArr~~nharr~~nhpar~~nis~~nisd~~niv~~njcy~~nlArr~~nlE~~nlarr~~nldr~~nle~~nleftarrow~~nleftrightarrow~~nleq~~nleqq~~nleqslant~~nles~~nless~~nlsim~~nlt~~nltri~~nltrie~~nmid~~nopf~~notinE~~notindot~~notinva~~notinvb~~notinvc~~notni~~notniva~~notnivb~~notnivc~~npar~~nparallel~~nparsl~~npart~~npolint~~npr~~nprcue~~npre~~nprec~~npreceq~~nrArr~~nrarr~~nrarrc~~nrarrw~~nrightarrow~~nrtri~~nrtrie~~nsc~~nsccue~~nsce~~nscr~~nshortmid~~nshortparallel~~nsim~~nsime~~nsimeq~~nsmid~~nspar~~nsqsube~~nsqsupe~~nsubE~~nsube~~nsubset~~nsubseteq~~nsubseteqq~~nsucc~~nsucceq~~nsup~~nsupE~~nsupe~~nsupset~~nsupseteq~~nsupseteqq~~ntgl~~ntlg~~ntriangleleft~~ntrianglelefteq~~ntriangleright~~ntrianglerighteq~~num~#~numero~~numsp~~nvDash~~nvHarr~~nvap~~nvdash~~nvge~~nvgt~>~nvinfin~~nvlArr~~nvle~~nvlt~<~nvltrie~~nvrArr~~nvrtrie~~nvsim~~nwArr~~nwarhk~~nwarr~~nwarrow~~nwnear~~oS~~oast~~ocir~~ocy~~odash~~odblac~~odiv~~odot~~odsold~~ofcir~~ofr~~ogon~~ogt~~ohbar~~ohm~~oint~~olarr~~olcir~~olcross~~olt~~omacr~~omid~~ominus~~oopf~~opar~~operp~~orarr~~ord~~order~~orderof~~origof~~oror~~orslope~~orv~~oscr~~osol~~otimesas~~ovbar~~par~~parallel~~parsim~~parsl~~pcy~~percnt~%~period~.~pertenk~~pfr~~phiv~~phmmat~~phone~~pitchfork~~planck~~planckh~~plankv~~plus~+~plusacir~~plusb~~pluscir~~plusdo~~plusdu~~pluse~~plussim~~plustwo~~pm~~pointint~~popf~~pr~~prE~~prap~~prcue~~pre~~prec~~precapprox~~preccurlyeq~~preceq~~precnapprox~~precneqq~~precnsim~~precsim~~primes~~prnE~~prnap~~prnsim~~profalar~~profline~~profsurf~~propto~~prsim~~prurel~~pscr~~puncsp~~qfr~~qint~~qopf~~qprime~~qscr~~quaternions~~quatint~~quest~?~questeq~~rAarr~~rAtail~~rBarr~~rHar~~race~~racute~~raemptyv~~rangd~~range~~rangle~~rarrap~~rarrb~~rarrbfs~~rarrc~~rarrfs~~rarrhk~~rarrlp~~rarrpl~~rarrsim~~rarrtl~~rarrw~~ratail~~ratio~~rationals~~rbarr~~rbbrk~~rbrace~}~rbrack~]~rbrke~~rbrksld~~rbrkslu~~rcaron~~rcedil~~rcub~}~rcy~~rdca~~rdldhar~~rdquor~~rdsh~~realine~~realpart~~reals~~rect~~rfisht~~rfr~~rhard~~rharu~~rharul~~rhov~~rightarrow~~rightarrowtail~~rightharpoondown~~rightharpoonup~~rightleftarrows~~rightleftharpoons~~rightrightarrows~~rightsquigarrow~~rightthreetimes~~ring~~risingdotseq~~rlarr~~rlhar~~rmoust~~rmoustache~~rnmid~~roang~~roarr~~robrk~~ropar~~ropf~~roplus~~rotimes~~rpar~)~rpargt~~rppolint~~rrarr~~rscr~~rsh~~rsqb~]~rsquor~~rthree~~rtimes~~rtri~~rtrie~~rtrif~~rtriltri~~ruluhar~~rx~~sacute~~sc~~scE~~scap~~sccue~~sce~~scedil~~scirc~~scnE~~scnap~~scnsim~~scpolint~~scsim~~scy~~sdotb~~sdote~~seArr~~searhk~~searr~~searrow~~semi~;~seswar~~setminus~~setmn~~sext~~sfr~~sfrown~~sharp~~shchcy~~shcy~~shortmid~~shortparallel~~sigmav~~simdot~~sime~~simeq~~simg~~simgE~~siml~~simlE~~simne~~simplus~~simrarr~~slarr~~smallsetminus~~smashp~~smeparsl~~smid~~smile~~smt~~smte~~smtes~~softcy~~sol~/~solb~~solbar~~sopf~~spadesuit~~spar~~sqcap~~sqcaps~~sqcup~~sqcups~~sqsub~~sqsube~~sqsubset~~sqsubseteq~~sqsup~~sqsupe~~sqsupset~~sqsupseteq~~squ~~square~~squarf~~squf~~srarr~~sscr~~ssetmn~~ssmile~~sstarf~~star~~starf~~straightepsilon~~straightphi~~strns~~subE~~subdot~~subedot~~submult~~subnE~~subne~~subplus~~subrarr~~subset~~subseteq~~subseteqq~~subsetneq~~subsetneqq~~subsim~~subsub~~subsup~~succ~~succapprox~~succcurlyeq~~succeq~~succnapprox~~succneqq~~succnsim~~succsim~~sung~~supE~~supdot~~supdsub~~supedot~~suphsol~~suphsub~~suplarr~~supmult~~supnE~~supne~~supplus~~supset~~supseteq~~supseteqq~~supsetneq~~supsetneqq~~supsim~~supsub~~supsup~~swArr~~swarhk~~swarr~~swarrow~~swnwar~~target~~tbrk~~tcaron~~tcedil~~tcy~~tdot~~telrec~~tfr~~therefore~~thetav~~thickapprox~~thicksim~~thkap~~thksim~~timesb~~timesbar~~timesd~~tint~~toea~~top~~topbot~~topcir~~topf~~topfork~~tosa~~tprime~~triangle~~triangledown~~triangleleft~~trianglelefteq~~triangleq~~triangleright~~trianglerighteq~~tridot~~trie~~triminus~~triplus~~trisb~~tritime~~trpezium~~tscr~~tscy~~tshcy~~tstrok~~twixt~~twoheadleftarrow~~twoheadrightarrow~~uHar~~ubrcy~~ubreve~~ucy~~udarr~~udblac~~udhar~~ufisht~~ufr~~uharl~~uharr~~uhblk~~ulcorn~~ulcorner~~ulcrop~~ultri~~umacr~~uogon~~uopf~~uparrow~~updownarrow~~upharpoonleft~~upharpoonright~~uplus~~upsi~~upuparrows~~urcorn~~urcorner~~urcrop~~uring~~urtri~~uscr~~utdot~~utilde~~utri~~utrif~~uuarr~~uwangle~~vArr~~vBar~~vBarv~~vDash~~vangrt~~varepsilon~~varkappa~~varnothing~~varphi~~varpi~~varpropto~~varr~~varrho~~varsigma~~varsubsetneq~~varsubsetneqq~~varsupsetneq~~varsupsetneqq~~vartheta~~vartriangleleft~~vartriangleright~~vcy~~vdash~~vee~~veebar~~veeeq~~vellip~~verbar~|~vert~|~vfr~~vltri~~vnsub~~vnsup~~vopf~~vprop~~vrtri~~vscr~~vsubnE~~vsubne~~vsupnE~~vsupne~~vzigzag~~wcirc~~wedbar~~wedge~~wedgeq~~wfr~~wopf~~wp~~wr~~wreath~~wscr~~xcap~~xcirc~~xcup~~xdtri~~xfr~~xhArr~~xharr~~xlArr~~xlarr~~xmap~~xnis~~xodot~~xopf~~xoplus~~xotime~~xrArr~~xrarr~~xscr~~xsqcup~~xuplus~~xutri~~xvee~~xwedge~~yacy~~ycirc~~ycy~~yfr~~yicy~~yopf~~yscr~~yucy~~zacute~~zcaron~~zcy~~zdot~~zeetrf~~zfr~~zhcy~~zigrarr~~zopf~~zscr~~~AMP~&~COPY~~GT~>~LT~<~QUOT~"~REG~',t.namedReferences.html4)})(Z_);var Do={};Object.defineProperty(Do,"__esModule",{value:!0});Do.numericUnicodeMap=void 0;Do.numericUnicodeMap={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376};var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0});Ar.highSurrogateTo=Ar.highSurrogateFrom=Ar.getCodePoint=Ar.fromCodePoint=void 0;Ar.fromCodePoint=String.fromCodePoint||function(t){return String.fromCharCode(Math.floor((t-65536)/1024)+55296,(t-65536)%1024+56320)};Ar.getCodePoint=String.prototype.codePointAt?function(t,e){return t.codePointAt(e)}:function(t,e){return(t.charCodeAt(e)-55296)*1024+t.charCodeAt(e+1)-56320+65536};Ar.highSurrogateFrom=55296;Ar.highSurrogateTo=56319;var gs=Se&&Se.__assign||function(){return gs=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},gs.apply(this,arguments)};Object.defineProperty(bn,"__esModule",{value:!0});bn.encode=uC;bn.decodeEntity=pC;bn.decode=mC;var Xs=Z_,iC=Do,G_=Ar,fd=gs(gs({},Xs.namedReferences),{all:Xs.namedReferences.html5}),oC={specialChars:/[<>'"&]/g,nonAscii:/[<>'"&\u0080-\uD7FF\uE000-\uFFFF\uDC00-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,nonAsciiPrintable:/[<>'"&\x01-\x08\x11-\x15\x17-\x1F\x7f-\uD7FF\uE000-\uFFFF\uDC00-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,nonAsciiPrintableOnly:/[\x01-\x08\x11-\x15\x17-\x1F\x7f-\uD7FF\uE000-\uFFFF\uDC00-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,extensive:/[\x01-\x0c\x0e-\x1f\x21-\x2c\x2e-\x2f\x3a-\x40\x5b-\x60\x7b-\x7d\x7f-\uD7FF\uE000-\uFFFF\uDC00-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g},cC={mode:"specialChars",level:"all",numeric:"decimal"};function uC(t,e){var r=e===void 0?cC:e,n=r.mode,s=n===void 0?"specialChars":n,a=r.numeric,i=a===void 0?"decimal":a,o=r.level,c=o===void 0?"all":o;if(!t)return"";var u=oC[s],l=fd[c].characters,d=i==="hexadecimal";return String.prototype.replace.call(t,u,function(h){var f=l[h];if(!f){var m=h.length>1?(0,G_.getCodePoint)(h,0):h.charCodeAt(0);f=(d?"&#x"+m.toString(16):"&#"+m)+";"}return f})}var lC={scope:"body",level:"all"},Lc=/&(?:#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);/g,Dc=/&(?:#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+)[;=]?/g,$h={xml:{strict:Lc,attribute:Dc,body:Xs.bodyRegExps.xml},html4:{strict:Lc,attribute:Dc,body:Xs.bodyRegExps.html4},html5:{strict:Lc,attribute:Dc,body:Xs.bodyRegExps.html5}},dC=gs(gs({},$h),{all:$h.html5}),V_=String.fromCharCode,fC=V_(65533),hC={level:"all"};function H_(t,e,r,n){var s=t,a=t[t.length-1];if(r&&a==="=")s=t;else if(n&&a!==";")s=t;else{var i=e[t];if(i)s=i;else if(t[0]==="&"&&t[1]==="#"){var o=t[2],c=o=="x"||o=="X"?parseInt(t.substr(3),16):parseInt(t.substr(2));s=c>=1114111?fC:c>65535?(0,G_.fromCodePoint)(c):V_(iC.numericUnicodeMap[c]||c)}}return s}function pC(t,e){var r=e===void 0?hC:e,n=r.level,s=n===void 0?"all":n;return t?H_(t,fd[s].entities,!1,!1):""}function mC(t,e){var r=e===void 0?lC:e,n=r.level,s=n===void 0?"all":n,a=r.scope,i=a===void 0?s==="xml"?"strict":"body":a;if(!t)return"";var o=dC[s][i],c=fd[s].entities,u=i==="attribute",l=i==="strict";return t.replace(o,function(d){return H_(d,c,u,l)})}var W_={exports:{}},J_={},Mc=Object.prototype.toString;function Wi(t,e){if(e&&(t===null||typeof t>"u"))return e+"=";if(Mc.call(t)=="[object Array]")return gC(t,e);if(Mc.call(t)=="[object Object]")return _C(t,e);if(Mc.call(t)=="[object Date]")return t.toISOString();if(e)return e+"="+encodeURIComponent(String(t));if(String(t).indexOf("=")!==-1)return String(t);throw new TypeError("Cannot build a querystring out of: "+t)}function gC(t,e){for(var r=[],n=0,s=t.length;n<s;n++)e?r.push(Wi(t[n],e+"[]")):r.push(Wi(t[n]));return r.join("&")}function _C(t,e){var r=[];return Object.keys(t).forEach(function(n){r.push(Wi(t[n],e?e+"["+encodeURIComponent(n)+"]":encodeURIComponent(n)))}),r.join("&")}J_.build=Wi;var K_={},yC=fl.readFile,vC=ll.basename;K_.build=function(t,e,r){if(typeof t!="object"||typeof t.pipe=="function")return r(new Error("Multipart builder expects data as key/val object."));var n="",s=X_(t),a=Object.keys(s).length;if(a===0)return r(new Error("Empty multipart body. Invalid data."));function i(l,d){if(l)return r(l);d&&(n+=d),--a||r(null,n+"--"+e+"--")}for(var o in s){var c=s[o];if(c===null||typeof c>"u")i();else if(Buffer.isBuffer(c)){var u={buffer:c,content_type:"application/octet-stream"};Rh(o,u,e,i)}else{var u=c.buffer||c.file||c.content_type?c:{value:c};Rh(o,u,e,i)}}};function Rh(t,e,r,n){var s="--"+r+`\r
`;s+='Content-Disposition: form-data; name="'+t+'"';function a(o,c){if(o){var u=e.content_type.indexOf("text")==-1;s+='; filename="'+encodeURIComponent(c)+`"\r
`,u&&(s+=`Content-Transfer-Encoding: binary\r
`),s+="Content-Type: "+e.content_type+`\r
\r
`,s+=u?o.toString("binary"):o.toString("utf8")}n(null,s+`\r
`)}if((e.file||e.buffer)&&e.content_type){var i=e.filename?e.filename:e.file?vC(e.file):t;if(e.buffer)return a(e.buffer,i);yC(e.file,function(o,c){if(o)return n(o);a(c,i)})}else{if(typeof e.value=="object")return n(new Error("Object received for "+t+", expected string."));e.content_type&&(s+=`\r
`,s+="Content-Type: "+e.content_type),s+=`\r
\r
`,s+=Buffer.from(String(e.value),"utf8").toString("binary"),a()}}function X_(t,e,r){e=e||{};for(var n in t){var s=r?r+"["+n+"]":n,a=t[n];a&&typeof a=="object"&&!(a.buffer||a.file||a.content_type)?X_(a,e,s):e[s]=a}return e}var bC=yv.createHash;function wC(t,e,r){var n=t.split(" ")[0],s=e[0],a=e[1];if(n=="Digest")return Ln.generate(t,s,a,r.method,r.path);if(n=="Basic")return Y_(s,a)}function ri(t){return bC("md5").update(t).digest("hex")}function Y_(t,e){var r=typeof e>"u"?t:[t,e].join(":");return"Basic "+Buffer.from(r).toString("base64")}var Ln={};Ln.parse_header=function(t){for(var e={},r=t.match(/([a-z0-9_-]+)="?([a-z0-9_=\/\.@\s-\+:)()]+)"?/gi),n=0,s=r.length;n<s;n++){var a=r[n].split("="),i=a.shift(),o=a.join("=").replace(/^"/,"").replace(/"$/,"");e[i]=o}return e};Ln.update_nc=function(t){var e=99999999;t++,t>e&&(t=1);var r=new Array(8).join("0")+"";return t=t+"",r.substr(0,8-t.length)+t};Ln.generate=function(t,e,r,n,s){var a=1,i=null,o=Ln.parse_header(t),c=ri(e+":"+o.realm+":"+r),u=ri(n.toUpperCase()+":"+s),l=[c,o.nonce];typeof o.qop=="string"?(i=ri(Math.random().toString(36)).substr(0,8),a=Ln.update_nc(a),l=l.concat(a,i),l=l.concat(o.qop,u)):l=l.concat(u);var d={uri:s,realm:o.realm,nonce:o.nonce,username:e,response:ri(l.join(":"))};o.qop&&(d.qop=o.qop),o.opaque&&(d.opaque=o.opaque),i&&(d.nc=a,d.cnonce=i),t=[];for(var h in d)t.push(h+'="'+d[h]+'"');return"Digest "+t.join(", ")};var EC={header:wC,basic:Y_,digest:Ln.generate},hd={},Ph=vv.unescape,TC=/^([^=\s]+)\s*=\s*("?)\s*(.*)\s*\2\s*$/,SC=/[\x00-\x1F\x7F\x3B\x3B\s\"\,\\"%]/g,xC=1,Lh=3;function IC(t){return t.trim().replace(/\x3B+$/,"")}function AC(t){var e=t.indexOf(";");return e===-1?t:t.substr(0,e)}function Dh(t){return t.toString().replace(SC,encodeURIComponent)}function kC(t){t=IC(t),t=AC(t);var e=TC.exec(t);return!e||!e[Lh]?null:{name:Ph(e[xC]),value:Ph(e[Lh])}}function OC(t){return t?(t=Array.isArray(t)?t:[t],t.reduce(function(e,r){var n=kC(r);return n&&(e[n.name]=n.value),e},{})):{}}function CC(t){return Object.keys(t).reduce(function(e,r){var n=Dh(r),s=Dh(t[r]);return e+=(e?"; ":"")+n+"="+s,e},"")}hd.read=OC;hd.write=CC;var pd={exports:{}},Q_={};(function(t){(function(e){e.parser=function(p,v){return new n(p,v)},e.SAXParser=n,e.SAXStream=l,e.createStream=u,e.MAX_BUFFER_LENGTH=64*1024;var r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(p,v){if(!(this instanceof n))return new n(p,v);var x=this;a(x),x.q=x.c="",x.bufferCheckPosition=e.MAX_BUFFER_LENGTH,x.opt=v||{},x.opt.lowercase=x.opt.lowercase||x.opt.lowercasetags,x.looseCase=x.opt.lowercase?"toLowerCase":"toUpperCase",x.tags=[],x.closed=x.closedRoot=x.sawRoot=!1,x.tag=x.error=null,x.strict=!!p,x.noscript=!!(p||x.opt.noscript),x.state=A.BEGIN,x.strictEntities=x.opt.strictEntities,x.ENTITIES=x.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),x.attribList=[],x.opt.xmlns&&(x.ns=Object.create(_)),x.opt.unquotedAttributeValues===void 0&&(x.opt.unquotedAttributeValues=!p),x.trackPosition=x.opt.position!==!1,x.trackPosition&&(x.position=x.line=x.column=0),q(x,"onready")}Object.create||(Object.create=function(p){function v(){}v.prototype=p;var x=new v;return x}),Object.keys||(Object.keys=function(p){var v=[];for(var x in p)p.hasOwnProperty(x)&&v.push(x);return v});function s(p){for(var v=Math.max(e.MAX_BUFFER_LENGTH,10),x=0,O=0,ae=r.length;O<ae;O++){var U=p[r[O]].length;if(U>v)switch(r[O]){case"textNode":Q(p);break;case"cdata":pe(p,"oncdata",p.cdata),p.cdata="";break;case"script":pe(p,"onscript",p.script),p.script="";break;default:P(p,"Max buffer length exceeded: "+r[O])}x=Math.max(x,U)}var re=e.MAX_BUFFER_LENGTH-x;p.bufferCheckPosition=re+p.position}function a(p){for(var v=0,x=r.length;v<x;v++)p[r[v]]=""}function i(p){Q(p),p.cdata!==""&&(pe(p,"oncdata",p.cdata),p.cdata=""),p.script!==""&&(pe(p,"onscript",p.script),p.script="")}n.prototype={end:function(){$(this)},write:S,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var o;try{o=require("stream").Stream}catch{o=function(){}}o||(o=function(){});var c=e.EVENTS.filter(function(p){return p!=="error"&&p!=="end"});function u(p,v){return new l(p,v)}function l(p,v){if(!(this instanceof l))return new l(p,v);o.apply(this),this._parser=new n(p,v),this.writable=!0,this.readable=!0;var x=this;this._parser.onend=function(){x.emit("end")},this._parser.onerror=function(O){x.emit("error",O),x._parser.error=null},this._decoder=null,c.forEach(function(O){Object.defineProperty(x,"on"+O,{get:function(){return x._parser["on"+O]},set:function(ae){if(!ae)return x.removeAllListeners(O),x._parser["on"+O]=ae,ae;x.on(O,ae)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(o.prototype,{constructor:{value:l}}),l.prototype.write=function(p){return typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(p)&&(this._decoder||(this._decoder=new TextDecoder("utf8")),p=this._decoder.decode(p,{stream:!0})),this._parser.write(p.toString()),this.emit("data",p),!0},l.prototype.end=function(p){if(p&&p.length&&this.write(p),this._decoder){var v=this._decoder.decode();v&&(this._parser.write(v),this.emit("data",v))}return this._parser.end(),!0},l.prototype.on=function(p,v){var x=this;return!x._parser["on"+p]&&c.indexOf(p)!==-1&&(x._parser["on"+p]=function(){var O=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);O.splice(0,0,p),x.emit.apply(x,O)}),o.prototype.on.call(x,p,v)};var d="[CDATA[",h="DOCTYPE",f="http://www.w3.org/XML/1998/namespace",m="http://www.w3.org/2000/xmlns/",_={xml:f,xmlns:m},y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,w=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,g=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function T(p){return p===" "||p===`
`||p==="\r"||p==="	"}function I(p){return p==='"'||p==="'"}function C(p){return p===">"||T(p)}function D(p,v){return p.test(v)}function k(p,v){return!D(p,v)}var A=0;e.STATE={BEGIN:A++,BEGIN_WHITESPACE:A++,TEXT:A++,TEXT_ENTITY:A++,OPEN_WAKA:A++,SGML_DECL:A++,SGML_DECL_QUOTED:A++,DOCTYPE:A++,DOCTYPE_QUOTED:A++,DOCTYPE_DTD:A++,DOCTYPE_DTD_QUOTED:A++,COMMENT_STARTING:A++,COMMENT:A++,COMMENT_ENDING:A++,COMMENT_ENDED:A++,CDATA:A++,CDATA_ENDING:A++,CDATA_ENDING_2:A++,PROC_INST:A++,PROC_INST_BODY:A++,PROC_INST_ENDING:A++,OPEN_TAG:A++,OPEN_TAG_SLASH:A++,ATTRIB:A++,ATTRIB_NAME:A++,ATTRIB_NAME_SAW_WHITE:A++,ATTRIB_VALUE:A++,ATTRIB_VALUE_QUOTED:A++,ATTRIB_VALUE_CLOSED:A++,ATTRIB_VALUE_UNQUOTED:A++,ATTRIB_VALUE_ENTITY_Q:A++,ATTRIB_VALUE_ENTITY_U:A++,CLOSE_TAG:A++,CLOSE_TAG_SAW_WHITE:A++,SCRIPT:A++,SCRIPT_ENDING:A++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(p){var v=e.ENTITIES[p],x=typeof v=="number"?String.fromCharCode(v):v;e.ENTITIES[p]=x});for(var H in e.STATE)e.STATE[e.STATE[H]]=H;A=e.STATE;function q(p,v,x){p[v]&&p[v](x)}function pe(p,v,x){p.textNode&&Q(p),q(p,v,x)}function Q(p){p.textNode=N(p.opt,p.textNode),p.textNode&&q(p,"ontext",p.textNode),p.textNode=""}function N(p,v){return p.trim&&(v=v.trim()),p.normalize&&(v=v.replace(/\s+/g," ")),v}function P(p,v){return Q(p),p.trackPosition&&(v+=`
Line: `+p.line+`
Column: `+p.column+`
Char: `+p.c),v=new Error(v),p.error=v,q(p,"onerror",v),p}function $(p){return p.sawRoot&&!p.closedRoot&&L(p,"Unclosed root tag"),p.state!==A.BEGIN&&p.state!==A.BEGIN_WHITESPACE&&p.state!==A.TEXT&&P(p,"Unexpected end"),Q(p),p.c="",p.closed=!0,q(p,"onend"),n.call(p,p.strict,p.opt),p}function L(p,v){if(typeof p!="object"||!(p instanceof n))throw new Error("bad call to strictFail");p.strict&&P(p,v)}function F(p){p.strict||(p.tagName=p.tagName[p.looseCase]());var v=p.tags[p.tags.length-1]||p,x=p.tag={name:p.tagName,attributes:{}};p.opt.xmlns&&(x.ns=v.ns),p.attribList.length=0,pe(p,"onopentagstart",x)}function Z(p,v){var x=p.indexOf(":"),O=x<0?["",p]:p.split(":"),ae=O[0],U=O[1];return v&&p==="xmlns"&&(ae="xmlns",U=""),{prefix:ae,local:U}}function X(p){if(p.strict||(p.attribName=p.attribName[p.looseCase]()),p.attribList.indexOf(p.attribName)!==-1||p.tag.attributes.hasOwnProperty(p.attribName)){p.attribName=p.attribValue="";return}if(p.opt.xmlns){var v=Z(p.attribName,!0),x=v.prefix,O=v.local;if(x==="xmlns")if(O==="xml"&&p.attribValue!==f)L(p,"xml: prefix must be bound to "+f+`
Actual: `+p.attribValue);else if(O==="xmlns"&&p.attribValue!==m)L(p,"xmlns: prefix must be bound to "+m+`
Actual: `+p.attribValue);else{var ae=p.tag,U=p.tags[p.tags.length-1]||p;ae.ns===U.ns&&(ae.ns=Object.create(U.ns)),ae.ns[O]=p.attribValue}p.attribList.push([p.attribName,p.attribValue])}else p.tag.attributes[p.attribName]=p.attribValue,pe(p,"onattribute",{name:p.attribName,value:p.attribValue});p.attribName=p.attribValue=""}function Y(p,v){if(p.opt.xmlns){var x=p.tag,O=Z(p.tagName);x.prefix=O.prefix,x.local=O.local,x.uri=x.ns[O.prefix]||"",x.prefix&&!x.uri&&(L(p,"Unbound namespace prefix: "+JSON.stringify(p.tagName)),x.uri=O.prefix);var ae=p.tags[p.tags.length-1]||p;x.ns&&ae.ns!==x.ns&&Object.keys(x.ns).forEach(function(ue){pe(p,"onopennamespace",{prefix:ue,uri:x.ns[ue]})});for(var U=0,re=p.attribList.length;U<re;U++){var Ie=p.attribList[U],Me=Ie[0],Re=Ie[1],Oe=Z(Me,!0),Be=Oe.prefix,jr=Oe.local,G=Be===""?"":x.ns[Be]||"",At={name:Me,value:Re,prefix:Be,local:jr,uri:G};Be&&Be!=="xmlns"&&!G&&(L(p,"Unbound namespace prefix: "+JSON.stringify(Be)),At.uri=Be),p.tag.attributes[Me]=At,pe(p,"onattribute",At)}p.attribList.length=0}p.tag.isSelfClosing=!!v,p.sawRoot=!0,p.tags.push(p.tag),pe(p,"onopentag",p.tag),v||(!p.noscript&&p.tagName.toLowerCase()==="script"?p.state=A.SCRIPT:p.state=A.TEXT,p.tag=null,p.tagName=""),p.attribName=p.attribValue="",p.attribList.length=0}function J(p){if(!p.tagName){L(p,"Weird empty close tag."),p.textNode+="</>",p.state=A.TEXT;return}if(p.script){if(p.tagName!=="script"){p.script+="</"+p.tagName+">",p.tagName="",p.state=A.SCRIPT;return}pe(p,"onscript",p.script),p.script=""}var v=p.tags.length,x=p.tagName;p.strict||(x=x[p.looseCase]());for(var O=x;v--;){var ae=p.tags[v];if(ae.name!==O)L(p,"Unexpected close tag");else break}if(v<0){L(p,"Unmatched closing tag: "+p.tagName),p.textNode+="</"+p.tagName+">",p.state=A.TEXT;return}p.tagName=x;for(var U=p.tags.length;U-- >v;){var re=p.tag=p.tags.pop();p.tagName=p.tag.name,pe(p,"onclosetag",p.tagName);var Ie={};for(var Me in re.ns)Ie[Me]=re.ns[Me];var Re=p.tags[p.tags.length-1]||p;p.opt.xmlns&&re.ns!==Re.ns&&Object.keys(re.ns).forEach(function(Oe){var Be=re.ns[Oe];pe(p,"onclosenamespace",{prefix:Oe,uri:Be})})}v===0&&(p.closedRoot=!0),p.tagName=p.attribValue=p.attribName="",p.attribList.length=0,p.state=A.TEXT}function ce(p){var v=p.entity,x=v.toLowerCase(),O,ae="";return p.ENTITIES[v]?p.ENTITIES[v]:p.ENTITIES[x]?p.ENTITIES[x]:(v=x,v.charAt(0)==="#"&&(v.charAt(1)==="x"?(v=v.slice(2),O=parseInt(v,16),ae=O.toString(16)):(v=v.slice(1),O=parseInt(v,10),ae=O.toString(10))),v=v.replace(/^0+/,""),isNaN(O)||ae.toLowerCase()!==v||O<0||O>1114111?(L(p,"Invalid character entity"),"&"+p.entity+";"):String.fromCodePoint(O))}function Ce(p,v){v==="<"?(p.state=A.OPEN_WAKA,p.startTagPosition=p.position):T(v)||(L(p,"Non-whitespace before first tag."),p.textNode=v,p.state=A.TEXT)}function _e(p,v){var x="";return v<p.length&&(x=p.charAt(v)),x}function S(p){var v=this;if(this.error)throw this.error;if(v.closed)return P(v,"Cannot write after close. Assign an onready handler.");if(p===null)return $(v);typeof p=="object"&&(p=p.toString());for(var x=0,O="";O=_e(p,x++),v.c=O,!!O;)switch(v.trackPosition&&(v.position++,O===`
`?(v.line++,v.column=0):v.column++),v.state){case A.BEGIN:if(v.state=A.BEGIN_WHITESPACE,O==="\uFEFF")continue;Ce(v,O);continue;case A.BEGIN_WHITESPACE:Ce(v,O);continue;case A.TEXT:if(v.sawRoot&&!v.closedRoot){for(var U=x-1;O&&O!=="<"&&O!=="&";)O=_e(p,x++),O&&v.trackPosition&&(v.position++,O===`
`?(v.line++,v.column=0):v.column++);v.textNode+=p.substring(U,x-1)}O==="<"&&!(v.sawRoot&&v.closedRoot&&!v.strict)?(v.state=A.OPEN_WAKA,v.startTagPosition=v.position):(!T(O)&&(!v.sawRoot||v.closedRoot)&&L(v,"Text data outside of root node."),O==="&"?v.state=A.TEXT_ENTITY:v.textNode+=O);continue;case A.SCRIPT:O==="<"?v.state=A.SCRIPT_ENDING:v.script+=O;continue;case A.SCRIPT_ENDING:O==="/"?v.state=A.CLOSE_TAG:(v.script+="<"+O,v.state=A.SCRIPT);continue;case A.OPEN_WAKA:if(O==="!")v.state=A.SGML_DECL,v.sgmlDecl="";else if(!T(O))if(D(y,O))v.state=A.OPEN_TAG,v.tagName=O;else if(O==="/")v.state=A.CLOSE_TAG,v.tagName="";else if(O==="?")v.state=A.PROC_INST,v.procInstName=v.procInstBody="";else{if(L(v,"Unencoded <"),v.startTagPosition+1<v.position){var ae=v.position-v.startTagPosition;O=new Array(ae).join(" ")+O}v.textNode+="<"+O,v.state=A.TEXT}continue;case A.SGML_DECL:if(v.sgmlDecl+O==="--"){v.state=A.COMMENT,v.comment="",v.sgmlDecl="";continue}v.doctype&&v.doctype!==!0&&v.sgmlDecl?(v.state=A.DOCTYPE_DTD,v.doctype+="<!"+v.sgmlDecl+O,v.sgmlDecl=""):(v.sgmlDecl+O).toUpperCase()===d?(pe(v,"onopencdata"),v.state=A.CDATA,v.sgmlDecl="",v.cdata=""):(v.sgmlDecl+O).toUpperCase()===h?(v.state=A.DOCTYPE,(v.doctype||v.sawRoot)&&L(v,"Inappropriately located doctype declaration"),v.doctype="",v.sgmlDecl=""):O===">"?(pe(v,"onsgmldeclaration",v.sgmlDecl),v.sgmlDecl="",v.state=A.TEXT):(I(O)&&(v.state=A.SGML_DECL_QUOTED),v.sgmlDecl+=O);continue;case A.SGML_DECL_QUOTED:O===v.q&&(v.state=A.SGML_DECL,v.q=""),v.sgmlDecl+=O;continue;case A.DOCTYPE:O===">"?(v.state=A.TEXT,pe(v,"ondoctype",v.doctype),v.doctype=!0):(v.doctype+=O,O==="["?v.state=A.DOCTYPE_DTD:I(O)&&(v.state=A.DOCTYPE_QUOTED,v.q=O));continue;case A.DOCTYPE_QUOTED:v.doctype+=O,O===v.q&&(v.q="",v.state=A.DOCTYPE);continue;case A.DOCTYPE_DTD:O==="]"?(v.doctype+=O,v.state=A.DOCTYPE):O==="<"?(v.state=A.OPEN_WAKA,v.startTagPosition=v.position):I(O)?(v.doctype+=O,v.state=A.DOCTYPE_DTD_QUOTED,v.q=O):v.doctype+=O;continue;case A.DOCTYPE_DTD_QUOTED:v.doctype+=O,O===v.q&&(v.state=A.DOCTYPE_DTD,v.q="");continue;case A.COMMENT:O==="-"?v.state=A.COMMENT_ENDING:v.comment+=O;continue;case A.COMMENT_ENDING:O==="-"?(v.state=A.COMMENT_ENDED,v.comment=N(v.opt,v.comment),v.comment&&pe(v,"oncomment",v.comment),v.comment=""):(v.comment+="-"+O,v.state=A.COMMENT);continue;case A.COMMENT_ENDED:O!==">"?(L(v,"Malformed comment"),v.comment+="--"+O,v.state=A.COMMENT):v.doctype&&v.doctype!==!0?v.state=A.DOCTYPE_DTD:v.state=A.TEXT;continue;case A.CDATA:for(var U=x-1;O&&O!=="]";)O=_e(p,x++),O&&v.trackPosition&&(v.position++,O===`
`?(v.line++,v.column=0):v.column++);v.cdata+=p.substring(U,x-1),O==="]"&&(v.state=A.CDATA_ENDING);continue;case A.CDATA_ENDING:O==="]"?v.state=A.CDATA_ENDING_2:(v.cdata+="]"+O,v.state=A.CDATA);continue;case A.CDATA_ENDING_2:O===">"?(v.cdata&&pe(v,"oncdata",v.cdata),pe(v,"onclosecdata"),v.cdata="",v.state=A.TEXT):O==="]"?v.cdata+="]":(v.cdata+="]]"+O,v.state=A.CDATA);continue;case A.PROC_INST:O==="?"?v.state=A.PROC_INST_ENDING:T(O)?v.state=A.PROC_INST_BODY:v.procInstName+=O;continue;case A.PROC_INST_BODY:if(!v.procInstBody&&T(O))continue;O==="?"?v.state=A.PROC_INST_ENDING:v.procInstBody+=O;continue;case A.PROC_INST_ENDING:O===">"?(pe(v,"onprocessinginstruction",{name:v.procInstName,body:v.procInstBody}),v.procInstName=v.procInstBody="",v.state=A.TEXT):(v.procInstBody+="?"+O,v.state=A.PROC_INST_BODY);continue;case A.OPEN_TAG:D(w,O)?v.tagName+=O:(F(v),O===">"?Y(v):O==="/"?v.state=A.OPEN_TAG_SLASH:(T(O)||L(v,"Invalid character in tag name"),v.state=A.ATTRIB));continue;case A.OPEN_TAG_SLASH:O===">"?(Y(v,!0),J(v)):(L(v,"Forward-slash in opening tag not followed by >"),v.state=A.ATTRIB);continue;case A.ATTRIB:if(T(O))continue;O===">"?Y(v):O==="/"?v.state=A.OPEN_TAG_SLASH:D(y,O)?(v.attribName=O,v.attribValue="",v.state=A.ATTRIB_NAME):L(v,"Invalid attribute name");continue;case A.ATTRIB_NAME:O==="="?v.state=A.ATTRIB_VALUE:O===">"?(L(v,"Attribute without value"),v.attribValue=v.attribName,X(v),Y(v)):T(O)?v.state=A.ATTRIB_NAME_SAW_WHITE:D(w,O)?v.attribName+=O:L(v,"Invalid attribute name");continue;case A.ATTRIB_NAME_SAW_WHITE:if(O==="=")v.state=A.ATTRIB_VALUE;else{if(T(O))continue;L(v,"Attribute without value"),v.tag.attributes[v.attribName]="",v.attribValue="",pe(v,"onattribute",{name:v.attribName,value:""}),v.attribName="",O===">"?Y(v):D(y,O)?(v.attribName=O,v.state=A.ATTRIB_NAME):(L(v,"Invalid attribute name"),v.state=A.ATTRIB)}continue;case A.ATTRIB_VALUE:if(T(O))continue;I(O)?(v.q=O,v.state=A.ATTRIB_VALUE_QUOTED):(v.opt.unquotedAttributeValues||P(v,"Unquoted attribute value"),v.state=A.ATTRIB_VALUE_UNQUOTED,v.attribValue=O);continue;case A.ATTRIB_VALUE_QUOTED:if(O!==v.q){O==="&"?v.state=A.ATTRIB_VALUE_ENTITY_Q:v.attribValue+=O;continue}X(v),v.q="",v.state=A.ATTRIB_VALUE_CLOSED;continue;case A.ATTRIB_VALUE_CLOSED:T(O)?v.state=A.ATTRIB:O===">"?Y(v):O==="/"?v.state=A.OPEN_TAG_SLASH:D(y,O)?(L(v,"No whitespace between attributes"),v.attribName=O,v.attribValue="",v.state=A.ATTRIB_NAME):L(v,"Invalid attribute name");continue;case A.ATTRIB_VALUE_UNQUOTED:if(!C(O)){O==="&"?v.state=A.ATTRIB_VALUE_ENTITY_U:v.attribValue+=O;continue}X(v),O===">"?Y(v):v.state=A.ATTRIB;continue;case A.CLOSE_TAG:if(v.tagName)O===">"?J(v):D(w,O)?v.tagName+=O:v.script?(v.script+="</"+v.tagName+O,v.tagName="",v.state=A.SCRIPT):(T(O)||L(v,"Invalid tagname in closing tag"),v.state=A.CLOSE_TAG_SAW_WHITE);else{if(T(O))continue;k(y,O)?v.script?(v.script+="</"+O,v.state=A.SCRIPT):L(v,"Invalid tagname in closing tag."):v.tagName=O}continue;case A.CLOSE_TAG_SAW_WHITE:if(T(O))continue;O===">"?J(v):L(v,"Invalid characters in closing tag");continue;case A.TEXT_ENTITY:case A.ATTRIB_VALUE_ENTITY_Q:case A.ATTRIB_VALUE_ENTITY_U:var re,Ie;switch(v.state){case A.TEXT_ENTITY:re=A.TEXT,Ie="textNode";break;case A.ATTRIB_VALUE_ENTITY_Q:re=A.ATTRIB_VALUE_QUOTED,Ie="attribValue";break;case A.ATTRIB_VALUE_ENTITY_U:re=A.ATTRIB_VALUE_UNQUOTED,Ie="attribValue";break}if(O===";"){var Me=ce(v);v.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(Me)?(v.entity="",v.state=re,v.write(Me)):(v[Ie]+=Me,v.entity="",v.state=re)}else D(v.entity.length?b:g,O)?v.entity+=O:(L(v,"Invalid character in entity name"),v[Ie]+="&"+v.entity+O,v.entity="",v.state=re);continue;default:throw new Error(v,"Unknown state: "+v.state)}return v.position>=v.bufferCheckPosition&&s(v),v}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||function(){var p=String.fromCharCode,v=Math.floor,x=function(){var O=16384,ae=[],U,re,Ie=-1,Me=arguments.length;if(!Me)return"";for(var Re="";++Ie<Me;){var Oe=Number(arguments[Ie]);if(!isFinite(Oe)||Oe<0||Oe>1114111||v(Oe)!==Oe)throw RangeError("Invalid code point: "+Oe);Oe<=65535?ae.push(Oe):(Oe-=65536,U=(Oe>>10)+55296,re=Oe%1024+56320,ae.push(U,re)),(Ie+1===Me||ae.length>O)&&(Re+=p.apply(null,ae),ae.length=0)}return Re};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:x,configurable:!0,writable:!0}):String.fromCodePoint=x}()})(t)})(Q_);var NC=fo.Transform,$C=Q_;function RC(t,e){var r,n,s=$C.parser(!0,{trim:!0,lowercase:!0});s.onerror=s.onend=a;function a(o){s.onerror=s.onend=function(){},e(o,r)}function i(o,c){return{name:o||"",value:"",attributes:c||{},children:[]}}s.oncdata=s.ontext=function(o){n&&(n.value+=o)},s.onopentag=function(o){var c=i(o.name,o.attributes);n?(c.parent=n,n.children.push(c)):r=c,n=c},s.onclosetag=function(){if(typeof n.parent<"u"){var o=n;n=n.parent,delete o.parent}},s.write(t).close()}function PC(t,e){function r(){var n=[],s=new NC({objectMode:!0});return s._transform=function(a,i,o){n.push(a),o()},s._flush=function(a){var i=this,o=Buffer.concat(n);try{e(o,function(c,u){if(c)throw c;i.push(u)})}catch{i.push(o)}finally{a()}},s}return{fn:r,name:t}}var ey={};function md(t,e,r){var n=PC(t,r);e.forEach(function(s){ey[s]=n})}md("json",["application/json","application/hal+json","text/javascript","application/vnd.api+json"],function(t,e){var r,n;try{n=JSON.parse(t)}catch(s){r=s}e(r,n)});md("xml",["text/xml","application/xml","application/rdf+xml","application/rss+xml","application/atom+xml"],function(t,e){RC(t.toString(),function(r,n){e(r,n)})});pd.exports=ey;pd.exports.use=md;var LC=pd.exports,jc={exports:{}},Fc,Mh;function wn(){if(Mh)return Fc;Mh=1;var t=bv,e=t.Buffer,r={},n;for(n in t)t.hasOwnProperty(n)&&(n==="SlowBuffer"||n==="Buffer"||(r[n]=t[n]));var s=r.Buffer={};for(n in e)e.hasOwnProperty(n)&&(n==="allocUnsafe"||n==="allocUnsafeSlow"||(s[n]=e[n]));if(r.Buffer.prototype=e.prototype,(!s.from||s.from===Uint8Array.from)&&(s.from=function(a,i,o){if(typeof a=="number")throw new TypeError('The "value" argument must not be of type number. Received type '+typeof a);if(a&&typeof a.length>"u")throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);return e(a,i,o)}),s.alloc||(s.alloc=function(a,i,o){if(typeof a!="number")throw new TypeError('The "size" argument must be of type number. Received type '+typeof a);if(a<0||a>=2*(1<<30))throw new RangeError('The value "'+a+'" is invalid for option "size"');var c=e(a);return!i||i.length===0?c.fill(0):typeof o=="string"?c.fill(i,o):c.fill(i),c}),!r.kStringMaxLength)try{r.kStringMaxLength=process.binding("buffer").kStringMaxLength}catch{}return r.constants||(r.constants={MAX_LENGTH:r.kMaxLength},r.kStringMaxLength&&(r.constants.MAX_STRING_LENGTH=r.kStringMaxLength)),Fc=r,Fc}var ni={},jh;function DC(){if(jh)return ni;jh=1;var t="\uFEFF";ni.PrependBOM=e;function e(n,s){this.encoder=n,this.addBOM=!0}e.prototype.write=function(n){return this.addBOM&&(n=t+n,this.addBOM=!1),this.encoder.write(n)},e.prototype.end=function(){return this.encoder.end()},ni.StripBOM=r;function r(n,s){this.decoder=n,this.pass=!1,this.options=s||{}}return r.prototype.write=function(n){var s=this.decoder.write(n);return this.pass||!s||(s[0]===t&&(s=s.slice(1),typeof this.options.stripBOM=="function"&&this.options.stripBOM()),this.pass=!0),s},r.prototype.end=function(){return this.decoder.end()},ni}var Uc={},Bc,Fh;function MC(){if(Fh)return Bc;Fh=1;var t=wn().Buffer;Bc={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:e};function e(c,u){this.enc=c.encodingName,this.bomAware=c.bomAware,this.enc==="base64"?this.encoder=a:this.enc==="cesu8"&&(this.enc="utf8",this.encoder=i,t.from("eda0bdedb2a9","hex").toString()!==""&&(this.decoder=o,this.defaultCharUnicode=u.defaultCharUnicode))}e.prototype.encoder=s,e.prototype.decoder=n;var r=wv.StringDecoder;r.prototype.end||(r.prototype.end=function(){});function n(c,u){this.decoder=new r(u.enc)}n.prototype.write=function(c){return t.isBuffer(c)||(c=t.from(c)),this.decoder.write(c)},n.prototype.end=function(){return this.decoder.end()};function s(c,u){this.enc=u.enc}s.prototype.write=function(c){return t.from(c,this.enc)},s.prototype.end=function(){};function a(c,u){this.prevStr=""}a.prototype.write=function(c){c=this.prevStr+c;var u=c.length-c.length%4;return this.prevStr=c.slice(u),c=c.slice(0,u),t.from(c,"base64")},a.prototype.end=function(){return t.from(this.prevStr,"base64")};function i(c,u){}i.prototype.write=function(c){for(var u=t.alloc(c.length*3),l=0,d=0;d<c.length;d++){var h=c.charCodeAt(d);h<128?u[l++]=h:h<2048?(u[l++]=192+(h>>>6),u[l++]=128+(h&63)):(u[l++]=224+(h>>>12),u[l++]=128+(h>>>6&63),u[l++]=128+(h&63))}return u.slice(0,l)},i.prototype.end=function(){};function o(c,u){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=u.defaultCharUnicode}return o.prototype.write=function(c){for(var u=this.acc,l=this.contBytes,d=this.accBytes,h="",f=0;f<c.length;f++){var m=c[f];(m&192)!==128?(l>0&&(h+=this.defaultCharUnicode,l=0),m<128?h+=String.fromCharCode(m):m<224?(u=m&31,l=1,d=1):m<240?(u=m&15,l=2,d=1):h+=this.defaultCharUnicode):l>0?(u=u<<6|m&63,l--,d++,l===0&&(d===2&&u<128&&u>0?h+=this.defaultCharUnicode:d===3&&u<2048?h+=this.defaultCharUnicode:h+=String.fromCharCode(u))):h+=this.defaultCharUnicode}return this.acc=u,this.contBytes=l,this.accBytes=d,h},o.prototype.end=function(){var c=0;return this.contBytes>0&&(c+=this.defaultCharUnicode),c},Bc}var Fr={},Uh;function jC(){if(Uh)return Fr;Uh=1;var t=wn().Buffer;Fr._utf32=e;function e(u,l){this.iconv=l,this.bomAware=!0,this.isLE=u.isLE}Fr.utf32le={type:"_utf32",isLE:!0},Fr.utf32be={type:"_utf32",isLE:!1},Fr.ucs4le="utf32le",Fr.ucs4be="utf32be",e.prototype.encoder=r,e.prototype.decoder=n;function r(u,l){this.isLE=l.isLE,this.highSurrogate=0}r.prototype.write=function(u){for(var l=t.from(u,"ucs2"),d=t.alloc(l.length*2),h=this.isLE?d.writeUInt32LE:d.writeUInt32BE,f=0,m=0;m<l.length;m+=2){var _=l.readUInt16LE(m),y=55296<=_&&_<56320,w=56320<=_&&_<57344;if(this.highSurrogate)if(y||!w)h.call(d,this.highSurrogate,f),f+=4;else{var g=(this.highSurrogate-55296<<10|_-56320)+65536;h.call(d,g,f),f+=4,this.highSurrogate=0;continue}y?this.highSurrogate=_:(h.call(d,_,f),f+=4,this.highSurrogate=0)}return f<d.length&&(d=d.slice(0,f)),d},r.prototype.end=function(){if(this.highSurrogate){var u=t.alloc(4);return this.isLE?u.writeUInt32LE(this.highSurrogate,0):u.writeUInt32BE(this.highSurrogate,0),this.highSurrogate=0,u}};function n(u,l){this.isLE=l.isLE,this.badChar=l.iconv.defaultCharUnicode.charCodeAt(0),this.overflow=[]}n.prototype.write=function(u){if(u.length===0)return"";var l=0,d=0,h=t.alloc(u.length+4),f=0,m=this.isLE,_=this.overflow,y=this.badChar;if(_.length>0){for(;l<u.length&&_.length<4;l++)_.push(u[l]);_.length===4&&(m?d=_[l]|_[l+1]<<8|_[l+2]<<16|_[l+3]<<24:d=_[l+3]|_[l+2]<<8|_[l+1]<<16|_[l]<<24,_.length=0,f=s(h,f,d,y))}for(;l<u.length-3;l+=4)m?d=u[l]|u[l+1]<<8|u[l+2]<<16|u[l+3]<<24:d=u[l+3]|u[l+2]<<8|u[l+1]<<16|u[l]<<24,f=s(h,f,d,y);for(;l<u.length;l++)_.push(u[l]);return h.slice(0,f).toString("ucs2")};function s(u,l,d,h){if((d<0||d>1114111)&&(d=h),d>=65536){d-=65536;var f=55296|d>>10;u[l++]=f&255,u[l++]=f>>8;var d=56320|d&1023}return u[l++]=d&255,u[l++]=d>>8,l}n.prototype.end=function(){this.overflow.length=0},Fr.utf32=a,Fr.ucs4="utf32";function a(u,l){this.iconv=l}a.prototype.encoder=i,a.prototype.decoder=o;function i(u,l){u=u||{},u.addBOM===void 0&&(u.addBOM=!0),this.encoder=l.iconv.getEncoder(u.defaultEncoding||"utf-32le",u)}i.prototype.write=function(u){return this.encoder.write(u)},i.prototype.end=function(){return this.encoder.end()};function o(u,l){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=u||{},this.iconv=l.iconv}o.prototype.write=function(u){if(!this.decoder){if(this.initialBufs.push(u),this.initialBufsLen+=u.length,this.initialBufsLen<32)return"";var l=c(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(l,this.options);for(var d="",h=0;h<this.initialBufs.length;h++)d+=this.decoder.write(this.initialBufs[h]);return this.initialBufs.length=this.initialBufsLen=0,d}return this.decoder.write(u)},o.prototype.end=function(){if(!this.decoder){var u=c(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(u,this.options);for(var l="",d=0;d<this.initialBufs.length;d++)l+=this.decoder.write(this.initialBufs[d]);var h=this.decoder.end();return h&&(l+=h),this.initialBufs.length=this.initialBufsLen=0,l}return this.decoder.end()};function c(u,l){var d=[],h=0,f=0,m=0,_=0,y=0;e:for(var w=0;w<u.length;w++)for(var g=u[w],b=0;b<g.length;b++)if(d.push(g[b]),d.length===4){if(h===0){if(d[0]===255&&d[1]===254&&d[2]===0&&d[3]===0)return"utf-32le";if(d[0]===0&&d[1]===0&&d[2]===254&&d[3]===255)return"utf-32be"}if((d[0]!==0||d[1]>16)&&m++,(d[3]!==0||d[2]>16)&&f++,d[0]===0&&d[1]===0&&(d[2]!==0||d[3]!==0)&&y++,(d[0]!==0||d[1]!==0)&&d[2]===0&&d[3]===0&&_++,d.length=0,h++,h>=100)break e}return y-m>_-f?"utf-32be":y-m<_-f?"utf-32le":l||"utf-32le"}return Fr}var si={},Bh;function FC(){if(Bh)return si;Bh=1;var t=wn().Buffer;si.utf16be=e;function e(){}e.prototype.encoder=r,e.prototype.decoder=n,e.prototype.bomAware=!0;function r(){}r.prototype.write=function(c){for(var u=t.from(c,"ucs2"),l=0;l<u.length;l+=2){var d=u[l];u[l]=u[l+1],u[l+1]=d}return u},r.prototype.end=function(){};function n(){this.overflowByte=-1}n.prototype.write=function(c){if(c.length==0)return"";var u=t.alloc(c.length+1),l=0,d=0;for(this.overflowByte!==-1&&(u[0]=c[0],u[1]=this.overflowByte,l=1,d=2);l<c.length-1;l+=2,d+=2)u[d]=c[l+1],u[d+1]=c[l];return this.overflowByte=l==c.length-1?c[c.length-1]:-1,u.slice(0,d).toString("ucs2")},n.prototype.end=function(){this.overflowByte=-1},si.utf16=s;function s(c,u){this.iconv=u}s.prototype.encoder=a,s.prototype.decoder=i;function a(c,u){c=c||{},c.addBOM===void 0&&(c.addBOM=!0),this.encoder=u.iconv.getEncoder("utf-16le",c)}a.prototype.write=function(c){return this.encoder.write(c)},a.prototype.end=function(){return this.encoder.end()};function i(c,u){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=c||{},this.iconv=u.iconv}i.prototype.write=function(c){if(!this.decoder){if(this.initialBufs.push(c),this.initialBufsLen+=c.length,this.initialBufsLen<16)return"";var u=o(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(u,this.options);for(var l="",d=0;d<this.initialBufs.length;d++)l+=this.decoder.write(this.initialBufs[d]);return this.initialBufs.length=this.initialBufsLen=0,l}return this.decoder.write(c)},i.prototype.end=function(){if(!this.decoder){var c=o(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(c,this.options);for(var u="",l=0;l<this.initialBufs.length;l++)u+=this.decoder.write(this.initialBufs[l]);var d=this.decoder.end();return d&&(u+=d),this.initialBufs.length=this.initialBufsLen=0,u}return this.decoder.end()};function o(c,u){var l=[],d=0,h=0,f=0;e:for(var m=0;m<c.length;m++)for(var _=c[m],y=0;y<_.length;y++)if(l.push(_[y]),l.length===2){if(d===0){if(l[0]===255&&l[1]===254)return"utf-16le";if(l[0]===254&&l[1]===255)return"utf-16be"}if(l[0]===0&&l[1]!==0&&f++,l[0]!==0&&l[1]===0&&h++,l.length=0,d++,d>=100)break e}return f>h?"utf-16be":f<h?"utf-16le":u||"utf-16le"}return si}var xs={},zh;function UC(){if(zh)return xs;zh=1;var t=wn().Buffer;xs.utf7=e,xs.unicode11utf7="utf7";function e(_,y){this.iconv=y}e.prototype.encoder=n,e.prototype.decoder=s,e.prototype.bomAware=!0;var r=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function n(_,y){this.iconv=y.iconv}n.prototype.write=function(_){return t.from(_.replace(r,(function(y){return"+"+(y==="+"?"":this.iconv.encode(y,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}).bind(this)))},n.prototype.end=function(){};function s(_,y){this.iconv=y.iconv,this.inBase64=!1,this.base64Accum=""}for(var a=/[A-Za-z0-9\/+]/,i=[],o=0;o<256;o++)i[o]=a.test(String.fromCharCode(o));var c=43,u=45,l=38;s.prototype.write=function(_){for(var y="",w=0,g=this.inBase64,b=this.base64Accum,T=0;T<_.length;T++)if(!g)_[T]==c&&(y+=this.iconv.decode(_.slice(w,T),"ascii"),w=T+1,g=!0);else if(!i[_[T]]){if(T==w&&_[T]==u)y+="+";else{var I=b+this.iconv.decode(_.slice(w,T),"ascii");y+=this.iconv.decode(t.from(I,"base64"),"utf16-be")}_[T]!=u&&T--,w=T+1,g=!1,b=""}if(!g)y+=this.iconv.decode(_.slice(w),"ascii");else{var I=b+this.iconv.decode(_.slice(w),"ascii"),C=I.length-I.length%8;b=I.slice(C),I=I.slice(0,C),y+=this.iconv.decode(t.from(I,"base64"),"utf16-be")}return this.inBase64=g,this.base64Accum=b,y},s.prototype.end=function(){var _="";return this.inBase64&&this.base64Accum.length>0&&(_=this.iconv.decode(t.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",_},xs.utf7imap=d;function d(_,y){this.iconv=y}d.prototype.encoder=h,d.prototype.decoder=f,d.prototype.bomAware=!0;function h(_,y){this.iconv=y.iconv,this.inBase64=!1,this.base64Accum=t.alloc(6),this.base64AccumIdx=0}h.prototype.write=function(_){for(var y=this.inBase64,w=this.base64Accum,g=this.base64AccumIdx,b=t.alloc(_.length*5+10),T=0,I=0;I<_.length;I++){var C=_.charCodeAt(I);32<=C&&C<=126?(y&&(g>0&&(T+=b.write(w.slice(0,g).toString("base64").replace(/\//g,",").replace(/=+$/,""),T),g=0),b[T++]=u,y=!1),y||(b[T++]=C,C===l&&(b[T++]=u))):(y||(b[T++]=l,y=!0),y&&(w[g++]=C>>8,w[g++]=C&255,g==w.length&&(T+=b.write(w.toString("base64").replace(/\//g,","),T),g=0)))}return this.inBase64=y,this.base64AccumIdx=g,b.slice(0,T)},h.prototype.end=function(){var _=t.alloc(10),y=0;return this.inBase64&&(this.base64AccumIdx>0&&(y+=_.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),y),this.base64AccumIdx=0),_[y++]=u,this.inBase64=!1),_.slice(0,y)};function f(_,y){this.iconv=y.iconv,this.inBase64=!1,this.base64Accum=""}var m=i.slice();return m[44]=!0,f.prototype.write=function(_){for(var y="",w=0,g=this.inBase64,b=this.base64Accum,T=0;T<_.length;T++)if(!g)_[T]==l&&(y+=this.iconv.decode(_.slice(w,T),"ascii"),w=T+1,g=!0);else if(!m[_[T]]){if(T==w&&_[T]==u)y+="&";else{var I=b+this.iconv.decode(_.slice(w,T),"ascii").replace(/,/g,"/");y+=this.iconv.decode(t.from(I,"base64"),"utf16-be")}_[T]!=u&&T--,w=T+1,g=!1,b=""}if(!g)y+=this.iconv.decode(_.slice(w),"ascii");else{var I=b+this.iconv.decode(_.slice(w),"ascii").replace(/,/g,"/"),C=I.length-I.length%8;b=I.slice(C),I=I.slice(0,C),y+=this.iconv.decode(t.from(I,"base64"),"utf16-be")}return this.inBase64=g,this.base64Accum=b,y},f.prototype.end=function(){var _="";return this.inBase64&&this.base64Accum.length>0&&(_=this.iconv.decode(t.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",_},xs}var zc={},qh;function BC(){if(qh)return zc;qh=1;var t=wn().Buffer;zc._sbcs=e;function e(s,a){if(!s)throw new Error("SBCS codec is called without the data.");if(!s.chars||s.chars.length!==128&&s.chars.length!==256)throw new Error("Encoding '"+s.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(s.chars.length===128){for(var i="",o=0;o<128;o++)i+=String.fromCharCode(o);s.chars=i+s.chars}this.decodeBuf=t.from(s.chars,"ucs2");for(var c=t.alloc(65536,a.defaultCharSingleByte.charCodeAt(0)),o=0;o<s.chars.length;o++)c[s.chars.charCodeAt(o)]=o;this.encodeBuf=c}e.prototype.encoder=r,e.prototype.decoder=n;function r(s,a){this.encodeBuf=a.encodeBuf}r.prototype.write=function(s){for(var a=t.alloc(s.length),i=0;i<s.length;i++)a[i]=this.encodeBuf[s.charCodeAt(i)];return a},r.prototype.end=function(){};function n(s,a){this.decodeBuf=a.decodeBuf}return n.prototype.write=function(s){for(var a=this.decodeBuf,i=t.alloc(s.length*2),o=0,c=0,u=0;u<s.length;u++)o=s[u]*2,c=u*2,i[c]=a[o],i[c+1]=a[o+1];return i.toString("ucs2")},n.prototype.end=function(){},zc}var qc,Zh;function zC(){return Zh||(Zh=1,qc={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},mik:{type:"_sbcs",chars:""},cp720:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",1e4:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}),qc}var Zc,Gh;function qC(){return Gh||(Gh=1,Zc={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\uFEFF"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},iso646cn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}`},iso646jp:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_\`abcdefghijklmnopqrstuvwxyz{|}`},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}}),Zc}var Gc={},Vh;function ZC(){if(Vh)return Gc;Vh=1;var t=wn().Buffer;Gc._dbcs=c;for(var e=-1,r=-2,n=-10,s=-1e3,a=new Array(256),i=-1,o=0;o<256;o++)a[o]=e;function c(h,f){if(this.encodingName=h.encodingName,!h)throw new Error("DBCS codec is called without the data.");if(!h.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var m=h.table();this.decodeTables=[],this.decodeTables[0]=a.slice(0),this.decodeTableSeq=[];for(var _=0;_<m.length;_++)this._addDecodeChunk(m[_]);if(typeof h.gb18030=="function"){this.gb18030=h.gb18030();var y=this.decodeTables.length;this.decodeTables.push(a.slice(0));var w=this.decodeTables.length;this.decodeTables.push(a.slice(0));for(var g=this.decodeTables[0],_=129;_<=254;_++)for(var b=this.decodeTables[s-g[_]],T=48;T<=57;T++){if(b[T]===e)b[T]=s-y;else if(b[T]>s)throw new Error("gb18030 decode tables conflict at byte 2");for(var I=this.decodeTables[s-b[T]],C=129;C<=254;C++){if(I[C]===e)I[C]=s-w;else{if(I[C]===s-w)continue;if(I[C]>s)throw new Error("gb18030 decode tables conflict at byte 3")}for(var D=this.decodeTables[s-I[C]],k=48;k<=57;k++)D[k]===e&&(D[k]=r)}}}this.defaultCharUnicode=f.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var A={};if(h.encodeSkipVals)for(var _=0;_<h.encodeSkipVals.length;_++){var H=h.encodeSkipVals[_];if(typeof H=="number")A[H]=!0;else for(var T=H.from;T<=H.to;T++)A[T]=!0}if(this._fillEncodeTable(0,0,A),h.encodeAdd)for(var q in h.encodeAdd)Object.prototype.hasOwnProperty.call(h.encodeAdd,q)&&this._setEncodeChar(q.charCodeAt(0),h.encodeAdd[q]);this.defCharSB=this.encodeTable[0][f.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===e&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===e&&(this.defCharSB=63)}c.prototype.encoder=u,c.prototype.decoder=l,c.prototype._getDecodeTrieNode=function(h){for(var f=[];h>0;h>>>=8)f.push(h&255);f.length==0&&f.push(0);for(var m=this.decodeTables[0],_=f.length-1;_>0;_--){var y=m[f[_]];if(y==e)m[f[_]]=s-this.decodeTables.length,this.decodeTables.push(m=a.slice(0));else if(y<=s)m=this.decodeTables[s-y];else throw new Error("Overwrite byte in "+this.encodingName+", addr: "+h.toString(16))}return m},c.prototype._addDecodeChunk=function(h){var f=parseInt(h[0],16),m=this._getDecodeTrieNode(f);f=f&255;for(var _=1;_<h.length;_++){var y=h[_];if(typeof y=="string")for(var w=0;w<y.length;){var g=y.charCodeAt(w++);if(55296<=g&&g<56320){var b=y.charCodeAt(w++);if(56320<=b&&b<57344)m[f++]=65536+(g-55296)*1024+(b-56320);else throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+h[0])}else if(4080<g&&g<=4095){for(var T=4095-g+2,I=[],C=0;C<T;C++)I.push(y.charCodeAt(w++));m[f++]=n-this.decodeTableSeq.length,this.decodeTableSeq.push(I)}else m[f++]=g}else if(typeof y=="number")for(var D=m[f-1]+1,w=0;w<y;w++)m[f++]=D++;else throw new Error("Incorrect type '"+typeof y+"' given in "+this.encodingName+" at chunk "+h[0])}if(f>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+h[0]+": too long"+f)},c.prototype._getEncodeBucket=function(h){var f=h>>8;return this.encodeTable[f]===void 0&&(this.encodeTable[f]=a.slice(0)),this.encodeTable[f]},c.prototype._setEncodeChar=function(h,f){var m=this._getEncodeBucket(h),_=h&255;m[_]<=n?this.encodeTableSeq[n-m[_]][i]=f:m[_]==e&&(m[_]=f)},c.prototype._setEncodeSequence=function(h,f){var m=h[0],_=this._getEncodeBucket(m),y=m&255,w;_[y]<=n?w=this.encodeTableSeq[n-_[y]]:(w={},_[y]!==e&&(w[i]=_[y]),_[y]=n-this.encodeTableSeq.length,this.encodeTableSeq.push(w));for(var g=1;g<h.length-1;g++){var b=w[m];typeof b=="object"?w=b:(w=w[m]={},b!==void 0&&(w[i]=b))}m=h[h.length-1],w[m]=f},c.prototype._fillEncodeTable=function(h,f,m){for(var _=this.decodeTables[h],y=!1,w={},g=0;g<256;g++){var b=_[g],T=f+g;if(!m[T])if(b>=0)this._setEncodeChar(b,T),y=!0;else if(b<=s){var I=s-b;if(!w[I]){var C=T<<8>>>0;this._fillEncodeTable(I,C,m)?y=!0:w[I]=!0}}else b<=n&&(this._setEncodeSequence(this.decodeTableSeq[n-b],T),y=!0)}return y};function u(h,f){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=f.encodeTable,this.encodeTableSeq=f.encodeTableSeq,this.defaultCharSingleByte=f.defCharSB,this.gb18030=f.gb18030}u.prototype.write=function(h){for(var f=t.alloc(h.length*(this.gb18030?4:3)),m=this.leadSurrogate,_=this.seqObj,y=-1,w=0,g=0;;){if(y===-1){if(w==h.length)break;var b=h.charCodeAt(w++)}else{var b=y;y=-1}if(55296<=b&&b<57344)if(b<56320)if(m===-1){m=b;continue}else m=b,b=e;else m!==-1?(b=65536+(m-55296)*1024+(b-56320),m=-1):b=e;else m!==-1&&(y=b,b=e,m=-1);var T=e;if(_!==void 0&&b!=e){var I=_[b];if(typeof I=="object"){_=I;continue}else typeof I=="number"?T=I:I==null&&(I=_[i],I!==void 0&&(T=I,y=b));_=void 0}else if(b>=0){var C=this.encodeTable[b>>8];if(C!==void 0&&(T=C[b&255]),T<=n){_=this.encodeTableSeq[n-T];continue}if(T==e&&this.gb18030){var D=d(this.gb18030.uChars,b);if(D!=-1){var T=this.gb18030.gbChars[D]+(b-this.gb18030.uChars[D]);f[g++]=129+Math.floor(T/12600),T=T%12600,f[g++]=48+Math.floor(T/1260),T=T%1260,f[g++]=129+Math.floor(T/10),T=T%10,f[g++]=48+T;continue}}}T===e&&(T=this.defaultCharSingleByte),T<256?f[g++]=T:T<65536?(f[g++]=T>>8,f[g++]=T&255):T<16777216?(f[g++]=T>>16,f[g++]=T>>8&255,f[g++]=T&255):(f[g++]=T>>>24,f[g++]=T>>>16&255,f[g++]=T>>>8&255,f[g++]=T&255)}return this.seqObj=_,this.leadSurrogate=m,f.slice(0,g)},u.prototype.end=function(){if(!(this.leadSurrogate===-1&&this.seqObj===void 0)){var h=t.alloc(10),f=0;if(this.seqObj){var m=this.seqObj[i];m!==void 0&&(m<256?h[f++]=m:(h[f++]=m>>8,h[f++]=m&255)),this.seqObj=void 0}return this.leadSurrogate!==-1&&(h[f++]=this.defaultCharSingleByte,this.leadSurrogate=-1),h.slice(0,f)}},u.prototype.findIdx=d;function l(h,f){this.nodeIdx=0,this.prevBytes=[],this.decodeTables=f.decodeTables,this.decodeTableSeq=f.decodeTableSeq,this.defaultCharUnicode=f.defaultCharUnicode,this.gb18030=f.gb18030}l.prototype.write=function(h){for(var f=t.alloc(h.length*2),m=this.nodeIdx,_=this.prevBytes,y=this.prevBytes.length,w=-this.prevBytes.length,g,b=0,T=0;b<h.length;b++){var I=b>=0?h[b]:_[b+y],g=this.decodeTables[m][I];if(!(g>=0))if(g===e)g=this.defaultCharUnicode.charCodeAt(0),b=w;else if(g===r){if(b>=3)var C=(h[b-3]-129)*12600+(h[b-2]-48)*1260+(h[b-1]-129)*10+(I-48);else var C=(_[b-3+y]-129)*12600+((b-2>=0?h[b-2]:_[b-2+y])-48)*1260+((b-1>=0?h[b-1]:_[b-1+y])-129)*10+(I-48);var D=d(this.gb18030.gbChars,C);g=this.gb18030.uChars[D]+C-this.gb18030.gbChars[D]}else if(g<=s){m=s-g;continue}else if(g<=n){for(var k=this.decodeTableSeq[n-g],A=0;A<k.length-1;A++)g=k[A],f[T++]=g&255,f[T++]=g>>8;g=k[k.length-1]}else throw new Error("iconv-lite internal error: invalid decoding table value "+g+" at "+m+"/"+I);if(g>=65536){g-=65536;var H=55296|g>>10;f[T++]=H&255,f[T++]=H>>8,g=56320|g&1023}f[T++]=g&255,f[T++]=g>>8,m=0,w=b+1}return this.nodeIdx=m,this.prevBytes=w>=0?Array.prototype.slice.call(h,w):_.slice(w+y).concat(Array.prototype.slice.call(h)),f.slice(0,T).toString("ucs2")},l.prototype.end=function(){for(var h="";this.prevBytes.length>0;){h+=this.defaultCharUnicode;var f=this.prevBytes.slice(1);this.prevBytes=[],this.nodeIdx=0,f.length>0&&(h+=this.write(f))}return this.prevBytes=[],this.nodeIdx=0,h};function d(h,f){if(h[0]>f)return-1;for(var m=0,_=h.length;m<_-1;){var y=m+(_-m+1>>1);h[y]<=f?m=y:_=y}return m}return Gc}const GC=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]],VC=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]],Vc=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]],Hh=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93],["8135f437",""]],HC=[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],WC=[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3],JC={uChars:HC,gbChars:WC},KC=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]],Wh=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]],XC=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]];var Hc,Jh;function YC(){return Jh||(Jh=1,Hc={shiftjis:{type:"_dbcs",table:function(){return GC},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return VC},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return Vc}},gbk:{type:"_dbcs",table:function(){return Vc.concat(Hh)}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return Vc.concat(Hh)},gb18030:function(){return JC},encodeSkipVals:[128],encodeAdd:{"":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return KC}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return Wh}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return Wh.concat(XC)},encodeSkipVals:[36457,36463,36478,36523,36532,36557,36560,36695,36713,36718,36811,36862,36973,36986,37060,37084,37105,37311,37551,37552,37553,37554,37585,37959,38090,38361,38652,39285,39798,39800,39803,39878,39902,39916,39926,40002,40019,40034,40040,40043,40055,40124,40125,40144,40279,40282,40388,40431,40443,40617,40687,40701,40800,40907,41079,41180,41183,36812,37576,38468,38637,41636,41637,41639,41638,41676,41678]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"}),Hc}var Kh;function QC(){return Kh||(Kh=1,function(t){for(var e=[MC(),jC(),FC(),UC(),BC(),zC(),qC(),ZC(),YC()],r=0;r<e.length;r++){var n=e[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}}(Uc)),Uc}var Wc,Xh;function eN(){if(Xh)return Wc;Xh=1;var t=wn().Buffer;return Wc=function(e){var r=e.Transform;function n(a,i){this.conv=a,i=i||{},i.decodeStrings=!1,r.call(this,i)}n.prototype=Object.create(r.prototype,{constructor:{value:n}}),n.prototype._transform=function(a,i,o){if(typeof a!="string")return o(new Error("Iconv encoding stream needs strings as its input."));try{var c=this.conv.write(a);c&&c.length&&this.push(c),o()}catch(u){o(u)}},n.prototype._flush=function(a){try{var i=this.conv.end();i&&i.length&&this.push(i),a()}catch(o){a(o)}},n.prototype.collect=function(a){var i=[];return this.on("error",a),this.on("data",function(o){i.push(o)}),this.on("end",function(){a(null,t.concat(i))}),this};function s(a,i){this.conv=a,i=i||{},i.encoding=this.encoding="utf8",r.call(this,i)}return s.prototype=Object.create(r.prototype,{constructor:{value:s}}),s.prototype._transform=function(a,i,o){if(!t.isBuffer(a)&&!(a instanceof Uint8Array))return o(new Error("Iconv decoding stream needs buffers as its input."));try{var c=this.conv.write(a);c&&c.length&&this.push(c,this.encoding),o()}catch(u){o(u)}},s.prototype._flush=function(a){try{var i=this.conv.end();i&&i.length&&this.push(i,this.encoding),a()}catch(o){a(o)}},s.prototype.collect=function(a){var i="";return this.on("error",a),this.on("data",function(o){i+=o}),this.on("end",function(){a(null,i)}),this},{IconvLiteEncoderStream:n,IconvLiteDecoderStream:s}},Wc}var Yh;function tN(){return Yh||(Yh=1,function(t){var e=wn().Buffer,r=DC(),n=t.exports;n.encodings=null,n.defaultCharUnicode="",n.defaultCharSingleByte="?",n.encode=function(i,o,c){i=""+(i||"");var u=n.getEncoder(o,c),l=u.write(i),d=u.end();return d&&d.length>0?e.concat([l,d]):l},n.decode=function(i,o,c){typeof i=="string"&&(n.skipDecodeWarning||(console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding"),n.skipDecodeWarning=!0),i=e.from(""+(i||""),"binary"));var u=n.getDecoder(o,c),l=u.write(i),d=u.end();return d?l+d:l},n.encodingExists=function(i){try{return n.getCodec(i),!0}catch{return!1}},n.toEncoding=n.encode,n.fromEncoding=n.decode,n._codecDataCache={},n.getCodec=function(i){n.encodings||(n.encodings=QC());for(var o=n._canonicalizeEncoding(i),c={};;){var u=n._codecDataCache[o];if(u)return u;var l=n.encodings[o];switch(typeof l){case"string":o=l;break;case"object":for(var d in l)c[d]=l[d];c.encodingName||(c.encodingName=o),o=l.type;break;case"function":return c.encodingName||(c.encodingName=o),u=new l(c,n),n._codecDataCache[c.encodingName]=u,u;default:throw new Error("Encoding not recognized: '"+i+"' (searched as: '"+o+"')")}}},n._canonicalizeEncoding=function(a){return(""+a).toLowerCase().replace(/:\d{4}$|[^0-9a-z]/g,"")},n.getEncoder=function(i,o){var c=n.getCodec(i),u=new c.encoder(o,c);return c.bomAware&&o&&o.addBOM&&(u=new r.PrependBOM(u,o)),u},n.getDecoder=function(i,o){var c=n.getCodec(i),u=new c.decoder(o,c);return c.bomAware&&!(o&&o.stripBOM===!1)&&(u=new r.StripBOM(u,o)),u},n.enableStreamingAPI=function(i){if(!n.supportsStreams){var o=eN()(i);n.IconvLiteEncoderStream=o.IconvLiteEncoderStream,n.IconvLiteDecoderStream=o.IconvLiteDecoderStream,n.encodeStream=function(u,l){return new n.IconvLiteEncoderStream(n.getEncoder(u,l),l)},n.decodeStream=function(u,l){return new n.IconvLiteDecoderStream(n.getDecoder(u,l),l)},n.supportsStreams=!0}};var s;try{s=require("stream")}catch{}s&&s.Transform?n.enableStreamingAPI(s):n.encodeStream=n.decodeStream=function(){throw new Error("iconv-lite Streaming API is not enabled. Use iconv.enableStreamingAPI(require('stream')); to enable it.")}}(jc)),jc.exports}var os,rN=ou.inherits,gd=fo,nN=/(?:charset|encoding)\s*=\s*['"]? *([\w\-]+)/i;rN(ya,gd.Transform);function ya(t){if(!(this instanceof ya))return new ya(t);gd.Transform.call(this,t),this.charset=t,this.parsed_chunk=!1}ya.prototype._transform=function(t,e,r){if(!this.parsed_chunk&&(this.charset=="utf-8"||this.charset=="utf8")){this.parsed_chunk=!0;var n=nN.exec(t.toString());if(n){var s=n[1].toLowerCase().replace("utf8","utf-8");os.encodingExists(s)&&(this.charset=s)}}if(this.charset=="utf-8"||!os.encodingExists(this.charset))return this.push(t),r();var a=this;this.decoder||(this.decoder=os.decodeStream(this.charset),this.decoder.on("data",function(i){a.push(i)})),this.decoder.write(t),r()};var sN=function(t){try{os||(os=tN())}catch{}return os?new ya(t):new gd.PassThrough},aN=fl,Ys=tm,Qh=fo;function iN(t,e){return Ys.URL?new Ys.URL(t,e):e?Ys.resolve(e,t):t}function oN(t,e){t.indexOf("http")<0&&(t="http://"+t),e.indexOf("http")<0&&(e="http://"+e);var r=Ys.parse(t),n=Ys.parse(e);return r.host==n.host&&String(r.port||(r.protocol=="https:"?443:80))==String(n.port||(n.protocol=="https:"?443:80))}function cN(t){var e=ty(["NO_PROXY"],!0);if(!e)return!0;var r,n=e.split(/[\s,]+/);for(var s in n)if(r=n[s],r.trim().length!=0){var a=new RegExp(r.replace(/^\./,"*").replace(/[.]/g,"\\$&").replace(/\*/g,".*"));if(t.match(a))return!1}return!0}function ty(t,e){for(var r,n=-1,s=process.env;!r&&n<t.length-1;)r=s[t[++n]],!r&&e&&(r=s[t[n].toLowerCase()]);return r}function uN(t){if(!t||t==="")return{};var e,r="utf8",n=t.split(";");return n.length>1&&(e=n[1].match(/charset=(.+)/))&&(r=e[1]),{type:n[0],charset:r}}function lN(t){return typeof t.pipe=="function"}function dN(t,e,r){if(e>0)return r(e);if(t.end!==void 0&&t.end!==1/0&&t.start!==void 0)return r(t.end+1-(t.start||0));aN.stat(t.path,function(n,s){r(s?s.size-(t.start||0):null)})}function fN(t,e){if(Qh.pipeline)return Qh.pipeline.apply(null,t.concat(e));for(var r=t.shift();t.length;)r=r.pipe(t.shift()),r.once("error",function(n){e&&e(n),e=null})}var hN={resolve_url:iN,get_env_var:ty,host_and_ports_match:oN,should_proxy_to:cN,parse_content_type:uN,is_stream:lN,get_stream_length:dN,pump_streams:fN};const pN="3.3.1",mN={version:pN};(function(t){var e=fl,r=gv,n=_v,s=tm,a=fo,i=ou.debuglog("needle"),o=J_.build,c=K_,u=EC,l=hd,d=LC,h=sN,f=hN,m=mN.version,_="Needle/"+m;_+=" (Node.js "+process.version+"; "+process.platform+" "+process.arch+")";var y="pfx key passphrase cert ca ciphers rejectUnauthorized secureProtocol checkServerIdentity family",w=!r.Agent||r.Agent.defaultMaxSockets!=1/0,g=Object.assign?Object.assign:ou._extend,b=[301,302,303,307,308];function T(Q,N){return Q.bind(null,N)}var I={};try{var C=require("zlib"),D={flush:C.Z_SYNC_FLUSH,finishFlush:C.Z_SYNC_FLUSH},k={flush:C.BROTLI_OPERATION_FLUSH,finishFlush:C.BROTLI_OPERATION_FLUSH};I["x-deflate"]=T(C.Inflate,D),I.deflate=T(C.Inflate,D),I["x-gzip"]=T(C.Gunzip,D),I.gzip=T(C.Gunzip,D),typeof C.BrotliDecompress=="function"&&(I.br=T(C.BrotliDecompress,k))}catch{}var A={boundary:"--------------------NODENEEDLEHTTPCLIENT",encoding:"utf8",parse_response:"all",proxy:null,agent:null,headers:{},accept:"*/*",user_agent:_,open_timeout:1e4,response_timeout:0,read_timeout:0,follow_max:0,stream_length:-1,signal:null,compressed:!1,decode_response:!0,parse_cookies:!0,follow_set_cookies:!1,follow_set_referer:!1,follow_keep_method:!1,follow_if_same_host:!1,follow_if_same_protocol:!1,follow_if_same_location:!1,use_proxy_from_env_var:!0},H={options:{decode:"decode_response",parse:"parse_response",timeout:"open_timeout",follow:"follow_max"},inverted:{}};Object.keys(H.options).map(function(Q){var N=H.options[Q];H.inverted[N]=Q});function q(Q){return Object.keys(A).map(function(N){if(A[N]!==null&&A[N].constructor==Q)return N}).filter(function(N){return N})}function pe(Q,N,P,$,L){if(typeof N!="string")throw new TypeError("URL must be a string, not "+N);this.method=Q.toLowerCase(),this.uri=N,this.data=P,typeof $=="function"?(this.callback=$,this.options={}):(this.callback=L,this.options=$)}pe.prototype.setup=function(Q,N){function P(ce,Ce){return typeof N[ce]<"u"?N[ce]:typeof N[H.inverted[ce]]<"u"?N[H.inverted[ce]]:Ce}function $(ce,Ce){var _e=P(Ce),S=typeof _e;if(S!="undefined"&&S!=ce)throw new TypeError(S+" received for "+Ce+", but expected a "+ce);return S==ce?_e:A[Ce]}var L={http_opts:{agent:P("agent",A.agent),localAddress:P("localAddress",void 0),lookup:P("lookup",void 0),signal:P("signal",A.signal)},headers:{},output:N.output,proxy:P("proxy",A.proxy),parser:P("parse_response",A.parse_response),encoding:N.encoding||(N.multipart?"binary":A.encoding)};if(q(Boolean).forEach(function(ce){L[ce]=$("boolean",ce)}),q(Number).forEach(function(ce){L[ce]=$("number",ce)}),L.http_opts.signal&&!(L.http_opts.signal instanceof AbortSignal))throw new TypeError(typeof L.http_opts.signal+" received for signal, but expected an AbortSignal");y.split(" ").forEach(function(ce){typeof N[ce]<"u"&&(L.http_opts.agent?L.http_opts.agent.options[ce]=N[ce]:L.http_opts[ce]=N[ce])});for(var F in A.headers)L.headers[F]=A.headers[F];if(L.headers.accept=N.accept||A.accept,L.headers["user-agent"]=N.user_agent||A.user_agent,N.content_type&&(L.headers["content-type"]=N.content_type),(N.connection||w)&&(L.headers.connection=N.connection||"close"),(N.compressed||A.compressed)&&typeof C<"u"&&(L.headers["accept-encoding"]=I.br?"gzip, deflate, br":"gzip, deflate"),N.cookies&&(L.headers.cookie=l.write(N.cookies)),Q.match(/[^\/]@/)){var Z=(s.parse(Q).auth||"").split(":");N.username=Z[0],N.password=Z[1]}if(N.username&&(N.auth&&(N.auth=="auto"||N.auth=="digest")?L.credentials=[N.username,N.password]:L.headers.authorization=u.basic(N.username,N.password)),L.use_proxy_from_env_var){var X=f.get_env_var(["HTTP_PROXY","HTTPS_PROXY"],!0);!L.proxy&&X&&(L.proxy=X)}if(L.proxy)if(!L.use_proxy_from_env_var||f.should_proxy_to(Q)){if(L.proxy.indexOf("http")===-1&&(L.proxy="http://"+L.proxy),L.proxy.indexOf("@")!==-1){var Y=(s.parse(L.proxy).auth||"").split(":");N.proxy_user=Y[0],N.proxy_pass=Y[1]}N.proxy_user&&(L.headers["proxy-authorization"]=u.basic(N.proxy_user,N.proxy_pass))}else delete L.proxy;for(var J in N.headers)L.headers[J.toLowerCase()]=N.headers[J];return L.uri_modifier=P("uri_modifier",null),L},pe.prototype.start=function(){var Q=new a.PassThrough({objectMode:!1}),N=this.uri,P=this.data,$=this.method,L=typeof this.options=="function"?this.options:this.callback,F=this.options||{};N.indexOf("http")===-1&&(N=N.replace(/^(\/\/)?/,"http://"));var Z=this,X,Y=!1,J=this.setup(N,F),ce=F.json||F.json!==!1&&J.headers["content-type"]=="application/json";if(P)if(F.multipart){var Ce=F.boundary||A.boundary;Y=!0,c.build(P,Ce,function(S,p){if(S)throw S;J.headers["content-type"]="multipart/form-data; boundary="+Ce,_e(p)})}else if(f.is_stream(P)){if($=="get")throw new Error("Refusing to pipe() a stream via GET. Did you mean .post?");J.stream_length>0||J.stream_length===0&&P.path?(Y=!0,f.get_stream_length(P,J.stream_length,function(S){P.length=S,_e(P)})):X=P}else Buffer.isBuffer(P)?X=P:$=="get"&&!ce?N=N.replace(/\?.*|$/,"?"+o(P)):(X=typeof P=="string"?P:ce?JSON.stringify(P):o(P),X=Buffer.from(X,J.encoding));function _e(S){S&&(S.length&&(J.headers["content-length"]=S.length),J.headers["content-type"]||(J.headers["content-type"]=ce?"application/json; charset=utf-8":"application/x-www-form-urlencoded")),F.json&&!F.accept&&!(F.headers||{}).accept&&(J.headers.accept="application/json"),Z.send_request(1,$,N,J,S,Q,L)}return Y||_e(X),Q},pe.prototype.get_request_opts=function(Q,N,P){var $=P.http_opts,L=P.proxy,F=L?s.parse(L):s.parse(N);if($.protocol=F.protocol,$.host=F.hostname,$.port=F.port||(F.protocol=="https:"?443:80),$.path=L?N:F.pathname+(F.search||""),$.method=Q,$.headers=P.headers,!$.headers.host){var Z=L?s.parse(N):F;$.headers.host=Z.hostname,Z.port&&[80,443].indexOf(Z.port)===-1&&($.headers.host+=":"+Z.port)}return $},pe.prototype.should_follow=function(Q,N,P){if(!Q)return!1;function $(F){var F=P[F];return Q.indexOf(F)!==-1}return!(!N.follow_if_same_location&&Q===P||N.follow_if_same_host&&!$("host")||N.follow_if_same_protocol&&!$("protocol"))},pe.prototype.send_request=function(Q,N,P,$,L,F,Z){if(typeof $.uri_modifier=="function"){var X=$.uri_modifier(P);i("Modifying request URI",P+" => "+X),P=X}var Y,J,ce=0,Ce=this,_e=this.get_request_opts(N,P,$),S=_e.protocol=="https:"?n:r,p=_e.signal;function v(U,re){if(ce++>0)return i("Already finished, stopping here.");if(J&&clearTimeout(J),Y.removeListener("error",x),F.done=!0,Y.once("error",function(){}),Z)return Z(U,re,re?re.body:void 0);F.emit("done",U);var Ie=F._readableState.pipes||[];Ie.forEach||(Ie=[Ie]),Ie.forEach(function(Me){Me.emit("done",U)})}function x(U){i("Request error",U),F.emit("err",U),v(U||new Error("Unknown error when making request."))}function O(){F.emit("err",new Error("Aborted by signal.")),Y.destroy()}function ae(U,re){J&&clearTimeout(J),!(re<=0)&&(J=setTimeout(function(){F.emit("timeout",U),Y.destroy(),U=="read"&&v(new Error(U+" timeout")),p&&p.removeEventListener("abort",O)},re))}return i("Making request #"+Q,_e),Y=S.request(_e,function(U){var re=U.headers;if(i("Got response",U.statusCode,re),F.emit("response",U),ae("read",$.read_timeout),$.parse_cookies&&(re["set-cookie"]||$.previous_resp_cookies)&&(U.cookies=g($.previous_resp_cookies||{},l.read(re["set-cookie"])),i("Got cookies",U.cookies)),b.indexOf(U.statusCode)!==-1&&Ce.should_follow(re.location,$,P)){if(clearTimeout(J),Q<=$.follow_max){if(F.emit("redirect",re.location),$.follow_keep_method||(N="GET",L=null,delete $.headers["content-length"]),$.follow_set_cookies&&f.host_and_ports_match(re.location,P)){var Ie=l.read($.headers.cookie);$.previous_resp_cookies=U.cookies,(Object.keys(Ie).length||Object.keys(U.cookies||{}).length)&&($.headers.cookie=l.write(g(Ie,U.cookies)))}else $.headers.cookie&&(i("Clearing original request cookie",$.headers.cookie),delete $.headers.cookie);$.follow_set_referer&&($.headers.referer=encodeURI(P)),$.headers.host=null;var Me=f.resolve_url(re.location,P);return i("Redirecting to "+Me.toString()),Ce.send_request(++Q,N,Me.toString(),$,L,F,Z)}else if($.follow_max>0)return v(new Error("Max redirects reached. Possible loop in: "+re.location))}if(U.statusCode==401&&re["www-authenticate"]&&$.credentials&&!$.headers.authorization){var Re=u.header(re["www-authenticate"],$.credentials,_e);if(Re)return $.headers.authorization=Re,Ce.send_request(Q,N,P,$,L,F,Z)}F.emit("header",U.statusCode,re),F.emit("headers",re);var Oe=[],Be=f.parse_content_type(re["content-type"]),jr=Be.type&&(Be.type.indexOf("text/")!=-1||!!Be.type.match(/(\/|\+)(xml|json)$/));if(re["content-encoding"]&&I[re["content-encoding"]]){var G=I[re["content-encoding"]]();G.on("error",x),Oe.push(G)}if($.parser&&d[Be.type]){var At=$.parser.toString().toLowerCase();(["xml","json"].indexOf(At)==-1||d[Be.type].name==At)&&(F.parser=d[Be.type].name,Oe.push(d[Be.type].fn()),F._writableState.objectMode=!0,F._readableState.objectMode=!0)}else jr&&$.decode_response&&Be.charset&&Oe.push(h(Be.charset));if(Oe.push(F),f.pump_streams([U].concat(Oe),function(ee){ee&&i(ee),ee&&ee.message=="write after end"&&Y.destroy()}),$.output&&U.statusCode==200){var ue=e.createWriteStream($.output);ue.on("error",x),F.on("end",function(){ue.writable&&ue.end()}),ue.on("close",function(){delete F.file}),F.on("readable",function(){for(var ee;(ee=this.read())!==null;)ue.writable&&ue.write(ee),U.body&&U.body.push(ee)}),F.file=ue}if(Z){U.raw=[],U.body=[],U.bytes=0;var le=new a.PassThrough;le.on("readable",function(){for(var ee;(ee=this.read())!=null;)U.bytes+=ee.length,U.raw.push(ee)}),f.pump_streams([U,le],function(ee){ee&&i(ee)}),(!$.output||U.statusCode!=200)&&F.on("readable",function(){for(var ee;(ee=this.read())!==null;)typeof ee=="string"&&(ee=Buffer.from(ee)),U.body.push(ee)})}F.on("end",function(){U.body&&(U.raw=Buffer.concat(U.raw),U.body[0]!==void 0&&!Buffer.isBuffer(U.body[0])?(U.body=U.body[0],F.parser&&(U.parser=F.parser)):(U.body=Buffer.concat(U.body),(jr||F.parser)&&(U.body=U.body.toString()))),F.file?F.file.on("close",function(){v(null,U)}):v(null,U)})}),ae("open",$.open_timeout),Y.on("error",x),Y.once("abort",function(){J&&clearTimeout(J)}),Y.once("socket",function(U){U.connecting?U.once("connect",function(){ae("response",$.response_timeout)}):ae("response",$.response_timeout)}),L?f.is_stream(L)?f.pump_streams([L,Y],function(U){U&&i(U)}):(Y.write(L,$.encoding),Y.end()):Y.end(),p&&(p.aborted===!0?O():p.addEventListener("abort",O,{once:!0})),F.abort=function(){Y.destroy()},F.request=Y,F},typeof Promise<"u"&&(t.exports=function(){var Q,N=[].slice.call(arguments);return N[0].match(/\.|\//)?Q=N.length>2?"post":"get":Q=N.shift(),Q.match(/get|head/i)&&N.length==2&&N.splice(1,0,null),new Promise(function(P,$){t.exports.request(Q,N[0],N[1],N[2],function(L,F){return L?$(L):P(F)})})}),t.exports.version=m,t.exports.defaults=function(Q){for(var N in Q){var P=H.options[N]||N;if(A.hasOwnProperty(P)&&typeof Q[N]<"u"){if(P!="parse_response"&&P!="proxy"&&P!="agent"&&P!="signal"){var $=A[P].constructor.name;if(Q[N].constructor.name!=$)throw new TypeError("Invalid type for "+N+", should be "+$)}else if(P==="signal"&&Q[N]!==null&&!(Q[N]instanceof AbortSignal))throw new TypeError("Invalid type for "+N+", should be AbortSignal");A[P]=Q[N]}else throw new Error("Invalid property for defaults:"+P)}return A},"head get".split(" ").forEach(function(Q){t.exports[Q]=function(N,P,$){return new pe(Q,N,null,P,$).start()}}),"post put patch delete".split(" ").forEach(function(Q){t.exports[Q]=function(N,P,$,L){return new pe(Q,N,P,$,L).start()}}),t.exports.request=function(Q,N,P,$,L){return new pe(Q,N,P,$,L).start()}})(W_);var lt=W_.exports,it={};(function(t){var e=Se&&Se.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseSpiceBody=t.ensureJSON=t.getVQD=t.queryString=t.SearchTimeType=t.SafeSearchType=t.COMMON_HEADERS=t.VQD_REGEX=t.SPICE_BASE=void 0;const r=e(lt);t.SPICE_BASE="https://duckduckgo.com/js/spice",t.VQD_REGEX=/vqd=['"](\d+-\d+(?:-\d+)?)['"]/,t.COMMON_HEADERS={"sec-ch-ua":'"Not=A?Brand";v="8", "Chromium";v="129"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"none","sec-fetch-user":"?1","sec-gpc":"1","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36"},function(o){o[o.STRICT=0]="STRICT",o[o.MODERATE=-1]="MODERATE",o[o.OFF=-2]="OFF"}(t.SafeSearchType||(t.SafeSearchType={})),function(o){o.ALL="a",o.DAY="d",o.WEEK="w",o.MONTH="m",o.YEAR="y"}(t.SearchTimeType||(t.SearchTimeType={}));function n(o){return new URLSearchParams(o).toString()}t.queryString=n;async function s(o,c="web",u){try{const l=await(0,r.default)("get",`https://duckduckgo.com/?${n({q:o,ia:c})}`,u);return t.VQD_REGEX.exec(l.body)[1]}catch{throw new Error(`Failed to get the VQD for query "${o}".`)}}t.getVQD=s;function a(o){return o instanceof Buffer?JSON.parse(o.toString()):typeof o=="string"?JSON.parse(o):o}t.ensureJSON=a;function i(o,c=/^ddg_spice_[\w]+\(\n?((?:.|\n)+)\n?\);?/){return JSON.parse(c.exec(o.toString())[1])}t.parseSpiceBody=i})(it);(function(t){var e=Se&&Se.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(t,"__esModule",{value:!0}),t.searchImages=t.ImageLicense=t.ImageColor=t.ImageLayout=t.ImageType=t.ImageSize=void 0;const r=bn,n=e(lt),s=it;var a;(function(f){f.ALL="",f.SMALL="Small",f.MEDIUM="Medium",f.LARGE="Large",f.WALLPAPER="Wallpaper"})(a=t.ImageSize||(t.ImageSize={}));var i;(function(f){f.ALL="",f.PHOTOGRAPH="photo",f.CLIPART="clipart",f.GIF="gif",f.TRANSPARENT="transparent"})(i=t.ImageType||(t.ImageType={}));var o;(function(f){f.ALL="",f.SQUARE="Square",f.TALL="Tall",f.WIDE="Wide"})(o=t.ImageLayout||(t.ImageLayout={}));var c;(function(f){f.ALL="",f.COLOR="color",f.BLACK_AND_WHITE="Monochrome",f.RED="Red",f.ORANGE="Orange",f.YELLOW="Yellow",f.GREEN="Green",f.BLUE="Blue",f.PINK="Pink",f.BROWN="Brown",f.BLACK="Black",f.GRAY="Gray",f.GREY="Gray",f.TEAL="Teal",f.WHITE="White"})(c=t.ImageColor||(t.ImageColor={}));var u;(function(f){f.ALL="",f.CREATIVE_COMMONS="Any",f.PUBLIC_DOMAIN="Public",f.SHARE="Share",f.SHARE_COMMERCIALLY="ShareCommercially",f.MODIFY="Modify",f.MODIFY_COMMERCIALLY="ModifyCommercially"})(u=t.ImageLicense||(t.ImageLicense={}));const l={safeSearch:s.SafeSearchType.OFF,locale:"en-us",offset:0};async function d(f,m,_){if(!f)throw new Error("Query cannot be empty!");m?m=h(m):m=l;let y=m.vqd;y||(y=await(0,s.getVQD)(f,"web",_));const w=[m.size?`size:${m.size}`:"",m.type?`type:${m.type}`:"",m.layout?`layout:${m.layout}`:"",m.color?`color:${m.color}`:"",m.license?`license:${m.license}`:""],g={l:m.locale,o:"json",q:f,vqd:y,p:m.safeSearch===0?"1":"-1",f:w.toString(),s:String(m.offset||0)},b=await(0,n.default)("get",`https://duckduckgo.com/i.js?${(0,s.queryString)(g)}`,_||{headers:s.COMMON_HEADERS});if(b.statusCode===403)throw new Error("A server error occurred!");const T=(0,s.ensureJSON)(b.body);return{noResults:!T.results.length,vqd:y,results:T.results.map(I=>({...I,title:(0,r.decode)(I.title)}))}}t.searchImages=d;function h(f){if(f=Object.assign({},l,f),!(f.safeSearch in s.SafeSearchType))throw new TypeError(`${f.safeSearch} is an invalid safe search type!`);if(typeof f.safeSearch=="string"&&(f.safeSearch=s.SafeSearchType[f.safeSearch]),typeof f.offset!="number")throw new TypeError("Search offset is not a number!");if(f.offset<0)throw new RangeError("Search offset cannot be below zero!");if(!f.locale||typeof f.locale!="string")throw new TypeError("Search locale must be a string!");if(f.size&&!Object.values(a).includes(f.size))throw new TypeError(`${f.size} is an invalid image size filter!`);if(f.type&&!Object.values(i).includes(f.type))throw new TypeError(`${f.type} is an invalid image type filter!`);if(f.layout&&!Object.values(o).includes(f.layout))throw new TypeError(`${f.layout} is an invalid image layout filter!`);if(f.color&&!Object.values(c).includes(f.color))throw new TypeError(`${f.color} is an invalid color filter!`);if(f.license&&!Object.values(u).includes(f.license))throw new TypeError(`${f.license} is an invalid license filter!`);if(f.vqd&&!/\d-\d+-\d+/.test(f.vqd))throw new Error(`${f.vqd} is an invalid VQD!`);return f}})(q_);var Mo={},gN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Mo,"__esModule",{value:!0});Mo.searchNews=void 0;const ep=bn,_N=gN(lt),dn=it,ry={safeSearch:dn.SafeSearchType.OFF,locale:"en-us",offset:0};async function yN(t,e,r){if(!t)throw new Error("Query cannot be empty!");e?e=vN(e):e=ry;let n=e.vqd;n||(n=await(0,dn.getVQD)(t,"web",r));const s={l:e.locale,o:"json",noamp:"1",q:t,vqd:n,p:e.safeSearch===0?"1":String(e.safeSearch),df:e.time||"",s:String(e.offset||0)},a=await(0,_N.default)("get",`https://duckduckgo.com/news.js?${(0,dn.queryString)(s)}`,r||{headers:dn.COMMON_HEADERS});if(a.statusCode===403)throw new Error("A server error occurred!");const i=(0,dn.ensureJSON)(a.body);return{noResults:!i.results.length,vqd:n,results:i.results.map(o=>({date:o.date,excerpt:(0,ep.decode)(o.excerpt),image:o.image,relativeTime:o.relative_time,syndicate:o.syndicate,title:(0,ep.decode)(o.title),url:o.url,isOld:!!o.is_old}))}}Mo.searchNews=yN;function vN(t){if(t=Object.assign({},ry,t),!(t.safeSearch in dn.SafeSearchType))throw new TypeError(`${t.safeSearch} is an invalid safe search type!`);if(typeof t.safeSearch=="string"&&(t.safeSearch=dn.SafeSearchType[t.safeSearch]),typeof t.offset!="number")throw new TypeError("Search offset is not a number!");if(t.offset<0)throw new RangeError("Search offset cannot be below zero!");if(!t.locale||typeof t.locale!="string")throw new TypeError("Search locale must be a string!");if(t.time&&!Object.values(dn.SearchTimeType).includes(t.time))throw new TypeError(`${t.time} is an invalid time filter!`);if(t.vqd&&!/\d-\d+-\d+/.test(t.vqd))throw new Error(`${t.vqd} is an invalid VQD!`);return t}var _s={},bN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(_s,"__esModule",{value:!0});_s.autocomplete=_s.search=void 0;const Hn=bn,ny=bN(lt),Nt=it,sy={safeSearch:Nt.SafeSearchType.OFF,time:Nt.SearchTimeType.ALL,locale:"en-us",region:"wt-wt",offset:0,marketRegion:"en-US"},wN=/DDG\.pageLayout\.load\('d',(\[.+\])\);DDG\.duckbar\.load(?:Module)?\('/,EN=/;DDG\.duckbar\.load\('images', ({"ads":.+"vqd":{".+":"\d-\d+-\d+"}})\);DDG\.duckbar\.load\('news/,TN=/;DDG\.duckbar\.load\('news', ({"ads":.+"vqd":{".+":"\d-\d+-\d+"}})\);DDG\.duckbar\.load\('videos/,SN=/;DDG\.duckbar\.load\('videos', ({"ads":.+"vqd":{".+":"\d-\d+-\d+"}})\);DDG\.duckbar\.loadModule\('related_searches/,xN=/DDG\.duckbar\.loadModule\('related_searches', ({"ads":.+"vqd":{".+":"\d-\d+-\d+"}})\);DDG\.duckbar\.load\('products/;async function IN(t,e,r){if(!t)throw new Error("Query cannot be empty!");e?e=AN(e):e=sy;let n=e.vqd;n||(n=await(0,Nt.getVQD)(t,"web",r||{headers:Nt.COMMON_HEADERS}));const s={q:t,...e.safeSearch!==Nt.SafeSearchType.STRICT?{t:"D"}:{},l:e.locale,...e.safeSearch===Nt.SafeSearchType.STRICT?{p:"1"}:{},kl:e.region||"wt-wt",s:String(e.offset),dl:"en",ct:"US",bing_market:e.marketRegion,df:e.time,vqd:n,...e.safeSearch!==Nt.SafeSearchType.STRICT?{ex:String(e.safeSearch)}:{},sp:"1",bpa:"1",biaexp:"b",msvrtexp:"b",...e.safeSearch===Nt.SafeSearchType.STRICT?{videxp:"a",nadse:"b",eclsexp:"a",stiaexp:"a",tjsexp:"b",related:"b",msnexp:"a"}:{nadse:"b",eclsexp:"b",tjsexp:"b"}},a=await(0,ny.default)("get",`https://links.duckduckgo.com/d.js?${(0,Nt.queryString)(s)}`,r);if(a.body.includes("DDG.deep.is506"))throw new Error("A server error occurred!");if(a.body.toString().includes("DDG.deep.anomalyDetectionBlock"))throw new Error("DDG detected an anomaly in the request, you are likely making requests too quickly.");const i=JSON.parse(wN.exec(a.body)[1].replace(/\t/g,"    "));if(i.length===1&&!("n"in i[0])){const h=i[0];if(!h.da&&h.t==="EOF"||!h.a||h.d==="google.com search")return{noResults:!0,vqd:n,results:[]}}const o={noResults:!1,vqd:n,results:[]};for(const h of i){if("n"in h)continue;let f;if(h.b){const[m,_,y]=h.b.split("	");f={prefix:m,title:_,domain:y}}o.results.push({title:h.t,description:(0,Hn.decode)(h.a),rawDescription:h.a,hostname:h.i,icon:`https://external-content.duckduckgo.com/ip3/${h.i}.ico`,url:h.u,bang:f})}const c=EN.exec(a.body);if(c){const h=JSON.parse(c[1].replace(/\t/g,"    "));o.images=h.results.map(f=>(f.title=(0,Hn.decode)(f.title),f))}const u=TN.exec(a.body);if(u){const h=JSON.parse(u[1].replace(/\t/g,"    "));o.news=h.results.map(f=>({date:f.date,excerpt:(0,Hn.decode)(f.excerpt),image:f.image,relativeTime:f.relative_time,syndicate:f.syndicate,title:(0,Hn.decode)(f.title),url:f.url,isOld:!!f.is_old}))}const l=SN.exec(a.body);if(l){const h=JSON.parse(l[1].replace(/\t/g,"    "));o.videos=[];for(const f of h.results)o.videos.push({url:f.content,title:(0,Hn.decode)(f.title),description:(0,Hn.decode)(f.description),image:f.images.large||f.images.medium||f.images.small||f.images.motion,duration:f.duration,publishedOn:f.publisher,published:f.published,publisher:f.uploader,viewCount:f.statistics.viewCount||void 0})}const d=xN.exec(a.body);if(d){const h=JSON.parse(d[1].replace(/\t/g,"    "));o.related=[];for(const f of h.results)o.related.push({text:f.text,raw:f.display_text})}return o}_s.search=IN;function AN(t){if(t=Object.assign({},sy,t),!(t.safeSearch in Nt.SafeSearchType))throw new TypeError(`${t.safeSearch} is an invalid safe search type!`);if(typeof t.safeSearch=="string"&&(t.safeSearch=Nt.SafeSearchType[t.safeSearch]),typeof t.offset!="number")throw new TypeError("Search offset is not a number!");if(t.offset<0)throw new RangeError("Search offset cannot be below zero!");if(t.time&&!Object.values(Nt.SearchTimeType).includes(t.time)&&!/\d{4}-\d{2}-\d{2}..\d{4}-\d{2}-\d{2}/.test(t.time))throw new TypeError(`${t.time} is an invalid search time!`);if(!t.locale||typeof t.locale!="string")throw new TypeError("Search locale must be a string!");if(!t.region||typeof t.region!="string")throw new TypeError("Search region must be a string!");if(!t.marketRegion||typeof t.marketRegion!="string")throw new TypeError("Search market region must be a string!");if(t.vqd&&!/\d-\d+-\d+/.test(t.vqd))throw new Error(`${t.vqd} is an invalid VQD!`);return t}async function kN(t,e,r){if(!t)throw new Error("Query cannot be empty!");const n={q:t,kl:e||"wt-wt"},s=await(0,ny.default)("get",`https://duckduckgo.com/ac/?${(0,Nt.queryString)(n)}`,r);return(0,Nt.ensureJSON)(s.body)}_s.autocomplete=kN;var ay={};(function(t){var e=Se&&Se.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(t,"__esModule",{value:!0}),t.searchVideos=t.VideoLicense=t.VideoDuration=t.VideoDefinition=void 0;const r=bn,n=e(lt),s=it;var a;(function(d){d.ANY="",d.HIGH="high",d.STANDARD="standard"})(a=t.VideoDefinition||(t.VideoDefinition={}));var i;(function(d){d.ANY="",d.SHORT="short",d.MEDIUM="medium",d.LONG="long"})(i=t.VideoDuration||(t.VideoDuration={}));var o;(function(d){d.ANY="",d.CREATIVE_COMMONS="creativeCommon",d.YOUTUBE="youtube"})(o=t.VideoLicense||(t.VideoLicense={}));const c={safeSearch:s.SafeSearchType.OFF,locale:"en-us",offset:0};async function u(d,h,f){if(!d)throw new Error("Query cannot be empty!");h?h=l(h):h=c;let m=h.vqd;m||(m=await(0,s.getVQD)(d,"web",f));const _=[h.time&&h.time!=="a"?`publishedAfter:${h.time}`:"",h.definition?`videoDefinition:${h.definition}`:"",h.duration?`videoDuration:${h.duration}`:"",h.license?`videoLicense:${h.license}`:""],y={l:h.locale,o:"json",q:d,vqd:m,p:h.safeSearch===0?"1":String(h.safeSearch),f:_.toString(),s:String(h.offset||0)},w=await(0,n.default)("get",`https://duckduckgo.com/v.js?${(0,s.queryString)(y)}`,f||{headers:s.COMMON_HEADERS});if(w.statusCode===403)throw new Error("A server error occurred!");const g=(0,s.ensureJSON)(w.body);return{noResults:!g.results.length,vqd:m,results:g.results.map(b=>({url:b.content,title:(0,r.decode)(b.title),description:(0,r.decode)(b.description),image:b.images.large||b.images.medium||b.images.small||b.images.motion,duration:b.duration,publishedOn:b.publisher,published:b.published,publisher:b.uploader,viewCount:b.statistics.viewCount||void 0}))}}t.searchVideos=u;function l(d){if(d=Object.assign({},c,d),!(d.safeSearch in s.SafeSearchType))throw new TypeError(`${d.safeSearch} is an invalid safe search type!`);if(typeof d.safeSearch=="string"&&(d.safeSearch=s.SafeSearchType[d.safeSearch]),typeof d.offset!="number")throw new TypeError("Search offset is not a number!");if(d.offset<0)throw new RangeError("Search offset cannot be below zero!");if(!d.locale||typeof d.locale!="string")throw new TypeError("Search locale must be a string!");if(d.time&&!Object.values(s.SearchTimeType).includes(d.time))throw new TypeError(`${d.time} is an invalid time filter!`);if(d.definition&&!Object.values(a).includes(d.definition))throw new TypeError(`${d.definition} is an invalid video definition!`);if(d.duration&&!Object.values(i).includes(d.duration))throw new TypeError(`${d.duration} is an invalid video duration!`);if(d.license&&!Object.values(o).includes(d.license))throw new TypeError(`${d.license} is an invalid video license!`);if(d.vqd&&!/\d-\d+-\d+/.test(d.vqd))throw new Error(`${d.vqd} is an invalid VQD!`);return d}})(ay);var jo={},ON=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(jo,"__esModule",{value:!0});jo.currency=void 0;const CN=ON(lt),tp=it;async function NN(t,e,r=1,n){if(!t)throw new Error("Currency `from` cannot be empty!");if(!e)throw new Error("Currency `to` cannot be empty!");const s=await(0,CN.default)("get",`${tp.SPICE_BASE}/currency/${r}/${t}/${e}`,n),a=(0,tp.parseSpiceBody)(s.body);if(a.headers.status!=="0")throw new Error(a.headers.description);return a}jo.currency=NN;var Fo={},$N=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fo,"__esModule",{value:!0});Fo.dictionaryAudio=void 0;const RN=$N(lt),PN=it;async function LN(t,e){if(!t)throw new Error("Word cannot be empty!");const r=await(0,RN.default)("get",`${PN.SPICE_BASE}/dictionary/audio/${t}`,e);return r.body.toString()===`ddg_spice_dictionary_audio();
`?[]:r.body}Fo.dictionaryAudio=LN;var Uo={},DN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Uo,"__esModule",{value:!0});Uo.dictionaryDefinition=void 0;const MN=DN(lt),rp=it;async function jN(t,e){if(!t)throw new Error("Word cannot be empty!");const r=await(0,MN.default)("get",`${rp.SPICE_BASE}/dictionary/definition/${t}`,e);return r.body.toString()===`ddg_spice_dictionary_definition();
`?[]:(0,rp.parseSpiceBody)(r.body)}Uo.dictionaryDefinition=jN;var Bo={},FN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Bo,"__esModule",{value:!0});Bo.dictionaryHyphenation=void 0;const UN=FN(lt),BN=it;async function zN(t,e){if(!t)throw new Error("Word cannot be empty!");const r=await(0,UN.default)("get",`${BN.SPICE_BASE}/dictionary/hyphenation/${t}`,e);return r.body.toString()===`ddg_spice_dictionary_hyphenation();
`?[]:r.body}Bo.dictionaryHyphenation=zN;var zo={},qN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(zo,"__esModule",{value:!0});zo.dictionaryPronunciation=void 0;const ZN=qN(lt),GN=it;async function VN(t,e){if(!t)throw new Error("Word cannot be empty!");const r=await(0,ZN.default)("get",`${GN.SPICE_BASE}/dictionary/pronunciation/${t}`,e);return r.body.toString()===`ddg_spice_dictionary_pronunciation();
`?[]:r.body}zo.dictionaryPronunciation=VN;var iy={};(function(t){var e=Se&&Se.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(t,"__esModule",{value:!0}),t.dns=t.DNSRecordType=void 0;const r=e(lt),n=it;var s;(function(i){i.ANY="any",i.A="a",i.AAAA="aaaa",i.AFSDB="afsdb",i.APL="apl",i.CAA="caa",i.CERT="cert",i.CNAME="cname",i.DHCID="dhcid",i.DLV="dlv",i.DNAME="dname",i.DNSKEY="dnskey",i.DS="ds",i.HIP="hip",i.IPSECKEY="ipseckey",i.KEY="key",i.KX="kx",i.LOC="loc",i.MX="mx",i.NS="ns",i.NSEC="nsec",i.NSEC3="nsec3",i.NSEC3PARAM="nsec3param",i.RRSIG="rrsig",i.RP="rp",i.SIG="sig",i.SOA="soa",i.SPF="spf",i.SRV="srv",i.SSHFP="sshfp",i.TA="ta",i.TKEY="tkey",i.TLSA="tlsa",i.TSIG="tsig",i.TX="tx",i.TXT="txt"})(s=t.DNSRecordType||(t.DNSRecordType={}));async function a(i,o=s.ANY,c){if(!i)throw new Error("Domain cannot be empty!");const u=await(0,r.default)("get",`${n.SPICE_BASE}/dns/${o}/${i}`,c);return(0,n.parseSpiceBody)(u.body)}t.dns=a})(iy);var qo={},HN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(qo,"__esModule",{value:!0});qo.emojipedia=void 0;const WN=HN(lt),np=it;async function JN(t,e){if(!t)throw new Error("Emoji cannot be empty!");const r=await(0,WN.default)("get",`${np.SPICE_BASE}/emojipedia/${t}`,e);return(0,np.parseSpiceBody)(r.body)}qo.emojipedia=JN;var Zo={},KN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Zo,"__esModule",{value:!0});Zo.expandUrl=void 0;const XN=KN(lt),sp=it;async function YN(t,e){if(!t)throw new Error("URL cannot be empty!");const r=await(0,XN.default)("get",`${sp.SPICE_BASE}/expand_url/${encodeURIComponent(t)}`,e);return(0,sp.parseSpiceBody)(r.body)}Zo.expandUrl=YN;var Go={},QN=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Go,"__esModule",{value:!0});Go.forecast=void 0;const e$=QN(lt),ap=it;async function t$(t,e="en",r){if(!t)throw new Error("Query cannot be empty!");if(!e)throw new Error("Locale cannot be empty!");const n=await(0,e$.default)("get",`${ap.SPICE_BASE}/forecast/${encodeURIComponent(t)}/${e}`,r);return n.body.toString()===`ddg_spice_forecast();
`?null:(0,ap.parseSpiceBody)(n.body,/ddg_spice_[\w]+\(\n?((?:.|\n)+)\n?\);?/)}Go.forecast=t$;var Vo={},r$=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Vo,"__esModule",{value:!0});Vo.statista=void 0;const n$=r$(lt),ip=it;async function s$(t,e){const r=await(0,n$.default)("get",`${ip.SPICE_BASE}/statista/${encodeURIComponent(t)}`,e);return(0,ip.parseSpiceBody)(r.body)}Vo.statista=s$;var Ho={},a$=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ho,"__esModule",{value:!0});Ho.stocks=void 0;const i$=a$(lt),op=it;async function o$(t,e){if(!t)throw new Error("Symbol cannot be empty!");const r=await(0,i$.default)("get",`${op.SPICE_BASE}/stocks/${t}`,e),n=(0,op.parseSpiceBody)(r.body);if(n.Outcome!=="Success")throw new Error(`${n.Outcome}: ${n.Message}`);return n}Ho.stocks=o$;var Wo={},c$=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Wo,"__esModule",{value:!0});Wo.thesaurus=void 0;const u$=c$(lt),cp=it;async function l$(t,e){if(!t)throw new Error("Word cannot be empty!");const r=await(0,u$.default)("get",`${cp.SPICE_BASE}/thesaurus/${t}`,e);return r.body.toString()===`ddg_spice_thesaurus();
`?null:(0,cp.parseSpiceBody)(r.body)}Wo.thesaurus=l$;var Jo={},d$=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Jo,"__esModule",{value:!0});Jo.time=void 0;const f$=d$(lt),up=it;async function h$(t,e){if(!t)throw new Error("Query cannot be empty!");const r=await(0,f$.default)("get",`${up.SPICE_BASE}/time/${t}`,e);return(0,up.parseSpiceBody)(r.body)}Jo.time=h$;(function(t){var e=Se&&Se.__createBinding||(Object.create?function(s,a,i,o){o===void 0&&(o=i),Object.defineProperty(s,o,{enumerable:!0,get:function(){return a[i]}})}:function(s,a,i,o){o===void 0&&(o=i),s[o]=a[i]}),r=Se&&Se.__exportStar||function(s,a){for(var i in s)i!=="default"&&!Object.prototype.hasOwnProperty.call(a,i)&&e(a,s,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchTimeType=t.SafeSearchType=t.getVQD=void 0,r(q_,t),r(Mo,t),r(_s,t),r(ay,t),r(jo,t),r(Fo,t),r(Uo,t),r(Bo,t),r(zo,t),r(iy,t),r(qo,t),r(Zo,t),r(Go,t),r(Vo,t),r(Ho,t),r(Wo,t),r(Jo,t);var n=it;Object.defineProperty(t,"getVQD",{enumerable:!0,get:function(){return n.getVQD}}),Object.defineProperty(t,"SafeSearchType",{enumerable:!0,get:function(){return n.SafeSearchType}}),Object.defineProperty(t,"SearchTimeType",{enumerable:!0,get:function(){return n.SearchTimeType}})})(Hi);var p$={};om(p$,{DuckDuckGoSearch:()=>oy,SafeSearchType:()=>Hi.SafeSearchType,SearchTimeType:()=>Hi.SearchTimeType});const m$=10;var oy=class extends Lo{constructor(e){super(e??{});E(this,"searchOptions");E(this,"maxResults",m$);E(this,"name","duckduckgo-search");E(this,"description","A search engine. Useful for when you need to answer questions about current events. Input should be a search query.");const{searchOptions:r,maxResults:n}=e??{};this.searchOptions=r,this.maxResults=n||this.maxResults}static lc_name(){return"DuckDuckGoSearch"}async _call(e){const{results:r}=await Hi.search(e,this.searchOptions);return JSON.stringify(r.map(n=>({title:n.title,link:n.url,snippet:n.description})).slice(0,this.maxResults))}};const g$=Lr({query:Kt().describe("The search query to look up on the web"),maxResults:oa().optional().describe("Maximum number of results (default: 5)")});class _$ extends zn{constructor(){super(...arguments);E(this,"name","web_search");E(this,"displayName","Web Search");E(this,"description","Search the web for information using DuckDuckGo. Use this when you need to find current information, facts, or resources from the internet.");E(this,"kind",Cr.Search);E(this,"parameterSchema",g$);E(this,"requiresConfirmation",!1);E(this,"searchTool",new oy)}getDescription(r){return`Search the web for: "${r.query}"`}async execute(r,n){if(n.aborted)return ze("Search cancelled",gt.CANCELLED);try{const s=await this.searchTool.invoke(r.query);return!s||s.length===0?Un("No results found for the search query."):Un(`Search results for "${r.query}":

${s}`,` Found results for: ${r.query}`)}catch(s){const a=s instanceof Error?s.message:String(s);return ze(`Search failed: ${a}`)}}}var cy={exports:{}},Ji={},_d={};(function(t){function e(){return e=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s[o]=i[o])}return s},e.apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0});var r,n={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1};t.tokenTypes=void 0,(r=t.tokenTypes||(t.tokenTypes={}))[r.FUNCTION_WITH_ONE_ARG=0]="FUNCTION_WITH_ONE_ARG",r[r.NUMBER=1]="NUMBER",r[r.BINARY_OPERATOR_HIGH_PRECENDENCE=2]="BINARY_OPERATOR_HIGH_PRECENDENCE",r[r.CONSTANT=3]="CONSTANT",r[r.OPENING_PARENTHESIS=4]="OPENING_PARENTHESIS",r[r.CLOSING_PARENTHESIS=5]="CLOSING_PARENTHESIS",r[r.DECIMAL=6]="DECIMAL",r[r.POSTFIX_FUNCTION_WITH_ONE_ARG=7]="POSTFIX_FUNCTION_WITH_ONE_ARG",r[r.FUNCTION_WITH_N_ARGS=8]="FUNCTION_WITH_N_ARGS",r[r.BINARY_OPERATOR_LOW_PRECENDENCE=9]="BINARY_OPERATOR_LOW_PRECENDENCE",r[r.BINARY_OPERATOR_PERMUTATION=10]="BINARY_OPERATOR_PERMUTATION",r[r.COMMA=11]="COMMA",r[r.EVALUATED_FUNCTION=12]="EVALUATED_FUNCTION",r[r.EVALUATED_FUNCTION_PARAMETER=13]="EVALUATED_FUNCTION_PARAMETER",r[r.SPACE=14]="SPACE",t.createTokens=function(s){return[{token:"sin",show:"sin",type:0,value:s.math.sin},{token:"cos",show:"cos",type:0,value:s.math.cos},{token:"tan",show:"tan",type:0,value:s.math.tan},{token:"pi",show:"&pi;",type:3,value:"PI"},{token:"(",show:"(",type:4,value:"("},{token:")",show:")",type:5,value:")"},{token:"P",show:"P",type:10,value:s.math.P},{token:"C",show:"C",type:10,value:s.math.C},{token:" ",show:" ",type:14,value:" ".anchor},{token:"asin",show:"asin",type:0,value:s.math.asin},{token:"acos",show:"acos",type:0,value:s.math.acos},{token:"atan",show:"atan",type:0,value:s.math.atan},{token:"7",show:"7",type:1,value:"7"},{token:"8",show:"8",type:1,value:"8"},{token:"9",show:"9",type:1,value:"9"},{token:"int",show:"Int",type:0,value:Math.floor},{token:"cosh",show:"cosh",type:0,value:s.math.cosh},{token:"acosh",show:"acosh",type:0,value:s.math.acosh},{token:"ln",show:" ln",type:0,value:Math.log},{token:"^",show:"^",type:10,value:Math.pow},{token:"root",show:"root",type:0,value:Math.sqrt},{token:"4",show:"4",type:1,value:"4"},{token:"5",show:"5",type:1,value:"5"},{token:"6",show:"6",type:1,value:"6"},{token:"/",show:"&divide;",type:2,value:s.math.div},{token:"!",show:"!",type:7,value:s.math.fact},{token:"tanh",show:"tanh",type:0,value:s.math.tanh},{token:"atanh",show:"atanh",type:0,value:s.math.atanh},{token:"Mod",show:" Mod ",type:2,value:s.math.mod},{token:"1",show:"1",type:1,value:"1"},{token:"2",show:"2",type:1,value:"2"},{token:"3",show:"3",type:1,value:"3"},{token:"*",show:"&times;",type:2,value:s.math.mul},{token:"sinh",show:"sinh",type:0,value:s.math.sinh},{token:"asinh",show:"asinh",type:0,value:s.math.asinh},{token:"e",show:"e",type:3,value:"E"},{token:"log",show:" log",type:0,value:s.math.log},{token:"0",show:"0",type:1,value:"0"},{token:".",show:".",type:6,value:"."},{token:"+",show:"+",type:9,value:s.math.add},{token:"-",show:"-",type:9,value:s.math.sub},{token:",",show:",",type:11,value:","},{token:"Sigma",show:"&Sigma;",type:12,value:s.math.sigma},{token:"n",show:"n",type:13,value:"n"},{token:"Pi",show:"&Pi;",type:12,value:s.math.Pi},{token:"pow",show:"pow",type:8,value:Math.pow,numberOfArguments:2},{token:"&",show:"&",type:9,value:s.math.and}].map(function(a){return e({},a,{precedence:n[a.type]})})},t.preced=n})(_d);Object.defineProperty(Ji,"__esModule",{value:!0});var xe=_d;function mt(t,e){for(var r=0;r<t.length;r++)t[r]+=e;return t}var wr={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0},Wn={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},y$={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},rr={},Is={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},v$={1:!0},Tt=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"," ","&"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function b$(t,e,r,n){for(var s=0;s<n;s++)if(t[r+s]!==e[s])return!1;return!0}function lp(t,e){for(var r=0;r<e.length;r++)if(e[r].token===t)return r;return-1}Ji.addToken=function(t){for(var e=0;e<t.length;e++){var r=t[e].token.length,n=-1;t[e].type===xe.tokenTypes.FUNCTION_WITH_N_ARGS&&t[e].numberOfArguments===void 0&&(t[e].numberOfArguments=2),Tt[r]=Tt[r]||[];for(var s=0;s<Tt[r].length;s++)if(t[e].token===Tt[r][s]){n=lp(Tt[r][s],this.tokens);break}n===-1?(this.tokens.push(t[e]),t[e].precedence=xe.preced[t[e].type],Tt.length<=t[e].token.length&&(Tt[t[e].token.length]=[]),Tt[t[e].token.length].push(t[e].token)):(this.tokens[n]=t[e],t[e].precedence=xe.preced[t[e].type])}},Ji.lex=function(t,e){var r,n={value:this.math.changeSign,type:xe.tokenTypes.FUNCTION_WITH_ONE_ARG,precedence:4,show:"-"},s={value:")",show:")",type:xe.tokenTypes.CLOSING_PARENTHESIS,precedence:0},a={value:"(",type:xe.tokenTypes.OPENING_PARENTHESIS,precedence:0,show:"("},i=[a],o=[],c=t,u=wr,l=0,d=rr,h="";e!==void 0&&this.addToken(e);var f=function(D,k){for(var A,H,q,pe=[],Q=k.length,N=0;N<Q;N++)if(!(N<Q-1&&k[N]===" "&&k[N+1]===" ")){for(A="",H=k.length-N>Tt.length-2?Tt.length-1:k.length-N;H>0;H--)if(Tt[H]!==void 0)for(q=0;q<Tt[H].length;q++)b$(k,Tt[H][q],N,H)&&(A=Tt[H][q],q=Tt[H].length,H=0);if(N+=A.length-1,A==="")throw new Error("Can't understand after "+k.slice(N));pe.push(D.tokens[lp(A,D.tokens)])}return pe}(this,c);for(r=0;r<f.length;r++){var m=f[r];if(m.type!==14){var _,y=m.token,w=m.type,g=m.value,b=m.precedence,T=m.show,I=i[i.length-1];for(_=o.length;_--&&o[_]===0;)if([xe.tokenTypes.FUNCTION_WITH_ONE_ARG,xe.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,xe.tokenTypes.CONSTANT,xe.tokenTypes.OPENING_PARENTHESIS,xe.tokenTypes.CLOSING_PARENTHESIS,xe.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE,xe.tokenTypes.BINARY_OPERATOR_PERMUTATION,xe.tokenTypes.COMMA,xe.tokenTypes.EVALUATED_FUNCTION,xe.tokenTypes.EVALUATED_FUNCTION_PARAMETER].indexOf(w)!==-1){if(u[w]!==!0)throw new Error(y+" is not allowed after "+h);i.push(s),u=Wn,d=Is,o.pop()}if(u[w]!==!0)throw new Error(y+" is not allowed after "+h);d[w]===!0&&(w=xe.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE,g=this.math.mul,T="&times;",b=3,r-=1);var C={value:g,type:w,precedence:b,show:T,numberOfArguments:m.numberOfArguments};if(w===xe.tokenTypes.FUNCTION_WITH_ONE_ARG)u=wr,d=rr,mt(o,1),i.push(C),f[r+1].type!==xe.tokenTypes.OPENING_PARENTHESIS&&(i.push(a),o.push(2));else if(w===xe.tokenTypes.NUMBER)I.type===xe.tokenTypes.NUMBER?(I.value+=g,mt(o,1)):i.push(C),u=Wn,d=y$;else if(w===xe.tokenTypes.BINARY_OPERATOR_HIGH_PRECENDENCE)u=wr,d=rr,mt(o,2),i.push(C);else if(w===xe.tokenTypes.CONSTANT)i.push(C),u=Wn,d=Is;else if(w===xe.tokenTypes.OPENING_PARENTHESIS)mt(o,1),l++,u=wr,d=rr,i.push(C);else if(w===xe.tokenTypes.CLOSING_PARENTHESIS){if(!l)throw new Error("Closing parenthesis are more than opening one, wait What!!!");l--,u=Wn,d=Is,i.push(C),mt(o,1)}else if(w===xe.tokenTypes.DECIMAL){if(I.hasDec)throw new Error("Two decimals are not allowed in one number");I.type!==xe.tokenTypes.NUMBER&&(I={show:"0",value:0,type:xe.tokenTypes.NUMBER,precedence:0},i.push(I),mt(o,-1)),u=v$,mt(o,1),d=rr,I.value+=g,I.hasDec=!0}else w===xe.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&(u=Wn,d=Is,mt(o,1),i.push(C));w===xe.tokenTypes.FUNCTION_WITH_N_ARGS?(u=wr,d=rr,mt(o,m.numberOfArguments+2),i.push(C),f[r+1].type!==xe.tokenTypes.OPENING_PARENTHESIS&&(i.push(a),o.push(m.numberOfArguments+2))):w===xe.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?(I.type===xe.tokenTypes.BINARY_OPERATOR_LOW_PRECENDENCE?I.value===this.math.add?(I.value=g,I.show=T,mt(o,1)):I.value===this.math.sub&&T==="-"&&(I.value=this.math.add,I.show="+",mt(o,1)):I.type!==xe.tokenTypes.CLOSING_PARENTHESIS&&I.type!==xe.tokenTypes.POSTFIX_FUNCTION_WITH_ONE_ARG&&I.type!==xe.tokenTypes.NUMBER&&I.type!==xe.tokenTypes.CONSTANT&&I.type!==xe.tokenTypes.EVALUATED_FUNCTION_PARAMETER?y==="-"&&(u=wr,d=rr,mt(o,1),o.push(2),i.push(n),i.push(a)):(i.push(C),mt(o,2)),u=wr,d=rr):w===xe.tokenTypes.BINARY_OPERATOR_PERMUTATION?(u=wr,d=rr,mt(o,2),i.push(C)):w===xe.tokenTypes.COMMA?(u=wr,d=rr,i.push(C)):w===xe.tokenTypes.EVALUATED_FUNCTION?(u=wr,d=rr,mt(o,6),i.push(C),f[r+1].type!==xe.tokenTypes.OPENING_PARENTHESIS&&(i.push(a),o.push(6))):w===xe.tokenTypes.EVALUATED_FUNCTION_PARAMETER&&(u=Wn,d=Is,i.push(C)),mt(o,-1),h=y}else if(r>0&&r<f.length-1&&f[r+1].type===1&&(f[r-1].type===1||f[r-1].type===6))throw new Error("Unexpected Space")}for(_=o.length;_--;)i.push(s);if(u[5]!==!0)throw new Error("complete the expression");for(;l--;)i.push(s);return i.push(s),i};var uy={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.toPostfix=function(e){for(var r,n,s,a=[],i=-1,o=-1,c=[{value:"(",type:4,precedence:0,show:"("}],u=1;u<e.length;u++)if(e[u].type===1||e[u].type===3||e[u].type===13)e[u].type===1&&(e[u].value=Number(e[u].value)),a.push(e[u]);else if(e[u].type===4)c.push(e[u]);else if(e[u].type===5)for(;((l=n=c.pop())==null?void 0:l.type)!==4;){var l;n&&a.push(n)}else if(e[u].type===11){for(;((d=n=c.pop())==null?void 0:d.type)!==4;){var d;n&&a.push(n)}c.push(n)}else{o=(r=e[u]).precedence,i=(s=c[c.length-1]).precedence;var h=s.value=="Math.pow"&&r.value=="Math.pow";if(o>i)c.push(r);else{for(;i>=o&&!h||h&&o<i;)n=c.pop(),s=c[c.length-1],n&&a.push(n),i=s.precedence,h=r.value=="Math.pow"&&s.value=="Math.pow";c.push(r)}}return a}})(uy);var ly={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.postfixEval=function(e,r){(r=r||{}).PI=Math.PI,r.E=Math.E;for(var n,s,a,i=[],o=r.n!==void 0,c=0;c<e.length;c++)if(e[c].type===1)i.push({value:e[c].value,type:1});else if(e[c].type===3)i.push({value:r[e[c].value],type:1});else if(e[c].type===0){var u=i[i.length-1];Array.isArray(u)?u.push(e[c]):u.value=e[c].value(u.value)}else if(e[c].type===7){var l=i[i.length-1];Array.isArray(l)?l.push(e[c]):l.value=e[c].value(l.value)}else if(e[c].type===8){for(var d=[],h=0;h<e[c].numberOfArguments;h++){var f=i.pop();f&&d.push(f.value)}i.push({type:1,value:e[c].value.apply(e[c],d.reverse())})}else if(e[c].type===10)n=i.pop(),s=i.pop(),Array.isArray(s)?((s=s.concat(n)).push(e[c]),i.push(s)):Array.isArray(n)?(n.unshift(s),n.push(e[c]),i.push(n)):i.push({type:1,value:e[c].value(s.value,n.value)});else if(e[c].type===2||e[c].type===9)n=i.pop(),s=i.pop(),Array.isArray(s)?((s=s.concat(n)).push(e[c]),i.push(s)):Array.isArray(n)?(n.unshift(s),n.push(e[c]),i.push(n)):i.push({type:1,value:e[c].value(s.value,n.value)});else if(e[c].type===12){n=i.pop();var m=void 0;m=!Array.isArray(n)&&n?[n]:n||[],s=i.pop(),a=i.pop(),i.push({type:1,value:e[c].value(a.value,s.value,m)})}else e[c].type===13&&(o?i.push({value:r[e[c].value],type:3}):i.push([e[c]]));if(i.length>1)throw new Error("Uncaught Syntax error");return parseFloat(i[0].value.toFixed(15))}})(ly);var yd={};Object.defineProperty(yd,"__esModule",{value:!0});yd.createMathFunctions=function(t){return{isDegree:!0,acos:function(e){return t.math.isDegree?180/Math.PI*Math.acos(e):Math.acos(e)},add:function(e,r){return e+r},asin:function(e){return t.math.isDegree?180/Math.PI*Math.asin(e):Math.asin(e)},atan:function(e){return t.math.isDegree?180/Math.PI*Math.atan(e):Math.atan(e)},acosh:function(e){return Math.log(e+Math.sqrt(e*e-1))},asinh:function(e){return Math.log(e+Math.sqrt(e*e+1))},atanh:function(e){return Math.log((1+e)/(1-e))},C:function(e,r){var n=1,s=e-r,a=r;a<s&&(a=s,s=r);for(var i=a+1;i<=e;i++)n*=i;var o=t.math.fact(s);return o==="NaN"?"NaN":n/o},changeSign:function(e){return-e},cos:function(e){return t.math.isDegree&&(e=t.math.toRadian(e)),Math.cos(e)},cosh:function(e){return(Math.pow(Math.E,e)+Math.pow(Math.E,-1*e))/2},div:function(e,r){return e/r},fact:function(e){if(e%1!=0)return"NaN";for(var r=1,n=2;n<=e;n++)r*=n;return r},inverse:function(e){return 1/e},log:function(e){return Math.log(e)/Math.log(10)},mod:function(e,r){return e%r},mul:function(e,r){return e*r},P:function(e,r){for(var n=1,s=Math.floor(e)-Math.floor(r)+1;s<=Math.floor(e);s++)n*=s;return n},Pi:function(e,r,n){for(var s=1,a=e;a<=r;a++)s*=Number(t.postfixEval(n,{n:a}));return s},pow10x:function(e){for(var r=1;e--;)r*=10;return r},sigma:function(e,r,n){for(var s=0,a=e;a<=r;a++)s+=Number(t.postfixEval(n,{n:a}));return s},sin:function(e){return t.math.isDegree&&(e=t.math.toRadian(e)),Math.sin(e)},sinh:function(e){return(Math.pow(Math.E,e)-Math.pow(Math.E,-1*e))/2},sub:function(e,r){return e-r},tan:function(e){return t.math.isDegree&&(e=t.math.toRadian(e)),Math.tan(e)},tanh:function(e){return t.math.sinh(e)/t.math.cosh(e)},toRadian:function(e){return e*Math.PI/180},and:function(e,r){return e&r}}};var dp=Ji,qu=_d,w$=uy,E$=ly,T$=yd,Jc=function(){function t(){this.toPostfix=w$.toPostfix,this.addToken=dp.addToken,this.lex=dp.lex,this.postfixEval=E$.postfixEval,this.math=T$.createMathFunctions(this),this.tokens=qu.createTokens(this)}return t.prototype.eval=function(e,r,n){return this.postfixEval(this.toPostfix(this.lex(e,r)),n)},t}();Jc.TOKEN_TYPES=qu.tokenTypes,Jc.tokenTypes=qu.tokenTypes,cy.exports=Jc;var S$=cy.exports;const x$=ml(S$);var I$={};om(I$,{Calculator:()=>dy});const A$=new x$;var dy=class extends Lo{constructor(){super(...arguments);E(this,"name","calculator");E(this,"description","Useful for getting the result of a math expression. The input to this tool should be a valid mathematical expression that could be executed by a simple calculator.")}static lc_name(){return"Calculator"}get lc_namespace(){return[...super.lc_namespace,"calculator"]}async _call(e){try{return A$.eval(e).toString()}catch{return"I don't know how to do that."}}};const k$=Lr({expression:Kt().describe('The mathematical expression to evaluate (e.g., "2 + 2", "sqrt(16)", "sin(45)")')});class O$ extends zn{constructor(){super(...arguments);E(this,"name","calculator");E(this,"displayName","Calculator");E(this,"description","Evaluate mathematical expressions. Supports basic arithmetic, trigonometry, logarithms, and more.");E(this,"kind",Cr.Other);E(this,"parameterSchema",k$);E(this,"requiresConfirmation",!1);E(this,"calculator",new dy)}getDescription(r){return`Calculate: ${r.expression}`}async execute(r){try{const n=await this.calculator.invoke(r.expression);return Un(`The result of "${r.expression}" is: ${n}`,` ${r.expression} = ${n}`)}catch(n){const s=n instanceof Error?n.message:String(n);return ze(`Calculation failed: ${s}`)}}}const C$=Lr({command:Kt().describe("The shell command to execute"),cwd:Kt().optional().describe("Working directory for the command"),timeout:oa().optional().describe("Command timeout in milliseconds (default: 60000)")});class N$ extends zn{constructor(){super(...arguments);E(this,"name","run_command");E(this,"displayName","Run Command");E(this,"description","Execute a shell command on the system. Use this to run scripts, install packages, build projects, or perform system operations. Commands that modify files or system state require user confirmation.");E(this,"kind",Cr.Execute);E(this,"parameterSchema",C$);E(this,"requiresConfirmation",!0);E(this,"canStreamOutput",!0)}getDescription(r){return`Execute command${r.cwd?` in ${r.cwd}`:""}: ${r.command}`}getConfirmationDetails(r){return{type:"exec",title:"Execute Shell Command",description:`Command: ${r.command}${r.cwd?`
Working Directory: ${r.cwd}`:""}`,impact:"This command will be executed on your system. Please review carefully before confirming."}}async execute(r,n,s){return new Promise(a=>{const i=process.platform==="win32"?"cmd.exe":"/bin/sh",o=process.platform==="win32"?"/c":"-c",c=Ev.spawn(i,[o,r.command],{cwd:r.cwd||process.cwd(),env:{...process.env},shell:!1});let u="",l="",d=!1;const h=setTimeout(()=>{d=!0,c.kill("SIGTERM")},r.timeout||6e4),f=()=>{d=!0,c.kill("SIGTERM")};n.addEventListener("abort",f),c.stdout.on("data",m=>{const _=m.toString();u+=_,s==null||s(_)}),c.stderr.on("data",m=>{const _=m.toString();l+=_,s==null||s(_)}),c.on("close",m=>{if(clearTimeout(h),n.removeEventListener("abort",f),d){n.aborted?a(ze("Command was cancelled",gt.CANCELLED)):a(ze("Command timed out",gt.TIMEOUT));return}const _=u+(l?`
[stderr]
${l}`:"");a(m===0?Un(_||"Command completed successfully with no output."," Command exited with code 0"):ze(`Command exited with code ${m}
${_}`,gt.EXECUTION_FAILED))}),c.on("error",m=>{clearTimeout(h),n.removeEventListener("abort",f),a(ze(`Failed to execute command: ${m.message}`))})})}}const $$=Lr({path:Kt().describe("Absolute path to the file to read"),startLine:oa().optional().describe("Starting line number (1-indexed, inclusive)"),endLine:oa().optional().describe("Ending line number (1-indexed, inclusive)")});class R$ extends zn{constructor(){super(...arguments);E(this,"name","read_file");E(this,"displayName","Read File");E(this,"description","Read the contents of a file. Can read specific line ranges to handle large files efficiently.");E(this,"kind",Cr.Read);E(this,"parameterSchema",$$);E(this,"requiresConfirmation",!1)}validateValues(r){return Bt.isAbsolute(r.path)?r.startLine!==void 0&&r.startLine<1?"startLine must be at least 1":r.endLine!==void 0&&r.endLine<1?"endLine must be at least 1":r.startLine!==void 0&&r.endLine!==void 0&&r.startLine>r.endLine?"startLine must be less than or equal to endLine":null:"Path must be an absolute path"}getDescription(r){const n=r.startLine&&r.endLine?` (lines ${r.startLine}-${r.endLine})`:"";return`Read file: ${r.path}${n}`}async execute(r,n){if(n.aborted)return ze("Read cancelled",gt.CANCELLED);try{if(!(await Jt.stat(r.path)).isFile())return ze(`Path is not a file: ${r.path}`,gt.INVALID_PARAMS);const i=(await Jt.readFile(r.path,"utf-8")).split(`
`),o=i.length;let c=i,u="";if(r.startLine||r.endLine){const h=(r.startLine||1)-1,f=r.endLine||o;c=i.slice(h,f),u=` (lines ${h+1}-${Math.min(f,o)} of ${o})`}const l=c.join(`
`),d=Bt.basename(r.path);return Un(`File: ${r.path}${u}
Total lines: ${o}

\`\`\`
${l}
\`\`\``,` ${d}${u}`)}catch(s){if(s.code==="ENOENT")return ze(`File not found: ${r.path}`,gt.FILE_NOT_FOUND);if(s.code==="EACCES")return ze(`Permission denied: ${r.path}`,gt.PERMISSION_DENIED);const a=s instanceof Error?s.message:String(s);return ze(`Failed to read file: ${a}`)}}}const P$=Lr({path:Kt().describe("Absolute path to the file to write"),content:Kt().describe("The content to write to the file"),overwrite:gu().optional().describe("Whether to overwrite existing file (default: false)"),createDirectories:gu().optional().describe("Create parent directories if needed (default: true)")});class L$ extends zn{constructor(){super(...arguments);E(this,"name","write_file");E(this,"displayName","Write File");E(this,"description","Write content to a file. Creates the file if it does not exist. Use this to create new files or replace entire file contents.");E(this,"kind",Cr.Edit);E(this,"parameterSchema",P$);E(this,"requiresConfirmation",!0)}validateValues(r){return Bt.isAbsolute(r.path)?null:"Path must be an absolute path"}getDescription(r){return`${r.overwrite?"Overwrite":"Create"} file: ${r.path} (${r.content.length} characters)`}getConfirmationDetails(r){const n=Bt.basename(r.path),s=r.content.length>200?r.content.substring(0,200)+"...":r.content;return{type:"edit",title:r.overwrite?"Overwrite File":"Create File",description:`File: ${n}
Path: ${r.path}

Content Preview:
${s}`,impact:r.overwrite?"This will overwrite the existing file content.":"This will create a new file."}}async execute(r,n){if(n.aborted)return ze("Write cancelled",gt.CANCELLED);try{let s=!1;try{await Jt.access(r.path),s=!0}catch{s=!1}if(s&&!r.overwrite)return ze(`File already exists: ${r.path}. Set overwrite=true to replace it.`,gt.INVALID_PARAMS);r.createDirectories&&await Jt.mkdir(Bt.dirname(r.path),{recursive:!0}),await Jt.writeFile(r.path,r.content,"utf-8");const a=Bt.basename(r.path),i=s?"Updated":"Created";return Un(`${i} file: ${r.path}
Written ${r.content.length} characters.`,` ${i} ${a}`)}catch(s){if(s.code==="EACCES")return ze(`Permission denied: ${r.path}`,gt.PERMISSION_DENIED);const a=s instanceof Error?s.message:String(s);return ze(`Failed to write file: ${a}`)}}}const D$=Lr({path:Kt().describe("Absolute path to the directory to list"),recursive:gu().optional().describe("Whether to list subdirectories recursively (default: false)"),maxDepth:oa().optional().describe("Maximum depth for recursive listing (default: 3)")});class M$ extends zn{constructor(){super(...arguments);E(this,"name","list_dir");E(this,"displayName","List Directory");E(this,"description","List the contents of a directory, showing files and subdirectories with their sizes.");E(this,"kind",Cr.Read);E(this,"parameterSchema",D$);E(this,"requiresConfirmation",!1)}validateValues(r){return Bt.isAbsolute(r.path)?null:"Path must be an absolute path"}getDescription(r){return`List directory: ${r.path}`}async execute(r,n){if(n.aborted)return ze("List cancelled",gt.CANCELLED);try{if(!(await Jt.stat(r.path)).isDirectory())return ze(`Path is not a directory: ${r.path}`,gt.INVALID_PARAMS);const a=await this.listDirectory(r.path),i=this.formatEntries(a);return Un(`Directory: ${r.path}

${i}`,` Listed ${a.length} items`)}catch(s){if(s.code==="ENOENT")return ze(`Directory not found: ${r.path}`,gt.FILE_NOT_FOUND);if(s.code==="EACCES")return ze(`Permission denied: ${r.path}`,gt.PERMISSION_DENIED);const a=s instanceof Error?s.message:String(s);return ze(`Failed to list directory: ${a}`)}}async listDirectory(r){const n=[],s=await Jt.readdir(r,{withFileTypes:!0});for(const a of s){if(a.name.startsWith(".")||a.name==="node_modules")continue;const i=Bt.join(r,a.name),o={name:a.name,isDirectory:a.isDirectory()};if(a.isDirectory())try{const c=await Jt.readdir(i);o.children=c.length}catch{o.children=0}else try{const c=await Jt.stat(i);o.size=c.size}catch{}n.push(o)}return n.sort((a,i)=>a.isDirectory!==i.isDirectory?a.isDirectory?-1:1:a.name.localeCompare(i.name)),n}formatEntries(r){return r.length===0?"(empty directory)":r.map(n=>{if(n.isDirectory)return` ${n.name}/ (${n.children} items)`;{const s=n.size!==void 0?this.formatSize(n.size):"";return` ${n.name} ${s}`}}).join(`
`)}formatSize(r){return r<1024?`(${r} B)`:r<1024*1024?`(${(r/1024).toFixed(1)} KB)`:`(${(r/1024/1024).toFixed(1)} MB)`}}function j$(){return[new _$,new O$,new N$,new R$,new L$,new M$]}function ai(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,t}function ye(t,e,r,n,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}function R(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}let fy=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return fy=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),r=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^r()&15>>+n/4).toString(16))};function Zu(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const Gu=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};class me extends Error{}class pt extends me{constructor(e,r,n,s){super(`${pt.makeMessage(e,r,n)}`),this.status=e,this.headers=s,this.requestID=s==null?void 0:s.get("x-request-id"),this.error=r;const a=r;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,r,n){const s=r!=null&&r.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,r,n,s){if(!e||!s)return new Ko({message:n,cause:Gu(r)});const a=r==null?void 0:r.error;return e===400?new hy(e,a,n,s):e===401?new py(e,a,n,s):e===403?new my(e,a,n,s):e===404?new gy(e,a,n,s):e===409?new _y(e,a,n,s):e===422?new yy(e,a,n,s):e===429?new vy(e,a,n,s):e>=500?new by(e,a,n,s):new pt(e,a,n,s)}}class zt extends pt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ko extends pt{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),r&&(this.cause=r)}}class Xo extends Ko{constructor({message:e}={}){super({message:e??"Request timed out."})}}class hy extends pt{}class py extends pt{}class my extends pt{}class gy extends pt{}class _y extends pt{}class yy extends pt{}class vy extends pt{}class by extends pt{}class wy extends me{constructor(){super("Could not parse response content as the length limit was reached")}}class Ey extends me{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Ls extends Error{constructor(e){super(e)}}const F$=/^[a-z][a-z0-9+.-]*:/i,U$=t=>F$.test(t);let $t=t=>($t=Array.isArray,$t(t)),fp=$t;function Ty(t){return typeof t!="object"?{}:t??{}}function B$(t){if(!t)return!0;for(const e in t)return!1;return!0}function z$(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Kc(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}const q$=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new me(`${t} must be an integer`);if(e<0)throw new me(`${t} must be a positive integer`);return e},Z$=t=>{try{return JSON.parse(t)}catch{return}},Ra=t=>new Promise(e=>setTimeout(e,t)),es="6.16.0",G$=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function V$(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const H$=()=>{var r;const t=V$();if(t==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":pp(Deno.build.os),"X-Stainless-Arch":hp(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((r=Deno.version)==null?void 0:r.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(t==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":pp(globalThis.process.platform??"unknown"),"X-Stainless-Arch":hp(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=W$();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":es,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function W$(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:r}of t){const n=r.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const hp=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",pp=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let mp;const J$=()=>mp??(mp=H$());function K$(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Sy(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function xy(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return Sy({start(){},async pull(r){const{done:n,value:s}=await e.next();n?r.close():r.enqueue(s)},async cancel(){var r;await((r=e.return)==null?void 0:r.call(e))}})}function Iy(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const r=await e.read();return r!=null&&r.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){const r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function X$(t){var n,s;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((s=(n=t[Symbol.asyncIterator]()).return)==null?void 0:s.call(n));return}const e=t.getReader(),r=e.cancel();e.releaseLock(),await r}const Y$=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Ay="RFC3986",ky=t=>String(t),gp={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:ky},Q$="RFC1738";let Vu=(t,e)=>(Vu=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Vu(t,e));const Er=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),Xc=1024,e4=(t,e,r,n,s)=>{if(t.length===0)return t;let a=t;if(typeof t=="symbol"?a=Symbol.prototype.toString.call(t):typeof t!="string"&&(a=String(t)),r==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=Xc){const c=a.length>=Xc?a.slice(o,o+Xc):a,u=[];for(let l=0;l<c.length;++l){let d=c.charCodeAt(l);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===Q$&&(d===40||d===41)){u[u.length]=c.charAt(l);continue}if(d<128){u[u.length]=Er[d];continue}if(d<2048){u[u.length]=Er[192|d>>6]+Er[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=Er[224|d>>12]+Er[128|d>>6&63]+Er[128|d&63];continue}l+=1,d=65536+((d&1023)<<10|c.charCodeAt(l)&1023),u[u.length]=Er[240|d>>18]+Er[128|d>>12&63]+Er[128|d>>6&63]+Er[128|d&63]}i+=u.join("")}return i};function t4(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function _p(t,e){if($t(t)){const r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}const Oy={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Cy=function(t,e){Array.prototype.push.apply(t,$t(e)?e:[e])};let yp;const st={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e4,encodeValuesOnly:!1,format:Ay,formatter:ky,indices:!1,serializeDate(t){return(yp??(yp=Function.prototype.call.bind(Date.prototype.toISOString)))(t)},skipNulls:!1,strictNullHandling:!1};function r4(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const Yc={};function Ny(t,e,r,n,s,a,i,o,c,u,l,d,h,f,m,_,y,w){let g=t,b=w,T=0,I=!1;for(;(b=b.get(Yc))!==void 0&&!I;){const H=b.get(t);if(T+=1,typeof H<"u"){if(H===T)throw new RangeError("Cyclic object value");I=!0}typeof b.get(Yc)>"u"&&(T=0)}if(typeof u=="function"?g=u(e,g):g instanceof Date?g=h==null?void 0:h(g):r==="comma"&&$t(g)&&(g=_p(g,function(H){return H instanceof Date?h==null?void 0:h(H):H})),g===null){if(a)return c&&!_?c(e,st.encoder,y,"key",f):e;g=""}if(r4(g)||t4(g)){if(c){const H=_?e:c(e,st.encoder,y,"key",f);return[(m==null?void 0:m(H))+"="+(m==null?void 0:m(c(g,st.encoder,y,"value",f)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(g)))]}const C=[];if(typeof g>"u")return C;let D;if(r==="comma"&&$t(g))_&&c&&(g=_p(g,c)),D=[{value:g.length>0?g.join(",")||null:void 0}];else if($t(u))D=u;else{const H=Object.keys(g);D=l?H.sort(l):H}const k=o?String(e).replace(/\./g,"%2E"):String(e),A=n&&$t(g)&&g.length===1?k+"[]":k;if(s&&$t(g)&&g.length===0)return A+"[]";for(let H=0;H<D.length;++H){const q=D[H],pe=typeof q=="object"&&typeof q.value<"u"?q.value:g[q];if(i&&pe===null)continue;const Q=d&&o?q.replace(/\./g,"%2E"):q,N=$t(g)?typeof r=="function"?r(A,Q):A:A+(d?"."+Q:"["+Q+"]");w.set(t,T);const P=new WeakMap;P.set(Yc,w),Cy(C,Ny(pe,N,r,n,s,a,i,o,r==="comma"&&_&&$t(g)?null:c,u,l,d,h,f,m,_,y,P))}return C}function n4(t=st){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||st.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=Ay;if(typeof t.format<"u"){if(!Vu(gp,t.format))throw new TypeError("Unknown format option provided.");r=t.format}const n=gp[r];let s=st.filter;(typeof t.filter=="function"||$t(t.filter))&&(s=t.filter);let a;if(t.arrayFormat&&t.arrayFormat in Oy?a=t.arrayFormat:"indices"in t?a=t.indices?"indices":"repeat":a=st.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:st.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:st.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:st.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:st.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?st.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:st.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:st.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:st.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:st.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:st.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:st.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:st.strictNullHandling}}function s4(t,e={}){let r=t;const n=n4(e);let s,a;typeof n.filter=="function"?(a=n.filter,r=a("",r)):$t(n.filter)&&(a=n.filter,s=a);const i=[];if(typeof r!="object"||r===null)return"";const o=Oy[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);const u=new WeakMap;for(let h=0;h<s.length;++h){const f=s[h];n.skipNulls&&r[f]===null||Cy(i,Ny(r[f],f,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}const l=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),l.length>0?d+l:""}function a4(t){let e=0;for(const s of t)e+=s.length;const r=new Uint8Array(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return r}let vp;function vd(t){let e;return(vp??(e=new globalThis.TextEncoder,vp=e.encode.bind(e)))(t)}let bp;function wp(t){let e;return(bp??(e=new globalThis.TextDecoder,bp=e.decode.bind(e)))(t)}var Mt,jt;class Yo{constructor(){Mt.set(this,void 0),jt.set(this,void 0),ye(this,Mt,new Uint8Array),ye(this,jt,null)}decode(e){if(e==null)return[];const r=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?vd(e):e;ye(this,Mt,a4([R(this,Mt,"f"),r]));const n=[];let s;for(;(s=i4(R(this,Mt,"f"),R(this,jt,"f")))!=null;){if(s.carriage&&R(this,jt,"f")==null){ye(this,jt,s.index);continue}if(R(this,jt,"f")!=null&&(s.index!==R(this,jt,"f")+1||s.carriage)){n.push(wp(R(this,Mt,"f").subarray(0,R(this,jt,"f")-1))),ye(this,Mt,R(this,Mt,"f").subarray(R(this,jt,"f"))),ye(this,jt,null);continue}const a=R(this,jt,"f")!==null?s.preceding-1:s.preceding,i=wp(R(this,Mt,"f").subarray(0,a));n.push(i),ye(this,Mt,R(this,Mt,"f").subarray(s.index)),ye(this,jt,null)}return n}flush(){return R(this,Mt,"f").length?this.decode(`
`):[]}}Mt=new WeakMap,jt=new WeakMap;Yo.NEWLINE_CHARS=new Set([`
`,"\r"]);Yo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function i4(t,e){for(let s=e??0;s<t.length;s++){if(t[s]===10)return{preceding:s,index:s+1,carriage:!1};if(t[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function o4(t){for(let n=0;n<t.length-1;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}const Ki={off:0,error:200,warn:300,info:400,debug:500},Ep=(t,e,r)=>{if(t){if(z$(Ki,t))return t;ft(r).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(Ki))}`)}};function Ds(){}function ii(t,e,r){return!e||Ki[t]>Ki[r]?Ds:e[t].bind(e)}const c4={error:Ds,warn:Ds,info:Ds,debug:Ds};let Tp=new WeakMap;function ft(t){const e=t.logger,r=t.logLevel??"off";if(!e)return c4;const n=Tp.get(e);if(n&&n[0]===r)return n[1];const s={error:ii("error",e,r),warn:ii("warn",e,r),info:ii("info",e,r),debug:ii("debug",e,r)};return Tp.set(e,[r,s]),s}const Sn=t=>(t.options&&(t.options={...t.options},delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,r])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":r]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);var As;class kr{constructor(e,r,n){this.iterator=e,As.set(this,void 0),this.controller=r,ye(this,As,n)}static fromSSEResponse(e,r,n){let s=!1;const a=n?ft(n):console;async function*i(){if(s)throw new me("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const c of u4(e,r))if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let u;try{u=JSON.parse(c.data)}catch(l){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),l}if(u&&u.error)throw new pt(void 0,u.error,void 0,e.headers);yield u}else{let u;try{u=JSON.parse(c.data)}catch(l){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),l}if(c.event=="error")throw new pt(void 0,u.error,u.message,void 0);yield{event:c.event,data:u}}}o=!0}catch(c){if(Zu(c))return;throw c}finally{o||r.abort()}}return new kr(i,r,n)}static fromReadableStream(e,r,n){let s=!1;async function*a(){const o=new Yo,c=Iy(e);for await(const u of c)for(const l of o.decode(u))yield l;for(const u of o.flush())yield u}async function*i(){if(s)throw new me("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const c of a())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(Zu(c))return;throw c}finally{o||r.abort()}}return new kr(i,r,n)}[(As=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],r=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),r.push(i)}return a.shift()}});return[new kr(()=>s(e),this.controller,R(this,As,"f")),new kr(()=>s(r),this.controller,R(this,As,"f"))]}toReadableStream(){const e=this;let r;return Sy({async start(){r=e[Symbol.asyncIterator]()},async pull(n){try{const{value:s,done:a}=await r.next();if(a)return n.close();const i=vd(JSON.stringify(s)+`
`);n.enqueue(i)}catch(s){n.error(s)}},async cancel(){var n;await((n=r.return)==null?void 0:n.call(r))}})}}async function*u4(t,e){if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new me("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new me("Attempted to iterate over a response with no body");const r=new d4,n=new Yo,s=Iy(t.body);for await(const a of l4(s))for(const i of n.decode(a)){const o=r.decode(i);o&&(yield o)}for(const a of n.flush()){const i=r.decode(a);i&&(yield i)}}async function*l4(t){let e=new Uint8Array;for await(const r of t){if(r==null)continue;const n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?vd(r):r;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=o4(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class d4{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,s]=f4(e,":");return s.startsWith(" ")&&(s=s.substring(1)),r==="event"?this.event=s:r==="data"&&this.data.push(s),null}}function f4(t,e){const r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}async function $y(t,e){const{response:r,requestLogID:n,retryOfRequestLogID:s,startTime:a}=e,i=await(async()=>{var d;if(e.options.stream)return ft(t).debug("response",r.status,r.url,r.headers,r.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(r,e.controller,t):kr.fromSSEResponse(r,e.controller,t);if(r.status===204)return null;if(e.options.__binaryResponse)return r;const o=r.headers.get("content-type"),c=(d=o==null?void 0:o.split(";")[0])==null?void 0:d.trim();if((c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))){const h=await r.json();return Ry(h,r)}return await r.text()})();return ft(t).debug(`[${n}] response parsed`,Sn({retryOfRequestLogID:s,url:r.url,status:r.status,body:i,durationMs:Date.now()-a})),i}function Ry(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Ms;class Qo extends Promise{constructor(e,r,n=$y){super(s=>{s(null)}),this.responsePromise=r,this.parseResponse=n,Ms.set(this,void 0),ye(this,Ms,e)}_thenUnwrap(e){return new Qo(R(this,Ms,"f"),this.responsePromise,async(r,n)=>Ry(e(await this.parseResponse(r,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(R(this,Ms,"f"),e))),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Ms=new WeakMap;var oi;class bd{constructor(e,r,n,s){oi.set(this,void 0),ye(this,oi,e),this.options=s,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new me("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await R(this,oi,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(oi=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}class h4 extends Qo{constructor(e,r,n){super(e,r,async(s,a)=>new n(s,a.response,await $y(s,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const r of e)yield r}}class ec extends bd{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class et extends bd{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var n;const e=this.getPaginatedItems(),r=(n=e[e.length-1])==null?void 0:n.id;return r?{...this.options,query:{...Ty(this.options.query),after:r}}:null}}class Xi extends bd{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...Ty(this.options.query),after:e}}:null}}const Py=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,r=typeof((t=e==null?void 0:e.versions)==null?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(r?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Qs(t,e,r){return Py(),new File(t,e??"unknown_file",r)}function _i(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const wd=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Sp=async(t,e)=>Hu(t.body)?{...t,body:await Ly(t.body,e)}:t,Bn=async(t,e)=>({...t,body:await Ly(t.body,e)}),xp=new WeakMap;function p4(t){const e=typeof t=="function"?t:t.fetch,r=xp.get(e);if(r)return r;const n=(async()=>{try{const s="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new s(a).text()}catch{return!0}})();return xp.set(e,n),n}const Ly=async(t,e)=>{if(!await p4(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const r=new FormData;return await Promise.all(Object.entries(t||{}).map(([n,s])=>Wu(r,n,s))),r},Dy=t=>t instanceof Blob&&"name"in t,m4=t=>typeof t=="object"&&t!==null&&(t instanceof Response||wd(t)||Dy(t)),Hu=t=>{if(m4(t))return!0;if(Array.isArray(t))return t.some(Hu);if(t&&typeof t=="object"){for(const e in t)if(Hu(t[e]))return!0}return!1},Wu=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(r instanceof Response)t.append(e,Qs([await r.blob()],_i(r)));else if(wd(r))t.append(e,Qs([await new Response(xy(r)).blob()],_i(r)));else if(Dy(r))t.append(e,r,_i(r));else if(Array.isArray(r))await Promise.all(r.map(n=>Wu(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,s])=>Wu(t,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},My=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",g4=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&My(t),_4=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function y4(t,e,r){if(Py(),t=await t,g4(t))return t instanceof File?t:Qs([await t.arrayBuffer()],t.name);if(_4(t)){const s=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Qs(await Ju(s),e,r)}const n=await Ju(t);if(e||(e=_i(t)),!(r!=null&&r.type)){const s=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof s=="string"&&(r={...r,type:s})}return Qs(n,e,r)}async function Ju(t){var r;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(My(t))e.push(t instanceof Blob?t:await t.arrayBuffer());else if(wd(t))for await(const n of t)e.push(...await Ju(n));else{const n=(r=t==null?void 0:t.constructor)==null?void 0:r.name;throw new Error(`Unexpected data type: ${typeof t}${n?`; constructor: ${n}`:""}${v4(t)}`)}return e}function v4(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}class he{constructor(e){this._client=e}}function jy(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Ip=Object.freeze(Object.create(null)),b4=(t=jy)=>function(r,...n){if(r.length===1)return r[0];let s=!1;const a=[],i=r.reduce((l,d,h)=>{var _;/[?#]/.test(d)&&(s=!0);const f=n[h];let m=(s?encodeURIComponent:t)(""+f);return h!==n.length&&(f==null||typeof f=="object"&&f.toString===((_=Object.getPrototypeOf(Object.getPrototypeOf(f.hasOwnProperty??Ip)??Ip))==null?void 0:_.toString))&&(m=f+"",a.push({start:l.length+d.length,length:m.length,error:`Value of type ${Object.prototype.toString.call(f).slice(8,-1)} is not a valid path parameter`})),l+d+(h===n.length?"":m)},""),o=i.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let u;for(;(u=c.exec(o))!==null;)a.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(a.sort((l,d)=>l.start-d.start),a.length>0){let l=0;const d=a.reduce((h,f)=>{const m=" ".repeat(f.start-l),_="^".repeat(f.length);return l=f.start+f.length,h+m+_},"");throw new me(`Path parameters result in path with invalid segments:
${a.map(h=>h.error).join(`
`)}
${i}
${d}`)}return i},B=b4(jy);let Fy=class extends he{list(e,r={},n){return this._client.getAPIList(B`/chat/completions/${e}/messages`,et,{query:r,...n})}};function Yi(t){return t!==void 0&&"function"in t&&t.function!==void 0}function w4(t,e){const r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),r}function Ed(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Pa(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function E4(t,e){return!e||!Uy(e)?{...t,choices:t.choices.map(r=>(By(r.message.tool_calls),{...r,message:{...r.message,parsed:null,...r.message.tool_calls?{tool_calls:r.message.tool_calls}:void 0}}))}:Td(t,e)}function Td(t,e){const r=t.choices.map(n=>{var s;if(n.finish_reason==="length")throw new wy;if(n.finish_reason==="content_filter")throw new Ey;return By(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(a=>S4(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?T4(e,n.message.content):null}}});return{...t,choices:r}}function T4(t,e){var r,n;return((r=t.response_format)==null?void 0:r.type)!=="json_schema"?null:((n=t.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function S4(t,e){var n;const r=(n=t.tools)==null?void 0:n.find(s=>{var a;return Yi(s)&&((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Pa(r)?r.$parseRaw(e.function.arguments):r!=null&&r.function.strict?JSON.parse(e.function.arguments):null}}}function x4(t,e){var n;if(!t||!("tools"in t)||!t.tools)return!1;const r=(n=t.tools)==null?void 0:n.find(s=>{var a;return Yi(s)&&((a=s.function)==null?void 0:a.name)===e.function.name});return Yi(r)&&(Pa(r)||(r==null?void 0:r.function.strict)||!1)}function Uy(t){var e;return Ed(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(r=>Pa(r)||r.type==="function"&&r.function.strict===!0))??!1}function By(t){for(const e of t||[])if(e.type!=="function")throw new me(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function I4(t){for(const e of t??[]){if(e.type!=="function")throw new me(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new me(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Qi=t=>(t==null?void 0:t.role)==="assistant",zy=t=>(t==null?void 0:t.role)==="tool";var Ku,yi,vi,js,Fs,bi,Us,Br,Bs,eo,to,ts,qy;class Sd{constructor(){Ku.add(this),this.controller=new AbortController,yi.set(this,void 0),vi.set(this,()=>{}),js.set(this,()=>{}),Fs.set(this,void 0),bi.set(this,()=>{}),Us.set(this,()=>{}),Br.set(this,{}),Bs.set(this,!1),eo.set(this,!1),to.set(this,!1),ts.set(this,!1),ye(this,yi,new Promise((e,r)=>{ye(this,vi,e,"f"),ye(this,js,r,"f")})),ye(this,Fs,new Promise((e,r)=>{ye(this,bi,e,"f"),ye(this,Us,r,"f")})),R(this,yi,"f").catch(()=>{}),R(this,Fs,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},R(this,Ku,"m",qy).bind(this))},0)}_connected(){this.ended||(R(this,vi,"f").call(this),this._emit("connect"))}get ended(){return R(this,Bs,"f")}get errored(){return R(this,eo,"f")}get aborted(){return R(this,to,"f")}abort(){this.controller.abort()}on(e,r){return(R(this,Br,"f")[e]||(R(this,Br,"f")[e]=[])).push({listener:r}),this}off(e,r){const n=R(this,Br,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===r);return s>=0&&n.splice(s,1),this}once(e,r){return(R(this,Br,"f")[e]||(R(this,Br,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{ye(this,ts,!0),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){ye(this,ts,!0),await R(this,Fs,"f")}_emit(e,...r){if(R(this,Bs,"f"))return;e==="end"&&(ye(this,Bs,!0),R(this,bi,"f").call(this));const n=R(this,Br,"f")[e];if(n&&(R(this,Br,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...r))),e==="abort"){const s=r[0];!R(this,ts,"f")&&!(n!=null&&n.length)&&Promise.reject(s),R(this,js,"f").call(this,s),R(this,Us,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=r[0];!R(this,ts,"f")&&!(n!=null&&n.length)&&Promise.reject(s),R(this,js,"f").call(this,s),R(this,Us,"f").call(this,s),this._emit("end")}}_emitFinal(){}}yi=new WeakMap,vi=new WeakMap,js=new WeakMap,Fs=new WeakMap,bi=new WeakMap,Us=new WeakMap,Br=new WeakMap,Bs=new WeakMap,eo=new WeakMap,to=new WeakMap,ts=new WeakMap,Ku=new WeakSet,qy=function(e){if(ye(this,eo,!0),e instanceof Error&&e.name==="AbortError"&&(e=new zt),e instanceof zt)return ye(this,to,!0),this._emit("abort",e);if(e instanceof me)return this._emit("error",e);if(e instanceof Error){const r=new me(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new me(String(e)))};function A4(t){return typeof t.parse=="function"}var St,Xu,ro,Yu,Qu,el,Zy,Gy;const k4=10;class Vy extends Sd{constructor(){super(...arguments),St.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const r=(n=e.choices[0])==null?void 0:n.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),zy(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Qi(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new me("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),R(this,St,"m",Xu).call(this)}async finalMessage(){return await this.done(),R(this,St,"m",ro).call(this)}async finalFunctionToolCall(){return await this.done(),R(this,St,"m",Yu).call(this)}async finalFunctionToolCallResult(){return await this.done(),R(this,St,"m",Qu).call(this)}async totalUsage(){return await this.done(),R(this,St,"m",el).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const r=R(this,St,"m",ro).call(this);r&&this._emit("finalMessage",r);const n=R(this,St,"m",Xu).call(this);n&&this._emit("finalContent",n);const s=R(this,St,"m",Yu).call(this);s&&this._emit("finalFunctionToolCall",s);const a=R(this,St,"m",Qu).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",R(this,St,"m",el).call(this))}async _createChatCompletion(e,r,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),R(this,St,"m",Zy).call(this,r);const a=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Td(a,r))}async _runChatCompletion(e,r,n){for(const s of r.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,r,n)}async _runTools(e,r,n){var f,m,_;const s="tool",{tool_choice:a="auto",stream:i,...o}=r,c=typeof a!="string"&&a.type==="function"&&((f=a==null?void 0:a.function)==null?void 0:f.name),{maxChatCompletions:u=k4}=n||{},l=r.tools.map(y=>{if(Pa(y)){if(!y.$callback)throw new me("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),d={};for(const y of l)y.type==="function"&&(d[y.function.name||y.function.function.name]=y.function);const h="tools"in r?l.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of r.messages)this._addMessage(y,!1);for(let y=0;y<u;++y){const g=(m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:m.message;if(!g)throw new me("missing message in ChatCompletion response");if(!((_=g.tool_calls)!=null&&_.length))return;for(const b of g.tool_calls){if(b.type!=="function")continue;const T=b.id,{name:I,arguments:C}=b.function,D=d[I];if(D){if(c&&c!==I){const q=`Invalid tool_call: ${JSON.stringify(I)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:T,content:q});continue}}else{const q=`Invalid tool_call: ${JSON.stringify(I)}. Available options are: ${Object.keys(d).map(pe=>JSON.stringify(pe)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:T,content:q});continue}let k;try{k=A4(D)?await D.parse(C):C}catch(q){const pe=q instanceof Error?q.message:String(q);this._addMessage({role:s,tool_call_id:T,content:pe});continue}const A=await D.function(k,this),H=R(this,St,"m",Gy).call(this,A);if(this._addMessage({role:s,tool_call_id:T,content:H}),c)return}}}}St=new WeakSet,Xu=function(){return R(this,St,"m",ro).call(this).content??null},ro=function(){let e=this.messages.length;for(;e-- >0;){const r=this.messages[e];if(Qi(r))return{...r,content:r.content??null,refusal:r.refusal??null}}throw new me("stream ended without producing a ChatCompletionMessage with role=assistant")},Yu=function(){var e,r;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(Qi(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(r=s.tool_calls.filter(a=>a.type==="function").at(-1))==null?void 0:r.function}},Qu=function(){for(let e=this.messages.length-1;e>=0;e--){const r=this.messages[e];if(zy(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===r.tool_call_id))}))return r.content}},el=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},Zy=function(e){if(e.n!=null&&e.n>1)throw new me("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Gy=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class xd extends Vy{static runTools(e,r,n){const s=new xd,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,a)),s}_addMessage(e,r=!0){super._addMessage(e,r),Qi(e)&&e.content&&this._emit("content",e.content)}}const Hy=1,Wy=2,Jy=4,Ky=8,Xy=16,Yy=32,Qy=64,e0=128,t0=256,r0=e0|t0,n0=Xy|Yy|r0|Qy,s0=Hy|Wy|n0,a0=Jy|Ky,O4=s0|a0,ct={STR:Hy,NUM:Wy,ARR:Jy,OBJ:Ky,NULL:Xy,BOOL:Yy,NAN:Qy,INFINITY:e0,MINUS_INFINITY:t0,INF:r0,SPECIAL:n0,ATOM:s0,COLLECTION:a0,ALL:O4};class C4 extends Error{}class N4 extends Error{}function $4(t,e=ct.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return R4(t.trim(),e)}const R4=(t,e)=>{const r=t.length;let n=0;const s=h=>{throw new C4(`${h} at position ${n}`)},a=h=>{throw new N4(`${h} at position ${n}`)},i=()=>(d(),n>=r&&s("Unexpected end of input"),t[n]==='"'?o():t[n]==="{"?c():t[n]==="["?u():t.substring(n,n+4)==="null"||ct.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||ct.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||ct.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||ct.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||ct.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||ct.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):l()),o=()=>{const h=n;let f=!1;for(n++;n<r&&(t[n]!=='"'||f&&t[n-1]==="\\");)f=t[n]==="\\"?!f:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(h,++n-Number(f)))}catch(m){a(String(m))}else if(ct.STR&e)try{return JSON.parse(t.substring(h,n-Number(f))+'"')}catch{return JSON.parse(t.substring(h,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{n++,d();const h={};try{for(;t[n]!=="}";){if(d(),n>=r&&ct.OBJ&e)return h;const f=o();d(),n++;try{const m=i();Object.defineProperty(h,f,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(ct.OBJ&e)return h;throw m}d(),t[n]===","&&n++}}catch{if(ct.OBJ&e)return h;s("Expected '}' at end of object")}return n++,h},u=()=>{n++;const h=[];try{for(;t[n]!=="]";)h.push(i()),d(),t[n]===","&&n++}catch{if(ct.ARR&e)return h;s("Expected ']' at end of array")}return n++,h},l=()=>{if(n===0){t==="-"&&ct.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(f){if(ct.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}a(String(f))}}const h=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(ct.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(h,n))}catch{t.substring(h,n)==="-"&&ct.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(h,t.lastIndexOf("e")))}catch(m){a(String(m))}}},d=()=>{for(;n<r&&` 
\r	`.includes(t[n]);)n++};return i()},Ap=t=>$4(t,ct.ALL^ct.NUM);var rt,Ur,Jn,tn,Qc,ci,eu,tu,ru,ui,nu,kp;class va extends Vy{constructor(e){super(),rt.add(this),Ur.set(this,void 0),Jn.set(this,void 0),tn.set(this,void 0),ye(this,Ur,e),ye(this,Jn,[])}get currentChatCompletionSnapshot(){return R(this,tn,"f")}static fromReadableStream(e){const r=new va(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){const s=new va(r);return s._run(()=>s._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,r,n){var i;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),R(this,rt,"m",Qc).call(this);const a=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)R(this,rt,"m",eu).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new zt;return this._addChatCompletion(R(this,rt,"m",ui).call(this))}async _fromReadableStream(e,r){var i;const n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),R(this,rt,"m",Qc).call(this),this._connected();const s=kr.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(R(this,rt,"m",ui).call(this)),R(this,rt,"m",eu).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new zt;return this._addChatCompletion(R(this,rt,"m",ui).call(this))}[(Ur=new WeakMap,Jn=new WeakMap,tn=new WeakMap,rt=new WeakSet,Qc=function(){this.ended||ye(this,tn,void 0)},ci=function(r){let n=R(this,Jn,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},R(this,Jn,"f")[r.index]=n,n)},eu=function(r){var s,a,i,o,c,u,l,d,h,f,m,_,y,w,g;if(this.ended)return;const n=R(this,rt,"m",kp).call(this,r);this._emit("chunk",r,n);for(const b of r.choices){const T=n.choices[b.index];b.delta.content!=null&&((s=T.message)==null?void 0:s.role)==="assistant"&&((a=T.message)!=null&&a.content)&&(this._emit("content",b.delta.content,T.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:T.message.content,parsed:T.message.parsed})),b.delta.refusal!=null&&((i=T.message)==null?void 0:i.role)==="assistant"&&((o=T.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:T.message.refusal}),((c=b.logprobs)==null?void 0:c.content)!=null&&((u=T.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(l=b.logprobs)==null?void 0:l.content,snapshot:((d=T.logprobs)==null?void 0:d.content)??[]}),((h=b.logprobs)==null?void 0:h.refusal)!=null&&((f=T.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=b.logprobs)==null?void 0:m.refusal,snapshot:((_=T.logprobs)==null?void 0:_.refusal)??[]});const I=R(this,rt,"m",ci).call(this,T);T.finish_reason&&(R(this,rt,"m",ru).call(this,T),I.current_tool_call_index!=null&&R(this,rt,"m",tu).call(this,T,I.current_tool_call_index));for(const C of b.delta.tool_calls??[])I.current_tool_call_index!==C.index&&(R(this,rt,"m",ru).call(this,T),I.current_tool_call_index!=null&&R(this,rt,"m",tu).call(this,T,I.current_tool_call_index)),I.current_tool_call_index=C.index;for(const C of b.delta.tool_calls??[]){const D=(y=T.message.tool_calls)==null?void 0:y[C.index];D!=null&&D.type&&((D==null?void 0:D.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=D.function)==null?void 0:w.name,index:C.index,arguments:D.function.arguments,parsed_arguments:D.function.parsed_arguments,arguments_delta:((g=C.function)==null?void 0:g.arguments)??""}):(D==null||D.type,void 0))}}},tu=function(r,n){var i,o,c;if(R(this,rt,"m",ci).call(this,r).done_tool_calls.has(n))return;const a=(i=r.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(c=(o=R(this,Ur,"f"))==null?void 0:o.tools)==null?void 0:c.find(l=>Yi(l)&&l.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Pa(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},ru=function(r){var s,a;const n=R(this,rt,"m",ci).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;const i=R(this,rt,"m",nu).call(this);this._emit("content.done",{content:r.message.content,parsed:i?i.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),(s=r.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),(a=r.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},ui=function(){if(this.ended)throw new me("stream has ended, this shouldn't happen");const r=R(this,tn,"f");if(!r)throw new me("request ended without sending any chunks");return ye(this,tn,void 0),ye(this,Jn,[]),P4(r,R(this,Ur,"f"))},nu=function(){var n;const r=(n=R(this,Ur,"f"))==null?void 0:n.response_format;return Ed(r)?r:null},kp=function(r){var n,s,a,i;let o=R(this,tn,"f");const{choices:c,...u}=r;o?Object.assign(o,u):o=ye(this,tn,{...u,choices:[]});for(const{delta:l,finish_reason:d,index:h,logprobs:f=null,...m}of r.choices){let _=o.choices[h];if(_||(_=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:f,...m}),f)if(!_.logprobs)_.logprobs=Object.assign({},f);else{const{content:C,refusal:D,...k}=f;Object.assign(_.logprobs,k),C&&((n=_.logprobs).content??(n.content=[]),_.logprobs.content.push(...C)),D&&((s=_.logprobs).refusal??(s.refusal=[]),_.logprobs.refusal.push(...D))}if(d&&(_.finish_reason=d,R(this,Ur,"f")&&Uy(R(this,Ur,"f")))){if(d==="length")throw new wy;if(d==="content_filter")throw new Ey}if(Object.assign(_,m),!l)continue;const{content:y,refusal:w,function_call:g,role:b,tool_calls:T,...I}=l;if(Object.assign(_.message,I),w&&(_.message.refusal=(_.message.refusal||"")+w),b&&(_.message.role=b),g&&(_.message.function_call?(g.name&&(_.message.function_call.name=g.name),g.arguments&&((a=_.message.function_call).arguments??(a.arguments=""),_.message.function_call.arguments+=g.arguments)):_.message.function_call=g),y&&(_.message.content=(_.message.content||"")+y,!_.message.refusal&&R(this,rt,"m",nu).call(this)&&(_.message.parsed=Ap(_.message.content))),T){_.message.tool_calls||(_.message.tool_calls=[]);for(const{index:C,id:D,type:k,function:A,...H}of T){const q=(i=_.message.tool_calls)[C]??(i[C]={});Object.assign(q,H),D&&(q.id=D),k&&(q.type=k),A&&(q.function??(q.function={name:A.name??"",arguments:""})),A!=null&&A.name&&(q.function.name=A.name),A!=null&&A.arguments&&(q.function.arguments+=A.arguments,x4(R(this,Ur,"f"),q)&&(q.function.parsed_arguments=Ap(q.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("chunk",s=>{const a=r.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(const a of r)a.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(const a of r)a.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>r.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new kr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function P4(t,e){const{id:r,choices:n,created:s,model:a,system_fingerprint:i,...o}=t,c={...o,id:r,choices:n.map(({message:u,finish_reason:l,index:d,logprobs:h,...f})=>{if(!l)throw new me(`missing finish_reason for choice ${d}`);const{content:m=null,function_call:_,tool_calls:y,...w}=u,g=u.role;if(!g)throw new me(`missing role for choice ${d}`);if(_){const{arguments:b,name:T}=_;if(b==null)throw new me(`missing function_call.arguments for choice ${d}`);if(!T)throw new me(`missing function_call.name for choice ${d}`);return{...f,message:{content:m,function_call:{arguments:b,name:T},role:g,refusal:u.refusal??null},finish_reason:l,index:d,logprobs:h}}return y?{...f,index:d,finish_reason:l,logprobs:h,message:{...w,role:g,content:m,refusal:u.refusal??null,tool_calls:y.map((b,T)=>{const{function:I,type:C,id:D,...k}=b,{arguments:A,name:H,...q}=I||{};if(D==null)throw new me(`missing choices[${d}].tool_calls[${T}].id
${li(t)}`);if(C==null)throw new me(`missing choices[${d}].tool_calls[${T}].type
${li(t)}`);if(H==null)throw new me(`missing choices[${d}].tool_calls[${T}].function.name
${li(t)}`);if(A==null)throw new me(`missing choices[${d}].tool_calls[${T}].function.arguments
${li(t)}`);return{...k,id:D,type:C,function:{...q,name:H,arguments:A}}})}}:{...f,message:{...w,content:m,role:g,refusal:u.refusal??null},finish_reason:l,index:d,logprobs:h}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return E4(c,e)}function li(t){return JSON.stringify(t)}class no extends va{static fromReadableStream(e){const r=new no(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){const s=new no(r),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,a)),s}}let Id=class extends he{constructor(){super(...arguments),this.messages=new Fy(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(B`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(B`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",et,{query:e,...r})}delete(e,r){return this._client.delete(B`/chat/completions/${e}`,r)}parse(e,r){return I4(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Td(n,e))}runTools(e,r){return e.stream?no.runTools(this._client,e,r):xd.runTools(this._client,e,r)}stream(e,r){return va.createChatCompletion(this._client,e,r)}};Id.Messages=Fy;class Ad extends he{constructor(){super(...arguments),this.completions=new Id(this._client)}}Ad.Completions=Id;const i0=Symbol("brand.privateNullableHeaders");function*L4(t){if(!t)return;if(i0 in t){const{values:n,nulls:s}=t;yield*n.entries();for(const a of s)yield[a,null];return}let e=!1,r;t instanceof Headers?r=t.entries():fp(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){const s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const a=fp(n[1])?n[1]:[n[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[s,null]),yield[s,o])}}const te=t=>{const e=new Headers,r=new Set;for(const n of t){const s=new Set;for(const[a,i]of L4(n)){const o=a.toLowerCase();s.has(o)||(e.delete(a),s.add(o)),i===null?(e.delete(a),r.add(o)):(e.append(a,i),r.delete(o))}}return{[i0]:!0,values:e,nulls:r}};class o0 extends he{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:te([{Accept:"application/octet-stream"},r==null?void 0:r.headers]),__binaryResponse:!0})}}class c0 extends he{create(e,r){return this._client.post("/audio/transcriptions",Bn({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class u0 extends he{create(e,r){return this._client.post("/audio/translations",Bn({body:e,...r,__metadata:{model:e.model}},this._client))}}class La extends he{constructor(){super(...arguments),this.transcriptions=new c0(this._client),this.translations=new u0(this._client),this.speech=new o0(this._client)}}La.Transcriptions=c0;La.Translations=u0;La.Speech=o0;class l0 extends he{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(B`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",et,{query:e,...r})}cancel(e,r){return this._client.post(B`/batches/${e}/cancel`,r)}}class d0 extends he{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,r){return this._client.get(B`/assistants/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,r,n){return this._client.post(B`/assistants/${e}`,{body:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},r){return this._client.getAPIList("/assistants",et,{query:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,r){return this._client.delete(B`/assistants/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}let f0=class extends he{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}};class h0 extends he{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}let tc=class extends he{constructor(){super(...arguments),this.sessions=new f0(this._client),this.transcriptionSessions=new h0(this._client)}};tc.Sessions=f0;tc.TranscriptionSessions=h0;class p0 extends he{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}cancel(e,r){return this._client.post(B`/chatkit/sessions/${e}/cancel`,{...r,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}}let m0=class extends he{retrieve(e,r){return this._client.get(B`/chatkit/threads/${e}`,{...r,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Xi,{query:e,...r,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}delete(e,r){return this._client.delete(B`/chatkit/threads/${e}`,{...r,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}listItems(e,r={},n){return this._client.getAPIList(B`/chatkit/threads/${e}/items`,Xi,{query:r,...n,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}};class rc extends he{constructor(){super(...arguments),this.sessions=new p0(this._client),this.threads=new m0(this._client)}}rc.Sessions=p0;rc.Threads=m0;class g0 extends he{create(e,r,n){return this._client.post(B`/threads/${e}/messages`,{body:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,r,n){const{thread_id:s}=r;return this._client.get(B`/threads/${s}/messages/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,r,n){const{thread_id:s,...a}=r;return this._client.post(B`/threads/${s}/messages/${e}`,{body:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,r={},n){return this._client.getAPIList(B`/threads/${e}/messages`,et,{query:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,r,n){const{thread_id:s}=r;return this._client.delete(B`/threads/${s}/messages/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class _0 extends he{retrieve(e,r,n){const{thread_id:s,run_id:a,...i}=r;return this._client.get(B`/threads/${s}/runs/${a}/steps/${e}`,{query:i,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,r,n){const{thread_id:s,...a}=r;return this._client.getAPIList(B`/threads/${s}/runs/${e}/steps`,et,{query:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}const D4=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),r=e.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}},Kn=t=>{var e,r,n,s,a;if(typeof globalThis.process<"u")return((r=(e=globalThis.process.env)==null?void 0:e[t])==null?void 0:r.trim())??void 0;if(typeof globalThis.Deno<"u")return(a=(s=(n=globalThis.Deno.env)==null?void 0:n.get)==null?void 0:s.call(n,t))==null?void 0:a.trim()};var ht,Cn,tl,Sr,wi,cr,Nn,as,kn,so,Ft,Ei,Ti,ea,zs,qs,Op,Cp,Np,$p,Rp,Pp,Lp;class ta extends Sd{constructor(){super(...arguments),ht.add(this),tl.set(this,[]),Sr.set(this,{}),wi.set(this,{}),cr.set(this,void 0),Nn.set(this,void 0),as.set(this,void 0),kn.set(this,void 0),so.set(this,void 0),Ft.set(this,void 0),Ei.set(this,void 0),Ti.set(this,void 0),ea.set(this,void 0)}[(tl=new WeakMap,Sr=new WeakMap,wi=new WeakMap,cr=new WeakMap,Nn=new WeakMap,as=new WeakMap,kn=new WeakMap,so=new WeakMap,Ft=new WeakMap,Ei=new WeakMap,Ti=new WeakMap,ea=new WeakMap,ht=new WeakSet,Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("event",s=>{const a=r.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(const a of r)a.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(const a of r)a.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>r.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const r=new Cn;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){var a;const n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=kr.fromReadableStream(e,this.controller);for await(const i of s)R(this,ht,"m",zs).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new zt;return this._addRun(R(this,ht,"m",qs).call(this))}toReadableStream(){return new kr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,s){const a=new Cn;return a._run(()=>a._runToolAssistantStream(e,r,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,r,n,s){var c;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.submitToolOutputs(r,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)R(this,ht,"m",zs).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new zt;return this._addRun(R(this,ht,"m",qs).call(this))}static createThreadAssistantStream(e,r,n){const s=new Cn;return s._run(()=>s._threadAssistantStream(e,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,r,n,s){const a=new Cn;return a._run(()=>a._runAssistantStream(e,r,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return R(this,Ei,"f")}currentRun(){return R(this,Ti,"f")}currentMessageSnapshot(){return R(this,cr,"f")}currentRunStepSnapshot(){return R(this,ea,"f")}async finalRunSteps(){return await this.done(),Object.values(R(this,Sr,"f"))}async finalMessages(){return await this.done(),Object.values(R(this,wi,"f"))}async finalRun(){if(await this.done(),!R(this,Nn,"f"))throw Error("Final run was not received.");return R(this,Nn,"f")}async _createThreadAssistantStream(e,r,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of i)R(this,ht,"m",zs).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new zt;return this._addRun(R(this,ht,"m",qs).call(this))}async _createAssistantStream(e,r,n,s){var c;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(r,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)R(this,ht,"m",zs).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new zt;return this._addRun(R(this,ht,"m",qs).call(this))}static accumulateDelta(e,r){for(const[n,s]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Kc(a)&&Kc(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!Kc(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,s){return await this._createAssistantStream(r,e,n,s)}async _runToolAssistantStream(e,r,n,s){return await this._createToolAssistantStream(r,e,n,s)}}Cn=ta,zs=function(e){if(!this.ended)switch(ye(this,Ei,e),R(this,ht,"m",Np).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":R(this,ht,"m",Lp).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,ht,"m",Cp).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":R(this,ht,"m",Op).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},qs=function(){if(this.ended)throw new me("stream has ended, this shouldn't happen");if(!R(this,Nn,"f"))throw Error("Final run has not been received");return R(this,Nn,"f")},Op=function(e){const[r,n]=R(this,ht,"m",Rp).call(this,e,R(this,cr,"f"));ye(this,cr,r),R(this,wi,"f")[r.id]=r;for(const s of n){const a=r.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=r.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=R(this,as,"f")){if(R(this,kn,"f"))switch(R(this,kn,"f").type){case"text":this._emit("textDone",R(this,kn,"f").text,R(this,cr,"f"));break;case"image_file":this._emit("imageFileDone",R(this,kn,"f").image_file,R(this,cr,"f"));break}ye(this,as,s.index)}ye(this,kn,r.content[s.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(R(this,as,"f")!==void 0){const s=e.data.content[R(this,as,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,R(this,cr,"f"));break;case"text":this._emit("textDone",s.text,R(this,cr,"f"));break}}R(this,cr,"f")&&this._emit("messageDone",e.data),ye(this,cr,void 0)}},Cp=function(e){const r=R(this,ht,"m",$p).call(this,e);switch(ye(this,ea,r),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==R(this,so,"f")?this._emit("toolCallDelta",a,r.step_details.tool_calls[a.index]):(R(this,Ft,"f")&&this._emit("toolCallDone",R(this,Ft,"f")),ye(this,so,a.index),ye(this,Ft,r.step_details.tool_calls[a.index]),R(this,Ft,"f")&&this._emit("toolCallCreated",R(this,Ft,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ye(this,ea,void 0),e.data.step_details.type=="tool_calls"&&R(this,Ft,"f")&&(this._emit("toolCallDone",R(this,Ft,"f")),ye(this,Ft,void 0)),this._emit("runStepDone",e.data,r);break}},Np=function(e){R(this,tl,"f").push(e),this._emit("event",e)},$p=function(e){switch(e.event){case"thread.run.step.created":return R(this,Sr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=R(this,Sr,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Cn.accumulateDelta(r,n.delta);R(this,Sr,"f")[e.data.id]=s}return R(this,Sr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":R(this,Sr,"f")[e.data.id]=e.data;break}if(R(this,Sr,"f")[e.data.id])return R(this,Sr,"f")[e.data.id];throw new Error("No snapshot available")},Rp=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in r.content){let i=r.content[a.index];r.content[a.index]=R(this,ht,"m",Pp).call(this,a,i)}else r.content[a.index]=a,n.push(a);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Pp=function(e,r){return Cn.accumulateDelta(r,e)},Lp=function(e){switch(ye(this,Ti,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":ye(this,Nn,e.data),R(this,Ft,"f")&&(this._emit("toolCallDone",R(this,Ft,"f")),ye(this,Ft,void 0));break}};let kd=class extends he{constructor(){super(...arguments),this.steps=new _0(this._client)}create(e,r,n){const{include:s,...a}=r;return this._client.post(B`/threads/${e}/runs`,{query:{include:s},body:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:r.stream??!1})}retrieve(e,r,n){const{thread_id:s}=r;return this._client.get(B`/threads/${s}/runs/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,r,n){const{thread_id:s,...a}=r;return this._client.post(B`/threads/${s}/runs/${e}`,{body:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,r={},n){return this._client.getAPIList(B`/threads/${e}/runs`,et,{query:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,r,n){const{thread_id:s}=r;return this._client.post(B`/threads/${s}/runs/${e}/cancel`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,r,n){const s=await this.create(e,r,n);return await this.poll(s.id,{thread_id:e},n)}createAndStream(e,r,n){return ta.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){var a;const s=te([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(e,r,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(c=l)}}await Ra(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,r,n){return ta.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){const{thread_id:s,...a}=r;return this._client.post(B`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){const s=await this.submitToolOutputs(e,r,n);return await this.poll(s.id,r,n)}submitToolOutputsStream(e,r,n){return ta.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};kd.Steps=_0;class nc extends he{constructor(){super(...arguments),this.runs=new kd(this._client),this.messages=new g0(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,r){return this._client.get(B`/threads/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,r,n){return this._client.post(B`/threads/${e}`,{body:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,r){return this._client.delete(B`/threads/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){const n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return ta.createThreadAssistantStream(e,this._client.beta.threads,r)}}nc.Runs=kd;nc.Messages=g0;class Es extends he{constructor(){super(...arguments),this.realtime=new tc(this._client),this.chatkit=new rc(this._client),this.assistants=new d0(this._client),this.threads=new nc(this._client)}}Es.Realtime=tc;Es.ChatKit=rc;Es.Assistants=d0;Es.Threads=nc;class y0 extends he{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}}class v0 extends he{retrieve(e,r,n){const{container_id:s}=r;return this._client.get(B`/containers/${s}/files/${e}/content`,{...n,headers:te([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}}let Od=class extends he{constructor(){super(...arguments),this.content=new v0(this._client)}create(e,r,n){return this._client.post(B`/containers/${e}/files`,Bn({body:r,...n},this._client))}retrieve(e,r,n){const{container_id:s}=r;return this._client.get(B`/containers/${s}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(B`/containers/${e}/files`,et,{query:r,...n})}delete(e,r,n){const{container_id:s}=r;return this._client.delete(B`/containers/${s}/files/${e}`,{...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}};Od.Content=v0;class Cd extends he{constructor(){super(...arguments),this.files=new Od(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(B`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",et,{query:e,...r})}delete(e,r){return this._client.delete(B`/containers/${e}`,{...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}}Cd.Files=Od;class b0 extends he{create(e,r,n){const{include:s,...a}=r;return this._client.post(B`/conversations/${e}/items`,{query:{include:s},body:a,...n})}retrieve(e,r,n){const{conversation_id:s,...a}=r;return this._client.get(B`/conversations/${s}/items/${e}`,{query:a,...n})}list(e,r={},n){return this._client.getAPIList(B`/conversations/${e}/items`,Xi,{query:r,...n})}delete(e,r,n){const{conversation_id:s}=r;return this._client.delete(B`/conversations/${s}/items/${e}`,n)}}class Nd extends he{constructor(){super(...arguments),this.items=new b0(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(B`/conversations/${e}`,r)}update(e,r,n){return this._client.post(B`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(B`/conversations/${e}`,r)}}Nd.Items=b0;let w0=class extends he{create(e,r){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&ft(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...r});return n?a:(ft(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const c=o.embedding;o.embedding=D4(c)}),i)))}};class E0 extends he{retrieve(e,r,n){const{eval_id:s,run_id:a}=r;return this._client.get(B`/evals/${s}/runs/${a}/output_items/${e}`,n)}list(e,r,n){const{eval_id:s,...a}=r;return this._client.getAPIList(B`/evals/${s}/runs/${e}/output_items`,et,{query:a,...n})}}class $d extends he{constructor(){super(...arguments),this.outputItems=new E0(this._client)}create(e,r,n){return this._client.post(B`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){const{eval_id:s}=r;return this._client.get(B`/evals/${s}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(B`/evals/${e}/runs`,et,{query:r,...n})}delete(e,r,n){const{eval_id:s}=r;return this._client.delete(B`/evals/${s}/runs/${e}`,n)}cancel(e,r,n){const{eval_id:s}=r;return this._client.post(B`/evals/${s}/runs/${e}`,n)}}$d.OutputItems=E0;class Rd extends he{constructor(){super(...arguments),this.runs=new $d(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(B`/evals/${e}`,r)}update(e,r,n){return this._client.post(B`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",et,{query:e,...r})}delete(e,r){return this._client.delete(B`/evals/${e}`,r)}}Rd.Runs=$d;let T0=class extends he{create(e,r){return this._client.post("/files",Bn({body:e,...r},this._client))}retrieve(e,r){return this._client.get(B`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",et,{query:e,...r})}delete(e,r){return this._client.delete(B`/files/${e}`,r)}content(e,r){return this._client.get(B`/files/${e}/content`,{...r,headers:te([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Ra(r),i=await this.retrieve(e),Date.now()-a>n)throw new Xo({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class S0 extends he{}let x0=class extends he{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};class Pd extends he{constructor(){super(...arguments),this.graders=new x0(this._client)}}Pd.Graders=x0;class I0 extends he{create(e,r,n){return this._client.getAPIList(B`/fine_tuning/checkpoints/${e}/permissions`,ec,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(B`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){const{fine_tuned_model_checkpoint:s}=r;return this._client.delete(B`/fine_tuning/checkpoints/${s}/permissions/${e}`,n)}}let Ld=class extends he{constructor(){super(...arguments),this.permissions=new I0(this._client)}};Ld.Permissions=I0;class A0 extends he{list(e,r={},n){return this._client.getAPIList(B`/fine_tuning/jobs/${e}/checkpoints`,et,{query:r,...n})}}class Dd extends he{constructor(){super(...arguments),this.checkpoints=new A0(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(B`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",et,{query:e,...r})}cancel(e,r){return this._client.post(B`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(B`/fine_tuning/jobs/${e}/events`,et,{query:r,...n})}pause(e,r){return this._client.post(B`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(B`/fine_tuning/jobs/${e}/resume`,r)}}Dd.Checkpoints=A0;class Ts extends he{constructor(){super(...arguments),this.methods=new S0(this._client),this.jobs=new Dd(this._client),this.checkpoints=new Ld(this._client),this.alpha=new Pd(this._client)}}Ts.Methods=S0;Ts.Jobs=Dd;Ts.Checkpoints=Ld;Ts.Alpha=Pd;class k0 extends he{}class Md extends he{constructor(){super(...arguments),this.graderModels=new k0(this._client)}}Md.GraderModels=k0;class O0 extends he{createVariation(e,r){return this._client.post("/images/variations",Bn({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",Bn({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}}class C0 extends he{retrieve(e,r){return this._client.get(B`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",ec,e)}delete(e,r){return this._client.delete(B`/models/${e}`,r)}}class N0 extends he{create(e,r){return this._client.post("/moderations",{body:e,...r})}}class $0 extends he{accept(e,r,n){return this._client.post(B`/realtime/calls/${e}/accept`,{body:r,...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}hangup(e,r){return this._client.post(B`/realtime/calls/${e}/hangup`,{...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}refer(e,r,n){return this._client.post(B`/realtime/calls/${e}/refer`,{body:r,...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}reject(e,r={},n){return this._client.post(B`/realtime/calls/${e}/reject`,{body:r,...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}}class R0 extends he{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}}class sc extends he{constructor(){super(...arguments),this.clientSecrets=new R0(this._client),this.calls=new $0(this._client)}}sc.ClientSecrets=R0;sc.Calls=$0;function M4(t,e){return!e||!F4(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:P0(t,e)}function P0(t,e){const r=t.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:z4(e,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:j4(e,i.text)}:i);return{...s,content:a}}return s}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||rl(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function j4(t,e){var r,n,s,a;return((n=(r=t.text)==null?void 0:r.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=t.text)==null?void 0:s.format)?((a=t.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function F4(t){var e;return!!Ed((e=t.text)==null?void 0:e.format)}function U4(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function B4(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function z4(t,e){const r=B4(t.tools??[],e.name);return{...e,...e,parsed_arguments:U4(r)?r.$parseRaw(e.arguments):r!=null&&r.strict?JSON.parse(e.arguments):null}}function rl(t){const e=[];for(const r of t.output)if(r.type==="message")for(const n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var Xn,di,rn,fi,Dp,Mp,jp,Fp;class jd extends Sd{constructor(e){super(),Xn.add(this),di.set(this,void 0),rn.set(this,void 0),fi.set(this,void 0),ye(this,di,e)}static createResponse(e,r,n){const s=new jd(r);return s._run(()=>s._createOrRetrieveResponse(e,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,r,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),R(this,Xn,"m",Dp).call(this);let a,i=null;"response_id"in r?(a=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=r.starting_after??null):a=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const c of a)R(this,Xn,"m",Mp).call(this,c,i);if((o=a.controller.signal)!=null&&o.aborted)throw new zt;return R(this,Xn,"m",jp).call(this)}[(di=new WeakMap,rn=new WeakMap,fi=new WeakMap,Xn=new WeakSet,Dp=function(){this.ended||ye(this,rn,void 0)},Mp=function(r,n){if(this.ended)return;const s=(i,o)=>{(n==null||o.sequence_number>n)&&this._emit(i,o)},a=R(this,Xn,"m",Fp).call(this,r);switch(s("event",r),r.type){case"response.output_text.delta":{const i=a.output[r.output_index];if(!i)throw new me(`missing output at index ${r.output_index}`);if(i.type==="message"){const o=i.content[r.content_index];if(!o)throw new me(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new me(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[r.output_index];if(!i)throw new me(`missing output at index ${r.output_index}`);i.type==="function_call"&&s("response.function_call_arguments.delta",{...r,snapshot:i.arguments});break}default:s(r.type,r);break}},jp=function(){if(this.ended)throw new me("stream has ended, this shouldn't happen");const r=R(this,rn,"f");if(!r)throw new me("request ended without sending any events");ye(this,rn,void 0);const n=q4(r,R(this,di,"f"));return ye(this,fi,n),n},Fp=function(r){var s;let n=R(this,rn,"f");if(!n){if(r.type!=="response.created")throw new me(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=ye(this,rn,r.response),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{const a=n.output[r.output_index];if(!a)throw new me(`missing output at index ${r.output_index}`);const i=a.type,o=r.part;i==="message"&&o.type!=="reasoning_text"?a.content.push(o):i==="reasoning"&&o.type==="reasoning_text"&&(a.content||(a.content=[]),a.content.push(o));break}case"response.output_text.delta":{const a=n.output[r.output_index];if(!a)throw new me(`missing output at index ${r.output_index}`);if(a.type==="message"){const i=a.content[r.content_index];if(!i)throw new me(`missing content at index ${r.content_index}`);if(i.type!=="output_text")throw new me(`expected content to be 'output_text', got ${i.type}`);i.text+=r.delta}break}case"response.function_call_arguments.delta":{const a=n.output[r.output_index];if(!a)throw new me(`missing output at index ${r.output_index}`);a.type==="function_call"&&(a.arguments+=r.delta);break}case"response.reasoning_text.delta":{const a=n.output[r.output_index];if(!a)throw new me(`missing output at index ${r.output_index}`);if(a.type==="reasoning"){const i=(s=a.content)==null?void 0:s[r.content_index];if(!i)throw new me(`missing content at index ${r.content_index}`);if(i.type!=="reasoning_text")throw new me(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=r.delta}break}case"response.completed":{ye(this,rn,r.response);break}}return n},Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("event",s=>{const a=r.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(const a of r)a.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(const a of r)a.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>r.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=R(this,fi,"f");if(!e)throw new me("stream ended without producing a ChatCompletion");return e}}function q4(t,e){return M4(t,e)}class L0 extends he{list(e,r={},n){return this._client.getAPIList(B`/responses/${e}/input_items`,et,{query:r,...n})}}class D0 extends he{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}}class ac extends he{constructor(){super(...arguments),this.inputItems=new L0(this._client),this.inputTokens=new D0(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&rl(n),n))}retrieve(e,r={},n){return this._client.get(B`/responses/${e}`,{query:r,...n,stream:(r==null?void 0:r.stream)??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&rl(s),s))}delete(e,r){return this._client.delete(B`/responses/${e}`,{...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>P0(n,e))}stream(e,r){return jd.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(B`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}}ac.InputItems=L0;ac.InputTokens=D0;class M0 extends he{create(e,r,n){return this._client.post(B`/uploads/${e}/parts`,Bn({body:r,...n},this._client))}}class Fd extends he{constructor(){super(...arguments),this.parts=new M0(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(B`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(B`/uploads/${e}/complete`,{body:r,...n})}}Fd.Parts=M0;const Z4=async t=>{const e=await Promise.allSettled(t),r=e.filter(s=>s.status==="rejected");if(r.length){for(const s of r)console.error(s.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class j0 extends he{create(e,r,n){return this._client.post(B`/vector_stores/${e}/file_batches`,{body:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,r,n){const{vector_store_id:s}=r;return this._client.get(B`/vector_stores/${s}/file_batches/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,r,n){const{vector_store_id:s}=r;return this._client.post(B`/vector_stores/${s}/file_batches/${e}/cancel`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,r,n){const s=await this.create(e,r);return await this.poll(e,s.id,n)}listFiles(e,r,n){const{vector_store_id:s,...a}=r;return this._client.getAPIList(B`/vector_stores/${s}/file_batches/${e}/files`,et,{query:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async poll(e,r,n){var a;const s=te([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(r,{vector_store_id:e},{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(c=l)}}await Ra(c);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},s){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,r.length),o=this._client,c=r.values(),u=[...n];async function l(h){for(let f of h){const m=await o.files.create({file:f,purpose:"assistants"},s);u.push(m.id)}}const d=Array(i).fill(c).map(l);return await Z4(d),await this.createAndPoll(e,{file_ids:u})}}class F0 extends he{create(e,r,n){return this._client.post(B`/vector_stores/${e}/files`,{body:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,r,n){const{vector_store_id:s}=r;return this._client.get(B`/vector_stores/${s}/files/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,r,n){const{vector_store_id:s,...a}=r;return this._client.post(B`/vector_stores/${s}/files/${e}`,{body:a,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,r={},n){return this._client.getAPIList(B`/vector_stores/${e}/files`,et,{query:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,r,n){const{vector_store_id:s}=r;return this._client.delete(B`/vector_stores/${s}/files/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,r,n){const s=await this.create(e,r,n);return await this.poll(e,s.id,n)}async poll(e,r,n){var a;const s=te([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const i=await this.retrieve(r,{vector_store_id:e},{...n,headers:s}).withResponse(),o=i.data;switch(o.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const u=i.response.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(c=l)}}await Ra(c);break;case"failed":case"completed":return o}}}async upload(e,r,n){const s=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,r,n){const s=await this.upload(e,r,n);return await this.poll(e,s.id,n)}content(e,r,n){const{vector_store_id:s}=r;return this._client.getAPIList(B`/vector_stores/${s}/files/${e}/content`,ec,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class ic extends he{constructor(){super(...arguments),this.files=new F0(this._client),this.fileBatches=new j0(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,r){return this._client.get(B`/vector_stores/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,r,n){return this._client.post(B`/vector_stores/${e}`,{body:r,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",et,{query:e,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,r){return this._client.delete(B`/vector_stores/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}search(e,r,n){return this._client.getAPIList(B`/vector_stores/${e}/search`,ec,{body:r,method:"post",...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}ic.Files=F0;ic.FileBatches=j0;class U0 extends he{create(e,r){return this._client.post("/videos",Sp({body:e,...r},this._client))}retrieve(e,r){return this._client.get(B`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Xi,{query:e,...r})}delete(e,r){return this._client.delete(B`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(B`/videos/${e}/content`,{query:r,...n,headers:te([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(B`/videos/${e}/remix`,Sp({body:r,...n},this._client))}}var rs,B0,Si;class z0 extends he{constructor(){super(...arguments),rs.add(this)}async unwrap(e,r,n=this._client.webhookSecret,s=300){return await this.verifySignature(e,r,n,s),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");R(this,rs,"m",B0).call(this,n);const a=te([r]).values,i=R(this,rs,"m",Si).call(this,a,"webhook-signature"),o=R(this,rs,"m",Si).call(this,a,"webhook-timestamp"),c=R(this,rs,"m",Si).call(this,a,"webhook-id"),u=parseInt(o,10);if(isNaN(u))throw new Ls("Invalid webhook timestamp format");const l=Math.floor(Date.now()/1e3);if(l-u>s)throw new Ls("Webhook timestamp is too old");if(u>l+s)throw new Ls("Webhook timestamp is too new");const d=i.split(" ").map(_=>_.startsWith("v1,")?_.substring(3):_),h=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=c?`${c}.${o}.${e}`:`${o}.${e}`,m=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const _ of d)try{const y=Buffer.from(_,"base64");if(await crypto.subtle.verify("HMAC",m,y,new TextEncoder().encode(f)))return}catch{continue}throw new Ls("The given webhook signature does not match the expected signature")}}rs=new WeakSet,B0=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Si=function(e,r){if(!e)throw new Error("Headers are required");const n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var nl,Ud,xi,q0;class Ae{constructor({baseURL:e=Kn("OPENAI_BASE_URL"),apiKey:r=Kn("OPENAI_API_KEY"),organization:n=Kn("OPENAI_ORG_ID")??null,project:s=Kn("OPENAI_PROJECT_ID")??null,webhookSecret:a=Kn("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(nl.add(this),xi.set(this,void 0),this.completions=new y0(this),this.chat=new Ad(this),this.embeddings=new w0(this),this.files=new T0(this),this.images=new O0(this),this.audio=new La(this),this.moderations=new N0(this),this.models=new C0(this),this.fineTuning=new Ts(this),this.graders=new Md(this),this.vectorStores=new ic(this),this.webhooks=new z0(this),this.beta=new Es(this),this.batches=new l0(this),this.uploads=new Fd(this),this.responses=new ac(this),this.realtime=new sc(this),this.conversations=new Nd(this),this.evals=new Rd(this),this.containers=new Cd(this),this.videos=new U0(this),r===void 0)throw new me("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const o={apiKey:r,organization:n,project:s,webhookSecret:a,...i,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&G$())throw new me(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??Ud.DEFAULT_TIMEOUT,this.logger=o.logger??console;const c="warn";this.logLevel=c,this.logLevel=Ep(o.logLevel,"ClientOptions.logLevel",this)??Ep(Kn("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??K$(),ye(this,xi,Y$),this._options=o,this.apiKey=typeof r=="string"?r:"Missing Key",this.organization=n,this.project=s,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:r}){}async authHeaders(e){return te([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return s4(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${es}`}defaultIdempotencyKey(){return`stainless-node-retry-${fy()}`}makeStatusError(e,r,n,s){return pt.generate(e,r,n,s)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let r;try{r=await e()}catch(n){throw n instanceof me?n:new me(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof r!="string"||!r)throw new me(`Expected 'apiKey' function argument to return a string but it returned ${r}`);return this.apiKey=r,!0}buildURL(e,r,n){const s=!R(this,nl,"m",q0).call(this)&&n||this.baseURL,a=U$(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return B$(i)||(r={...i,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(a.search=this.stringifyQuery(r)),a.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:r,options:n}){}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(s=>({method:e,path:r,...s})))}request(e,r=null){return new Qo(this,this.makeRequest(e,r,void 0))}async makeRequest(e,r,n){var w,g;const s=await e,a=s.maxRetries??this.maxRetries;r==null&&(r=a),await this.prepareOptions(s);const{req:i,url:o,timeout:c}=await this.buildRequest(s,{retryCount:a-r});await this.prepareRequest(i,{url:o,options:s});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),l=n===void 0?"":`, retryOf: ${n}`,d=Date.now();if(ft(this).debug(`[${u}] sending request`,Sn({retryOfRequestLogID:n,method:s.method,url:o,options:s,headers:i.headers})),(w=s.signal)!=null&&w.aborted)throw new zt;const h=new AbortController,f=await this.fetchWithTimeout(o,i,c,h).catch(Gu),m=Date.now();if(f instanceof globalThis.Error){const b=`retrying, ${r} attempts remaining`;if((g=s.signal)!=null&&g.aborted)throw new zt;const T=Zu(f)||/timed? ?out/i.test(String(f)+("cause"in f?String(f.cause):""));if(r)return ft(this).info(`[${u}] connection ${T?"timed out":"failed"} - ${b}`),ft(this).debug(`[${u}] connection ${T?"timed out":"failed"} (${b})`,Sn({retryOfRequestLogID:n,url:o,durationMs:m-d,message:f.message})),this.retryRequest(s,r,n??u);throw ft(this).info(`[${u}] connection ${T?"timed out":"failed"} - error; no more retries left`),ft(this).debug(`[${u}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Sn({retryOfRequestLogID:n,url:o,durationMs:m-d,message:f.message})),T?new Xo:new Ko({cause:f})}const _=[...f.headers.entries()].filter(([b])=>b==="x-request-id").map(([b,T])=>", "+b+": "+JSON.stringify(T)).join(""),y=`[${u}${l}${_}] ${i.method} ${o} ${f.ok?"succeeded":"failed"} with status ${f.status} in ${m-d}ms`;if(!f.ok){const b=await this.shouldRetry(f);if(r&&b){const A=`retrying, ${r} attempts remaining`;return await X$(f.body),ft(this).info(`${y} - ${A}`),ft(this).debug(`[${u}] response error (${A})`,Sn({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:m-d})),this.retryRequest(s,r,n??u,f.headers)}const T=b?"error; no more retries left":"error; not retryable";ft(this).info(`${y} - ${T}`);const I=await f.text().catch(A=>Gu(A).message),C=Z$(I),D=C?void 0:I;throw ft(this).debug(`[${u}] response error (${T})`,Sn({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,message:D,durationMs:Date.now()-d})),this.makeStatusError(f.status,C,D,f.headers)}return ft(this).info(y),ft(this).debug(`[${u}] response start`,Sn({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:m-d})),{response:f,options:s,controller:h,requestLogID:u,retryOfRequestLogID:n,startTime:d}}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}requestAPIList(e,r){const n=this.makeRequest(r,null,void 0);return new h4(this,n,e)}async fetchWithTimeout(e,r,n,s){const{signal:a,method:i,...o}=r||{};a&&a.addEventListener("abort",()=>s.abort());const c=setTimeout(()=>s.abort(),n),u=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,l={signal:s.signal,...u?{duplex:"half"}:{},method:"GET",...o};i&&(l.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(c)}}async shouldRetry(e){const r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n,s){let a;const i=s==null?void 0:s.get("retry-after-ms");if(i){const c=parseFloat(i);Number.isNaN(c)||(a=c)}const o=s==null?void 0:s.get("retry-after");if(o&&!a){const c=parseFloat(o);Number.isNaN(c)?a=Date.parse(o)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(r,c)}return await Ra(a),this.makeRequest(e,r-1,n)}calculateDefaultRetryTimeoutMillis(e,r){const a=r-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}async buildRequest(e,{retryCount:r=0}={}){const n={...e},{method:s,path:a,query:i,defaultBaseURL:o}=n,c=this.buildURL(a,i,o);"timeout"in n&&q$("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:u,body:l}=this.buildBody({options:n}),d=await this.buildHeaders({options:e,method:s,bodyHeaders:u,retryCount:r});return{req:{method:s,headers:d,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:c,timeout:n.timeout}}async buildHeaders({options:e,method:r,bodyHeaders:n,retryCount:s}){let a={};this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=te([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...J$(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:r}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=te([r]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:xy(e)}:R(this,xi,"f").call(this,{body:e,headers:n})}}Ud=Ae,xi=new WeakMap,nl=new WeakSet,q0=function(){return this.baseURL!=="https://api.openai.com/v1"};Ae.OpenAI=Ud;Ae.DEFAULT_TIMEOUT=6e5;Ae.OpenAIError=me;Ae.APIError=pt;Ae.APIConnectionError=Ko;Ae.APIConnectionTimeoutError=Xo;Ae.APIUserAbortError=zt;Ae.NotFoundError=gy;Ae.ConflictError=_y;Ae.RateLimitError=vy;Ae.BadRequestError=hy;Ae.AuthenticationError=py;Ae.InternalServerError=by;Ae.PermissionDeniedError=my;Ae.UnprocessableEntityError=yy;Ae.InvalidWebhookSignatureError=Ls;Ae.toFile=y4;Ae.Completions=y0;Ae.Chat=Ad;Ae.Embeddings=w0;Ae.Files=T0;Ae.Images=O0;Ae.Audio=La;Ae.Moderations=N0;Ae.Models=C0;Ae.FineTuning=Ts;Ae.Graders=Md;Ae.VectorStores=ic;Ae.Webhooks=z0;Ae.Beta=Es;Ae.Batches=l0;Ae.Uploads=Fd;Ae.Responses=ac;Ae.Realtime=sc;Ae.Conversations=Nd;Ae.Evals=Rd;Ae.Containers=Cd;Ae.Videos=U0;function Bd(t){if(!t||typeof t!="object")return t;let e;return t.constructor.name===Xo.name&&"message"in t&&typeof t.message=="string"?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===zt.name&&"message"in t&&typeof t.message=="string"?(e=new Error(t.message),e.name="AbortError"):"status"in t&&t.status===400&&"message"in t&&typeof t.message=="string"&&t.message.includes("tool_calls")?e=ai(t,"INVALID_TOOL_RESULTS"):"status"in t&&t.status===401?e=ai(t,"MODEL_AUTHENTICATION"):"status"in t&&t.status===429?e=ai(t,"MODEL_RATE_LIMIT"):"status"in t&&t.status===404?e=ai(t,"MODEL_NOT_FOUND"):e=t,e}const ao=(t,e)=>{const r=[...new Set(e==null?void 0:e.map(s=>{if(typeof s=="string")return s;const a=new s({});if(!("getType"in a)||typeof a.getType!="function")throw new Error("Invalid type provided.");return a.getType()}))],n=t.getType();return r.some(s=>s===n)};function G4(t,e){return Array.isArray(t)?Up(t,e):Yr.from(r=>Up(r,t))}function Up(t,e={}){const{includeNames:r,excludeNames:n,includeTypes:s,excludeTypes:a,includeIds:i,excludeIds:o}=e,c=[];for(const u of t)if(!(n&&u.name&&n.includes(u.name))){{if(a&&ao(u,a))continue;if(o&&u.id&&o.includes(u.id))continue}s||i||r?(r&&u.name&&r.some(l=>l===u.name)||s&&ao(u,s)||i&&u.id&&i.some(l=>l===u.id))&&c.push(u):c.push(u)}return c}function V4(t){return Array.isArray(t)?Bp(t):Yr.from(Bp)}function Bp(t){if(!t.length)return[];const e=[];for(const r of t){const n=r,s=e.pop();if(!s)e.push(n);else if(n.getType()==="tool"||n.getType()!==s.getType())e.push(s,n);else{const a=Di(s),i=Di(n),o=a.concat(i);typeof a.content=="string"&&typeof i.content=="string"&&(o.content=`${a.content}
${i.content}`),e.push(J4(o))}}return e}function H4(t,e){if(Array.isArray(t)){const r=t;if(!e)throw new Error("Options parameter is required when providing messages.");return zp(r,e)}else{const r=t;return Yr.from(n=>zp(n,r)).withConfig({runName:"trim_messages"})}}async function zp(t,e){const{maxTokens:r,tokenCounter:n,strategy:s="last",allowPartial:a=!1,endOn:i,startOn:o,includeSystem:c=!1,textSplitter:u}=e;if(o&&s==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(c&&s==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let l;"getNumTokens"in n?l=async h=>(await Promise.all(h.map(m=>n.getNumTokens(m.content)))).reduce((m,_)=>m+_,0):l=async h=>n(h);let d=G0;if(u&&("splitText"in u?d=u.splitText:d=async h=>u(h)),s==="first")return Z0(t,{maxTokens:r,tokenCounter:l,textSplitter:d,partialStrategy:a?"first":void 0,endOn:i});if(s==="last")return W4(t,{maxTokens:r,tokenCounter:l,textSplitter:d,allowPartial:a,includeSystem:c,startOn:o,endOn:i});throw new Error(`Unrecognized strategy: '${s}'. Must be one of 'first' or 'last'.`)}async function Z0(t,e){const{maxTokens:r,tokenCounter:n,textSplitter:s,partialStrategy:a,endOn:i}=e;let o=[...t],c=0;for(let u=0;u<o.length;u+=1){const l=u>0?o.slice(0,-u):o;if(await n(l)<=r){c=o.length-u;break}}if(c<o.length&&a){let u=!1;if(Array.isArray(o[c].content)){const l=o[c];if(typeof l.content=="string")throw new Error("Expected content to be an array.");const d=l.content.length,h=a==="last"?[...l.content].reverse():l.content;for(let f=1;f<=d;f+=1){const m=a==="first"?h.slice(0,f):h.slice(-f),_=Object.fromEntries(Object.entries(l).filter(([g])=>g!=="type"&&!g.startsWith("lc_"))),y=zd(l.getType(),{..._,content:m}),w=[...o.slice(0,c),y];if(await n(w)<=r)o=w,c+=1,u=!0;else break}u&&a==="last"&&(l.content=[...h].reverse())}if(!u){const l=o[c];let d;if(Array.isArray(l.content)&&l.content.some(h=>typeof h=="string"||h.type==="text")){const h=l.content.find(f=>f.type==="text"&&f.text);d=h==null?void 0:h.text}else typeof l.content=="string"&&(d=l.content);if(d){const h=await s(d),f=h.length;a==="last"&&h.reverse();for(let m=0;m<f-1;m+=1)if(h.pop(),l.content=h.join(""),await n([...o.slice(0,c),l])<=r){a==="last"&&(l.content=[...h].reverse().join("")),o=[...o.slice(0,c),l],c+=1;break}}}}if(i){const u=Array.isArray(i)?i:[i];for(;c>0&&!ao(o[c-1],u);)c-=1}return o.slice(0,c)}async function W4(t,e){var l;const{allowPartial:r=!1,includeSystem:n=!1,endOn:s,startOn:a,...i}=e;let o=t.map(d=>{const h=Object.fromEntries(Object.entries(d).filter(([f])=>f!=="type"&&!f.startsWith("lc_")));return zd(d.getType(),h,El(d))});if(s){const d=Array.isArray(s)?s:[s];for(;o.length>0&&!ao(o[o.length-1],d);)o=o.slice(0,-1)}const c=n&&((l=o[0])==null?void 0:l.getType())==="system";let u=c?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return u=await Z0(u,{...i,partialStrategy:r?"last":void 0,endOn:a}),c?[u[0],...u.slice(1).reverse()]:u.reverse()}const qp={human:{message:Dr,messageChunk:Sa},ai:{message:It,messageChunk:Mr},system:{message:Wr,messageChunk:mn},developer:{message:Wr,messageChunk:mn},tool:{message:pr,messageChunk:wa},function:{message:go,messageChunk:Ta},generic:{message:qn,messageChunk:Ea},remove:{message:Li,messageChunk:Li}};function zd(t,e,r){var a;let n,s;switch(t){case"human":r?n=new Sa(e):s=new Dr(e);break;case"ai":if(r){let i={...e};"tool_calls"in i&&(i={...i,tool_call_chunks:(a=i.tool_calls)==null?void 0:a.map(o=>({...o,type:"tool_call_chunk",index:void 0,args:JSON.stringify(o.args)}))}),n=new Mr(i)}else s=new It(e);break;case"system":r?n=new mn(e):s=new Wr(e);break;case"developer":r?n=new mn({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):s=new Wr({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)r?n=new wa(e):s=new pr(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(r)n=new Ta(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");s=new go(e)}break;case"generic":if("role"in e)r?n=new Ea(e):s=new qn(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${t}`)}if(r&&n)return n;if(s)return s;throw new Error(`Unrecognized message type ${t}`)}function J4(t){const e=t.getType();let r;const n=Object.fromEntries(Object.entries(t).filter(([s])=>!["type","tool_call_chunks"].includes(s)&&!s.startsWith("lc_")));if(e in qp&&(r=zd(e,n)),!r)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(qp)}`);return r}function G0(t){const e=t.split(`
`);return Promise.resolve([...e.slice(0,-1).map(r=>`${r}
`),e[e.length-1]])}const K4=["tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result"],X4=["image","video","audio","text-plain","file"],Y4=["text","reasoning",...K4,...X4];var Q4={};Ne(Q4,{AIMessage:()=>It,AIMessageChunk:()=>Mr,BaseMessage:()=>Xr,BaseMessageChunk:()=>vn,ChatMessage:()=>qn,ChatMessageChunk:()=>Ea,DEFAULT_MERGE_IGNORE_KEYS:()=>bm,FunctionMessage:()=>go,FunctionMessageChunk:()=>Ta,HumanMessage:()=>Dr,HumanMessageChunk:()=>Sa,KNOWN_BLOCK_TYPES:()=>Y4,RemoveMessage:()=>Li,SystemMessage:()=>Wr,SystemMessageChunk:()=>mn,ToolMessage:()=>pr,ToolMessageChunk:()=>wa,_isMessageFieldWithRole:()=>Tm,_mergeDicts:()=>vt,_mergeLists:()=>ba,_mergeObj:()=>wm,_mergeStatus:()=>vm,coerceMessageLikeToMessage:()=>Vs,collapseToolCallChunks:()=>$m,convertToChunk:()=>Di,convertToOpenAIImageBlock:()=>mm,convertToProviderContentBlock:()=>vl,defaultTextSplitter:()=>G0,defaultToolCallParser:()=>Sl,filterMessages:()=>G4,getBufferString:()=>Al,iife:()=>Nm,isAIMessage:()=>_o,isAIMessageChunk:()=>bu,isBase64ContentBlock:()=>yl,isBaseMessage:()=>un,isBaseMessageChunk:()=>El,isChatMessage:()=>Bb,isChatMessageChunk:()=>zb,isDataContentBlock:()=>Rr,isDirectToolOutput:()=>Tl,isFunctionMessage:()=>qb,isFunctionMessageChunk:()=>Zb,isHumanMessage:()=>Gb,isHumanMessageChunk:()=>Vb,isIDContentBlock:()=>pm,isMessage:()=>ym,isOpenAIToolCallArray:()=>Mb,isPlainTextContentBlock:()=>bb,isSystemMessage:()=>Hb,isSystemMessageChunk:()=>Wb,isToolMessage:()=>Sm,isToolMessageChunk:()=>xm,isURLContentBlock:()=>_l,mapChatMessagesToStoredMessages:()=>dw,mapStoredMessageToChatMessage:()=>kl,mapStoredMessagesToChatMessages:()=>lw,mergeContent:()=>Hr,mergeMessageRuns:()=>V4,mergeResponseMetadata:()=>Om,mergeUsageMetadata:()=>Il,parseBase64DataUrl:()=>ca,parseMimeType:()=>yu,trimMessages:()=>H4});const Dn=t=>t();function Da(t){return t?!!(/^o\d/.test(t??"")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat")):!1}function eR(t){return t.role!=="system"&&t.role!=="developer"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function io(t){var r,n,s;const e=((r=t.metadata)==null?void 0:r.filename)??((n=t.metadata)==null?void 0:n.name)??((s=t.metadata)==null?void 0:s.title);if(!e)throw new Error("a filename or name or title is needed via meta-data for OpenAI when working with multimodal blocks");return e}function Ma(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!qn.isInstance(t))throw new Error("Invalid generic chat message");return eR(t);default:throw new Error(`Unknown message type: ${e}`)}}function tR(t){return t.includes("gpt-5.2-pro")}function rR(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=t;if((n||i)&&s&&e)return`${s}/${e}`;if((n||i)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||i){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${e}`}return a}function Zp(t){return typeof Headers<"u"&&t!==null&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Headers]"}function nR(t){const e=Dn(()=>{if(Zp(t))return t;if(Array.isArray(t))return new Headers(t);if(typeof t=="object"&&t!==null&&"values"in t&&Zp(t.values))return t.values;if(typeof t=="object"&&t!==null){const r=Object.entries(t).filter(([,n])=>typeof n=="string").map(([n,s])=>[n,s]);return new Headers(r)}return new Headers});return Object.fromEntries(e.entries())}function sR(){let t=Ol();return(t==="node"||t==="deno")&&(t=`(${t}/${process.version}; ${process.platform}; ${process.arch})`),t}function aR(t,e=!1,r="1.0.0"){const n=nR(t),s=sR(),a=`langchainjs${e?"-azure":""}-openai`;return{...n,"User-Agent":n["User-Agent"]?`${a}/${r} (${s})${n["User-Agent"]}`:`${a}/${r} (${s})`}}var iR={};Ne(iR,{convertToOpenAIFunction:()=>V0,convertToOpenAITool:()=>H0,isLangChainTool:()=>Ro,isRunnableToolLike:()=>od,isStructuredTool:()=>id,isStructuredToolParams:()=>cd});function V0(t,e){const r=typeof e=="number"?void 0:e;return{name:t.name,description:t.description,parameters:ur(t.schema),...(r==null?void 0:r.strict)!==void 0?{strict:r.strict}:{}}}function H0(t,e){const r=typeof e=="number"?void 0:e;let n;return Ro(t)?n={type:"function",function:V0(t)}:n=t,(r==null?void 0:r.strict)!==void 0&&(n.function.strict=r.strict),n}var oR={};Ne(oR,{extendInteropZodObject:()=>fI,getInteropZodDefaultGetter:()=>pI,getInteropZodObjectShape:()=>ku,getSchemaDescription:()=>ko,interopParse:()=>uI,interopParseAsync:()=>Ao,interopSafeParse:()=>cI,interopSafeParseAsync:()=>Kg,interopZodObjectMakeFieldsOptional:()=>_I,interopZodObjectPartial:()=>hI,interopZodObjectPassthrough:()=>Ou,interopZodObjectStrict:()=>qi,interopZodTransformInputSchema:()=>Qg,isInteropZodError:()=>e_,isInteropZodLiteral:()=>oI,isInteropZodObject:()=>dI,isInteropZodSchema:()=>Ir,isShapelessZodSchema:()=>lI,isSimpleStringZodSchema:()=>Hl,isZodArrayV4:()=>Oo,isZodLiteralV3:()=>Wg,isZodLiteralV4:()=>Jg,isZodNullableV4:()=>Yg,isZodObjectV3:()=>Wl,isZodObjectV4:()=>$r,isZodOptionalV4:()=>Xg,isZodSchema:()=>iI,isZodSchemaV3:()=>tt,isZodSchemaV4:()=>He});function cR(t,e){let r;return Ro(t)?r=H0(t):r=t,(e==null?void 0:e.strict)!==void 0&&(r.function.strict=e.strict),r}function uR(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function lR(t){const e=["namespace functions {",""];for(const r of t)r.description&&e.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(e.push(`type ${r.name} = (_: {`),e.push(W0(r.parameters,0)),e.push("}) => any;")):e.push(`type ${r.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function W0(t,e){var n;const r=[];for(const[s,a]of Object.entries(t.properties??{}))a.description&&e<2&&r.push(`// ${a.description}`),(n=t.required)!=null&&n.includes(s)?r.push(`${s}: ${oo(a,e)},`):r.push(`${s}?: ${oo(a,e)},`);return r.map(s=>" ".repeat(e)+s).join(`
`)}function oo(t,e){if(uR(t))return t.anyOf.map(r=>oo(r,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(r=>`"${r}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(r=>`${r}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(r=>`${r}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",W0(t,e+2),"}"].join(`
`);case"array":return t.items?`${oo(t.items,e)}[]`:"any[]";default:return""}}function J0(t){if(t)return t==="any"||t==="required"?"required":t==="auto"?"auto":t==="none"?"none":typeof t=="string"?{type:"function",function:{name:t}}:t}function qd(t){return"type"in t&&t.type!=="function"}function dR(t){return typeof t=="object"&&t!==null&&"extras"in t&&typeof t.extras=="object"&&t.extras!==null&&"providerToolDefinition"in t.extras&&typeof t.extras.providerToolDefinition=="object"&&t.extras.providerToolDefinition!==null}function fR(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type!=="function"}function co(t){return typeof t=="object"&&t!==null&&"metadata"in t&&typeof t.metadata=="object"&&t.metadata!==null&&"customTool"in t.metadata&&typeof t.metadata.customTool=="object"&&t.metadata.customTool!==null}function K0(t){return"type"in t&&t.type==="custom"&&"custom"in t&&typeof t.custom=="object"&&t.custom!==null}function hR(t){if(t.type==="custom_tool_call")return{...t,type:"tool_call",call_id:t.id,id:t.call_id,name:t.name,isCustomTool:!0,args:{input:t.input}}}function pR(t){if(t.type==="computer_call")return{...t,type:"tool_call",call_id:t.id,id:t.call_id,name:"computer_use",isComputerTool:!0,args:{action:t.action}}}function mR(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="tool_call"&&"isComputerTool"in t&&t.isComputerTool===!0}function gR(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="tool_call"&&"isCustomTool"in t&&t.isCustomTool===!0}function _R(t){const e=()=>{if(t.custom.format){if(t.custom.format.type==="grammar")return{type:"grammar",definition:t.custom.format.grammar.definition,syntax:t.custom.format.grammar.syntax};if(t.custom.format.type==="text")return{type:"text"}}};return{type:"custom",name:t.custom.name,description:t.custom.description,format:e()}}function yR(t){const e=()=>{if(t.format){if(t.format.type==="grammar")return{type:"grammar",grammar:{definition:t.format.definition,syntax:t.format.syntax}};if(t.format.type==="text")return{type:"text"}}};return{type:"custom",custom:{name:t.name,description:t.description,format:e()}}}const vR=Symbol("Let zodToJsonSchema decide on which parser to use"),Gp={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},bR=t=>typeof t=="string"?{...Gp,basePath:["#"],definitions:{},name:t}:{...Gp,basePath:["#"],definitions:{},...t},sl=t=>"_def"in t?t._def:t;function wR(t){if(!t)return!0;for(const e in t)return!1;return!0}const ER=t=>{const e=bR(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[sl(s),{def:sl(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function X0(t,e,r,n){n!=null&&n.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function Ue(t,e,r,n,s){t[e]=r,X0(t,e,n,s)}function TR(){return{}}function SR(t,e){var n,s;const r={type:"array"};return((s=(n=t.type)==null?void 0:n._def)==null?void 0:s.typeName)!==M.ZodAny&&(r.items=De(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Ue(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Ue(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Ue(r,"minItems",t.exactLength.value,t.exactLength.message,e),Ue(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function xR(t,e){const r={type:"integer",format:"int64"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ue(r,"minimum",n.value,n.message,e):Ue(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Ue(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ue(r,"maximum",n.value,n.message,e):Ue(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Ue(r,"maximum",n.value,n.message,e));break;case"multipleOf":Ue(r,"multipleOf",n.value,n.message,e);break}return r}function IR(){return{type:"boolean"}}function AR(t,e){return De(t.type._def,e)}const kR=(t,e)=>De(t.innerType._def,e);function Y0(t,e,r){const n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>Y0(t,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return OR(t,e)}}const OR=(t,e)=>{const r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(const n of t.checks)switch(n.kind){case"min":Ue(r,"minimum",n.value,n.message,e);break;case"max":Ue(r,"maximum",n.value,n.message,e);break}return r};function CR(t,e){return{...De(t.innerType._def,e),default:t.defaultValue()}}function NR(t,e,r){return e.effectStrategy==="input"?De(t.schema._def,e,r):{}}function $R(t){return{type:"string",enum:[...t.values]}}const RR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function PR(t,e){const r=[De(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),De(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return r.forEach(a=>{if(RR(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function LR(t,e){const r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}let su;const En={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(su===void 0&&(su=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),su),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Q0(t,e){const r={type:"string"};function n(s){return e.patternStrategy==="escape"?DR(s):s}if(t.checks)for(const s of t.checks)switch(s.kind){case"min":Ue(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,s.value):s.value,s.message,e);break;case"max":Ue(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":nr(r,"email",s.message,e);break;case"format:idn-email":nr(r,"idn-email",s.message,e);break;case"pattern:zod":sr(r,En.email,s.message,e);break}break;case"url":nr(r,"uri",s.message,e);break;case"uuid":nr(r,"uuid",s.message,e);break;case"regex":sr(r,s.regex,s.message,e);break;case"cuid":sr(r,En.cuid,s.message,e);break;case"cuid2":sr(r,En.cuid2,s.message,e);break;case"startsWith":sr(r,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":sr(r,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":nr(r,"date-time",s.message,e);break;case"date":nr(r,"date",s.message,e);break;case"time":nr(r,"time",s.message,e);break;case"duration":nr(r,"duration",s.message,e);break;case"length":Ue(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,s.value):s.value,s.message,e),Ue(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,s.value):s.value,s.message,e);break;case"includes":{sr(r,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&nr(r,"ipv4",s.message,e),s.version!=="v4"&&nr(r,"ipv6",s.message,e);break}case"emoji":sr(r,En.emoji,s.message,e);break;case"ulid":{sr(r,En.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{nr(r,"binary",s.message,e);break}case"contentEncoding:base64":{Ue(r,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{sr(r,En.base64,s.message,e);break}}break}case"nanoid":sr(r,En.nanoid,s.message,e)}return r}const DR=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),nr=(t,e,r,n)=>{var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Ue(t,"format",e,r,n)},sr=(t,e,r,n)=>{var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Vp(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Ue(t,"pattern",Vp(e,n),r,n)},Vp=(t,e)=>{var u;const r=typeof t=="function"?t():t;if(!e.applyRegexFlags||!r.flags)return r.source;const n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},s=n.i?r.source.toLowerCase():r.source;let a="",i=!1,o=!1,c=!1;for(let l=0;l<s.length;l++){if(i){a+=s[l],i=!1;continue}if(n.i){if(o){if(s[l].match(/[a-z]/)){c?(a+=s[l],a+=`${s[l-2]}-${s[l]}`.toUpperCase(),c=!1):s[l+1]==="-"&&((u=s[l+2])!=null&&u.match(/[a-z]/))?(a+=s[l],c=!0):a+=`${s[l]}${s[l].toUpperCase()}`;continue}}else if(s[l].match(/[a-z]/)){a+=`[${s[l]}${s[l].toUpperCase()}]`;continue}}if(n.m){if(s[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&s[l]==="."){a+=o?`${s[l]}\r
`:`[${s[l]}\r
]`;continue}a+=s[l],s[l]==="\\"?i=!0:o&&s[l]==="]"?o=!1:!o&&s[l]==="["&&(o=!0)}try{const l=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a};function ev(t,e){var n,s,a,i;if(e.target==="openApi3"&&((n=t.keyType)==null?void 0:n._def.typeName)===M.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((o,c)=>({...o,[c]:De(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const r={type:"object",additionalProperties:De(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return r;if(((s=t.keyType)==null?void 0:s._def.typeName)===M.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const o=Object.entries(Q0(t.keyType._def,e)).reduce((c,[u,l])=>u==="type"?c:{...c,[u]:l},{});return{...r,propertyNames:o}}else if(((i=t.keyType)==null?void 0:i._def.typeName)===M.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};return r}function MR(t,e){if(e.mapStrategy==="record")return ev(t,e);const r=De(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=De(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function jR(t){const e=t.values,n=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function FR(){return{not:{}}}function UR(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const uo={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function BR(t,e){if(e.target==="openApi3")return Hp(t,e);const r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in uo&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((s,a)=>{const i=uo[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===r.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:r.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return Hp(t,e)}const Hp=(t,e)=>{const r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,s)=>De(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function zR(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:uo[t.innerType._def.typeName],nullable:!0}:{type:[uo[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=De(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=De(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function qR(t,e){const r={type:"number"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"int":r.type="integer",X0(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ue(r,"minimum",n.value,n.message,e):Ue(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Ue(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ue(r,"maximum",n.value,n.message,e):Ue(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Ue(r,"maximum",n.value,n.message,e));break;case"multipleOf":Ue(r,"multipleOf",n.value,n.message,e);break}return r}function ZR(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":De(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":De(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function GR(t,e){const r={type:"object",...Object.entries(t.shape()).reduce((n,[s,a])=>{var c;if(a===void 0||a._def===void 0)return n;const i=[...e.currentPath,"properties",s],o=De(a._def,{...e,currentPath:i,propertyPath:i});if(o===void 0)return n;if(e.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&typeof((c=a._def)==null?void 0:c.defaultValue)>"u")throw new Error(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...n.properties,[s]:o},required:a.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:ZR(t,e)};return r.required.length||delete r.required,r}const VR=(t,e)=>{if(e.propertyPath&&e.currentPath.slice(0,e.propertyPath.length).toString()===e.propertyPath.toString())return De(t.innerType._def,{...e,currentPath:e.currentPath});const r=De(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},HR=(t,e)=>{if(e.pipeStrategy==="input")return De(t.in._def,e);if(e.pipeStrategy==="output")return De(t.out._def,e);const r=De(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=De(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(s=>s!==void 0)}};function WR(t,e){return De(t.type._def,e)}function JR(t,e){const n={type:"array",uniqueItems:!0,items:De(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Ue(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Ue(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function KR(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>De(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:De(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>De(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function XR(){return{not:{}}}function YR(){return{}}const QR=(t,e)=>De(t.innerType._def,e);function De(t,e,r=!1){var i;const n=e.seen.get(t);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,t,e,n,r);if(o!==vR)return o}if(n&&!r){const o=e2(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=r2(t,t.typeName,e,r);return a&&n2(t,e,a),s.jsonSchema=a,a}const e2=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"extract-to-root":const r=t.path.slice(e.basePath.length+1).join("_");return r!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[r]=t.def),{$ref:[...e.basePath,e.definitionPath,r].join("/")};case"relative":return{$ref:t2(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},t2=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},r2=(t,e,r,n)=>{switch(e){case M.ZodString:return Q0(t,r);case M.ZodNumber:return qR(t,r);case M.ZodObject:return GR(t,r);case M.ZodBigInt:return xR(t,r);case M.ZodBoolean:return IR();case M.ZodDate:return Y0(t,r);case M.ZodUndefined:return XR();case M.ZodNull:return UR(r);case M.ZodArray:return SR(t,r);case M.ZodUnion:case M.ZodDiscriminatedUnion:return BR(t,r);case M.ZodIntersection:return PR(t,r);case M.ZodTuple:return KR(t,r);case M.ZodRecord:return ev(t,r);case M.ZodLiteral:return LR(t,r);case M.ZodEnum:return $R(t);case M.ZodNativeEnum:return jR(t);case M.ZodNullable:return zR(t,r);case M.ZodOptional:return VR(t,r);case M.ZodMap:return MR(t,r);case M.ZodSet:return JR(t,r);case M.ZodLazy:return De(t.getter()._def,r);case M.ZodPromise:return WR(t,r);case M.ZodNaN:case M.ZodNever:return FR();case M.ZodEffects:return NR(t,r,n);case M.ZodAny:return TR();case M.ZodUnknown:return YR();case M.ZodDefault:return CR(t,r);case M.ZodBranded:return AR(t,r);case M.ZodReadonly:return QR(t,r);case M.ZodCatch:return kR(t,r);case M.ZodPipeline:return HR(t,r);case M.ZodFunction:case M.ZodVoid:case M.ZodSymbol:return;default:return(s=>{})()}},n2=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r),s2=(t,e)=>{const r=ER(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=De(t._def,n===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(wR(r.definitions))return;const c={},u=new Set;for(let l=0;l<500;l++){const d=Object.entries(r.definitions).filter(([h])=>!u.has(h));if(d.length===0)break;for(const[h,f]of d)c[h]=De(sl(f),{...r,currentPath:[...r.basePath,r.definitionPath,h]},!0)??{},u.add(h)}return c})(),o=n===void 0?i?{...s,[r.definitionPath]:i}:s:r.nameStrategy==="duplicate-ref"?{...s,...i||r.seenRefs.size?{[r.definitionPath]:{...i,...r.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...i,[n]:s}};return r.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function a2(t){if(t.type!=="object")throw new Error(`Root schema must have type: 'object' but got type: ${t.type?`'${t.type}'`:"undefined"}`);const e=structuredClone(t);return zr(e,[],e)}function al(t){if(typeof t=="boolean")return!1;if(t.type==="null")return!0;for(const e of t.oneOf??[])if(al(e))return!0;for(const e of t.anyOf??[])if(al(e))return!0;return!1}function zr(t,e,r){if(typeof t=="boolean")throw new TypeError(`Expected object schema but got boolean; path=${e.join("/")}`);if(!xn(t))throw new TypeError(`Expected ${JSON.stringify(t)} to be an object; path=${e.join("/")}`);const n=t.$defs;if(xn(n))for(const[h,f]of Object.entries(n))zr(f,[...e,"$defs",h],r);const s=t.definitions;if(xn(s))for(const[h,f]of Object.entries(s))zr(f,[...e,"definitions",h],r);t.type==="object"&&!("additionalProperties"in t)&&(t.additionalProperties=!1);const i=t.required??[],o=t.properties;if(xn(o)){for(const[h,f]of Object.entries(o))if(!al(f)&&!i.includes(h))throw new Error(`Zod field at \`${[...e,"properties",h].join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);t.required=Object.keys(o),t.properties=Object.fromEntries(Object.entries(o).map(([h,f])=>[h,zr(f,[...e,"properties",h],r)]))}const c=t.items;xn(c)&&(t.items=zr(c,[...e,"items"],r));const u=t.anyOf;Array.isArray(u)&&(t.anyOf=u.map((h,f)=>zr(h,[...e,"anyOf",String(f)],r)));const l=t.allOf;if(Array.isArray(l))if(l.length===1){const h=zr(l[0],[...e,"allOf","0"],r);Object.assign(t,h),delete t.allOf}else t.allOf=l.map((h,f)=>zr(h,[...e,"allOf",String(f)],r));t.default===null&&delete t.default;const d=t.$ref;if(d&&o2(t,1)){if(typeof d!="string")throw new TypeError(`Received non-string $ref - ${d}; path=${e.join("/")}`);const h=i2(r,d);if(typeof h=="boolean")throw new Error(`Expected \`$ref: ${d}\` to resolve to an object schema but got boolean`);if(!xn(h))throw new Error(`Expected \`$ref: ${d}\` to resolve to an object but got ${JSON.stringify(h)}`);return Object.assign(t,{...h,...t}),delete t.$ref,zr(t,e,r)}return t}function i2(t,e){if(!e.startsWith("#/"))throw new Error(`Unexpected $ref format ${JSON.stringify(e)}; Does not start with #/`);const r=e.slice(2).split("/");let n=t;for(const s of r){if(!xn(n))throw new Error(`encountered non-object entry while resolving ${e} - ${JSON.stringify(n)}`);const a=n[s];if(a===void 0)throw new Error(`Key ${s} not found while resolving ${e}`);n=a}return n}function xn(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function o2(t,e){let r=0;for(const n in t)if(r++,r>e)return!0;return!1}function c2(t,e){return s2(t,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function u2(t){return a2(Au(t,{target:"draft-7"}))}function l2(t){return"_zod"in t}function d2(t,e,r){return w4({type:"json_schema",json_schema:{...r,name:e,strict:!0,schema:l2(t)?u2(t):c2(t,{name:e})}},n=>t.parse(JSON.parse(n)))}const Wp=["jsonSchema","functionCalling","jsonMode"];function f2(t,e){if(typeof e<"u"&&!Wp.includes(e))throw new Error(`Invalid method: ${e}. Supported methods are: ${Wp.join(", ")}`);const r=!t.startsWith("gpt-3")&&!t.startsWith("gpt-4-")&&t!=="gpt-4";if(r&&!e)return"jsonSchema";if(!r&&e==="jsonSchema")throw new Error(`JSON Schema is not supported for model "${t}". Please use a different method, e.g. "functionCalling" or "jsonMode".`);return e??"functionCalling"}function h2(t,e){const r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),r}function p2(t,e,r){if(tt(t))return d2(t,e,r);if(He(t))return h2({type:"json_schema",json_schema:{...r,name:e,strict:!0,schema:ur(t,{cycles:"ref",reused:"ref",override(n){n.jsonSchema.title=e}})}},n=>xo(t,JSON.parse(n)));throw new Error("Unsupported schema response format")}function m2(t,e){if(e&&typeof e=="object"&&"images"in e&&Array.isArray(e.images)){const r=e.images.filter(n=>{var s;return typeof((s=n==null?void 0:n.image_url)==null?void 0:s.url)=="string"}).map(n=>({type:"image",url:n.image_url.url}));return[{type:"text",text:t},...r]}return t}const g2={"gpt-4.1-nano":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-3-small":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:8192,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-05-13":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-08-06":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1-mini":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-3.5-turbo":{maxInputTokens:16385,imageInputs:!1,audioInputs:!1,pdfInputs:!1,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!1,imageUrlInputs:!1,pdfToolMessage:!1,imageToolMessage:!1,toolChoice:!0},"text-embedding-3-large":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:3072,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4-turbo":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-preview":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-mini":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"codex-mini-latest":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-nano":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-codex":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o1:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-mini":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-mini":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:65536,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-ada-002":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-11-20":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o3:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-chat-latest":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-mini":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-pro":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:272e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0}};var _2=g2,ys=class extends Xe{constructor(e){super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"func");e&&(this.func=e.func)}static lc_name(){return"RunnablePassthrough"}async invoke(e,r){const n=Pe(r);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,r){const n=Pe(r);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,n))if(yield i,a)if(s===void 0)s=i;else try{s=yn(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new td(new ws({steps:e}))}};const y2=t=>t();function au(t){const e=t.constructor;return new e({...t,content:t.contentBlocks,response_metadata:{...t.response_metadata,output_version:"v1"}})}var v2={};Ne(v2,{BaseChatModel:()=>Zd,SimpleChatModel:()=>b2});function iu(t){const e=[];for(const r of t){let n=r;if(Array.isArray(r.content))for(let s=0;s<r.content.length;s++){const a=r.content[s];(_l(a)||yl(a))&&n===r&&(n=new r.constructor({...n,content:[...r.content.slice(0,s),mm(a),...r.content.slice(s+1)]}))}e.push(n)}return e}var Zd=class In extends ad{constructor(r){super(r);E(this,"lc_namespace",["langchain","chat_models",this._llmType()]);E(this,"disableStreaming",!1);E(this,"outputVersion");this.outputVersion=y2(()=>{const n=r.outputVersion??Nr("LC_OUTPUT_VERSION");return n&&["v0","v1"].includes(n)?n:"v0"})}get callKeys(){return[...super.callKeys,"outputVersion"]}_separateRunnableConfigFromCallOptionsCompat(r){const[n,s]=super._separateRunnableConfigFromCallOptions(r);return s.signal=n.signal,[n,s]}async invoke(r,n){const s=In._convertInputToPromptValue(r);return(await this.generatePrompt([s],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(r,n,s){throw new Error("Not implemented.")}async*_streamIterator(r,n){var s;if(this._streamResponseChunks===In.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(r,n);else{const i=In._convertInputToPromptValue(r).toChatMessages(),[o,c]=this._separateRunnableConfigFromCallOptionsCompat(n),u={...o.metadata,...this.getLsParams(c)},l=await Pt.configure(o.callbacks,this.callbacks,o.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:c,invocation_params:this==null?void 0:this.invocationParams(c),batch_size:1},h=c.outputVersion??this.outputVersion,f=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),[iu(i)],o.runId,void 0,d,void 0,void 0,o.runName));let m,_;try{for await(const y of this._streamResponseChunks(i,c,f==null?void 0:f[0])){if(y.message.id==null){const w=(s=f==null?void 0:f.at(0))==null?void 0:s.runId;w!=null&&y.message._updateId(`run-${w}`)}y.message.response_metadata={...y.generationInfo,...y.message.response_metadata},h==="v1"?yield au(y.message):yield y.message,m?m=m.concat(y):m=y,bu(y.message)&&y.message.usage_metadata!==void 0&&(_={tokenUsage:{promptTokens:y.message.usage_metadata.input_tokens,completionTokens:y.message.usage_metadata.output_tokens,totalTokens:y.message.usage_metadata.total_tokens}})}}catch(y){throw await Promise.all((f??[]).map(w=>w==null?void 0:w.handleLLMError(y))),y}await Promise.all((f??[]).map(y=>y==null?void 0:y.handleLLMEnd({generations:[[m]],llmOutput:_})))}}getLsParams(r){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:r.stop,ls_provider:n}}async _generateUncached(r,n,s,a){var f,m;const i=r.map(_=>_.map(Vs));let o;if(a!==void 0&&a.length===i.length)o=a;else{const _={...s.metadata,...this.getLsParams(n)},y=await Pt.configure(s.callbacks,this.callbacks,s.tags,this.tags,_,this.metadata,{verbose:this.verbose}),w={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1};o=await(y==null?void 0:y.handleChatModelStart(this.toJSON(),i.map(iu),s.runId,void 0,w,void 0,void 0,s.runName))}const c=n.outputVersion??this.outputVersion,u=[],l=[];if(!!(o!=null&&o[0].handlers.find(Nl))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==In.prototype._streamResponseChunks)try{const _=await this._streamResponseChunks(i[0],n,o==null?void 0:o[0]);let y,w;for await(const g of _){if(g.message.id==null){const b=(f=o==null?void 0:o.at(0))==null?void 0:f.runId;b!=null&&g.message._updateId(`run-${b}`)}y===void 0?y=g:y=yn(y,g),bu(g.message)&&g.message.usage_metadata!==void 0&&(w={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(y===void 0)throw new Error("Received empty response from chat model call.");u.push([y]),await(o==null?void 0:o[0].handleLLMEnd({generations:u,llmOutput:w}))}catch(_){throw await(o==null?void 0:o[0].handleLLMError(_)),_}else{const _=await Promise.allSettled(i.map(async(y,w)=>{const g=await this._generate(y,{...n,promptIndex:w},o==null?void 0:o[w]);if(c==="v1")for(const b of g.generations)b.message=au(b.message);return g}));await Promise.all(_.map(async(y,w)=>{var g,b,T;if(y.status==="fulfilled"){const I=y.value;for(const C of I.generations){if(C.message.id==null){const D=(g=o==null?void 0:o.at(0))==null?void 0:g.runId;D!=null&&C.message._updateId(`run-${D}`)}C.message.response_metadata={...C.generationInfo,...C.message.response_metadata}}return I.generations.length===1&&(I.generations[0].message.response_metadata={...I.llmOutput,...I.generations[0].message.response_metadata}),u[w]=I.generations,l[w]=I.llmOutput,(b=o==null?void 0:o[w])==null?void 0:b.handleLLMEnd({generations:[I.generations],llmOutput:I.llmOutput})}else return await((T=o==null?void 0:o[w])==null?void 0:T.handleLLMError(y.reason)),Promise.reject(y.reason)}))}const h={generations:u,llmOutput:l.length?(m=this._combineLLMOutput)==null?void 0:m.call(this,...l):void 0};return Object.defineProperty(h,_a,{value:o?{runIds:o==null?void 0:o.map(_=>_.runId)}:void 0,configurable:!0}),h}async _generateCached({messages:r,cache:n,llmStringKey:s,parsedOptions:a,handledOptions:i}){const o=r.map(g=>g.map(Vs)),c={...i.metadata,...this.getLsParams(a)},u=await Pt.configure(i.callbacks,this.callbacks,i.tags,this.tags,c,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),o.map(iu),i.runId,void 0,l,void 0,void 0,i.runName)),h=[],m=(await Promise.allSettled(o.map(async(g,b)=>{const T=In._convertInputToPromptValue(g).toString(),I=await n.lookup(T,s);return I==null&&h.push(b),I}))).map((g,b)=>({result:g,runManager:d==null?void 0:d[b]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),_=a.outputVersion??this.outputVersion,y=[];await Promise.all(m.map(async({result:g,runManager:b},T)=>{if(g.status==="fulfilled"){const I=g.value;return y[T]=I.map(C=>("message"in C&&un(C.message)&&_o(C.message)&&(C.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},_==="v1"&&(C.message=au(C.message))),C.generationInfo={...C.generationInfo,tokenUsage:{}},C)),I.length&&await(b==null?void 0:b.handleLLMNewToken(I[0].text)),b==null?void 0:b.handleLLMEnd({generations:[I]},void 0,void 0,void 0,{cached:!0})}else return await(b==null?void 0:b.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const w={generations:y,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(w,_a,{value:d?{runIds:d==null?void 0:d.map(g=>g.runId)}:void 0,configurable:!0}),w}async generate(r,n,s){let a;Array.isArray(n)?a={stop:n}:a=n;const i=r.map(_=>_.map(Vs)),[o,c]=this._separateRunnableConfigFromCallOptionsCompat(a);if(o.callbacks=o.callbacks??s,!this.cache)return this._generateUncached(i,c,o);const{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(c),{generations:d,missingPromptIndices:h,startedRunManagers:f}=await this._generateCached({messages:i,cache:u,llmStringKey:l,parsedOptions:c,handledOptions:o});let m={};if(h.length>0){const _=await this._generateUncached(h.map(y=>i[y]),c,o,f!==void 0?h.map(y=>f==null?void 0:f[y]):void 0);await Promise.all(_.generations.map(async(y,w)=>{const g=h[w];d[g]=y;const b=In._convertInputToPromptValue(i[g]).toString();return u.update(b,l,y)})),m=_.llmOutput??{}}return{generations:d,llmOutput:m}}invocationParams(r){return{}}_modelType(){return"base_chat_model"}async generatePrompt(r,n,s){const a=r.map(i=>i.toChatMessages());return this.generate(a,n,s)}withStructuredOutput(r,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n!=null&&n.strict)throw new Error('"strict" mode is not supported for this model by default.');const s=r,a=n==null?void 0:n.name,i=ko(s)??"A function available to call.",o=n==null?void 0:n.method,c=n==null?void 0:n.includeRaw;if(o==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=a??"extract",l;Ir(s)?l=[{type:"function",function:{name:u,description:i,parameters:ur(s)}}]:("name"in s&&(u=s.name),l=[{type:"function",function:{name:u,description:i,parameters:s}}]);const d=this.bindTools(l),h=Yr.from(y=>{if(!Mr.isInstance(y))throw new Error("Input is not an AIMessageChunk.");if(!y.tool_calls||y.tool_calls.length===0)throw new Error("No tool calls found in the response.");const w=y.tool_calls.find(g=>g.name===u);if(!w)throw new Error(`No tool call found with name ${u}.`);return w.args});if(!c)return d.pipe(h).withConfig({runName:"StructuredOutput"});const f=ys.assign({parsed:(y,w)=>h.invoke(y.raw,w)}),m=ys.assign({parsed:()=>null}),_=f.withFallbacks({fallbacks:[m]});return Na.from([{raw:d},_]).withConfig({runName:"StructuredOutputRunnable"})}},b2=class extends Zd{async _generate(t,e,r){const n=await this._call(t,e,r),s=new It(n);if(typeof s.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:s.content,message:s}]}}},w2=class extends Xe{constructor(e){super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"runnables");this.runnables=e.runnables}static lc_name(){return"RouterRunnable"}async invoke(e,r){const{key:n,input:s}=e,a=this.runnables[n];if(a===void 0)throw new Error(`No runnable associated with key "${n}".`);return a.invoke(s,Pe(r))}async batch(e,r,n){var h;const s=e.map(f=>f.key),a=e.map(f=>f.input);if(s.find(f=>this.runnables[f]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=s.map(f=>this.runnables[f]),c=this._getOptionsList(r??{},e.length),u=((h=c[0])==null?void 0:h.maxConcurrency)??(n==null?void 0:n.maxConcurrency),l=u&&u>0?u:e.length,d=[];for(let f=0;f<a.length;f+=l){const m=a.slice(f,f+l).map((y,w)=>o[w].invoke(y,c[w])),_=await Promise.all(m);d.push(_)}return d.flat()}async stream(e,r){const{key:n,input:s}=e,a=this.runnables[n];if(a===void 0)throw new Error(`No runnable associated with key "${n}".`);return a.stream(s,r)}},E2=class extends Xe{constructor(e){super(e);E(this,"lc_namespace",["langchain_core","runnables"]);E(this,"lc_serializable",!0);E(this,"default");E(this,"branches");this.branches=e.branches,this.default=e.default}static lc_name(){return"RunnableBranch"}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const n=e.slice(0,-1).map(([a,i])=>[dr(a),dr(i)]),s=dr(e[e.length-1]);return new this({branches:n,default:s})}async _invoke(e,r,n){let s;for(let a=0;a<this.branches.length;a+=1){const[i,o]=this.branches[a];if(await i.invoke(e,qe(r,{callbacks:n==null?void 0:n.getChild(`condition:${a+1}`)}))){s=await o.invoke(e,qe(r,{callbacks:n==null?void 0:n.getChild(`branch:${a+1}`)}));break}}return s||(s=await this.default.invoke(e,qe(r,{callbacks:n==null?void 0:n.getChild("branch:default")}))),s}async invoke(e,r={}){return this._callWithConfig(this._invoke,e,r)}async*_streamIterator(e,r){const n=await qt(r),s=await(n==null?void 0:n.handleChainStart(this.toJSON(),at(e,"input"),r==null?void 0:r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));let a,i=!0,o;try{for(let c=0;c<this.branches.length;c+=1){const[u,l]=this.branches[c];if(await u.invoke(e,qe(r,{callbacks:s==null?void 0:s.getChild(`condition:${c+1}`)}))){o=await l.stream(e,qe(r,{callbacks:s==null?void 0:s.getChild(`branch:${c+1}`)}));for await(const h of o)if(yield h,i)if(a===void 0)a=h;else try{a=yn(a,h)}catch{a=void 0,i=!1}break}}if(o===void 0){o=await this.default.stream(e,qe(r,{callbacks:s==null?void 0:s.getChild("branch:default")}));for await(const c of o)if(yield c,i)if(a===void 0)a=c;else try{a=yn(a,c)}catch{a=void 0,i=!1}}}catch(c){throw await(s==null?void 0:s.handleChainError(c)),c}await(s==null?void 0:s.handleChainEnd(a??{}))}},T2=class extends ms{constructor(e){let r=Yr.from((i,o)=>this._enterHistory(i,o??{})).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(r=ys.assign({[n]:r}).withConfig({runName:"insertHistory"}));const s=r.pipe(e.runnable.withListeners({onEnd:(i,o)=>this._exitHistory(i,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:s});E(this,"runnable");E(this,"inputMessagesKey");E(this,"outputMessagesKey");E(this,"historyMessagesKey");E(this,"getMessageHistory");this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let r;if(typeof e=="object"&&!Array.isArray(e)&&!un(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?r=e[n][0]:r=e[n]}else r=e;if(typeof r=="string")return[new Dr(r)];if(Array.isArray(r))return r;if(un(r))return[r];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(r,null,2)}`)}_getOutputMessages(e){let r;if(!Array.isArray(e)&&!un(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?r=e.generations[0][0].message:r=e[n]}else r=e;if(typeof r=="string")return[new It(r)];if(Array.isArray(r))return r;if(un(r))return[r];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(r,null,2)}`)}async _enterHistory(e,r){var a;const s=await((a=r==null?void 0:r.configurable)==null?void 0:a.messageHistory).getMessages();return this.historyMessagesKey===void 0?s.concat(this._getInputMessages(e)):s}async _exitHistory(e,r){var c;const n=(c=r.configurable)==null?void 0:c.messageHistory;let s;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?s=e.inputs[0]:s=e.inputs;let a=this._getInputMessages(s);if(this.historyMessagesKey===void 0){const u=await n.getMessages();a=a.slice(u.length)}const i=e.outputs;if(!i)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(i);await n.addMessages([...a,...o])}async _mergeConfig(...e){const r=await super._mergeConfig(...e);if(!r.configurable||!r.configurable.sessionId){const s={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(s)}, ${JSON.stringify(a)})`)}const{sessionId:n}=r.configurable;return r.configurable.messageHistory=await this.getMessageHistory(n),r}},S2={};Ne(S2,{RouterRunnable:()=>w2,Runnable:()=>Xe,RunnableAssign:()=>td,RunnableBinding:()=>ms,RunnableBranch:()=>E2,RunnableEach:()=>pk,RunnableLambda:()=>Yr,RunnableMap:()=>ws,RunnableParallel:()=>_k,RunnablePassthrough:()=>ys,RunnablePick:()=>S_,RunnableRetry:()=>ed,RunnableSequence:()=>Na,RunnableToolLike:()=>Uu,RunnableWithFallbacks:()=>T_,RunnableWithMessageHistory:()=>T2,_coerceToRunnable:()=>dr,ensureConfig:()=>Pe,getCallbackManagerForConfig:()=>qt,mergeConfigs:()=>Fi,patchConfig:()=>qe,pickRunnableConfigKeys:()=>Jr,raceWithSignal:()=>Kr});var tv=class extends Xe{parseResultWithPrompt(t,e,r){return this.parseResult(t,r)}_baseMessageToString(t){return typeof t.content=="string"?t.content:this._baseMessageContentToString(t.content)}_baseMessageContentToString(t){return JSON.stringify(t)}async invoke(t,e){return typeof t=="string"?this._callWithConfig(async(r,n)=>this.parseResult([{text:r}],n==null?void 0:n.callbacks),t,{...e,runType:"parser"}):this._callWithConfig(async(r,n)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],n==null?void 0:n.callbacks),t,{...e,runType:"parser"})}},oc=class extends tv{parseResult(t,e){return this.parse(t[0].text,e)}async parseWithPrompt(t,e,r){return this.parse(t,r)}_type(){throw new Error("_type not implemented")}},Gr=class extends Error{constructor(e,r,n,s=!1){super(e);E(this,"llmOutput");E(this,"observation");E(this,"sendToLLM");if(this.llmOutput=r,this.observation=n,this.sendToLLM=s,s&&(n===void 0||r===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Im(this,"OUTPUT_PARSING_FAILURE")}},ja=class extends oc{async*_transform(t){for await(const e of t)typeof e=="string"?yield this.parseResult([{text:e}]):yield this.parseResult([{message:e,text:this._baseMessageToString(e)}])}async*transform(t,e){yield*this._transformStreamWithConfig(t,this._transform.bind(this),{...e,runType:"parser"})}},cc=class extends ja{constructor(e){super(e);E(this,"diff",!1);this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let r,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(El(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new ps({message:s,text:s.content})}else if(un(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new ps({message:Di(s),text:s.content})}else a=new hs({text:s});n===void 0?n=a:n=n.concat(a);const i=await this.parsePartialResult([n]);i!=null&&!Rn(i,r)&&(this.diff?yield this._diff(r,i):yield i,r=i)}}getFormatInstructions(){return""}},x2=class extends ja{constructor(){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers","bytes"]);E(this,"lc_serializable",!0);E(this,"textEncoder",new TextEncoder)}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},Fa=class extends ja{constructor(){super(...arguments);E(this,"re")}async*_transform(e){let r="";for await(const n of e)if(typeof n=="string"?r+=n:r+=n.content,this.re){const s=[...r.matchAll(this.re)];if(s.length>1){let a=0;for(const i of s.slice(0,-1))yield[i[1]],a+=(i.index??0)+i[0].length;r=r.slice(a)}}else{const s=await this.parse(r);if(s.length>1){for(const a of s.slice(0,-1))yield[a];r=s[s.length-1]}}for(const n of await this.parse(r))yield[n]}},I2=class extends Fa{constructor(){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers","list"]);E(this,"lc_serializable",!0)}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(r=>r.trim())}catch{throw new Gr(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},A2=class extends Fa{constructor({length:e,separator:r}){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers","list"]);E(this,"length");E(this,"separator");this.length=e,this.separator=r||","}async parse(e){try{const r=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&r.length!==this.length)throw new Gr(`Incorrect number of items. Expected ${this.length}, got ${r.length}.`);return r}catch(r){throw Object.getPrototypeOf(r)===Gr.prototype?r:new Gr(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},k2=class extends Fa{constructor(){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers","list"]);E(this,"lc_serializable",!0);E(this,"re",/\d+\.\s([^\n]+)/g)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(r=>r[1])}},O2=class extends Fa{constructor(){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers","list"]);E(this,"lc_serializable",!0);E(this,"re",/^\s*[-*]\s([^\n]+)$/gm)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(r=>r[1])}},C2=class extends ja{constructor(){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers","string"]);E(this,"lc_serializable",!0)}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((r,n)=>r+this._messageContentToString(n),"")}},lo=class extends oc{constructor(e){super(e);E(this,"lc_namespace",["langchain","output_parsers","structured"]);this.schema=e}static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const r=Lr(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,Kt().describe(s)])));return new this(r)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(ur(this.schema))}
\`\`\`
`}async parse(e){var r,n;try{const s=e.trim(),i=(((r=s.match(/^```(?:json)?\s*([\s\S]*?)```/))==null?void 0:r[1])||((n=s.match(/```json\s*([\s\S]*?)```/))==null?void 0:n[1])||s).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(o,c)=>`"${c.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await Ao(this.schema,JSON.parse(i))}catch(s){throw new Gr(`Failed to parse. Text: "${e}". Error: ${s}`,e)}}},rv=class extends lo{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(t){const e=(t==null?void 0:t.interpolationDepth)??1;if(e<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(ur(this.schema)).replaceAll("{","{".repeat(e)).replaceAll("}","}".repeat(e))}
\`\`\``}_schemaToInstruction(t,e=2){const r=t;if("type"in r){let n=!1,s;if(Array.isArray(r.type)){const o=r.type.findIndex(c=>c==="null");o!==-1&&(n=!0,r.type.splice(o,1)),s=r.type.join(" | ")}else s=r.type;if(r.type==="object"&&r.properties){const o=r.description?` // ${r.description}`:"";return`{
${Object.entries(r.properties).map(([u,l])=>{var h;const d=(h=r.required)!=null&&h.includes(u)?"":" (optional)";return`${" ".repeat(e)}"${u}": ${this._schemaToInstruction(l,e+2)}${d}`}).join(`
`)}
${" ".repeat(e-2)}}${o}`}if(r.type==="array"&&r.items){const o=r.description?` // ${r.description}`:"";return`array[
${" ".repeat(e)}${this._schemaToInstruction(r.items,e+2)}
${" ".repeat(e-2)}] ${o}`}const a=n?" (nullable)":"",i=r.description?` // ${r.description}`:"";return`${s}${i}${a}`}if("anyOf"in r)return r.anyOf.map(n=>this._schemaToInstruction(n,e)).join(`
${" ".repeat(e-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(t){return new this(t)}static fromNamesAndDescriptions(t){const e=Lr(Object.fromEntries(Object.entries(t).map(([r,n])=>[r,Kt().describe(n)])));return new this(e)}},N2=class extends oc{constructor({inputSchema:e}){super(...arguments);E(this,"structuredInputParser");this.structuredInputParser=new rv(e)}async parse(e){let r;try{r=await this.structuredInputParser.parse(e)}catch(n){throw new Gr(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(r)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}},$2={};Ne($2,{applyPatch:()=>fs,compare:()=>Kl});var il=class extends cc{constructor(){super(...arguments);E(this,"lc_namespace",["langchain_core","output_parsers"]);E(this,"lc_serializable",!0)}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,r){return this.diff?super._concatOutputChunks(e,r):r}_diff(e,r){if(r)return e?Kl(e,r):[{op:"replace",path:"",value:r}]}async parsePartialResult(e){return vu(e[0].text)}async parse(e){return vu(e,JSON.parse)}getFormatInstructions(){return""}_baseMessageToString(e){return e.text}};const R2=function(){const t={};t.parser=function(S,p){return new r(S,p)},t.SAXParser=r,t.SAXStream=u,t.createStream=c,t.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function r(S,p){if(!(this instanceof r))return new r(S,p);var v=this;s(v),v.q=v.c="",v.bufferCheckPosition=t.MAX_BUFFER_LENGTH,v.opt=p||{},v.opt.lowercase=v.opt.lowercase||v.opt.lowercasetags,v.looseCase=v.opt.lowercase?"toLowerCase":"toUpperCase",v.tags=[],v.closed=v.closedRoot=v.sawRoot=!1,v.tag=v.error=null,v.strict=!!S,v.noscript=!!(S||v.opt.noscript),v.state=k.BEGIN,v.strictEntities=v.opt.strictEntities,v.ENTITIES=v.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),v.attribList=[],v.opt.xmlns&&(v.ns=Object.create(m)),v.trackPosition=v.opt.position!==!1,v.trackPosition&&(v.position=v.line=v.column=0),H(v,"onready")}Object.create||(Object.create=function(S){function p(){}p.prototype=S;var v=new p;return v}),Object.keys||(Object.keys=function(S){var p=[];for(var v in S)S.hasOwnProperty(v)&&p.push(v);return p});function n(S){for(var p=Math.max(t.MAX_BUFFER_LENGTH,10),v=0,x=0,O=e.length;x<O;x++){var ae=S[e[x]].length;if(ae>p)switch(e[x]){case"textNode":pe(S);break;case"cdata":q(S,"oncdata",S.cdata),S.cdata="";break;case"script":q(S,"onscript",S.script),S.script="";break;default:N(S,"Max buffer length exceeded: "+e[x])}v=Math.max(v,ae)}var U=t.MAX_BUFFER_LENGTH-v;S.bufferCheckPosition=U+S.position}function s(S){for(var p=0,v=e.length;p<v;p++)S[e[p]]=""}function a(S){pe(S),S.cdata!==""&&(q(S,"oncdata",S.cdata),S.cdata=""),S.script!==""&&(q(S,"onscript",S.script),S.script="")}r.prototype={end:function(){P(this)},write:_e,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){a(this)}};var i=ReadableStream;i||(i=function(){});var o=t.EVENTS.filter(function(S){return S!=="error"&&S!=="end"});function c(S,p){return new u(S,p)}function u(S,p){if(!(this instanceof u))return new u(S,p);i.apply(this),this._parser=new r(S,p),this.writable=!0,this.readable=!0;var v=this;this._parser.onend=function(){v.emit("end")},this._parser.onerror=function(x){v.emit("error",x),v._parser.error=null},this._decoder=null,o.forEach(function(x){Object.defineProperty(v,"on"+x,{get:function(){return v._parser["on"+x]},set:function(O){if(!O)return v.removeAllListeners(x),v._parser["on"+x]=O,O;v.on(x,O)},enumerable:!0,configurable:!1})})}u.prototype=Object.create(i.prototype,{constructor:{value:u}}),u.prototype.write=function(S){return this._parser.write(S.toString()),this.emit("data",S),!0},u.prototype.end=function(S){return S&&S.length&&this.write(S),this._parser.end(),!0},u.prototype.on=function(S,p){var v=this;return!v._parser["on"+S]&&o.indexOf(S)!==-1&&(v._parser["on"+S]=function(){var x=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);x.splice(0,0,S),v.emit.apply(v,x)}),i.prototype.on.call(v,S,p)};var l="[CDATA[",d="DOCTYPE",h="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",m={xml:h,xmlns:f},_=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,w=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,g=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function b(S){return S===" "||S===`
`||S==="\r"||S==="	"}function T(S){return S==='"'||S==="'"}function I(S){return S===">"||b(S)}function C(S,p){return S.test(p)}function D(S,p){return!C(S,p)}var k=0;t.STATE={BEGIN:k++,BEGIN_WHITESPACE:k++,TEXT:k++,TEXT_ENTITY:k++,OPEN_WAKA:k++,SGML_DECL:k++,SGML_DECL_QUOTED:k++,DOCTYPE:k++,DOCTYPE_QUOTED:k++,DOCTYPE_DTD:k++,DOCTYPE_DTD_QUOTED:k++,COMMENT_STARTING:k++,COMMENT:k++,COMMENT_ENDING:k++,COMMENT_ENDED:k++,CDATA:k++,CDATA_ENDING:k++,CDATA_ENDING_2:k++,PROC_INST:k++,PROC_INST_BODY:k++,PROC_INST_ENDING:k++,OPEN_TAG:k++,OPEN_TAG_SLASH:k++,ATTRIB:k++,ATTRIB_NAME:k++,ATTRIB_NAME_SAW_WHITE:k++,ATTRIB_VALUE:k++,ATTRIB_VALUE_QUOTED:k++,ATTRIB_VALUE_CLOSED:k++,ATTRIB_VALUE_UNQUOTED:k++,ATTRIB_VALUE_ENTITY_Q:k++,ATTRIB_VALUE_ENTITY_U:k++,CLOSE_TAG:k++,CLOSE_TAG_SAW_WHITE:k++,SCRIPT:k++,SCRIPT_ENDING:k++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(S){var p=t.ENTITIES[S],v=typeof p=="number"?String.fromCharCode(p):p;t.ENTITIES[S]=v});for(var A in t.STATE)t.STATE[t.STATE[A]]=A;k=t.STATE;function H(S,p,v){S[p]&&S[p](v)}function q(S,p,v){S.textNode&&pe(S),H(S,p,v)}function pe(S){S.textNode=Q(S.opt,S.textNode),S.textNode&&H(S,"ontext",S.textNode),S.textNode=""}function Q(S,p){return S.trim&&(p=p.trim()),S.normalize&&(p=p.replace(/\s+/g," ")),p}function N(S,p){return pe(S),S.trackPosition&&(p+=`
Line: `+S.line+`
Column: `+S.column+`
Char: `+S.c),p=new Error(p),S.error=p,H(S,"onerror",p),S}function P(S){return S.sawRoot&&!S.closedRoot&&$(S,"Unclosed root tag"),S.state!==k.BEGIN&&S.state!==k.BEGIN_WHITESPACE&&S.state!==k.TEXT&&N(S,"Unexpected end"),pe(S),S.c="",S.closed=!0,H(S,"onend"),r.call(S,S.strict,S.opt),S}function $(S,p){if(typeof S!="object"||!(S instanceof r))throw new Error("bad call to strictFail");S.strict&&N(S,p)}function L(S){S.strict||(S.tagName=S.tagName[S.looseCase]());var p=S.tags[S.tags.length-1]||S,v=S.tag={name:S.tagName,attributes:{}};S.opt.xmlns&&(v.ns=p.ns),S.attribList.length=0,q(S,"onopentagstart",v)}function F(S,p){var v=S.indexOf(":"),x=v<0?["",S]:S.split(":"),O=x[0],ae=x[1];return p&&S==="xmlns"&&(O="xmlns",ae=""),{prefix:O,local:ae}}function Z(S){if(S.strict||(S.attribName=S.attribName[S.looseCase]()),S.attribList.indexOf(S.attribName)!==-1||S.tag.attributes.hasOwnProperty(S.attribName)){S.attribName=S.attribValue="";return}if(S.opt.xmlns){var p=F(S.attribName,!0),v=p.prefix,x=p.local;if(v==="xmlns")if(x==="xml"&&S.attribValue!==h)$(S,"xml: prefix must be bound to "+h+`
Actual: `+S.attribValue);else if(x==="xmlns"&&S.attribValue!==f)$(S,"xmlns: prefix must be bound to "+f+`
Actual: `+S.attribValue);else{var O=S.tag,ae=S.tags[S.tags.length-1]||S;O.ns===ae.ns&&(O.ns=Object.create(ae.ns)),O.ns[x]=S.attribValue}S.attribList.push([S.attribName,S.attribValue])}else S.tag.attributes[S.attribName]=S.attribValue,q(S,"onattribute",{name:S.attribName,value:S.attribValue});S.attribName=S.attribValue=""}function X(S,p){if(S.opt.xmlns){var v=S.tag,x=F(S.tagName);v.prefix=x.prefix,v.local=x.local,v.uri=v.ns[x.prefix]||"",v.prefix&&!v.uri&&($(S,"Unbound namespace prefix: "+JSON.stringify(S.tagName)),v.uri=x.prefix);var O=S.tags[S.tags.length-1]||S;v.ns&&O.ns!==v.ns&&Object.keys(v.ns).forEach(function(At){q(S,"onopennamespace",{prefix:At,uri:v.ns[At]})});for(var ae=0,U=S.attribList.length;ae<U;ae++){var re=S.attribList[ae],Ie=re[0],Me=re[1],Re=F(Ie,!0),Oe=Re.prefix,Be=Re.local,jr=Oe===""?"":v.ns[Oe]||"",G={name:Ie,value:Me,prefix:Oe,local:Be,uri:jr};Oe&&Oe!=="xmlns"&&!jr&&($(S,"Unbound namespace prefix: "+JSON.stringify(Oe)),G.uri=Oe),S.tag.attributes[Ie]=G,q(S,"onattribute",G)}S.attribList.length=0}S.tag.isSelfClosing=!!p,S.sawRoot=!0,S.tags.push(S.tag),q(S,"onopentag",S.tag),p||(!S.noscript&&S.tagName.toLowerCase()==="script"?S.state=k.SCRIPT:S.state=k.TEXT,S.tag=null,S.tagName=""),S.attribName=S.attribValue="",S.attribList.length=0}function Y(S){if(!S.tagName){$(S,"Weird empty close tag."),S.textNode+="</>",S.state=k.TEXT;return}if(S.script){if(S.tagName!=="script"){S.script+="</"+S.tagName+">",S.tagName="",S.state=k.SCRIPT;return}q(S,"onscript",S.script),S.script=""}var p=S.tags.length,v=S.tagName;S.strict||(v=v[S.looseCase]());for(var x=v;p--;){var O=S.tags[p];if(O.name!==x)$(S,"Unexpected close tag");else break}if(p<0){$(S,"Unmatched closing tag: "+S.tagName),S.textNode+="</"+S.tagName+">",S.state=k.TEXT;return}S.tagName=v;for(var ae=S.tags.length;ae-- >p;){var U=S.tag=S.tags.pop();S.tagName=S.tag.name,q(S,"onclosetag",S.tagName);var re={};for(var Ie in U.ns)re[Ie]=U.ns[Ie];var Me=S.tags[S.tags.length-1]||S;S.opt.xmlns&&U.ns!==Me.ns&&Object.keys(U.ns).forEach(function(Re){var Oe=U.ns[Re];q(S,"onclosenamespace",{prefix:Re,uri:Oe})})}p===0&&(S.closedRoot=!0),S.tagName=S.attribValue=S.attribName="",S.attribList.length=0,S.state=k.TEXT}function J(S){var p=S.entity,v=p.toLowerCase(),x,O="";return S.ENTITIES[p]?S.ENTITIES[p]:S.ENTITIES[v]?S.ENTITIES[v]:(p=v,p.charAt(0)==="#"&&(p.charAt(1)==="x"?(p=p.slice(2),x=parseInt(p,16),O=x.toString(16)):(p=p.slice(1),x=parseInt(p,10),O=x.toString(10))),p=p.replace(/^0+/,""),isNaN(x)||O.toLowerCase()!==p?($(S,"Invalid character entity"),"&"+S.entity+";"):String.fromCodePoint(x))}function ce(S,p){p==="<"?(S.state=k.OPEN_WAKA,S.startTagPosition=S.position):b(p)||($(S,"Non-whitespace before first tag."),S.textNode=p,S.state=k.TEXT)}function Ce(S,p){var v="";return p<S.length&&(v=S.charAt(p)),v}function _e(S){var p=this;if(this.error)throw this.error;if(p.closed)return N(p,"Cannot write after close. Assign an onready handler.");if(S===null)return P(p);typeof S=="object"&&(S=S.toString());for(var v=0,x="";x=Ce(S,v++),p.c=x,!!x;)switch(p.trackPosition&&(p.position++,x===`
`?(p.line++,p.column=0):p.column++),p.state){case k.BEGIN:if(p.state=k.BEGIN_WHITESPACE,x==="\uFEFF")continue;ce(p,x);continue;case k.BEGIN_WHITESPACE:ce(p,x);continue;case k.TEXT:if(p.sawRoot&&!p.closedRoot){for(var O=v-1;x&&x!=="<"&&x!=="&";)x=Ce(S,v++),x&&p.trackPosition&&(p.position++,x===`
`?(p.line++,p.column=0):p.column++);p.textNode+=S.substring(O,v-1)}x==="<"&&!(p.sawRoot&&p.closedRoot&&!p.strict)?(p.state=k.OPEN_WAKA,p.startTagPosition=p.position):(!b(x)&&(!p.sawRoot||p.closedRoot)&&$(p,"Text data outside of root node."),x==="&"?p.state=k.TEXT_ENTITY:p.textNode+=x);continue;case k.SCRIPT:x==="<"?p.state=k.SCRIPT_ENDING:p.script+=x;continue;case k.SCRIPT_ENDING:x==="/"?p.state=k.CLOSE_TAG:(p.script+="<"+x,p.state=k.SCRIPT);continue;case k.OPEN_WAKA:if(x==="!")p.state=k.SGML_DECL,p.sgmlDecl="";else if(!b(x))if(C(_,x))p.state=k.OPEN_TAG,p.tagName=x;else if(x==="/")p.state=k.CLOSE_TAG,p.tagName="";else if(x==="?")p.state=k.PROC_INST,p.procInstName=p.procInstBody="";else{if($(p,"Unencoded <"),p.startTagPosition+1<p.position){var ae=p.position-p.startTagPosition;x=new Array(ae).join(" ")+x}p.textNode+="<"+x,p.state=k.TEXT}continue;case k.SGML_DECL:(p.sgmlDecl+x).toUpperCase()===l?(q(p,"onopencdata"),p.state=k.CDATA,p.sgmlDecl="",p.cdata=""):p.sgmlDecl+x==="--"?(p.state=k.COMMENT,p.comment="",p.sgmlDecl=""):(p.sgmlDecl+x).toUpperCase()===d?(p.state=k.DOCTYPE,(p.doctype||p.sawRoot)&&$(p,"Inappropriately located doctype declaration"),p.doctype="",p.sgmlDecl=""):x===">"?(q(p,"onsgmldeclaration",p.sgmlDecl),p.sgmlDecl="",p.state=k.TEXT):(T(x)&&(p.state=k.SGML_DECL_QUOTED),p.sgmlDecl+=x);continue;case k.SGML_DECL_QUOTED:x===p.q&&(p.state=k.SGML_DECL,p.q=""),p.sgmlDecl+=x;continue;case k.DOCTYPE:x===">"?(p.state=k.TEXT,q(p,"ondoctype",p.doctype),p.doctype=!0):(p.doctype+=x,x==="["?p.state=k.DOCTYPE_DTD:T(x)&&(p.state=k.DOCTYPE_QUOTED,p.q=x));continue;case k.DOCTYPE_QUOTED:p.doctype+=x,x===p.q&&(p.q="",p.state=k.DOCTYPE);continue;case k.DOCTYPE_DTD:p.doctype+=x,x==="]"?p.state=k.DOCTYPE:T(x)&&(p.state=k.DOCTYPE_DTD_QUOTED,p.q=x);continue;case k.DOCTYPE_DTD_QUOTED:p.doctype+=x,x===p.q&&(p.state=k.DOCTYPE_DTD,p.q="");continue;case k.COMMENT:x==="-"?p.state=k.COMMENT_ENDING:p.comment+=x;continue;case k.COMMENT_ENDING:x==="-"?(p.state=k.COMMENT_ENDED,p.comment=Q(p.opt,p.comment),p.comment&&q(p,"oncomment",p.comment),p.comment=""):(p.comment+="-"+x,p.state=k.COMMENT);continue;case k.COMMENT_ENDED:x!==">"?($(p,"Malformed comment"),p.comment+="--"+x,p.state=k.COMMENT):p.state=k.TEXT;continue;case k.CDATA:x==="]"?p.state=k.CDATA_ENDING:p.cdata+=x;continue;case k.CDATA_ENDING:x==="]"?p.state=k.CDATA_ENDING_2:(p.cdata+="]"+x,p.state=k.CDATA);continue;case k.CDATA_ENDING_2:x===">"?(p.cdata&&q(p,"oncdata",p.cdata),q(p,"onclosecdata"),p.cdata="",p.state=k.TEXT):x==="]"?p.cdata+="]":(p.cdata+="]]"+x,p.state=k.CDATA);continue;case k.PROC_INST:x==="?"?p.state=k.PROC_INST_ENDING:b(x)?p.state=k.PROC_INST_BODY:p.procInstName+=x;continue;case k.PROC_INST_BODY:if(!p.procInstBody&&b(x))continue;x==="?"?p.state=k.PROC_INST_ENDING:p.procInstBody+=x;continue;case k.PROC_INST_ENDING:x===">"?(q(p,"onprocessinginstruction",{name:p.procInstName,body:p.procInstBody}),p.procInstName=p.procInstBody="",p.state=k.TEXT):(p.procInstBody+="?"+x,p.state=k.PROC_INST_BODY);continue;case k.OPEN_TAG:C(y,x)?p.tagName+=x:(L(p),x===">"?X(p):x==="/"?p.state=k.OPEN_TAG_SLASH:(b(x)||$(p,"Invalid character in tag name"),p.state=k.ATTRIB));continue;case k.OPEN_TAG_SLASH:x===">"?(X(p,!0),Y(p)):($(p,"Forward-slash in opening tag not followed by >"),p.state=k.ATTRIB);continue;case k.ATTRIB:if(b(x))continue;x===">"?X(p):x==="/"?p.state=k.OPEN_TAG_SLASH:C(_,x)?(p.attribName=x,p.attribValue="",p.state=k.ATTRIB_NAME):$(p,"Invalid attribute name");continue;case k.ATTRIB_NAME:x==="="?p.state=k.ATTRIB_VALUE:x===">"?($(p,"Attribute without value"),p.attribValue=p.attribName,Z(p),X(p)):b(x)?p.state=k.ATTRIB_NAME_SAW_WHITE:C(y,x)?p.attribName+=x:$(p,"Invalid attribute name");continue;case k.ATTRIB_NAME_SAW_WHITE:if(x==="=")p.state=k.ATTRIB_VALUE;else{if(b(x))continue;$(p,"Attribute without value"),p.tag.attributes[p.attribName]="",p.attribValue="",q(p,"onattribute",{name:p.attribName,value:""}),p.attribName="",x===">"?X(p):C(_,x)?(p.attribName=x,p.state=k.ATTRIB_NAME):($(p,"Invalid attribute name"),p.state=k.ATTRIB)}continue;case k.ATTRIB_VALUE:if(b(x))continue;T(x)?(p.q=x,p.state=k.ATTRIB_VALUE_QUOTED):($(p,"Unquoted attribute value"),p.state=k.ATTRIB_VALUE_UNQUOTED,p.attribValue=x);continue;case k.ATTRIB_VALUE_QUOTED:if(x!==p.q){x==="&"?p.state=k.ATTRIB_VALUE_ENTITY_Q:p.attribValue+=x;continue}Z(p),p.q="",p.state=k.ATTRIB_VALUE_CLOSED;continue;case k.ATTRIB_VALUE_CLOSED:b(x)?p.state=k.ATTRIB:x===">"?X(p):x==="/"?p.state=k.OPEN_TAG_SLASH:C(_,x)?($(p,"No whitespace between attributes"),p.attribName=x,p.attribValue="",p.state=k.ATTRIB_NAME):$(p,"Invalid attribute name");continue;case k.ATTRIB_VALUE_UNQUOTED:if(!I(x)){x==="&"?p.state=k.ATTRIB_VALUE_ENTITY_U:p.attribValue+=x;continue}Z(p),x===">"?X(p):p.state=k.ATTRIB;continue;case k.CLOSE_TAG:if(p.tagName)x===">"?Y(p):C(y,x)?p.tagName+=x:p.script?(p.script+="</"+p.tagName,p.tagName="",p.state=k.SCRIPT):(b(x)||$(p,"Invalid tagname in closing tag"),p.state=k.CLOSE_TAG_SAW_WHITE);else{if(b(x))continue;D(_,x)?p.script?(p.script+="</"+x,p.state=k.SCRIPT):$(p,"Invalid tagname in closing tag."):p.tagName=x}continue;case k.CLOSE_TAG_SAW_WHITE:if(b(x))continue;x===">"?Y(p):$(p,"Invalid characters in closing tag");continue;case k.TEXT_ENTITY:case k.ATTRIB_VALUE_ENTITY_Q:case k.ATTRIB_VALUE_ENTITY_U:var U,re;switch(p.state){case k.TEXT_ENTITY:U=k.TEXT,re="textNode";break;case k.ATTRIB_VALUE_ENTITY_Q:U=k.ATTRIB_VALUE_QUOTED,re="attribValue";break;case k.ATTRIB_VALUE_ENTITY_U:U=k.ATTRIB_VALUE_UNQUOTED,re="attribValue";break}if(x===";")if(p.opt.unparsedEntities){var Ie=J(p);p.entity="",p.state=U,p.write(Ie)}else p[re]+=J(p),p.entity="",p.state=U;else C(p.entity.length?g:w,x)?p.entity+=x:($(p,"Invalid character in entity name"),p[re]+="&"+p.entity+x,p.entity="",p.state=U);continue;default:throw new Error(p,"Unknown state: "+p.state)}return p.position>=p.bufferCheckPosition&&n(p),p}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||function(){var S=String.fromCharCode,p=Math.floor,v=function(){var x=16384,O=[],ae,U,re=-1,Ie=arguments.length;if(!Ie)return"";for(var Me="";++re<Ie;){var Re=Number(arguments[re]);if(!isFinite(Re)||Re<0||Re>1114111||p(Re)!==Re)throw RangeError("Invalid code point: "+Re);Re<=65535?O.push(Re):(Re-=65536,ae=(Re>>10)+55296,U=Re%1024+56320,O.push(ae,U)),(re+1===Ie||O.length>x)&&(Me+=S.apply(null,O),O.length=0)}return Me};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:v,configurable:!0,writable:!0}):String.fromCodePoint=v}(),t},P2=R2(),ol=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var L2=class extends cc{constructor(e){super(e);E(this,"tags");E(this,"lc_namespace",["langchain_core","output_parsers"]);E(this,"lc_serializable",!0);this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,r){if(r)return e?Kl(e,r):[{op:"replace",path:"",value:r}]}async parsePartialResult(e){return cl(e[0].text)}async parse(e){return cl(e)}getFormatInstructions(){var r;return!!(this.tags&&this.tags.length>0)?ol.replace("{tags}",((r=this.tags)==null?void 0:r.join(", "))??""):ol}};const D2=t=>t.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),nv=t=>{if(Object.keys(t).length===0)return{};const e={};return t.children.length>0?(e[t.name]=t.children.map(nv),e):(e[t.name]=t.text??void 0,e)};function cl(t){const e=D2(t),r=P2.parser(!0);let n={};const s=[];r.onopentag=o=>{const c={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};s.length>0?s[s.length-1].children.push(c):n=c,o.isSelfClosing||s.push(c)},r.onclosetag=()=>{if(s.length>0){const o=s.pop();s.length===0&&o&&(n=o)}},r.ontext=o=>{if(s.length>0){const c=s[s.length-1];c.text+=o}},r.onattribute=o=>{if(s.length>0){const c=s[s.length-1];c.attributes[o.name]=o.value}};const a=/```(xml)?(.*)```/s.exec(e),i=a?a[2]:e;return r.write(i).close(),n&&n.name==="?xml"&&(n=n.children[0]),nv(n)}var M2={};Ne(M2,{AsymmetricStructuredOutputParser:()=>N2,BaseCumulativeTransformOutputParser:()=>cc,BaseLLMOutputParser:()=>tv,BaseOutputParser:()=>oc,BaseTransformOutputParser:()=>ja,BytesOutputParser:()=>x2,CommaSeparatedListOutputParser:()=>I2,CustomListOutputParser:()=>A2,JsonMarkdownStructuredOutputParser:()=>rv,JsonOutputParser:()=>il,ListOutputParser:()=>Fa,MarkdownListOutputParser:()=>O2,NumberedListOutputParser:()=>k2,OutputParserException:()=>Gr,StringOutputParser:()=>C2,StructuredOutputParser:()=>lo,XMLOutputParser:()=>L2,XML_FORMAT_INSTRUCTIONS:()=>ol,parseJsonMarkdown:()=>vu,parsePartialJson:()=>mo,parseXMLMarkdown:()=>cl});function uc(t,e){if(t.function===void 0)return;let r;if(e!=null&&e.partial)try{r=mo(t.function.arguments??"{}")}catch{return}else try{r=JSON.parse(t.function.arguments)}catch(s){throw new Gr([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:t.function.name,args:r,type:"tool_call"};return e!=null&&e.returnId&&(n.id=t.id),n}function sv(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function ra(t,e){var r,n;return{name:(r=t.function)==null?void 0:r.name,args:(n=t.function)==null?void 0:n.arguments,id:t.id,error:e,type:"invalid_tool_call"}}var av=class extends cc{constructor(e){super(e);E(this,"returnId",!1);E(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);E(this,"lc_serializable",!0);this.returnId=(e==null?void 0:e.returnId)??this.returnId}static lc_name(){return"JsonOutputToolsParser"}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,r=!0){var i;const n=e[0].message;let s;if(_o(n)&&((i=n.tool_calls)!=null&&i.length)?s=n.tool_calls.map(o=>{const{id:c,...u}=o;return this.returnId?{id:c,...u}:u}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(c=>uc(c,{returnId:this.returnId,partial:r}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const c={type:o.name,args:o.args,id:o.id};a.push(c)}return a}},ul=class extends av{constructor(e){super(e);E(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);E(this,"lc_serializable",!0);E(this,"returnId",!1);E(this,"keyName");E(this,"returnSingle",!1);E(this,"zodSchema");this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}static lc_name(){return"JsonOutputKeyToolsParser"}async _validateResult(e){var n;if(this.zodSchema===void 0)return e;const r=await Kg(this.zodSchema,e);if(r.success)return r.data;throw new Gr(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((n=r.error)==null?void 0:n.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}},j2={};Ne(j2,{JsonOutputKeyToolsParser:()=>ul,JsonOutputToolsParser:()=>av,convertLangChainToolCallToOpenAI:()=>sv,makeInvalidToolCall:()=>ra,parseToolCall:()=>uc});var Gd=class extends Zd{constructor(e){var n,s,a,i;super(e??{});E(this,"temperature");E(this,"topP");E(this,"frequencyPenalty");E(this,"presencePenalty");E(this,"n");E(this,"logitBias");E(this,"model","gpt-3.5-turbo");E(this,"modelKwargs");E(this,"stop");E(this,"stopSequences");E(this,"user");E(this,"timeout");E(this,"streaming",!1);E(this,"streamUsage",!0);E(this,"maxTokens");E(this,"logprobs");E(this,"topLogprobs");E(this,"apiKey");E(this,"organization");E(this,"__includeRawResponse");E(this,"client");E(this,"clientConfig");E(this,"supportsStrictToolCalling");E(this,"audio");E(this,"modalities");E(this,"reasoning");E(this,"zdrEnabled");E(this,"service_tier");E(this,"promptCacheKey");E(this,"promptCacheRetention");E(this,"verbosity");E(this,"defaultOptions");E(this,"lc_serializable",!0);const r=typeof((n=e==null?void 0:e.configuration)==null?void 0:n.apiKey)=="string"||typeof((s=e==null?void 0:e.configuration)==null?void 0:s.apiKey)=="function"?(a=e==null?void 0:e.configuration)==null?void 0:a.apiKey:void 0;this.apiKey=(e==null?void 0:e.apiKey)??r??Nr("OPENAI_API_KEY"),this.organization=((i=e==null?void 0:e.configuration)==null?void 0:i.organization)??Nr("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoning=e==null?void 0:e.reasoning,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.promptCacheKey=(e==null?void 0:e.promptCacheKey)??this.promptCacheKey,this.promptCacheRetention=(e==null?void 0:e.promptCacheRetention)??this.promptCacheRetention,this.verbosity=(e==null?void 0:e.verbosity)??this.verbosity,this.disableStreaming=(e==null?void 0:e.disableStreaming)===!0,this.streaming=(e==null?void 0:e.streaming)===!0,this.disableStreaming&&(this.streaming=!1),(e==null?void 0:e.streaming)===!1&&(this.disableStreaming=!0),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),(e==null?void 0:e.service_tier)!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=(e==null?void 0:e.zdrEnabled)??!1}_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","promptCacheKey","promptCacheRetention","verbosity"]}getLsParams(e){const r=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:r.temperature??void 0,ls_max_tokens:r.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}_getReasoningParams(e){if(!Da(this.model))return;let r;return this.reasoning!==void 0&&(r={...r,...this.reasoning}),(e==null?void 0:e.reasoning)!==void 0&&(r={...r,...e.reasoning}),r}_getResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Ir(e.json_schema.schema)?p2(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=rR(n),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,a.defaultHeaders=aR(a.defaultHeaders),this.client=new Ae(a)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,r){return co(e)?yR(e.metadata.customTool):nd(e)?(r==null?void 0:r.strict)!==void 0?{...e,function:{...e.function,strict:r.strict}}:e:cR(e,r)}bindTools(e,r){let n;return(r==null?void 0:r.strict)!==void 0?n=r.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.withConfig({tools:e.map(s=>qd(s)||co(s)?s:dR(s)?s.extras.providerToolDefinition:this._convertChatOpenAIToolToCompletionsTool(s,{strict:n})),...r})}async stream(e,r){return super.stream(e,this._combineCallOptions(r))}async invoke(e,r){return super.invoke(e,this._combineCallOptions(r))}_combineLLMOutput(...e){return e.reduce((r,n)=>(n&&n.tokenUsage&&(r.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,r.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,r.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),r),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let r=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const a=await Promise.all(e.map(async i=>{var h,f,m,_,y,w;const o=await this.getNumTokens(i.content),c=await this.getNumTokens(Ma(i)),u=i.name!==void 0?s+await this.getNumTokens(i.name):0;let l=o+n+c+u;const d=i;if(d._getType()==="function"&&(l-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(l+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(l+=await this.getNumTokens((m=d.additional_kwargs.function_call)==null?void 0:m.name)),(_=d.additional_kwargs.function_call)!=null&&_.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse((y=d.additional_kwargs.function_call)==null?void 0:y.arguments)))}catch(g){console.error("Error parsing function arguments",g,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens((w=d.additional_kwargs.function_call)==null?void 0:w.arguments)}return r+=l,l}));return r+=3,{totalCount:r,countPerMessage:a}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async _getEstimatedTokenCountFromPrompt(e,r,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(r&&n!=="auto"){const a=lR(r);s+=await this.getNumTokens(a),s+=9}return r&&e.find(a=>a._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async moderateContent(e,r){const n=this._getClientOptions(r==null?void 0:r.options),s=(r==null?void 0:r.model)??"omni-moderation-latest",a={input:e,model:s};return this.caller.call(async()=>{try{return await this.client.moderations.create(a,n)}catch(i){throw Bd(i)}})}get profile(){return _2[this.model]??{}}_getStructuredOutputMethod(e){const r={...e};if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"){if((r==null?void 0:r.method)===void 0)return"jsonSchema"}else r.method==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);return r.method}withStructuredOutput(e,r){let n,s;const{schema:a,name:i,includeRaw:o}={...r,schema:e};if((r==null?void 0:r.strict)!==void 0&&r.method==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");const c=f2(this.model,r==null?void 0:r.method);if(c==="jsonMode"){Ir(a)?s=lo.fromZodSchema(a):s=new il;const h=ur(a);n=this.withConfig({outputVersion:"v0",response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:i??"extract",...h}}})}else if(c==="jsonSchema"){const h={name:i??"extract",description:ko(a),schema:a,strict:r==null?void 0:r.strict},f=ur(h.schema);if(n=this.withConfig({outputVersion:"v0",response_format:{type:"json_schema",json_schema:h},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:h.name,description:h.description,...f}}}),Ir(a)){const m=lo.fromZodSchema(a);s=Yr.from(_=>"parsed"in _.additional_kwargs?_.additional_kwargs.parsed:m)}else s=new il}else{let h=i??"extract";if(Ir(a)){const f=ur(a);n=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:h,...f}},...(r==null?void 0:r.strict)!==void 0?{strict:r.strict}:{}}),s=new ul({returnSingle:!0,keyName:h,zodSchema:a})}else{let f;typeof a.name=="string"&&typeof a.parameters=="object"&&a.parameters!=null?(f=a,h=a.name):(h=a.title??h,f={name:h,description:a.description??"",parameters:a});const m=ur(a);n=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:h,...m}},...(r==null?void 0:r.strict)!==void 0?{strict:r.strict}:{}}),s=new ul({returnSingle:!0,keyName:h})}}if(!o)return n.pipe(s);const u=ys.assign({parsed:(h,f)=>s.invoke(h.raw,f)}),l=ys.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[l]});return Na.from([{raw:n},d])}};const iv={providerName:"ChatOpenAI",fromStandardTextBlock(t){return{type:"text",text:t.text}},fromStandardImageBlock(t){var e,r;if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url,...(e=t.metadata)!=null&&e.detail?{detail:t.metadata.detail}:{}}};if(t.source_type==="base64")return{type:"image_url",image_url:{url:`data:${t.mime_type??""};base64,${t.data}`,...(r=t.metadata)!=null&&r.detail?{detail:t.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(t){if(t.source_type==="url"){const e=ca({dataUrl:t.url});if(!e)throw new Error(`URL audio blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);const r=e.mime_type||t.mime_type||"";let n;try{n=yu(r)}catch{throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(n.type!=="audio"||n.subtype!=="wav"&&n.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:n.subtype,data:e.data}}}if(t.source_type==="base64"){let e;try{e=yu(t.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:t.data}}}throw new Error(`Audio content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(t){var e,r,n,s,a;if(t.source_type==="url"){const i=ca({dataUrl:t.url}),o=io(t);if(!i)throw new Error(`URL file blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:t.url,...(e=t.metadata)!=null&&e.filename||(r=t.metadata)!=null&&r.name?{filename:o}:{}}}}if(t.source_type==="base64"){const i=io(t);return{type:"file",file:{file_data:`data:${t.mime_type??""};base64,${t.data}`,...(n=t.metadata)!=null&&n.filename||(s=t.metadata)!=null&&s.name||(a=t.metadata)!=null&&a.title?{filename:i}:{}}}}if(t.source_type==="id")return{type:"file",file:{file_id:t.id}};throw new Error(`File content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)}},F2=({message:t,rawResponse:e,includeRawResponse:r})=>{var s,a;const n=t.tool_calls;switch(t.role){case"assistant":{const i=[],o=[];for(const d of n??[])try{i.push(uc(d,{returnId:!0}))}catch(h){o.push(ra(d,h.message))}const c={function_call:t.function_call,tool_calls:n};r!==void 0&&(c.__raw_response=e);const u={model_provider:"openai",model_name:e.model,...e.system_fingerprint?{usage:{...e.usage},system_fingerprint:e.system_fingerprint}:{}};t.audio&&(c.audio=t.audio);const l=m2(t.content||"",(a=(s=e.choices)==null?void 0:s[0])==null?void 0:a.message);return new It({content:l,tool_calls:i,invalid_tool_calls:o,additional_kwargs:c,response_metadata:u,id:e.id})}default:return new qn(t.content||"",t.role??"unknown")}},U2=({delta:t,rawResponse:e,includeRawResponse:r,defaultRole:n})=>{var c,u;const s=t.role??n,a=t.content??"";let i;t.function_call?i={function_call:t.function_call}:t.tool_calls?i={tool_calls:t.tool_calls}:i={},r&&(i.__raw_response=e),t.audio&&(i.audio={...t.audio,index:e.choices[0].index});const o={model_provider:"openai",usage:{...e.usage}};if(s==="user")return new Sa({content:a,response_metadata:o});if(s==="assistant"){const l=[];if(Array.isArray(t.tool_calls))for(const d of t.tool_calls)l.push({name:(c=d.function)==null?void 0:c.name,args:(u=d.function)==null?void 0:u.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new Mr({content:a,tool_call_chunks:l,additional_kwargs:i,id:e.id,response_metadata:o})}else return s==="system"?new mn({content:a,response_metadata:o}):s==="developer"?new mn({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Ta({content:a,additional_kwargs:i,name:t.name,response_metadata:o}):s==="tool"?new wa({content:a,additional_kwargs:i,tool_call_id:t.tool_call_id,response_metadata:o}):new Ea({content:a,role:s,response_metadata:o})},B2=t=>{if(t.type==="image"){if(t.url)return{type:"image_url",image_url:{url:t.url}};if(t.data)return{type:"image_url",image_url:{url:`data:${t.mimeType};base64,${t.data}`}}}if(t.type==="audio"&&t.data){const e=Nm(()=>{const[,r]=t.mimeType.split("/");return r==="wav"||r==="mp3"?r:"wav"});return{type:"input_audio",input_audio:{data:t.data.toString(),format:e}}}if(t.type==="file"){if(t.data){const e=io(t);return{type:"file",file:{file_data:`data:${t.mimeType};base64,${t.data}`,filename:e}}}if(t.fileId)return{type:"file",file:{file_id:t.fileId}}}},z2=({message:t,model:e})=>{let r=Ma(t);if(r==="system"&&Da(e)&&(r="developer"),r==="developer")return{role:"developer",content:t.contentBlocks.filter(s=>s.type==="text")};if(r==="system")return{role:"system",content:t.contentBlocks.filter(s=>s.type==="text")};if(r==="assistant")return{role:"assistant",content:t.contentBlocks.filter(s=>s.type==="text")};if(r==="tool"&&pr.isInstance(t))return{role:"tool",tool_call_id:t.tool_call_id,content:t.contentBlocks.filter(s=>s.type==="text")};if(r==="function")return{role:"function",name:t.name??"",content:t.contentBlocks.filter(s=>s.type==="text").join("")};function*n(s){for(const a of s){a.type==="text"&&(yield{type:"text",text:a.text});const i=B2(a);i&&(yield i)}}return{role:"user",content:Array.from(n(t.contentBlocks))}},Jp=({messages:t,model:e})=>t.flatMap(r=>{var i,o;if("output_version"in r.response_metadata&&((i=r.response_metadata)==null?void 0:i.output_version)==="v1")return z2({message:r});let n=Ma(r);n==="system"&&Da(e)&&(n="developer");const s=typeof r.content=="string"?r.content:r.content.map(c=>Rr(c)?vl(c,iv):c),a={role:n,content:s};if(r.name!=null&&(a.name=r.name),r.additional_kwargs.function_call!=null&&(a.function_call=r.additional_kwargs.function_call),It.isInstance(r)&&((o=r.tool_calls)!=null&&o.length)?a.tool_calls=r.tool_calls.map(sv):(r.additional_kwargs.tool_calls!=null&&(a.tool_calls=r.additional_kwargs.tool_calls),pr.isInstance(r)&&r.tool_call_id!=null&&(a.tool_call_id=r.tool_call_id)),r.additional_kwargs.audio&&typeof r.additional_kwargs.audio=="object"&&"id"in r.additional_kwargs.audio){const c={role:"assistant",audio:{id:r.additional_kwargs.audio.id}};return[a,c]}return a});var q2=class extends Gd{invocationParams(t,e){var i;let r;(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let n={};(t==null?void 0:t.stream_options)!==void 0?n={stream_options:t.stream_options}:this.streamUsage&&(this.streaming||e!=null&&e.streaming)&&(n={stream_options:{include_usage:!0}});const s={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(t==null?void 0:t.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:t==null?void 0:t.functions,function_call:t==null?void 0:t.function_call,tools:(i=t==null?void 0:t.tools)!=null&&i.length?t.tools.map(o=>this._convertChatOpenAIToolToCompletionsTool(o,{strict:r})):void 0,tool_choice:J0(t==null?void 0:t.tool_choice),response_format:this._getResponseFormat(t==null?void 0:t.response_format),seed:t==null?void 0:t.seed,...n,parallel_tool_calls:t==null?void 0:t.parallel_tool_calls,...this.audio||t!=null&&t.audio?{audio:this.audio||(t==null?void 0:t.audio)}:{},...this.modalities||t!=null&&t.modalities?{modalities:this.modalities||(t==null?void 0:t.modalities)}:{},...this.modelKwargs,prompt_cache_key:(t==null?void 0:t.promptCacheKey)??this.promptCacheKey,prompt_cache_retention:(t==null?void 0:t.promptCacheRetention)??this.promptCacheRetention,verbosity:(t==null?void 0:t.verbosity)??this.verbosity};(t==null?void 0:t.prediction)!==void 0&&(s.prediction=t.prediction),this.service_tier!==void 0&&(s.service_tier=this.service_tier),(t==null?void 0:t.service_tier)!==void 0&&(s.service_tier=t.service_tier);const a=this._getReasoningParams(t);return a!==void 0&&a.effort!==void 0&&(s.reasoning_effort=a.effort),Da(s.model)?s.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:s.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,s}async _generate(t,e,r){var i,o;const n={},s=this.invocationParams(e),a=Jp({messages:t,model:this.model});if(s.stream){const c=this._streamResponseChunks(t,e,r),u={};for await(const _ of c){_.message.response_metadata={..._.generationInfo,..._.message.response_metadata};const y=((i=_.generationInfo)==null?void 0:i.completion)??0;u[y]===void 0?u[y]=_:u[y]=u[y].concat(_)}const l=Object.entries(u).sort(([_],[y])=>parseInt(_,10)-parseInt(y,10)).map(([_,y])=>y),{functions:d,function_call:h}=this.invocationParams(e),f=await this._getEstimatedTokenCountFromPrompt(t,d,h),m=await this._getNumTokensFromGenerations(l);return n.input_tokens=f,n.output_tokens=m,n.total_tokens=f+m,{generations:l,llmOutput:{estimatedTokenUsage:{promptTokens:n.input_tokens,completionTokens:n.output_tokens,totalTokens:n.total_tokens}}}}else{const c=await this.completionWithRetry({...s,stream:!1,messages:a},{signal:e==null?void 0:e.signal,...e==null?void 0:e.options}),{completion_tokens:u,prompt_tokens:l,total_tokens:d,prompt_tokens_details:h,completion_tokens_details:f}=(c==null?void 0:c.usage)??{};u&&(n.output_tokens=(n.output_tokens??0)+u),l&&(n.input_tokens=(n.input_tokens??0)+l),d&&(n.total_tokens=(n.total_tokens??0)+d),((h==null?void 0:h.audio_tokens)!==null||(h==null?void 0:h.cached_tokens)!==null)&&(n.input_token_details={...(h==null?void 0:h.audio_tokens)!==null&&{audio:h==null?void 0:h.audio_tokens},...(h==null?void 0:h.cached_tokens)!==null&&{cache_read:h==null?void 0:h.cached_tokens}}),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.reasoning_tokens)!==null)&&(n.output_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.reasoning_tokens)!==null&&{reasoning:f==null?void 0:f.reasoning_tokens}});const m=[];for(const _ of(c==null?void 0:c.choices)??[]){const w={text:((o=_.message)==null?void 0:o.content)??"",message:this._convertCompletionsMessageToBaseMessage(_.message??{role:"assistant"},c)};w.generationInfo={..._.finish_reason?{finish_reason:_.finish_reason}:{},..._.logprobs?{logprobs:_.logprobs}:{}},_o(w.message)&&(w.message.usage_metadata=n),w.message=new It(Object.fromEntries(Object.entries(w.message).filter(([g])=>!g.startsWith("lc_")))),m.push(w)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:n.input_tokens,completionTokens:n.output_tokens,totalTokens:n.total_tokens}}}}}async*_streamResponseChunks(t,e,r){var c,u,l,d,h,f,m,_,y,w;const n=Jp({messages:t,model:this.model}),s={...this.invocationParams(e,{streaming:!0}),messages:n,stream:!0};let a;const i=await this.completionWithRetry(s,e);let o;for await(const g of i){const b=(c=g==null?void 0:g.choices)==null?void 0:c[0];if(g.usage&&(o=g.usage),!b)continue;const{delta:T}=b;if(!T)continue;const I=this._convertCompletionsDeltaToBaseMessageChunk(T,g,a);a=T.role??a;const C={prompt:e.promptIndex??0,completion:b.index??0};if(typeof I.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const D={...C};b.finish_reason!=null&&(D.finish_reason=b.finish_reason,D.system_fingerprint=g.system_fingerprint,D.model_name=g.model,D.service_tier=g.service_tier),this.logprobs&&(D.logprobs=b.logprobs);const k=new ps({message:I,text:I.content,generationInfo:D});yield k,await(r==null?void 0:r.handleLLMNewToken(k.text??"",C,void 0,void 0,void 0,{chunk:k}))}if(o){const g={...((u=o.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(l=o.prompt_tokens_details)==null?void 0:l.audio_tokens},...((d=o.prompt_tokens_details)==null?void 0:d.cached_tokens)!==null&&{cache_read:(h=o.prompt_tokens_details)==null?void 0:h.cached_tokens}},b={...((f=o.completion_tokens_details)==null?void 0:f.audio_tokens)!==null&&{audio:(m=o.completion_tokens_details)==null?void 0:m.audio_tokens},...((_=o.completion_tokens_details)==null?void 0:_.reasoning_tokens)!==null&&{reasoning:(y=o.completion_tokens_details)==null?void 0:y.reasoning_tokens}};yield new ps({message:new Mr({content:"",response_metadata:{usage:{...o}},usage_metadata:{input_tokens:o.prompt_tokens,output_tokens:o.completion_tokens,total_tokens:o.total_tokens,...Object.keys(g).length>0&&{input_token_details:g},...Object.keys(b).length>0&&{output_token_details:b}}}),text:""})}if((w=e.signal)!=null&&w.aborted)throw new Error("AbortError")}async completionWithRetry(t,e){const r=this._getClientOptions(e),n=t.response_format&&t.response_format.type==="json_schema";return this.caller.call(async()=>{try{return n&&!t.stream?await this.client.chat.completions.parse(t,r):await this.client.chat.completions.create(t,r)}catch(s){throw Bd(s)}})}_convertCompletionsDeltaToBaseMessageChunk(t,e,r){return U2({delta:t,rawResponse:e,includeRawResponse:this.__includeRawResponse,defaultRole:r})}_convertCompletionsMessageToBaseMessage(t,e){return F2({message:t,rawResponse:e,includeRawResponse:this.__includeRawResponse})}};const is="__openai_function_call_ids__",ov=t=>{var n,s,a,i;const e={...((n=t==null?void 0:t.input_tokens_details)==null?void 0:n.cached_tokens)!=null&&{cache_read:(s=t==null?void 0:t.input_tokens_details)==null?void 0:s.cached_tokens}},r={...((a=t==null?void 0:t.output_tokens_details)==null?void 0:a.reasoning_tokens)!=null&&{reasoning:(i=t==null?void 0:t.output_tokens_details)==null?void 0:i.reasoning_tokens}};return{input_tokens:(t==null?void 0:t.input_tokens)??0,output_tokens:(t==null?void 0:t.output_tokens)??0,total_tokens:(t==null?void 0:t.total_tokens)??0,input_token_details:e,output_token_details:r}},cv=t=>{if(t.error){const o=new Error(t.error.message);throw o.name=t.error.code,o}let e;const r=[],n=[],s=[],a={model_provider:"openai",model:t.model,created_at:t.created_at,id:t.id,incomplete_details:t.incomplete_details,metadata:t.metadata,object:t.object,status:t.status,user:t.user,service_tier:t.service_tier,model_name:t.model},i={};for(const o of t.output)if(o.type==="message")e=o.id,r.push(...o.content.flatMap(c=>c.type==="output_text"?("parsed"in c&&c.parsed!=null&&(i.parsed=c.parsed),{type:"text",text:c.text,annotations:c.annotations}):c.type==="refusal"?(i.refusal=c.refusal,[]):c));else if(o.type==="function_call"){const c={function:{name:o.name,arguments:o.arguments},id:o.call_id};try{n.push(uc(c,{returnId:!0}))}catch(u){let l;typeof u=="object"&&u!=null&&"message"in u&&typeof u.message=="string"&&(l=u.message),s.push(ra(c,l))}i[is]??(i[is]={}),o.id&&(i[is][o.call_id]=o.id)}else if(o.type==="reasoning")i.reasoning=o;else if(o.type==="custom_tool_call"){const c=hR(o);c?n.push(c):s.push(ra(o,"Malformed custom tool call"))}else if(o.type==="computer_call"){const c=pR(o);c?n.push(c):s.push(ra(o,"Malformed computer call"))}else i.tool_outputs??(i.tool_outputs=[]),i.tool_outputs.push(o);return new It({id:e,content:r,tool_calls:n,invalid_tool_calls:s,usage_metadata:ov(t.usage),additional_kwargs:i,response_metadata:a})},Z2=t=>{const e=(t.summary.length>1?t.summary.reduce((r,n)=>{const s=r[r.length-1];return s.index===n.index?s.text+=n.text:r.push(n),r},[{...t.summary[0]}]):t.summary).map(r=>Object.fromEntries(Object.entries(r).filter(([n])=>n!=="index")));return{...t,summary:e}},G2=t=>{var c,u;const e=[];let r={},n;const s=[],a={model_provider:"openai"},i={};let o;if(t.type==="response.output_text.delta")e.push({type:"text",text:t.delta,index:t.content_index});else if(t.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[t.annotation],index:t.content_index});else if(t.type==="response.output_item.added"&&t.item.type==="message")o=t.item.id;else if(t.type==="response.output_item.added"&&t.item.type==="function_call")s.push({type:"tool_call_chunk",name:t.item.name,args:t.item.arguments,id:t.item.call_id,index:t.output_index}),i[is]={[t.item.call_id]:t.item.id};else if(t.type==="response.output_item.done"&&t.item.type==="computer_call")s.push({type:"tool_call_chunk",name:"computer_use",args:JSON.stringify({action:t.item.action}),id:t.item.call_id,index:t.output_index}),i.tool_outputs=[t.item];else if(t.type==="response.output_item.done"&&["web_search_call","file_search_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(t.item.type))i.tool_outputs=[t.item];else if(t.type==="response.created")a.id=t.response.id,a.model_name=t.response.model,a.model=t.response.model;else if(t.type==="response.completed"){const l=cv(t.response);n=ov(t.response.usage),((u=(c=t.response.text)==null?void 0:c.format)==null?void 0:u.type)==="json_schema"&&(i.parsed??(i.parsed=JSON.parse(l.text)));for(const[d,h]of Object.entries(t.response))d!=="id"&&(a[d]=h)}else if(t.type==="response.function_call_arguments.delta"||t.type==="response.custom_tool_call_input.delta")s.push({type:"tool_call_chunk",args:t.delta,index:t.output_index});else if(t.type==="response.web_search_call.completed"||t.type==="response.file_search_call.completed")r={tool_outputs:{id:t.item_id,type:t.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(t.type==="response.refusal.done")i.refusal=t.refusal;else if(t.type==="response.output_item.added"&&"item"in t&&t.item.type==="reasoning"){const l=t.item.summary?t.item.summary.map((d,h)=>({...d,index:h})):void 0;i.reasoning={id:t.item.id,type:t.item.type,...l?{summary:l}:{}}}else if(t.type==="response.reasoning_summary_part.added")i.reasoning={type:"reasoning",summary:[{...t.part,index:t.summary_index}]};else if(t.type==="response.reasoning_summary_text.delta")i.reasoning={type:"reasoning",summary:[{text:t.delta,type:"summary_text",index:t.summary_index}]};else return t.type==="response.image_generation_call.partial_image",null;return new ps({text:e.map(l=>l.text).join(""),message:new Mr({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:i,response_metadata:a}),generationInfo:r})},V2=t=>{var n;const e=It.isInstance(t)&&((n=t.response_metadata)==null?void 0:n.model_provider)==="openai";function*r(){const s=Dn(()=>{try{const g=Ma(t);return g==="system"||g==="developer"||g==="assistant"||g==="user"?g:"assistant"}catch{return"assistant"}});let a;const i=new Set,o=new Set,c=new Map,u=new Map;function*l(){if(!a)return;const g=a.content;(typeof g=="string"&&g.length>0||Array.isArray(g)&&g.length>0)&&(yield a),a=void 0}const d=g=>{a||(a={type:"message",role:s,content:[]}),typeof a.content=="string"?a.content=a.content.length>0?[{type:"input_text",text:a.content},...g]:[...g]:a.content.push(...g)},h=g=>{if(typeof g=="string")return g;try{return JSON.stringify(g??{})}catch{return"{}"}},f=g=>{const b=Dn(()=>{var I;const T=(I=g.metadata)==null?void 0:I.detail;return T==="low"||T==="high"||T==="auto"?T:"auto"});if(g.fileId)return{type:"input_image",detail:b,file_id:g.fileId};if(g.url)return{type:"input_image",detail:b,image_url:g.url};if(g.data){const T=typeof g.data=="string"?g.data:Buffer.from(g.data).toString("base64"),I=g.mimeType??"image/png";return{type:"input_image",detail:b,image_url:`data:${I};base64,${T}`}}},m=g=>{const b=io(g);if(g.fileId&&typeof b=="string")return{type:"input_file",file_id:g.fileId,...b?{filename:b}:{}};if(g.url&&typeof b=="string")return{type:"input_file",file_url:g.url,...b?{filename:b}:{}};if(g.data&&typeof b=="string"){const T=typeof g.data=="string"?g.data:Buffer.from(g.data).toString("base64");return{type:"input_file",file_data:`data:${g.mimeType??"application/octet-stream"};base64,${T}`,...b?{filename:b}:{}}}},_=g=>{const b=Dn(()=>{if(Array.isArray(g.summary)){const C=g.summary,D=(C==null?void 0:C.map(k=>k==null?void 0:k.text).filter(k=>typeof k=="string"))??[];if(D.length>0)return D}return g.reasoning?[g.reasoning]:[]}),T=b.length>0?b.map(C=>({type:"summary_text",text:C})):[{type:"summary_text",text:""}],I={type:"reasoning",id:g.id??"",summary:T};return g.reasoning&&(I.content=[{type:"reasoning_text",text:g.reasoning}]),I},y=g=>({type:"function_call",name:g.name??"",call_id:g.id??"",arguments:h(g.args)}),w=g=>{const b=h(g.output),T=g.status==="success"?"completed":g.status==="error"?"incomplete":void 0;return{type:"function_call_output",call_id:g.toolCallId??"",output:b,...T?{status:T}:{}}};for(const g of t.contentBlocks)if(g.type==="text")d([{type:"input_text",text:g.text}]);else if(g.type!=="invalid_tool_call"){if(g.type==="reasoning")yield*l(),yield _(g);else if(g.type==="tool_call"){yield*l();const b=g.id??"";b&&(i.add(b),c.delete(b)),yield y(g)}else if(g.type==="tool_call_chunk"){if(g.id){const b=c.get(g.id)??{name:g.name,args:[]};g.name&&(b.name=g.name),g.args&&b.args.push(g.args),c.set(g.id,b)}}else if(g.type==="server_tool_call"){yield*l();const b=g.id??"";b&&(o.add(b),u.delete(b)),yield y(g)}else if(g.type==="server_tool_call_chunk"){if(g.id){const b=u.get(g.id)??{name:g.name,args:[]};g.name&&(b.name=g.name),g.args&&b.args.push(g.args),u.set(g.id,b)}}else if(g.type==="server_tool_call_result")yield*l(),yield w(g);else if(g.type!=="audio")if(g.type==="file"){const b=m(g);b&&d([b])}else if(g.type==="image"){const b=f(g);b&&d([b])}else if(g.type==="video"){const b=m(g);b&&d([b])}else g.type==="text-plain"?g.text&&d([{type:"input_text",text:g.text}]):g.type==="non_standard"&&e&&(yield*l(),yield g.value)}yield*l();for(const[g,b]of c){if(!g||i.has(g))continue;const T=b.args.join("");!b.name&&!T||(yield{type:"function_call",call_id:g,name:b.name??"",arguments:T})}for(const[g,b]of u){if(!g||o.has(g))continue;const T=b.args.join("");!b.name&&!T||(yield{type:"function_call",call_id:g,name:b.name??"",arguments:T})}}return Array.from(r())},Kp=({messages:t,zdrEnabled:e,model:r})=>t.flatMap(n=>{var o,c,u,l;const s=n.response_metadata;if((s==null?void 0:s.output_version)==="v1")return V2(n);const a=n.additional_kwargs;let i=Ma(n);if(i==="system"&&Da(r)&&(i="developer"),i==="function")throw new Error("Function messages are not supported in Responses API");if(i==="tool"){const d=n;if((a==null?void 0:a.type)==="computer_call_output")return{type:"computer_call_output",output:(()=>{if(typeof d.content=="string")return{type:"input_image",image_url:d.content};if(Array.isArray(d.content)){const m=d.content.find(w=>w.type==="input_image");if(m)return m;const _=d.content.find(w=>w.type==="computer_screenshot");if(_)return _;const y=d.content.find(w=>w.type==="image_url");if(y)return{type:"input_image",image_url:typeof y.image_url=="string"?y.image_url:y.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:d.tool_call_id};if((o=d.additional_kwargs)!=null&&o.customTool)return{type:"custom_tool_call_output",call_id:d.tool_call_id,output:d.content};const h=Array.isArray(d.content)&&d.content.every(f=>typeof f=="object"&&f!==null&&"type"in f&&(f.type==="input_file"||f.type==="input_image"||f.type==="input_text"));return{type:"function_call_output",call_id:d.tool_call_id,id:(c=d.id)!=null&&c.startsWith("fc_")?d.id:void 0,output:h?d.content:typeof d.content!="string"?JSON.stringify(d.content):d.content}}if(i==="assistant"){if(!e&&(s==null?void 0:s.output)!=null&&Array.isArray(s==null?void 0:s.output)&&(s==null?void 0:s.output.length)>0&&(s!=null&&s.output.every(y=>"type"in y)))return s==null?void 0:s.output;const d=[];if(a!=null&&a.reasoning&&!e){const y=Z2(a.reasoning);d.push(y)}let{content:h}=n;a!=null&&a.refusal&&(typeof h=="string"&&(h=[{type:"output_text",text:h,annotations:[]}]),h=[...h,{type:"refusal",refusal:a.refusal}]),(typeof h=="string"||h.length>0)&&d.push({type:"message",role:"assistant",...n.id&&!e&&n.id.startsWith("msg_")?{id:n.id}:{},content:Dn(()=>typeof h=="string"?h:h.flatMap(y=>y.type==="text"?{type:"output_text",text:y.text,annotations:y.annotations??[]}:y.type==="output_text"||y.type==="refusal"?y:[]))});const f=a==null?void 0:a[is];It.isInstance(n)&&((u=n.tool_calls)!=null&&u.length)?d.push(...n.tool_calls.map(y=>gR(y)?{type:"custom_tool_call",id:y.call_id,call_id:y.id??"",input:y.args.input,name:y.name}:mR(y)?{type:"computer_call",id:y.call_id,call_id:y.id??"",action:y.args.action}:{type:"function_call",name:y.name,arguments:JSON.stringify(y.args),call_id:y.id,...e?{}:{id:f==null?void 0:f[y.id]}})):a!=null&&a.tool_calls&&d.push(...a.tool_calls.map(y=>({type:"function_call",name:y.function.name,call_id:y.id,arguments:y.function.arguments,...e?{}:{id:f==null?void 0:f[y.id]}})));const m=(l=s==null?void 0:s.output)!=null&&l.length?s==null?void 0:s.output:a.tool_outputs,_=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(m!=null){const y=m,w=y==null?void 0:y.filter(g=>_.includes(g.type));w.length>0&&d.push(...w)}return d}if(i==="user"||i==="system"||i==="developer"){if(typeof n.content=="string")return{type:"message",role:i,content:n.content};const d=[],h=n.content.flatMap(f=>{if(f.type==="mcp_approval_response"&&d.push({type:"mcp_approval_response",approval_request_id:f.approval_request_id,approve:f.approve}),Rr(f))return vl(f,iv);if(f.type==="text")return{type:"input_text",text:f.text};if(f.type==="image_url"){const m=Dn(()=>{if(typeof f.image_url=="string")return f.image_url;if(typeof f.image_url=="object"&&f.image_url!==null&&"url"in f.image_url)return f.image_url.url}),_=Dn(()=>{if(typeof f.image_url=="string")return"auto";if(typeof f.image_url=="object"&&f.image_url!==null&&"detail"in f.image_url)return f.image_url.detail});return{type:"input_image",image_url:m,detail:_}}return f.type==="input_text"||f.type==="input_image"||f.type==="input_file"?f:[]});return h.length>0&&d.push({type:"message",role:i,content:h}),d}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${i}`),[]});var H2=class extends Gd{invocationParams(t){var s;let e;(t==null?void 0:t.strict)!==void 0&&(e=t.strict),e===void 0&&this.supportsStrictToolCalling!==void 0&&(e=this.supportsStrictToolCalling);const r={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:t==null?void 0:t.previous_response_id,truncation:t==null?void 0:t.truncation,include:t==null?void 0:t.include,tools:(s=t==null?void 0:t.tools)!=null&&s.length?this._reduceChatOpenAITools(t.tools,{stream:this.streaming,strict:e}):void 0,tool_choice:fR(t==null?void 0:t.tool_choice)?t==null?void 0:t.tool_choice:(()=>{const a=J0(t==null?void 0:t.tool_choice);if(typeof a=="object"&&"type"in a){if(a.type==="function")return{type:"function",name:a.function.name};if(a.type==="allowed_tools")return{type:"allowed_tools",mode:a.allowed_tools.mode,tools:a.allowed_tools.tools};if(a.type==="custom")return{type:"custom",name:a.custom.name}}})(),text:(()=>{if(t!=null&&t.text)return t.text;const a=this._getResponseFormat(t==null?void 0:t.response_format);return(a==null?void 0:a.type)==="json_schema"?a.json_schema.schema!=null?{format:{type:"json_schema",schema:a.json_schema.schema,description:a.json_schema.description,name:a.json_schema.name,strict:a.json_schema.strict},verbosity:t==null?void 0:t.verbosity}:void 0:{format:a,verbosity:t==null?void 0:t.verbosity}})(),parallel_tool_calls:t==null?void 0:t.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,prompt_cache_key:(t==null?void 0:t.promptCacheKey)??this.promptCacheKey,prompt_cache_retention:(t==null?void 0:t.promptCacheRetention)??this.promptCacheRetention,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},n=this._getReasoningParams(t);return n!==void 0&&(r.reasoning=n),r}async _generate(t,e,r){var s;const n=this.invocationParams(e);if(n.stream){const a=this._streamResponseChunks(t,e,r);let i;for await(const o of a)o.message.response_metadata={...o.generationInfo,...o.message.response_metadata},i=(i==null?void 0:i.concat(o))??o;return{generations:i?[i]:[],llmOutput:{estimatedTokenUsage:(s=i==null?void 0:i.message)==null?void 0:s.usage_metadata}}}else{const a=await this.completionWithRetry({input:Kp({messages:t,zdrEnabled:this.zdrEnabled??!1,model:this.model}),...n,stream:!1},{signal:e==null?void 0:e.signal,...e==null?void 0:e.options});return{generations:[{text:a.output_text,message:cv(a)}],llmOutput:{id:a.id,estimatedTokenUsage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.total_tokens}:void 0}}}}async*_streamResponseChunks(t,e,r){const n=await this.completionWithRetry({...this.invocationParams(e),input:Kp({messages:t,zdrEnabled:this.zdrEnabled??!1,model:this.model}),stream:!0},e);for await(const s of n){const a=G2(s);a!=null&&(yield a,await(r==null?void 0:r.handleLLMNewToken(a.text||"",{prompt:e.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:a})))}}async completionWithRetry(t,e){return this.caller.call(async()=>{var n,s;const r=this._getClientOptions(e);try{return((s=(n=t.text)==null?void 0:n.format)==null?void 0:s.type)==="json_schema"&&!t.stream?await this.client.responses.parse(t,r):await this.client.responses.create(t,r)}catch(a){throw Bd(a)}})}_reduceChatOpenAITools(t,e){const r=[];for(const n of t)if(qd(n))n.type==="image_generation"&&(e!=null&&e.stream)&&(n.partial_images=1),r.push(n);else if(co(n)){const s=n.metadata.customTool;r.push({type:"custom",name:s.name,description:s.description,format:s.format})}else nd(n)?r.push({type:"function",name:n.function.name,parameters:n.function.parameters,description:n.function.description,strict:(e==null?void 0:e.strict)??null}):K0(n)&&r.push(_R(n));return r}},W2=class uv extends Gd{constructor(r){super(r);E(this,"useResponsesApi",!1);E(this,"responses");E(this,"completions");this.fields=r,this.useResponsesApi=(r==null?void 0:r.useResponsesApi)??!1,this.responses=(r==null?void 0:r.responses)??new H2(r),this.completions=(r==null?void 0:r.completions)??new q2(r)}get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}get callKeys(){return[...super.callKeys,"useResponsesApi"]}_useResponsesApi(r){var i,o,c,u,l;const n=(i=r==null?void 0:r.tools)==null?void 0:i.some(qd),s=(r==null?void 0:r.previous_response_id)!=null||(r==null?void 0:r.text)!=null||(r==null?void 0:r.truncation)!=null||(r==null?void 0:r.include)!=null||((o=r==null?void 0:r.reasoning)==null?void 0:o.summary)!=null||((c=this.reasoning)==null?void 0:c.summary)!=null,a=((u=r==null?void 0:r.tools)==null?void 0:u.some(K0))||((l=r==null?void 0:r.tools)==null?void 0:l.some(co));return this.useResponsesApi||n||s||a||tR(this.model)}getLsParams(r){const n=this._combineCallOptions(r);return this._useResponsesApi(r)?this.responses.getLsParams(n):this.completions.getLsParams(n)}invocationParams(r){const n=this._combineCallOptions(r);return this._useResponsesApi(r)?this.responses.invocationParams(n):this.completions.invocationParams(n)}async _generate(r,n,s){return this._useResponsesApi(n)?this.responses._generate(r,n):this.completions._generate(r,n,s)}async*_streamResponseChunks(r,n,s){if(this._useResponsesApi(n)){yield*this.responses._streamResponseChunks(r,this._combineCallOptions(n),s);return}yield*this.completions._streamResponseChunks(r,this._combineCallOptions(n),s)}withConfig(r){const n=new uv(this.fields);return n.defaultOptions={...this.defaultOptions,...r},n}},J2={};Ne(J2,{BaseLLM:()=>lv,LLM:()=>K2});var lv=class Zs extends ad{constructor(){super(...arguments);E(this,"lc_namespace",["langchain","llms",this._llmType()])}async invoke(r,n){const s=Zs._convertInputToPromptValue(r);return(await this.generatePrompt([s],n,n==null?void 0:n.callbacks)).generations[0][0].text}async*_streamResponseChunks(r,n,s){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(r){const[n,s]=super._separateRunnableConfigFromCallOptions(r);return s.signal=n.signal,[n,s]}async*_streamIterator(r,n){if(this._streamResponseChunks===Zs.prototype._streamResponseChunks)yield this.invoke(r,n);else{const s=Zs._convertInputToPromptValue(r),[a,i]=this._separateRunnableConfigFromCallOptionsCompat(n),o=await Pt.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),c={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},u=await(o==null?void 0:o.handleLLMStart(this.toJSON(),[s.toString()],a.runId,void 0,c,void 0,void 0,a.runName));let l=new hs({text:""});try{for await(const d of this._streamResponseChunks(s.toString(),i,u==null?void 0:u[0]))l?l=l.concat(d):l=d,typeof d.text=="string"&&(yield d.text)}catch(d){throw await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[l]]})))}}async generatePrompt(r,n,s){const a=r.map(i=>i.toString());return this.generate(a,n,s)}invocationParams(r){return{}}_flattenLLMResult(r){const n=[];for(let s=0;s<r.generations.length;s+=1){const a=r.generations[s];if(s===0)n.push({generations:[a],llmOutput:r.llmOutput});else{const i=r.llmOutput?{...r.llmOutput,tokenUsage:{}}:void 0;n.push({generations:[a],llmOutput:i})}}return n}async _generateUncached(r,n,s,a){let i;if(a!==void 0&&a.length===r.length)i=a;else{const l=await Pt.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),d={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:r.length};i=await(l==null?void 0:l.handleLLMStart(this.toJSON(),r,s.runId,void 0,d,void 0,void 0,s==null?void 0:s.runName))}const o=!!(i!=null&&i[0].handlers.find(Nl));let c;if(o&&r.length===1&&this._streamResponseChunks!==Zs.prototype._streamResponseChunks)try{const l=await this._streamResponseChunks(r[0],n,i==null?void 0:i[0]);let d;for await(const h of l)d===void 0?d=h:d=yn(d,h);if(d===void 0)throw new Error("Received empty response from chat model call.");c={generations:[[d]],llmOutput:{}},await(i==null?void 0:i[0].handleLLMEnd(c))}catch(l){throw await(i==null?void 0:i[0].handleLLMError(l)),l}else{try{c=await this._generate(r,n,i==null?void 0:i[0])}catch(d){throw await Promise.all((i??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}const l=this._flattenLLMResult(c);await Promise.all((i??[]).map((d,h)=>d==null?void 0:d.handleLLMEnd(l[h])))}const u=(i==null?void 0:i.map(l=>l.runId))||void 0;return Object.defineProperty(c,_a,{value:u?{runIds:u}:void 0,configurable:!0}),c}async _generateCached({prompts:r,cache:n,llmStringKey:s,parsedOptions:a,handledOptions:i,runId:o}){const c=await Pt.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:r.length},l=await(c==null?void 0:c.handleLLMStart(this.toJSON(),r,o,void 0,u,void 0,void 0,i==null?void 0:i.runName)),d=[],f=(await Promise.allSettled(r.map(async(y,w)=>{const g=await n.lookup(y,s);return g==null&&d.push(w),g}))).map((y,w)=>({result:y,runManager:l==null?void 0:l[w]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),m=[];await Promise.all(f.map(async({result:y,runManager:w},g)=>{if(y.status==="fulfilled"){const b=y.value;return m[g]=b.map(T=>(T.generationInfo={...T.generationInfo,tokenUsage:{}},T)),b.length&&await(w==null?void 0:w.handleLLMNewToken(b[0].text)),w==null?void 0:w.handleLLMEnd({generations:[b]},void 0,void 0,void 0,{cached:!0})}else return await(w==null?void 0:w.handleLLMError(y.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(y.reason)}));const _={generations:m,missingPromptIndices:d,startedRunManagers:l};return Object.defineProperty(_,_a,{value:l?{runIds:l==null?void 0:l.map(y=>y.runId)}:void 0,configurable:!0}),_}async generate(r,n,s){if(!Array.isArray(r))throw new Error("Argument 'prompts' is expected to be a string[]");let a;Array.isArray(n)?a={stop:n}:a=n;const[i,o]=this._separateRunnableConfigFromCallOptionsCompat(a);if(i.callbacks=i.callbacks??s,!this.cache)return this._generateUncached(r,o,i);const{cache:c}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({prompts:r,cache:c,llmStringKey:u,parsedOptions:o,handledOptions:i,runId:i.runId});let f={};if(d.length>0){const m=await this._generateUncached(d.map(_=>r[_]),o,i,h!==void 0?d.map(_=>h==null?void 0:h[_]):void 0);await Promise.all(m.generations.map(async(_,y)=>{const w=d[y];return l[w]=_,c.update(r[w],u,_)})),f=m.llmOutput??{}}return{generations:l,llmOutput:f}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},K2=class extends lv{async _generate(t,e,r){return{generations:await Promise.all(t.map((s,a)=>this._call(s,{...e,promptIndex:a},r).then(i=>[{text:i}])))}}},X2={};Ne(X2,{chunkArray:()=>Y2});const Y2=(t,e)=>t.reduce((r,n,s)=>{const a=Math.floor(s/e),i=r[a]||[];return r[a]=i.concat([n]),r},[]);var Q2={};Ne(Q2,{Embeddings:()=>e8});var e8=class{constructor(t){E(this,"caller");this.caller=new Ca(t??{})}};const t8=bt({type:Vt("screenshot")}),r8=bt({type:Vt("click"),x:yt(),y:yt(),button:ld(["left","right","wheel","back","forward"]).default("left")}),n8=bt({type:Vt("double_click"),x:yt(),y:yt(),button:ld(["left","right","wheel","back","forward"]).default("left")}),s8=bt({type:Vt("drag"),path:$a(bt({x:yt(),y:yt()}))}),a8=bt({type:Vt("keypress"),keys:$a(Ut())}),i8=bt({type:Vt("move"),x:yt(),y:yt()}),o8=bt({type:Vt("scroll"),x:yt(),y:yt(),scroll_x:yt(),scroll_y:yt()}),c8=bt({type:Vt("type"),text:Ut()}),u8=bt({type:Vt("wait"),duration:yt().optional()}),l8=ud("type",[t8,r8,n8,s8,a8,i8,o8,c8,u8]);bt({action:l8});const d8=bt({type:Vt("exec"),command:$a(Ut()),env:DO(Ut(),Ut()).optional(),working_directory:Ut().optional(),timeout_ms:yt().optional(),user:Ut().optional()});ud("type",[d8]);bt({commands:$a(Ut()).describe("Array of shell commands to execute"),timeout_ms:yt().optional().describe("Optional timeout in milliseconds for the commands"),max_output_length:yt().optional().describe("Optional maximum number of characters to return from each command")});const f8=bt({type:Vt("create_file"),path:Ut(),diff:Ut()}),h8=bt({type:Vt("update_file"),path:Ut(),diff:Ut()}),p8=bt({type:Vt("delete_file"),path:Ut()});ud("type",[f8,h8,p8]);const m8=/^---\r?\n([\s\S]*?)\r?\n---(?:\r?\n([\s\S]*))?/;function g8(t){const e=t.split(/\r?\n/);let r,n;for(let s=0;s<e.length;s++){const a=e[s],i=a.match(/^\s*name:\s*(.*)$/);if(i){r=i[1].trim().replace(/^["']|["']$/g,"");continue}const o=a.match(/^\s*description:\s*(.*)$/);if(o){const c=[o[1].trim().replace(/^["']|["']$/g,"")];for(;s+1<e.length;){const u=e[s+1];if(u.match(/^[ \t]+\S/))c.push(u.trim()),s++;else break}n=c.filter(Boolean).join(" ");continue}}return r!==void 0&&n!==void 0?{name:r,description:n}:null}async function Xp(t){var e;try{const n=(await Jt.readFile(t,"utf-8")).match(m8);if(!n)return console.warn(`Invalid skill file (no frontmatter): ${t}`),null;const s=g8(n[1]);return s?{name:s.name,description:s.description,location:t,body:((e=n[2])==null?void 0:e.trim())??""}:(console.warn(`Invalid skill frontmatter: ${t}`),null)}catch(r){return console.error(`Error loading skill from ${t}:`,r),null}}async function Yp(t){const e=[];try{const r=Bt.resolve(t),n=await Jt.stat(r).catch(()=>null);if(!n||!n.isDirectory())return[];const s=await Jt.readdir(r,{withFileTypes:!0});for(const a of s){const i=Bt.join(r,a.name);if(a.isFile()&&a.name==="SKILL.md"){const o=await Xp(i);o&&e.push(o)}else if(a.isDirectory()){const o=Bt.join(i,"SKILL.md"),c=await Xp(o);c&&e.push(c)}}}catch(r){console.error(`Error discovering skills in ${t}:`,r)}return e}function _8(){const t=process.env.HOME||process.env.USERPROFILE||"";return Bt.join(t,".redconvert","skills")}function y8(t){return Bt.join(t,".agent","skills")}class v8{constructor(){E(this,"skills",[]);E(this,"activeSkillNames",new Set);E(this,"disabledSkillNames",new Set)}async discoverSkills(e){this.skills=[];const r=await this.discoverBuiltinSkills();this.addSkillsWithPrecedence(r.map(a=>({...a,isBuiltin:!0})));const n=_8(),s=await Yp(n);if(this.addSkillsWithPrecedence(s),e){const a=y8(e),i=await Yp(a);this.addSkillsWithPrecedence(i)}for(const a of this.skills)a.disabled=this.disabledSkillNames.has(a.name.toLowerCase())}async discoverBuiltinSkills(){return[]}addSkillsWithPrecedence(e){const r=new Map(this.skills.map(n=>[n.name.toLowerCase(),n]));for(const n of e){const s=n.name.toLowerCase(),a=r.get(s);a&&a.location!==n.location&&console.log(`Skill "${n.name}" from "${n.location}" is overriding the skill from "${a.location}".`),r.set(s,n)}this.skills=Array.from(r.values())}getSkills(){return this.skills.filter(e=>!e.disabled)}getAllSkills(){return this.skills}getSkill(e){const r=e.toLowerCase();return this.skills.find(n=>n.name.toLowerCase()===r)??null}activateSkill(e){const r=this.getSkill(e);return!r||r.disabled?null:(this.activeSkillNames.add(e.toLowerCase()),`<activated_skill name="${r.name}">
<description>${r.description}</description>
<location>${r.location}</location>
<instructions>
${r.body}
</instructions>
</activated_skill>`)}isSkillActive(e){return this.activeSkillNames.has(e.toLowerCase())}getActiveSkills(){return this.skills.filter(e=>this.activeSkillNames.has(e.name.toLowerCase()))}resetActiveSkills(){this.activeSkillNames.clear()}setDisabledSkills(e){this.disabledSkillNames=new Set(e.map(r=>r.toLowerCase()));for(const r of this.skills)r.disabled=this.disabledSkillNames.has(r.name.toLowerCase())}getSkillsXml(){const e=this.getSkills();return e.length===0?"":`
# Available Agent Skills

You have access to the following specialized skills. To activate a skill and receive its detailed instructions, you can call the \`activate_skill\` tool with the skill's name.

<available_skills>
${e.map(n=>`  <skill>
    <name>${n.name}</name>
    <description>${n.description}</description>
    <location>${n.location}</location>
  </skill>`).join(`
`)}
</available_skills>
`}}function b8(t){const{skills:e,tools:r,activatedSkillContent:n,interactive:s=!0,customRules:a}=t,i=[];return i.push(w8(s)),i.push(E8(s,e.length>0)),i.push(T8(r)),e.length>0&&i.push(S8(e)),n&&i.push(n),i.push(x8(s)),a&&i.push(`
# Custom Rules

${a}`),i.push(I8()),i.join(`

`)}function w8(t){return`You are ${t?"an interactive":"a non-interactive"} AI assistant specializing in software engineering and general tasks. Your primary goal is to help users safely and efficiently, adhering strictly to the following instructions and utilizing your available tools.`}function E8(t,e){let r=`# Core Mandates

- **Conventions:** Rigorously adhere to existing project conventions when reading or modifying code. Analyze surrounding code, tests, and configuration first.
- **Libraries/Frameworks:** NEVER assume a library/framework is available. Verify its established usage within the project before employing it.
- **Style & Structure:** Mimic the style, structure, and patterns of existing code in the project.
- **Idiomatic Changes:** When editing, understand the local context to ensure your changes integrate naturally.
- **Comments:** Add code comments sparingly. Focus on *why* something is done, rather than *what* is done. Do not edit comments that are separate from the code you are changing.
- **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, consider adding tests.`;return t?r+=`
- **Confirm Ambiguity:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.`:r+=`
- **Handle Ambiguity:** Do not take significant actions beyond the clear scope of the request.`,r+=`
- **Explaining Changes:** After completing a code modification *do not* provide summaries unless asked.
- **Do Not Revert:** Do not revert changes unless explicitly asked by the user.`,e&&(r+="\n- **Skill Guidance:** Once a skill is activated via `activate_skill`, its instructions are returned wrapped in `<activated_skill>` tags. You MUST treat the content within `<instructions>` as expert procedural guidance, prioritizing these specialized rules for the duration of the task."),r}function T8(t){const e=t.map(a=>a.name),r=t.filter(a=>a.kind===Cr.Read).map(a=>a.name),n=t.filter(a=>a.kind===Cr.Edit).map(a=>a.name),s=t.filter(a=>a.kind===Cr.Execute).map(a=>a.name);return`# Tool Usage

You have access to the following tools: ${e.join(", ")}.

## Guidelines

- **Parallelism:** Execute multiple independent tool calls in parallel when feasible.
- **Read Before Edit:** Always use read tools (${r.join(", ")||"reading tools"}) to understand context before making changes.
- **Confirm Sensitive Actions:** Tools that modify files (${n.join(", ")||"edit tools"}) or execute commands (${s.join(", ")||"command tools"}) may require user confirmation.
- **Handle Errors Gracefully:** If a tool call fails, analyze the error and try an alternative approach.
- **Limit Output:** When executing commands that produce verbose output, consider filtering or limiting the output.`}function S8(t){return`# Available Skills

You have access to specialized skills. To activate a skill and receive its detailed instructions, call the \`activate_skill\` tool with the skill's name.

<available_skills>
${t.filter(r=>!r.disabled).map(r=>`  <skill>
    <name>${r.name}</name>
    <description>${r.description}</description>
  </skill>`).join(`
`)}
</available_skills>

When a skill seems relevant to the user's request, activate it to receive expert guidance.`}function x8(t){let e=`# Operational Guidelines

## Tone and Style
- **Concise & Direct:** Be professional and direct.
- **Minimal Output:** Focus on the user's query without unnecessary explanations.
- **Clarity over Brevity:** When needed, prioritize clarity for essential explanations.
- **No Chitchat:** Avoid conversational filler. Get straight to the action.

## Formatting
- Use Markdown for formatting responses.
- Use code blocks with language specification for code.
- Use bullet points for lists.

## Security and Safety
- **Explain Critical Commands:** Before executing commands that modify the system, provide a brief explanation.
- **Security First:** Never introduce code that exposes secrets, API keys, or sensitive information.
- **Respect Cancellations:** If a user cancels a tool call, respect their choice.`;return t&&(e+=`

## Interactive Mode
- Ask clarifying questions when the request is ambiguous.
- Confirm significant changes before executing them.
- Provide progress updates for long-running tasks.`),e}function I8(){return`# Final Reminder

Your core function is efficient and safe assistance. Balance conciseness with clarity, especially for safety and system modifications. Always prioritize user control and project conventions. Never make assumptions about file contentsverify first. You are an agentkeep going until the user's query is completely resolved.`}class A8{constructor(e,r){E(this,"toolRegistry");E(this,"toolExecutor");E(this,"skillManager");E(this,"config");E(this,"onEvent");E(this,"abortController",null);E(this,"pendingConfirmations",new Map);E(this,"activatedSkillContent","");this.config=e,this.onEvent=r,this.toolRegistry=new eb;const n=j$();this.toolRegistry.registerTools(n),this.toolExecutor=new tb(this.toolRegistry,this.handleConfirmRequest.bind(this)),this.skillManager=new v8}async initialize(){await this.skillManager.discoverSkills(this.config.projectRoot)}async run(e){this.abortController=new AbortController;const r=this.abortController.signal;try{this.onEvent({type:"thinking",content:"Processing your request..."});const n=this.createLLM(),s=b8({skills:this.skillManager.getSkills(),tools:this.toolRegistry.getAllTools(),activatedSkillContent:this.activatedSkillContent,interactive:!0}),a=[new Wr(s),new Dr(e)];let i=0;const o=this.config.maxTurns||20,c=Date.now(),u=(this.config.maxTimeMinutes||10)*60*1e3;for(;i<o;){if(Date.now()-c>u){this.onEvent({type:"error",message:"Agent execution timed out"});break}if(r.aborted){this.onEvent({type:"error",message:"Agent execution cancelled"});break}i++;const l=await n.invoke(a);if(l.tool_calls&&l.tool_calls.length>0){a.push(l);const h=await this.executeToolCalls(l.tool_calls,r);for(const f of h)a.push(new pr({tool_call_id:f.callId,content:f.result.llmContent}));continue}const d=typeof l.content=="string"?l.content:JSON.stringify(l.content);this.onEvent({type:"response_chunk",content:d}),this.onEvent({type:"response_end",content:d});break}this.onEvent({type:"done"})}catch(n){const s=n instanceof Error?n.message:String(n);this.onEvent({type:"error",message:s})}finally{this.abortController=null}}async executeToolCalls(e,r){const n=[];for(const s of e){const a=s.id||Math.random().toString(36).substring(7),i=this.toolRegistry.getTool(s.name);if(this.onEvent({type:"tool_start",callId:a,name:s.name,params:s.args,description:(i==null?void 0:i.getDescription(s.args))||`Calling ${s.name}`}),s.name==="activate_skill"){const l=s.args.name,d=await this.handleActivateSkill(l,a);n.push(d);continue}const o={callId:a,name:s.name,params:s.args},c=l=>{this.onEvent({type:"tool_output",callId:a,chunk:l})},u=await this.toolExecutor.execute(o,r,c);this.onEvent({type:"tool_end",callId:a,name:s.name,result:{success:u.result.success,content:u.result.display||u.result.llmContent}}),n.push(u)}return n}async handleActivateSkill(e,r){const n=Date.now(),s=this.skillManager.activateSkill(e);if(!s)return{callId:r,name:"activate_skill",result:{success:!1,llmContent:`Skill "${e}" not found or is disabled.`},durationMs:Date.now()-n};this.activatedSkillContent=s;const a=this.skillManager.getSkill(e);return this.onEvent({type:"skill_activated",name:e,description:(a==null?void 0:a.description)||""}),{callId:r,name:"activate_skill",result:{success:!0,llmContent:s},durationMs:Date.now()-n}}async handleConfirmRequest(e,r,n,s){return new Promise(a=>{this.pendingConfirmations.set(e,{callId:e,resolve:a}),this.onEvent({type:"tool_confirm_request",callId:e,name:r.name,details:s}),setTimeout(()=>{this.pendingConfirmations.has(e)&&(this.pendingConfirmations.delete(e),a(im.Cancel))},6e4)})}confirmToolCall(e,r){const n=this.pendingConfirmations.get(e);n&&(this.pendingConfirmations.delete(e),n.resolve(r))}cancel(){this.abortController&&this.abortController.abort()}createLLM(){const e=this.toolRegistry.getToolSchemas(),r={name:"activate_skill",description:"Activate a skill to receive expert guidance for a specific task. Use this when a skill seems relevant to the user's request.",parameters:{type:"object",properties:{name:{type:"string",description:"The name of the skill to activate"}},required:["name"]}},n=[...e,r];return new W2({modelName:this.config.model,apiKey:this.config.apiKey,configuration:{baseURL:this.config.baseURL},temperature:this.config.temperature??.7,streaming:!1}).bindTools(n)}getToolRegistry(){return this.toolRegistry}getSkillManager(){return this.skillManager}}async function k8(t,e){const r=new A8(t,e);return await r.initialize(),r}process.env.DIST=cn.join(__dirname,"../dist");process.env.VITE_PUBLIC=xt.app.isPackaged?process.env.DIST:cn.join(process.env.DIST,"../public");let nn;const Qp=process.env.VITE_DEV_SERVER_URL;function dv(){const t=process.env.VITE_PUBLIC||cn.join(__dirname,"../public");if(nn=new xt.BrowserWindow({icon:cn.join(t,"electron-vite.svg"),webPreferences:{preload:cn.join(__dirname,"preload.js")},width:1200,height:800,backgroundColor:"#FFFFFF",titleBarStyle:"hiddenInset"}),nn.webContents.on("did-finish-load",()=>{nn==null||nn.webContents.send("main-process-message",new Date().toLocaleString())}),Qp)nn.loadURL(Qp);else{const e=process.env.DIST||cn.join(__dirname,"../dist");nn.loadFile(cn.join(e,"index.html"))}}xt.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(xt.app.quit(),nn=null)});xt.app.on("activate",()=>{xt.BrowserWindow.getAllWindows().length===0&&dv()});xt.app.whenReady().then(dv);xt.ipcMain.handle("db:save-settings",(t,e)=>Av(e));xt.ipcMain.handle("db:get-settings",()=>rm());xt.ipcMain.handle("ai:fetch-models",async(t,{apiKey:e,baseURL:r})=>{try{const n=`${r}/models`,s=await fetch(n,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch models: ${s.statusText}`);return(await s.json()).data||[]}catch(n){const s=n instanceof Error?n.message:String(n);throw new Error(s)}});let Mn=null;xt.ipcMain.on("ai:start-chat",async(t,e,r)=>{const n=t.sender,s=rm()||{},a={apiKey:(r==null?void 0:r.apiKey)||s.api_key||"",baseURL:(r==null?void 0:r.baseURL)||s.api_endpoint||"",model:(r==null?void 0:r.modelName)||s.model_name||"",projectRoot:process.cwd(),maxTurns:20,maxTimeMinutes:10,temperature:.7};if(!a.apiKey){n.send("ai:error","API Key is missing. Please configure it in Settings.");return}if(!a.model){n.send("ai:error","Model Name is missing. Please configure a default model in Settings.");return}try{Mn=await k8(a,i=>{switch(i.type){case"thinking":n.send("ai:stream-event",{type:"stage_start",data:{stage:"thinking",content:i.content}});break;case"tool_start":n.send("ai:stream-event",{type:"tool_start",data:{callId:i.callId,name:i.name,input:i.params,description:i.description}});break;case"tool_end":n.send("ai:stream-event",{type:"tool_end",data:{callId:i.callId,name:i.name,output:i.result}});break;case"tool_confirm_request":n.send("ai:tool-confirm-request",{callId:i.callId,name:i.name,details:i.details});break;case"response_chunk":n.send("ai:stream-event",{type:"token_stream",data:{content:i.content}});break;case"skill_activated":n.send("ai:stream-event",{type:"skill_activated",data:{name:i.name,description:i.description}});break;case"error":n.send("ai:error",i.message);break;case"done":n.send("ai:stream-end");break}}),await Mn.run(e)}catch(i){const o=i instanceof Error?i.message:"Unknown error occurred";n.send("ai:error",o)}finally{Mn=null}});xt.ipcMain.on("ai:confirm-tool",(t,e,r)=>{if(Mn){const{ToolConfirmationOutcome:n}=require("./core/toolRegistry"),s=r?n.ProceedOnce:n.Cancel;Mn.confirmToolCall(e,s)}});xt.ipcMain.on("ai:cancel",()=>{Mn&&Mn.cancel()});xt.ipcMain.handle("skills:list",async()=>{try{const{SkillManager:t}=require("./core/skillManager"),e=new t;return await e.discoverSkills(process.cwd()),e.getAllSkills()}catch(t){return console.error("Failed to list skills:",t),[]}});
